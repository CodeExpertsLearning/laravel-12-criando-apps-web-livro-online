<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Livro: Laravel 12 - Criando Aplicações Web</title>

    <meta property="og:locale" content="pt_BR" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Livro: Laravel 12, Aprenda Laravel Hoje Mesmo!" />
    <meta
      property="og:description"
      content="Livro Laravel 12, Aprenda Laravel Hoje Mesmo!"
    />
    <meta
      property="og:url"
      content="https://laravel.codeexperts.com.br/"
    />
    <meta property="og:site_name" content="Code Experts, Livro Laravel 12" />
    <meta
      property="og:image"
      content="/resources/social.png"
    />
    <meta name="twitter:card" content="summary_large_image" />

    <meta
      name="twitter:description"
      content="Livro Laravel 12, Aprenda Laravel Hoje Mesmo!"
    />

    <meta name="twitter:title" content="Livro: Laravel 12, Aprenda Laravel Hoje Mesmo!" />
    <meta name="twitter:site" content="@Code_Experts" />
    <meta name="twitter:domain" content="Code_Experts" />
    <meta
      name="twitter:image"
      content="/resources/social.png"
    />
  <link href="stylesheet.css?v=1.1" rel="stylesheet" />
  <link rel="icon" type="image/ico" href="/favicon.ico">
</head>

<body dir="" class="markua010" id="top">

<div class="topBuy">
  <a href="https://book.codeexperts.com.br/" target="_blank">Adquira Sua Cópia Aqui</a>
</div>
  
<div class="backToTop">
  <a href="#top">Voltar ao Topo</a>
</div>
<div id="leanpub-toc">
<h2>Índice</h2>
<ol class="toc">
<ul class='toc no-parts'>
  <li>
    <a href='#leanpub-auto-quem-somos'>Quem Somos</a>
    <ul>
      <li>
        <a href='#leanpub-auto-nanderson-castro'>Nanderson Castro</a>
      </li>
      <li>
        <a href='#leanpub-auto-code-experts'>Code Experts</a>
      </li>
      <li>
        <a href='#leanpub-auto-a-loja-virou-a-plataforma'>A loja virou a plataforma!</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-para-quem--este-livro'>Para quem é este livro?</a>
  </li>
  <li>
    <a href='#leanpub-auto-repositrio-com-os-cdigos'>Repositório com os códigos</a>
  </li>
  <li>
    <a href='#leanpub-auto-caso-queira-contribuir'>Caso queira contribuir</a>
  </li>
  <li>
    <a href='#leanpub-auto-laravel'>Laravel</a>
    <ul>
      <li>
        <a href='#leanpub-auto-laravel-12'>Laravel 12</a>
      </li>
      <li>
        <a href='#leanpub-auto-obtendo-o-laravel'>Obtendo o Laravel</a>
      </li>
      <li>
        <a href='#leanpub-auto-iniciando-primeiro-projeto'>Iniciando Primeiro Projeto</a>
      </li>
      <li>
        <a href='#leanpub-auto-conhecendo-a-estrutura-do-laravel'>Conhecendo a estrutura do Laravel</a>
      </li>
      <li>
        <a href='#leanpub-auto-laravel-artisan-cli'>Laravel: Artisan CLI</a>
      </li>
      <li>
        <a href='#leanpub-auto-executando-a-aplicao'>Executando a Aplicação</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-hello-world-com-laravel'>Hello World com Laravel</a>
    <ul>
      <li>
        <a href='#leanpub-auto-mvc'>MVC</a>
      </li>
      <li>
        <a href='#leanpub-auto-roteiro-para-nosso-primeiro-hello-world'>Roteiro para nosso primeiro Hello World</a>
      </li>
      <li>
        <a href='#leanpub-auto-iniciando-hello-world'>Iniciando Hello World</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-1'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-rotas--controllers'>Rotas &amp; Controllers</a>
    <ul>
      <li>
        <a href='#leanpub-auto-rotas'>Rotas</a>
      </li>
      <li>
        <a href='#leanpub-auto-controllers'>Controllers</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-2'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-formulrios-request--response'>Formulários, Request &amp; Response</a>
    <ul>
      <li>
        <a href='#leanpub-auto-iniciando-pelo-formulrio'>Iniciando pelo formulário</a>
      </li>
      <li>
        <a href='#leanpub-auto-request-manipulando-requisies'>Request, manipulando requisições</a>
      </li>
      <li>
        <a href='#leanpub-auto-manipulando-os-dados-da-requisio'>Manipulando os dados da requisição</a>
      </li>
      <li>
        <a href='#leanpub-auto-response-manipulando-respostas'>Response: manipulando respostas</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-3'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-database-migrations-seeds--factories'>Database: Migrations, Seeds &amp; Factories</a>
    <ul>
      <li>
        <a href='#leanpub-auto-migrations'>Migrations</a>
      </li>
      <li>
        <a href='#leanpub-auto-executando-primeira-migrao'>Executando primeira migração</a>
      </li>
      <li>
        <a href='#leanpub-auto-criando-nossas-migraes'>Criando Nossas Migrações</a>
      </li>
      <li>
        <a href='#leanpub-auto-seeds'>Seeds</a>
      </li>
      <li>
        <a href='#leanpub-auto-factories'>Factories</a>
      </li>
      <li>
        <a href='#leanpub-auto-model-factories-com-seeds'>Model Factories com Seeds</a>
      </li>
      <li>
        <a href='#leanpub-auto-migrations-revertendo-coisas'>Migrations! Revertendo coisas!</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-4'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-eloquent-trabalhando-com-models'>Eloquent, trabalhando com Models</a>
    <ul>
      <li>
        <a href='#leanpub-auto-os-models'>Os Models!</a>
      </li>
      <li>
        <a href='#leanpub-auto-eloquent'>Eloquent?</a>
      </li>
      <li>
        <a href='#leanpub-auto-eloquent-na-prtica'>Eloquent na prática</a>
      </li>
      <li>
        <a href='#leanpub-auto-inserindo-dados-com-eloquent'>Inserindo dados com Eloquent</a>
      </li>
      <li>
        <a href='#leanpub-auto-mass-assignment'>Mass Assignment</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-5'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-blade-template-engine-do-laravel'>Blade, Template Engine do Laravel</a>
    <ul>
      <li>
        <a href='#leanpub-auto-layouts'>Layouts</a>
      </li>
      <li>
        <a href='#leanpub-auto-laos-de-repetio--condicionais'>Laços de Repetição &amp; Condicionais</a>
      </li>
      <li>
        <a href='#leanpub-auto-paginao-na-view'>Paginação na View</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-6'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-relacionamentos-com-eloquent'>Relacionamentos com Eloquent</a>
    <ul>
      <li>
        <a href='#leanpub-auto-relacionamento-1n-um-para-muitos-e-inverso'>Relacionamento 1:N (Um para Muitos e Inverso)</a>
      </li>
      <li>
        <a href='#leanpub-auto-manytomany-com-eloquent-categorias-e-produtos'>ManyToMany com Eloquent: Categorias e Produtos</a>
      </li>
      <li>
        <a href='#leanpub-auto-crud-de-categorias'>CRUD de Categorias</a>
      </li>
      <li>
        <a href='#leanpub-auto-alteraes-em-productcontroller'>Alterações em ProductController</a>
      </li>
      <li>
        <a href='#leanpub-auto-inserindo-muitos-para-muitos-product-x-category'>Inserindo Muitos para Muitos (Product x Category)</a>
      </li>
      <li>
        <a href='#leanpub-auto-alterando-rea-de-produtos-para-insero-nn'>Alterando área de Produtos para Inserção N:N</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-7'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-autenticao'>Autenticação</a>
    <ul>
      <li>
        <a href='#leanpub-auto-logando-usurios'>Logando usuários</a>
      </li>
      <li>
        <a href='#leanpub-auto-sessions-no-laravel'>Sessions no Laravel</a>
      </li>
      <li>
        <a href='#leanpub-auto-criando-nosso-login'>Criando nosso login</a>
      </li>
      <li>
        <a href='#leanpub-auto-vamos-ao-logout'>Vamos ao logout</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-8'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-validao'>Validação</a>
    <ul>
      <li>
        <a href='#leanpub-auto-form-request-e-validaes'>Form Request e Validações</a>
      </li>
      <li>
        <a href='#leanpub-auto-montando-regras-de-validao'>Montando Regras de Validação</a>
      </li>
      <li>
        <a href='#leanpub-auto-usando-o-form-request'>Usando o Form Request</a>
      </li>
      <li>
        <a href='#leanpub-auto-exibindo-validaes-nas-views-blade'>Exibindo validações nas Views Blade</a>
      </li>
      <li>
        <a href='#leanpub-auto-exibindo-validaes-nos-formulrio'>Exibindo validações nos formulário</a>
      </li>
      <li>
        <a href='#leanpub-auto-validao-em-categorias'>Validação em Categorias</a>
      </li>
      <li>
        <a href='#leanpub-auto-mensagens-de-erro'>Mensagens de erro</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-9'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-upload-de-arquivos'>Upload de Arquivos</a>
    <ul>
      <li>
        <a href='#leanpub-auto-conhecendo-upload-no-laravel'>Conhecendo Upload no Laravel</a>
      </li>
      <li>
        <a href='#leanpub-auto-upload-fotos-produto'>Upload Fotos Produto</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-10'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-criando-front-da-experts-store'>Criando Front da Experts Store</a>
    <ul>
      <li>
        <a href='#leanpub-auto-antes-falemos-de-blade-tag-componentes-ou-componentes'>Antes, falemos de Blade Tag Componentes ou Componentes</a>
      </li>
      <li>
        <a href='#leanpub-auto-componentes-slots'>Componentes: Slots</a>
      </li>
      <li>
        <a href='#leanpub-auto-componente-para-layout-front-loja'>Componente para Layout Front Loja</a>
      </li>
      <li>
        <a href='#leanpub-auto-laravel--vite'>Laravel &amp; Vite</a>
      </li>
      <li>
        <a href='#leanpub-auto-nosso-front-home--single-produto'>Nosso Front: Home &amp; Single Produto</a>
      </li>
      <li>
        <a href='#leanpub-auto-mutators--accessors'>Mutators &amp; Accessors</a>
      </li>
      <li>
        <a href='#leanpub-auto-nossas-views-home--single-produto'>Nossas Views: Home &amp; Single Produto</a>
      </li>
      <li>
        <a href='#leanpub-auto-nosso-carrinho'>Nosso Carrinho</a>
      </li>
      <li>
        <a href='#leanpub-auto-produtos-por-categorias'>Produtos por Categorias</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-11'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-container-de-servios-laravel'>Container de Serviços Laravel</a>
    <ul>
      <li>
        <a href='#leanpub-auto-di-injeo-de-dependncias'>DI (Injeção de Dependências)</a>
      </li>
      <li>
        <a href='#leanpub-auto-container-de-servios'>Container de Serviços</a>
      </li>
      <li>
        <a href='#leanpub-auto-laravel-service-providers'>Laravel Service Providers</a>
      </li>
      <li>
        <a href='#leanpub-auto-checkout-finalizando-compra'>Checkout, finalizando compra</a>
      </li>
      <li>
        <a href='#leanpub-auto-rotas-e-views-checkout'>Rotas e Views Checkout</a>
      </li>
      <li>
        <a href='#leanpub-auto-cadastro-cliente--concluindo-processo-de-checkout'>Cadastro cliente &amp; Concluindo Processo de Checkout</a>
      </li>
      <li>
        <a href='#leanpub-auto-prosseguindo-pra-finalizao-do-checkout'>Prosseguindo pra Finalização do Checkout</a>
      </li>
      <li>
        <a href='#leanpub-auto-pedidos-orders-do-cliente'>Pedidos (Orders) do Cliente</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-12'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-acl--eventos'>ACL &amp; Eventos</a>
    <ul>
      <li>
        <a href='#leanpub-auto-laravel-autorizao'>Laravel: Autorização</a>
      </li>
      <li>
        <a href='#leanpub-auto-como-vamos-controlar-nosso-acesso'>Como vamos controlar nosso acesso</a>
      </li>
      <li>
        <a href='#leanpub-auto-eventos'>Eventos</a>
      </li>
      <li>
        <a href='#leanpub-auto-cancelando-pedido-do-usurio'>Cancelando pedido do usuário</a>
      </li>
      <li>
        <a href='#leanpub-auto-pra-finalizar'>Pra Finalizar</a>
      </li>
      <li>
        <a href='#leanpub-auto-eloquent-casts'>Eloquent Casts</a>
      </li>
      <li>
        <a href='#leanpub-auto-concluses-13'>Conclusões</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='#leanpub-auto-continue-em-contato-conosco'>Continue em contato conosco</a>
  </li>
</ul>

</ol>
</div>
<div id="leanpub-main" class="markua010">
<h1 id="leanpub-auto-quem-somos" class="chapter">Quem Somos</h1>

<h2 id="leanpub-auto-nanderson-castro" class="section">Nanderson Castro</h2>

<p>Iniciei na programação, contando o inicio da jornada e estudos, lá em 2007 mas meu contato com o primeiro computador foi nos anos 2000 por meio do computador de um tio meu com Windows 98 na época.</p>

<p>Meu principal intuito ao entrar no mundo da programação não era de nenhuma maneira ensinar e sim criar minha loja virtual para vender produtos de um velho sonho que tinha, sonho esse que era ter uma loja de produtos de informática e games (Seguindo os passos de meu pai, comerciante). Sempre via essa tal extensão <code>.php</code> nas urls dos sites e fóruns, então resolvi que iria começar por aí, buscando saber o que era esse tal de PHP.</p>

<p>Alguém lembra das bancas de revistas, rsrsrs. Fui a uma banca de revistas e comprei um mini-livro, da antiga Digerati, sobre PHP, entretanto, estava me precipitando muito pois não conhecia nada de lógica e o livro tinha aspectos avançados da linguagem, eu noob, achando que tudo é a mesma coisa, penei para encontrar o material correto rsrsrs!</p>

<p>Lembro de ter deixado o livro de lado e partido para entender como de fato começar e depois de muito penar e pesquisar fui pro zero absoluto, estudando lógica de programação e o funcionamento da web, então, o dia do livro chegou, quando finalmente consegui entender a proposta dele além de continuar a buscar mais conhecimentos para evoluir e montar minha loja, que cá entre nós tecnicamente nunca chegou sendo criada por mim…</p>

<p>Acabei que, na época, montando a loja mas montei por meio de serviços de loja pronta na época, entretanto, continuava a estudar programação e Web, me apaixonando cada vez mais. PHP foi minha linguagem de escolha e a que me especializei e uso até hoje, inclusive, alcançando a tão sonhada certificação PHP em 2015.</p>

<p>No percurso e carreira, passando por empresas locais e trabalhos remotos encontrei o Laravel, na versão 3 ainda e de lá pra cá sempre tenho ele como uma ferramenta na minha bagagem de ferramentas, quando preciso entregar aplicações web de forma produtiva e robusta e com muito valor.</p>

<p>Não acredito em bala de prata, entendo que existem casos e casos e a ferramenta ideal para o trabalho do momento!</p>

<p>Mas o Laravel é um excelente framework do mercado e que vêm ganhando muita notoriedade e cada vez mais isso só se mantêm. Ele têm um foco muito grande em produtividade e você vai aprender isso na prática, aqui nesta jornada comigo.</p>

<h2 id="leanpub-auto-code-experts" class="section">Code Experts</h2>

<p>A Code Experts é uma escola de cursos online com foco em prática onde abordamos os conceitos da programação web em projetos práticos e reais. A Code Experts, antes Code Experts Learning, começou como um braço de educação da Code Experts (Criação de Sistemas Web Sob Demanda).</p>

<p>Iniciamos na educação para suprir uma demanda faltante de cursos em nossa cidade, São Luis do Maranhão, e da vontade de transformar outras vidas por meio do ensino de programação, levando o conhecimento e simplificando o caminho para os devs iniciantes.</p>

<p>Dia após dia buscamos melhorar nossas metodológias de forma a gerar valor para nossos alunos, resultando em melhora de nossos materiais e na didática abordada!</p>

<p>O trabalho com educação foi tão grande que resolvemos fazer o merge e unificar tudo em educação, então a Code Experts Learning, de uma braço de educação, tornou-se o corpo todo! Tornou-se <b>Code Experts - Cursos Online de Programação na Prática</b>.</p>

<h2 id="leanpub-auto-a-loja-virou-a-plataforma" class="section">A loja virou a plataforma!</h2>

<p>O conhecimento adquirido ao longo dos anos, que inicialmente seria para criar minha loja de produtos de informática e games, tornou-se para criação de nossa plataforma de cursos online lançada em 2016, especificamente Novembro de 2016 no dia 05 e de lá pra cá venho concentrando meus esforços para a cada dia melhorar a experiência dos nossos alunos dentro dela.</p>

<p>O trabalho apenas começou!</p>

<p>Hoje sou desde o zelador ao editor de vídeos, passando por escritor e professor mas busco sempre dá o meu melhor para entregar excelentes materiais para nossos alunos e não farei diferente aqui neste livro!</p>

<p>Conte comigo!</p>

<p>Te convido também a nos conhecer em <a href="https://codeexperts.com.br">codeexperts.com.br</a>.</p>


<h1 id="leanpub-auto-para-quem--este-livro" class="chapter">Para quem é este livro?</h1>

<p>Bom, serei breve aqui.</p>

<p>Escrevi este livro para os programadores PHP e entusiastas que buscam melhorar sua produtividade na criação de Aplicações Web usando a linguagem, entregando softwares mais rápidos e com valor agregado. Nem sempre rápido quer dizer de má qualidade pois o Laravel te permite criar coisas com menos tempo e esforço mas com alto valor agregado e é por este caminho que irei te guiar nestas páginas.</p>

<p>É claro que se você apenas começou com PHP, recomendo fortemente a continuar estudando as bases da linguagem e busque materiais sobre Orientação a Objetos, pois estes conhecimentos irão te adicionar uma excelente base para entender todos os conceitos abordados, não somente no Laravel, mas em frameworks PHP modernos.</p>

<p>Se você está pronto para a jornada, então conte comigo e vamos lá!</p>


<h1 id="leanpub-auto-repositrio-com-os-cdigos" class="chapter">Repositório com os códigos</h1>

<p>O projeto está disponível de forma completa no github e você pode escolher seguir a jornada de duas formas:</p>

<ul>
  <li>Baixando todo o código pra acompanhar junto com o livro;</li>
  <li>Ou apenas deixar o repositório pra buscas de códigos especifícos.</li>
</ul>

<p>O repositório do projeto do livro está organizado por capítulos, sendo cada capítulo uma branch específica. Cada branch está incremental, tendo o código atual do capítulo junto dos códigos dos capítulos anteriores.</p>

<p>Acesse o repositório em <a href="https://bit.ly/laravel-12-ebook-app-code">bit.ly/laravel-12-ebook-app-code</a></p>

<blockquote>
  <p>A branch main será a branch com o app completo, caso queira navegar por capítulos utilize as branchs. Você pode inclusive, ver os commits de cada capítulo(branch) para ver as alterações especifícicas ou ver os commits da branch principal que terá o merge do app completo.</p>
</blockquote>


<h1 id="leanpub-auto-caso-queira-contribuir" class="chapter">Caso queira contribuir</h1>

<p>Hoje estou atuando como instrutor independente e inclusive este livro(ebook) vêm sendo escrito, revisado e atualizado de forma independente também. Posso ter deixado passar erros aqui e ali, pode existir também algum ponto em que você possa travar quer seja porque eu deixei algum código por adicionar quer seja por você se perder na jornada.</p>

<p>Para isso criei um tópico no nosso grupo principal no telegram para escutar você e prestar um suporte para te destravar na jornada!</p>

<p>Te convido a participar em <a href="http://t.me/CodeExpertsCursos">t.me/CodeExpertsCursos</a> ou podes buscar no seu telegram pelo <b>@CodeExpertsCursos</b>.</p>

<p>Te espero aqui no grupo também!</p>

<p>Att. Nanderson Castro (Code Experts)</p>


<h1 id="leanpub-auto-laravel" class="chapter">Laravel</h1>

<p>Laravel é um fullstack framework criado por Taylor Otwell. O Laravel foi criado em Junho de 2011 e de lá pra cá vem ganhando muita notoriedade por meio de suas features e facilidades, quando tratamos da criação de aplicações web em geral.</p>

<p>O Laravel foi fortemente inspirado pelo Rails, desde sua forma de trabalho e gerações, a sua estrutura. O Laravel hoje em sua versão 12 e conta com um ecossistema em constante crescimento, envolvendo diversos projetos, componenetes e ferramentas dentro do seu proprio ecossistema.</p>

<p>Conheceremos diversas funcionalidades do framework e veremos como ele traz essa simplicidade tão aclamada pela comunidade de desenvolvedores PHP.</p>

<p>Para conhecimento, o Laravel hoje possui plataformas para Deploy, Criação de Projetos com Foco em Saas, Ferramentas de Suporte ao Desenvolvimento e também projetos para painéis CMS além, claro, de todo o projeto em open-source que temos.</p>

<h2 id="leanpub-auto-laravel-12" class="section">Laravel 12</h2>

<p>Iniciar um projeto Laravel 12, hoje é recomendado fortemente o uso do Laravel CLI ou Installer. Por meio do installer você será guiado por um utilitário que te guia por escolhas com o fim de iniciar seu projeto com os recursos que você está acostumado. O Laravel traz algumas opções de inicialização de projeto, onde você pode iniciar usando ou não um Starter Kit.</p>

<p>Starter kits são opções que trazem para você um projeto para de fato iniciar app rapidamente, eles vêm com autenticação, registro, perfil e mais e têm o foco de te direcionar pro que de fato importa, sua regra criada dentro desse projeto pré-preparado. </p>

<p>O Laravel possui hoje apenas um StarterKit com 3 opções de stack (tecnologia de ferramentas que vai compor esse starter kit).</p>

<p>As stacks são:</p>

<ul>
  <li>Livewire</li>
  <li>React com InertiaJS</li>
  <li>Vue com InertiaJS</li>
</ul>

<p>Você pode optar por iniciar o projeto Laravel sem a escolha de uma stack listada acima, que a priore é que iremos fazer aqui nesta jornada!</p>

<h2 id="leanpub-auto-obtendo-o-laravel" class="section">Obtendo o Laravel</h2>

<p>Dado a questão das stacks faladas anteriormente, vamos iniciar nosso projeto e entender o que precisamos para usar o installer em nossa máquina. Lembrando que para usar o installer vamos precisar do composer em nossa máquina.</p>

<p>Para isso instale o composer através do site <a href="https://getcomposer.org">getcomposer.org</a>.</p>

<blockquote>
  <p>Se você chegou até aqui em busca do Laravel e entendeu nosso epílogo <code>Pra Quem é Este Livro</code>, você já deve ter o composer em sua máquina e lidar com ele não deve ser mais problema para você!</p>
</blockquote>

<h3 id="leanpub-auto-requerimentos" class="subsection">Requerimentos</h3>

<p>Para termos sucesso na utilização do Laravel Installer com foco em iniciar um novo projeto, cheque se seu PHP respeita as seguintes configurações:</p>

<ul>
  <li>PHP maior ou igual ao 8.2;</li>
  <li>Extensão BCMath;</li>
  <li>Extensão Ctype;</li>
  <li>Extensão JSON;</li>
  <li>Extensão Mbstring;</li>
  <li>Extensão OpenSSL;</li>
  <li>Extensão PDO;</li>
  <li>Extensão Tokenizer;</li>
  <li>Extensão XML;</li>
</ul>

<p>Para verificar sua versão do PHP de forma rápida basta acessar seu terminal ou cmd(tenha certeza que o PHP está no PATH do seu Sistema) e execute o comando abaixo:</p>

<p><code>php -v</code></p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----req-1.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Para visualizar suas extensões execute em seu terminal o comand abaixo:</p>

<p><code>php -m</code></p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----req-2.png">
    <figcaption></figcaption>
  </figure>
</div>


<h3 id="leanpub-auto-laravel-installer-windows" class="subsection">Laravel Installer (Windows)</h3>

<p>Com o composer em sua máquina Windows, vamos instalar o nosso utilitário, o Laravel Installer. </p>

<p>Primeiramente abra seu prompt de comando, para isso basta utilizar a combinação de teclas <code>CTRL + R</code> e na janelinha que aparecer digitar: <b>cmd</b>. </p>

<blockquote>
  <p>Você também pode usar o <b>Windows Terminal</b> e ele pode ser obtido na loja de aplicativos da Microsoft no Windows 10.</p>
</blockquote>

<p>Se você executou o CTRL+R e digitou o cmd, pressione ENTER para abrir o prompt.</p>

<p>Com o prompt aberto, digite e execute o comando abaixo, dando um ENTER após a digitação:</p>

    composer global require “laravel/installer”<br>
<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/images----installer-1.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<p>Com isso o composer vai baixar o pacote laravel/installer e jogar na pasta mencionada abaixo, dentro da pasta vendor/bin que está no caminho abaixo:</p>

    C:/Users/&lt;seu_nome_de_usuario&gt;/AppData/Roaming/Composer/<br>
<p>Veja o resultado da instalação abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-2.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<blockquote>
  <p>Na época de atualização e escrita deste livro, a versão do Installer é a 5.14, que traz consigo as novidades, no wizard de instalação, com foco nas melhorias de ecossistema do Laravel 12</p>
</blockquote>

<p>Feito isso, precisamos adicionar o caminho dos binários globais do composer no PATH do Windows. Primeiramente acesse o menu propriedades do Meu Computador, como mostrado abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-3.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<p>Após isso, acesse o menu Configurações Avançadas do Sistema, no menu lateral direito da sua tela. Veja abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-4.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<p>Na tela que aparecer, na parte inferior, acesse o menu <b>Variáveis de Ambiente</b>.</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-5.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<p>Na janela de Variáveis de Ambiente, na parte inferior, procure por Path e clique em editar, você pode editar o PATH apenas para o seu usuário, selecionando o Path da área acima ou o Path do sistema global selecionando o Path na área abaixo, eu editei somente a do meu usuário, no caso o Path da área acima.</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-6.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<p>Clicando duas vezes na variável Path ou selecionando e clicando em Editar… você verá uma janela como abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-6-1.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<p>Na janelinha que aparecer, clique em novo e adicione o Path do composer conforme abaixo:</p>

    %USERPROFILE%/AppData/Roaming/Composer/vendor/bin<br>
<p>Veja uma imagem para facilitar:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-6-2.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<p>Após isso, dê OK até sair de todas as janelas. Se seu prompt continuou aberto durante o processo, feche-o e abra novamente.</p>

<p>Para verificar se o laravel installer é reconhecido, execute em seu cmd o comando: <b>laravel</b>, dê ENTER e obtenha o resultado abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-7.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<p>Agora estamos aptos a iniciar um projeto Laravel, por meio do Laravel Installer em nosso CMD ou Windows Terminal.</p>

<h3 id="leanpub-auto-laravel-installer-macos-ou-linux--unix-like" class="subsection">Laravel Installer (MacOS ou Linux / Unix Like)</h3>

<p>Tendo a certeza que o Composer está em sua máquina, execute o comando abaixo em seu terminal:</p>

    composer global require “laravel/installer”<br>
<p>Após a instalação do pacote precisamos linkar ele no PATH do nosso sistema. Se você usa o bash em seu terminal o arquivo que você pode utilizar para configurar o PATH será o <b>.bash_profile</b>, caso utilize o zsh o arquivo a ser alterado será o <b>.zshrc</b>. Ambos os arquivos encontram-se na pasta do seu usuário, em <b>$HOME</b>.</p>

<p>PS.: Pelo terminal você pode digitar <code>cd ~</code> e dá um enter que cairá na pasta do seu usuário, pelo seu terminal.</p>

<p>Ao abrir o arquivo correspondente, adicione a seguinte linha ao final do arquivo:</p>

<p>MacOS: <code>PATH="$HOME/.composer/vendor/bin:$PATH"</code></p>

<p>No Linux você terá duas possibilidades e pasta: <code>$HOME/.config/composer/vendor/bin</code> ou <code>$HOME/.composer/vendor/bin</code></p>

<p>Após isso, reinicie seu terminal e execute o comando laravel.</p>

<p>Veja o resultado abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----installer-8.jpg">
    <figcaption></figcaption>
  </figure>
</div>


<blockquote>
  <p>Lembrando que sua versão será 5.14 ou superior dado o momento em que estou atualizando/escrevendo este livro.</p>
</blockquote>

<h2 id="leanpub-auto-iniciando-primeiro-projeto" class="section">Iniciando Primeiro Projeto</h2>

<p>Vamo enfim iniciar nosso novo projeto e que seguiremos na prática, através dele, aqui nesta jornada!</p>

<h3 id="leanpub-auto-iniciando-projeto-com-laravel-installer" class="subsection">Iniciando projeto com Laravel Installer</h3>

<p>Por meio do Laravel Installer vamos iniciar nosso projeto com o seguinte comando abaixo:</p>

<p><code>laravel new store_app</code></p>

<blockquote>
  <p>Lembre de entrar pelo seu terminal e escolhar sua pasta de escolha, nesta pasta será criada a pasta do projeto conforme o nome que você escolher.</p>
</blockquote>

<p>Nesta versão do installer precisaremos escolher a stack conforme mencionei anteriormente mas pra fins de momento vamos optar pela opção none:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----project-1.png">
    <figcaption></figcaption>
  </figure>
</div>


<blockquote>
  <p>Perceba que a opção padrão é none, você pode deixar em branco e simplesmente dá ENTER ou digitar none e ENTER.</p>
</blockquote>

<p>Com isso o instaldor baixará todo o projeto Laravel, instalará as dependências deste projeto automaticamente e jogará tudo dentro da pasta <code>store_app</code>.</p>

<p>A opção de escolhe <code>none</code> iniciará para nós um projeto sem um starter kit, estamos fazendo isso pelo nosso momento didático aqui no livro. Escolher um starter kit agora tornaria nossa jornada mais dificil pois requer conhecimentos extras que não abordaremos neste livro.</p>

<p>Durante o passo de instalação o Laravel Installer abrirá um opção para selecionarmos o banco de escolha, por padrão o drive do banco é SQlite mas vamos optar pelo MySQL, basta digitar como na imagem e dá ENTER. Veja abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----project-1-2.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Após a escolha acima ele pedirá pra você executar as migrações, então opte por <code>SIM</code> e certifique-se de seu banco está levantado, mais a frente falaremos sobre migrations(migrações).</p>

<p>Confirme também a opção de instalar os assets via NPM para o frontend.</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----project-1-3.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Feito todo esse caminho seu projeto será criado e basta acessar a pasta criada para verificar seu primeiro projeto com Laravel, recém iniciado claro!</p>

<h2 id="leanpub-auto-conhecendo-a-estrutura-do-laravel" class="section">Conhecendo a estrutura do Laravel</h2>

<p>Vamos conhecer as pastas e os arquivos que fazem parte da estrutura base do nosso projeto:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----project-2.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>O Laravel possui algumas pastas base, como a pasta <code>app</code>, <code>bootstrap</code>, <code>database</code>, <code>config</code>, <code>public</code>, <code>resources</code>, <code>storage</code>, <code>routes</code>, <code>tests</code> e a <code>vendor</code>. Vamos ver o que cada pasta destas representa ou armazena em sua estrutura.</p>

<h4 id="leanpub-auto-app" class="subsubsection">app</h4>

<p>A pasta app conterá todo o conteúdo do nosso projeto como os models, controllers, serviços, providers, middlewares e outros. Concentraremos muito dos nossos esforços nesta pasta durante a criação e desenvolvimento de nosso projeto.</p>

<h4 id="leanpub-auto-config" class="subsubsection">config</h4>

<p>Os arquivos de configuração, do projeto laravel, encontram-se nesta pasta. Configurações de conexões com banco de dados, configurações para armazenamento de arquivos, configurações de autenticação, mailers, serviços, sessão e outros. Esta pasta contêm arquivos que armazenam os arrays de configuração para cada uma das áreas mencionadas.</p>

<h4 id="leanpub-auto-resources" class="subsubsection">resources</h4>

<p>Nesta pasta temos algumas subpastas que são: <code>views</code>, <code>js</code>, &amp; <code>css</code>. A priore esta pasta salva os assets frontend que podemos cosumir no projeto e também nossas views da camada de templates do projeto.</p>

<h4 id="leanpub-auto-storage" class="subsubsection">storage</h4>

<p>Nesta pasta o Laravel salva arquivos de sessions, caches, logs e nós também podemos utilizar para armazenar arquivos mediante uploads em nosso projeto.</p>

<h4 id="leanpub-auto-routes" class="subsubsection">routes</h4>

<p>Nesta pasta vamos encontrar os arquivos para o mapeamento das rotas de nosso projeto. Rotas estas que permitirão o nosso usuário acessar determinada url e ter o conteúdo processado e esperado. </p>

<p>Mais a frente vamos conhecer melhor essas rotas, no Laravel 12 por padrão teremos apenas os arquivos de rota para Web e Console, as rotas de API e Broadcast Channels são adicionadas mediante necessidade, isso vêm desde a versão 11.</p>

<h4 id="leanpub-auto-tests" class="subsubsection">tests</h4>

<p>Nesta pasta teremos as classes para teste de nossa aplicação. Testes Unitários, Funcionais e outros.</p>

<h4 id="leanpub-auto-database" class="subsubsection">database</h4>

<p>Aqui teremos os arquivos de migração, na pasta <code>migrations</code> para nossas tabelas, vamos conhecer mais sobre migrações a frente. Temos, também, os arquivos para os seeds, na pasta <code>seeders</code> e também as factories, na pasta <code>factories</code> que também conheceremos mais a frente aqui.</p>

<h4 id="leanpub-auto-bootstrap" class="subsubsection">bootstrap</h4>

<p>Na pasta bootstrap teremos os arquivos responsáveis por inicializar os participantes do framework Laravel, encaminhando as requisições e indicando como as coisas devem ser executadas.</p>

<p>Nesta pasta, no arquivo app.php é onde configuraremos, conforma necessidade, quesões sobre Middlewares, Erro Handler e mais.</p>

<h4 id="leanpub-auto-public" class="subsubsection">public</h4>

<p>Esta é nossa pasta principal, a que fica exposta para a web e que contêm nosso front controller. </p>

<p>Por meio desta pasta é que recebemos nossas requisições, especificamente no index.php, e a partir daí que o laravel direciona as requisições e começa a executar o que é necessário para aquela demanda recebida pelo browser.</p>

<h4 id="leanpub-auto-vendor" class="subsubsection">vendor</h4>

<p>A vendor, como conhecemos, é onde ficam os pacotes de terceiros dentro de nossa aplicação. Pacotes estes, mapeados e instalados pelo composer.</p>

<h3 id="leanpub-auto-outros-arquivos-da-raiz-do-projeto" class="subsection">Outros arquivos da raiz do projeto</h3>

<p>Temos ainda alguns arquivos na raiz do nosso projeto, como o <code>composer.json</code> e o <code>composer.lock</code> onde estão definidas as nossas dependêncas e as versões baixadas respectivamente.</p>

<p>Temos também o <code>package.json</code> que contêm algumas definições de dependências do frontend.</p>

<p>Temos ainda também o <code>server.php</code> que nos permite emular o mod_rewrite do apache.</p>

<p>Temos também o <code>phpunit.xml</code> que contêm as configurações para a execução dos testes unitários, funcionais e etc em nossa aplicação.</p>

<p>A parte de asset bundler, para as builds do frontend, é gerenciada pelo ViteJS e seu arquivo de configurações é o <code>vite.config.js</code>.</p>

<p>Deixei por último o arquivo <code>.env</code> que contêm as variavéis de ambiente para cada configuração de nossa aplicação.</p>

<p>Neste arquivo encontramos os parâmetros para conexão com o banco, o aplication key: que é o hash único para nossa aplicação. Encontramos outras variáveis neste arquivo que são consumidas pelo app, vale dá uma conferida.</p>

<p>Este arquivo e essas configurações são providas pelo pacote DotEnv do Vance Lucas.</p>

<p>Basicamente esta é a estrutura do nosso projeto Laravel, e nela estaremos enquanto realizamos nossa jornada!</p>

<h2 id="leanpub-auto-laravel-artisan-cli" class="section">Laravel: Artisan CLI</h2>

<p>O Laravel possui uma interface de comandos ou command line interface (CLI) chamada de <code>artisan</code>. Por meio dela podemos melhorar bastante nossa produtividade enquanto desenvolvemos, como por exemplo: Gerar models, controllers, gerenciar nossas filas e muito mais!</p>

<p>Para conhecer todos os comando disponíveis no Artisan, basta executar na raiz do seu projeto o seguinte comando:</p>

<p><code>php artisan</code></p>

<p>O resultado deste comando será a lista de comandos e subcomandos disponiveis neste executável de terminal, que é o Artisan.</p>

<blockquote>
  <p>Sempre que precisar lembrar dos parâmetros de um comando/subcomando específico, lembre sempre da opção <code>--help</code>, exemplo: <code>php artisan make:model --help</code></p>
</blockquote>

<h2 id="leanpub-auto-executando-a-aplicao" class="section">Executando a Aplicação</h2>

<p>Para concluirmos nosso primeiro capítulo, vamos iniciar nossa aplicação e testá-la em nosso browser. Para isso acesse o seu projeto via terminal ou cmd no Windows e na raiz, deste projeto, execute o comando abaixo:</p>

<p><code>php artisan serve</code></p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----project-4.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>O comando acima disponibilizará sua aplicação, via browser, no seguinte link: <code>http://127.0.0.1:8000</code>. Veja o resultado ao acessarmos o projeto inicialmente:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----project-5.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Se tudo estiver corretamente configurado, teremos o resultado acima, a tela inicial do nosso projeto Laravel, e sua página inicial padrão.</p>

<blockquote>
  <p>A título de informação, ao iniciar seu server, você pode escolher uma porta e host diferentes com as opções <code>--host</code> e <code>--port</code> informando os valores que quer mudar, lembre sempre da opção <code>--help</code> para uma doc do comando em questão. Exemplo: <code>php artisan serve --help</code></p>
</blockquote>

<h2 id="leanpub-auto-concluses" class="section">Conclusões</h2>

<p>Neste capítulo concluimos as configurações iniciais para criarmos projetos com o Laravel , o que permitiu inclusive criarmos nosso projeto que será incrementado a cada capítulo deste livro.</p>

<p>Agora, continuando para o próximo capítulo vamos começar a entender a estrutura geral do framework por meio da criação do nosso Hello World no Laravel.</p>

<p>Vamos lá!</p>


<h1 id="leanpub-auto-hello-world-com-laravel" class="chapter">Hello World com Laravel</h1>

<p>Este capítulo visa mostrar o Laravel de uma forma geral, o que definirá nosso fluxo de trabalho durante todo o desenvolvimento. Gosto muito de tomar uma abordagem prática, por isso, vamos trabalhar todos os conceitos envolvendo o framework em cima de um projeto prático e direto ao ponto.</p>

<p>O projeto escolhido e que nos traz todo o aparato para entedermos cada parte de um framework fullstack, será a criação de uma loja virtual, além do sistema de comentários. </p>

<p>Então vamos lá colocar a mão na massa e dar inicio, a nossa jornada de conhecimento mas antes não podemos deixar de fazer nosso famoso mantra, criar um Hello World com o framework!</p>

<h2 id="leanpub-auto-mvc" class="section">MVC</h2>

<p>Antes de continuarmos, é interessante sabermos um pouco do modelo base utilizado no organização da estrurua dentro do nosso projeto Laravel, esse modelo ou padrão é o famoso MVC, Model-View-Controller.</p>

<p>A maioria dos frameworks atuais utilizam este padrão para organizar seus componentes/participantes, além de ter um <code>Front Controller</code> que recebe as requisições recebidas por nossa aplicação e entrega/delega para quem responsável daquela requisição. Geralmente este <code>Front Controller</code> se encontra na pasta public(Diretério WEBROOT da aplicação), e é inicializado no arquivo index.php dos frameworks, como o é no Laravel.</p>

<p>O modelo MVC possui três camadas base, as que comentei acima, o <b>Model</b>, o <b>Controller</b> e a <b>View</b>. Vamos entender o que é cada parte:</p>

<h3 id="leanpub-auto-model" class="subsection">Model</h3>

<p>A camada do Model ou Modelo é a camada que normalmente conterá nossas regras de negócio, geralmente possuem as entidades que representam a conversa com o banco de dados mas podem conter classes  com regras de negócio específicas e até podem conter classes que realizam algum determinado serviço.</p>

<p>Dentro do Laravel nossos models serão as classes que representam alguma tabela no banco de dados, com poderes de manipulação referentes a esse tratamento com o banco. Você pode encontrar, por default, as classes model dentro da pasta <code>app/Models</code>.</p>

<h3 id="leanpub-auto-controller" class="subsection">Controller</h3>

<p>A camada do Controller ou Controlador é a camada mais fina, digamos assim, pois deve receber a requisição e já demandar para o model em questão, caso necessário, e dado o retorno do model, o controller pega este retorno e entrega para a view ou, como em muitos casos, só carrega uma view caso não necessitemos de operações na camada do Model.</p>

<p>A ideia pro controller é que ele seja o mais simples possivel, portanto, evite adicionar regras e complexidade em seus Controllers.</p>

<p>Dentro do Laravel estes controllers encontram-se na pasta <code>app/Http/Controllers</code>.</p>

<h3 id="leanpub-auto-view" class="subsection">View</h3>

<p>A camada de View ou visualização é a camada de interação do usuário,  onde nossos templates vão existir, como as telas do nosso sistema e as páginas de nossos sites. </p>

<p>Nesta camada, também, não é recomendado colocar regra de negócios, como por exemplo: consultas ao banco ou coisas deste tipo. Esta camada é exclusivamente para exibição de resultados e input de dados, via formulários, além de interações Javascripts e outros processos já esperados para uma melhor experiência do usuário.</p>

<p>No Laravel, as views encontram-se na pasta <code>resources/views/</code>. As views do Laravel são compostas por um template engine, que falarei sobre ele mais a frente, chamado de <b>Blade</b>. O Blade visa simplificar a escrita de pontos dinâmicos em nossas views como o uso loops, condicionais, estrururas customizadas e muito mais.</p>

<h2 id="leanpub-auto-roteiro-para-nosso-primeiro-hello-world" class="section">Roteiro para nosso primeiro Hello World</h2>

<p>Para criarmos nosso hello world, vamos seguir o roteiro abaixo:</p>

<ul>
  <li>Criar um controller para execução, ao chamarmos nossa rota em questão;</li>
  <li>Criar uma view para envio da nossa string: <code>Hello World</code> a ser exibida como resultado do acesso;</li>
  <li>Criar nossa rota para chamada e acesso em nosso browser.</li>
</ul>

<p>A priore passos bem simples e que vão nos dar um panorama inicial do framework para a partir daí, seguirmos com os conceitos individualmente.</p>

<h2 id="leanpub-auto-iniciando-hello-world" class="section">Iniciando Hello World</h2>

<p>Acesse o projeto iniciado no capítulo passado pelo seu terminal ou cmd no Windows. Na certeza de está na raiz do seu projeto execute o seguinte comando abaixo:</p>

<p><code>php artisan make:controller HelloWorldController</code></p>

<p>Ao executar o comando acima teremos o seguinte resultado, pro sucesso da criação do nosso primeiro controller, exibido em nosso terminal ou cmd: <code>Controller &lt;CAMINHO_ATE_O_CONTROLLER&gt; created successfully.</code></p>

<p>Após isso teremos o nosso controller criado dentro da pasta do nosso projeto, especificamente em: <code>app/Http/Controllers</code>. E o arquivo criado será: <code>HelloWorldController.php</code>. </p>

<p>Não esqueça de acessar o projeto em seu editor ou IDE de código de sua preferência.</p>

<p>PS.: Recomendo aqui, caso não tenha um em questão, o Visual Studio Code. Para baixar, acesse <b>code.visualstudio.com</b>.</p>

<p>O código do nosso controller encontra-se abaixo, este código foi gerado junto com o arquivo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">HelloWorldController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">//</code>
<code class="linenos">10 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O resultado acima é a classe do nosso controller, que estende do Controller base e já traz um import para nós, o nosso Request que também conheceremos ele no decorrer do nosso livro.</p>

<p>Vamos criar nosso primeiro método para execução. Abaixo segue o conteúdo do nosso primeiro método:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nv">public</code> <code class="nv">function</code> <code class="nv">index</code><code class="ss">()</code>
<code class="linenos">2 </code>{
<code class="linenos">3 </code>	$<code class="nv">helloWorld</code> <code class="o">=</code> <code class="s1">'</code><code class="s">Hello World</code><code class="s1">'</code><code class="c1">;</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code>	<code class="k">return</code> <code class="nv">view</code><code class="ss">(</code><code class="s1">'</code><code class="s">hello_world.index</code><code class="s1">'</code>, <code class="nv">compact</code><code class="ss">(</code><code class="s1">'</code><code class="s">helloWorld</code><code class="s1">'</code><code class="ss">))</code><code class="c1">;</code>
<code class="linenos">6 </code>}
</pre></div>

</figure>


<p>Do método acima temos um ponto bem interessante, o retorno da função helper chamada <code>view</code> que recebe como primeiro parâmetro a view desejada e o segundo parâmetro um array associativo com os valores a serem enviados para esta view.</p>

<p>Antes de entendermos como vamos criar a view, com base no primeiro parâmetro do helper <b>view()</b>, preciso te falar que a função compact é uma função do proprio PHP e que pega as variáveis informadas nesta função e joga dentro de um array associativo, respeitando o pensamento de: o nome da variável ser a chave associativa e o valor da variável será o valor desta chave no array criado. </p>

<p>Exemplo, o compact acima, informado no segundo parâmetro do helper view(), terá como resultado o seguinte array associativo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>[
<code class="linenos">2 </code>   'helloWorld' =&gt; 'Hello World'
<code class="linenos">3 </code>]
</pre></div>

</figure>


<p>Agora, como podemos criar nossa view de forma que o primeiro parâmetro da função helper <code>view</code> seja satisfeito? Vamos entender!</p>

<p>Temos o seguinte valor: <code>hello_world.index</code>. </p>

<p>A última parte da string acima, apresentada pós <code>.</code> , será o nome da nossa view e deve respeitar o seguinte nome de arquivo, se depois do ponto tenho <code>index</code> precisarei criar uma view chamada <code>index.blade.php</code> lá na pasta de views. </p>

<p>Só que antes do ponto temos o valor <code>hello_world</code>, que neste caso será a pasta onde nosso <code>index.blade.php</code> estará ou será criado, então, no fim das contas precisaremos criar lá dentro da pasta <code>resources/views</code> uma pasta chamada <code>hello_world</code> e dentro desta pasta nosso arquivo <code>index.blade.php</code> chegando ao caminho completo e o arquivo: <code>resources/views/hello_world/index.blade.php</code>.</p>

<blockquote>
  <p>PS.: Se você quiser chamar uma view diretamente que esteja dentro da pasta de views, basta informar apenas o nome da view em questão. Se você tiver mais niveis, em questão de pastas, até chegar na view, é necessário informá-los até o arquivo da view em questão. Você não precisa informar o caminho base <b>resources/views</b> e nem a extensão do arquivos <b>.blade.php</b>, pois o Laravel já inclui automaticamente para você.</p>
</blockquote>

<p>Com isso crie o arquivo <code>index.blade.php</code> e sua pasta <code>hello_world</code> dentro da pasta <code>views</code>. Com o seguinte conteúdo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;h1&gt;</code><code class="cp">{{</code><code class="err">$</code><code class="nv">helloWorld</code><code class="cp">}}</code><code class="nt">&lt;/h1&gt;</code>
</pre></div>

</figure>


<p>Acima temos, dentro do elemento <code>h1</code>, o nosso primeiro contato com o template engine Blade. Usamos acima a notação de print, chamada de interpolação nos template engines, abre <code>{{</code> fecha <code>}}</code>, dentro da nossa view e pegamos a nossa variável <code>$helloWorld</code> vinda lá do nosso controller e exibimos seu valor dentro da tag html do elemento h1.</p>

<p>Agora, que já seguimos os dois passos iniciais do nosso roteiro, precisamos permitir o acesso e execução deste método, método index do nosso controller <b>HelloWorldController</b>, por parte dos nossos usuários mediante a liberação de uma url para acesso.</p>

<p>Como faremos isso? Simples, no momento, vamos criar uma rota que apontará para o método do nosso controller! </p>

<p>Vamos lá que vou te mostrar!</p>

<p>Abra seu arquivo <code>web.php</code> que se encontra na pasta <code>routes</code> na raiz do projeto. </p>

<p>Teremos o seguinte conteúdo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="cp">&lt;?php</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="k">use</code> <code class="nx">Illuminate\Support\Facades\Route</code><code class="p">;</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>
<code class="linenos">6 </code>    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'welcome'</code><code class="p">);</code>
<code class="linenos">7 </code><code class="p">});</code>
</pre></div>

</figure>


<p>Este arquivo web.php conterá todas as rotas da nossa aplicação, rotas estas que trabalham com a exibição de views dinâmicas em nosso projeto. Tudo que for UI ou User Interface(Interface do Usuário) terá suas rotas definidas neste arquivo.</p>

<p>De cara já vemos a primeira definição de rota, a rota principal <code>/</code> que exibe a view <code>welcome.blade.php</code> , que está lá dentro da pasta de views. Esta rota é a rota executado ao acessarmos a página principal de uma aplicação Laravel recém instalada e que futuramente será nossa rota de entrada do site/loja. </p>

<p>Agora vamos definir nossa rota de hello world.</p>

<p>Adicione o código abaixo, após a definição da rota principal que já existe:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'hello-world'</code><code class="o">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">HelloWorldController</code><code class="nl">::class</code><code class="p">,</code><code class="s1">'index'</code><code class="o">\</code>
<code class="linenos">2 </code><code class="cp">]</code><code class="o">);</code>
</pre></div>

</figure>


<p>Acima temos nossa primeira rota definida, a rota escolhida foi <code>hello-world</code> que executará o método index do controller HelloWorldController, beleza, como isto está definido? Vamos lá!</p>

<p>O segundo parâmetro do método <code>get</code>, do <code>Route</code> , é o executavél para esta rota, que pode ser uma função anônima como vimos na definição da rota principal já existente ou um array que respeite <code>Controller, Método</code>. </p>

<p>Existe ainda uma outra forma, que é usando uma string no formato <b>NamespaceAtéOController@Metodo</b>. Basicamente ficando como abaixo:</p>

<p><code>Route::get('hello-world', '\\App\\Http\\Controllers\\HelloWorldController@index');</code></p>

<p>Ao acessarmos em nosso browser a url http://127.0.0.1:8000/hello-world, o Laravel vai buscar por nossa rota internamente em sua coleção de rotas e ao encontrar uma rota que faça o match com <i>hello-world</i>, executará o segundo parâmetro desta rota encontrada, que como comentado pode ser uma funcão anônima ou um método de um controller ou resumindo um <code>Callable</code>, como fizemos a definição.</p>

<p>Com nossa rota definda, chegamos ao passo 3 e final do nosso roteiro e já podemos iniciar nosso webserver, na raiz do projeto para o teste do nosso Hello World. </p>

<p>Execute o comand abaixo em seu terminal ou cmd:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan serve
</pre></div>

</figure>


<p>E acesse em seu browser <code>http://127.0.0.1:8000/hello-world</code>, onde teremos o resultado abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----hello.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>O Hello World em nossa tela!</p>

<h2 id="leanpub-auto-concluses-1" class="section">Conclusões</h2>

<p>Neste capítulo vimos diretamente o processo de expor uma rota para acesso via browser, a execução de nosso controller através do método index, bem como, a exibição do resultado em uma view.</p>

<p>É claro que cada etapa destas carece de um pouco mais de informações, e também, é claro que cada etapa destas contêm diversos detalhes que serão necessários, para termos um melhor proveito do framework.</p>

<p>A partir de agora iremos debsravar toda estas opções e outros pontos a mais que não foram diretamente mostrados aqui.</p>

<p>Este capítulo serviu para te mostrar um panorama geral que será utilizado no decorrer de sua caminhada com o framework durante o desenvolvimento de suas aplicações, então, vamos continuando que temos bastante coisa para aprender ainda!</p>

<p>Vamos continuar nossa jornada!</p>


<h1 id="leanpub-auto-rotas--controllers" class="chapter">Rotas &amp; Controllers</h1>

<p>Rotas e Controllers são integrantes bem importantes em nossas aplicações Laravel. Neste capítulo vamos conhecer mais opções proporcionadas pelas rotas e como podemos trabalhar com controllers conhecendo um pouco além do que vimos no capítulo passado.</p>

<p>Vamos as rotas então!</p>

<h2 id="leanpub-auto-rotas" class="section">Rotas</h2>

<p>As rotas no Laravel nos ajudam a termos um maior controle no mapeamento dos acessos a nossa aplicação, claro que nós definimos nossas urls e expomos pro nosso usuário. Como temos que mapear nossas URLs dentro dos arquivos de rota, fica mais fácil termos controle do que será exposto e também fica mais fácil de customizar como queremos.</p>

<p>Dentro do Laravel temos os arquivos de rotas bem separados, que nos ajudam a organizar melhor tais rotas que dependendo da aplicação podem se tornar bem grande no quesito de definições escritas dentro do arquivo de rotas em questão.</p>

<p>O Laravel possui os seguintes arquivos de rotas: <code>web.php</code>, <code>api.php</code>( vem mediante habilitar via comando), <code>channels.php</code>(mesmo detalhe sobre o api.php, precisamos habilitar dentro do fw) e <code>console.php</code>.</p>

<h5 id="leanpub-auto-webphp" class="subsubsubsection">web.php</h5>

<p>O arquivo web.php conterá as rotas de sua aplicação com as interfaces para o usuário. Todas as rotas que têm esse fim deverão ser definidas neste arquivo.</p>

<h5 id="leanpub-auto-apiphp" class="subsubsubsection">api.php</h5>

<p>Se você for trabalhar com APIs, expondo endpoints para que outras aplicações possam consumir seus recursos, você deverá definir suas rotas com este fim no arquivo <b>api.php</b>.</p>

<p>Esse arquivo não existe em um projeto novo, para habilitá-lo precisamos executar o comando <code>php artisan install:api</code> com o fim de ambientar toda a parte para APIs REST do framework.</p>

<h5 id="leanpub-auto-channelsphp" class="subsubsubsection">channels.php</h5>

<p>Se você for trabalhar com eventos de Broadcasting suas rotas deverão ser definidas neste arquivo, as rotas aqui dispostas são utilizadas para controle de acesso aos canais usados no Broadcast.</p>

<p>Esse arquivo também não existe em um projeto novo, para habilitá-lo precisamos executar o comando <code>php artisan install:broadcast</code> com o fim de ambientar toda a parte para mensagens broadcast do framework.</p>

<h5 id="leanpub-auto-consolephp" class="subsubsubsection">console.php</h5>

<p>Arquivo para registro de comandos para o console e execução a partir do artisan.</p>

<h3 id="leanpub-auto-definio-de-rotas" class="subsection">Definição de Rotas</h3>

<p>Como vimos no último capítulo, abordei duas formas de definição de rotas em nosso Hello World. Uma era a rota que já existia no arquivo <b>web.php</b> e a outra foi nossa definição de rota para nosso Hello World. </p>

<p>Vamos da uma revisada, uma relembrada:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'/'</code><code class="o">,</code> <code class="nt">function</code> <code class="o">()</code> <code class="p">{</code>
<code class="linenos">2 </code>    <code class="err">return</code> <code class="err">view('welcome')</code><code class="p">;</code>
<code class="linenos">3 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>e </p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'hello-world'</code><code class="o">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">HelloWorldController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'index</code><code class="se">\</code><code class="s1"></code>
<code class="linenos">2 </code><code class="s1">'</code><code class="cp">]</code><code class="o">);</code>
</pre></div>

</figure>


<p>Acima temos duas formas de definição para rotas, com respeito ao que será executado. Lembrando que o primeiro parâmetro do método get é a rota em questão e o segundo parâmetro será um callable: uma função anônima ou um método de um Controller que será executado ao acessarmos a rota.</p>

<p>Na rota inicial, que já tinhamos no arquivo web.php, vemos a utilização da função anônima e em nossa rota usamos a definição de chamada do controller e seu método diretamente.</p>

<p>Um primeiro ponto que podemos abordar sobre os métodos do <code>Route</code>, como vimos o <code>get</code> até o momento, é que teremos métodos respeitando os verbos http, como: </p>

<ul>
  <li>GET: Acesso diretos a URL;</li>
  <li>POST: Envio de dados via body da Request com intuito de criar;</li>
  <li>PUT: Verbo que indica a intenção de atualizar um recurso;</li>
  <li>PATCH: Verbo que indica a intenção de atualizar pedaços de um recurso;</li>
  <li>DELETE: Verbo que indica a intenção de remover um recurso;</li>
  <li>OPTIONS: Quando enviado espera-se saber quais VERBOS HTTP determinada rota suporta;</li>
</ul>

<p>Podemos utilizá-los da seguinte maneira:</p>

<ul>
  <li>Route::get($route, $callback);</li>
  <li>Route::post($route, $callback);</li>
  <li>Route::put($route, $callback);</li>
  <li>Route::patch($route, $callback);</li>
  <li>Route::delete($route, $callback);</li>
  <li>Route::options($route, $callback);</li>
</ul>

<p>Podemos usar os métodos conforme os verbos http mostrados, tendo sempre como primeiro parâmetro, a rota em si, e o segundo parâmetro o callable ou executável para esta rota quando acessada.</p>

<h3 id="leanpub-auto-route-match-e-route-any" class="subsection">Route match e Route any</h3>

<p>Se precisarmos usar uma rota que responda a determinados tipos de verbos http, podemos usar o método <code>match</code> do <code>Route</code>. Como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">match</code><code class="o">(</code><code class="cp">[</code><code class="s1">'get'</code><code class="p">,</code> <code class="s1">'post'</code><code class="cp">]</code><code class="o">,</code> <code class="s1">'products/create'</code><code class="o">,</code> <code class="nt">function</code><code class="o">()</code><code class="p">{</code>
<code class="linenos">2 </code>	<code class="err">return</code> <code class="err">'Esta</code> <code class="err">rota</code> <code class="err">bate</code> <code class="err">com</code> <code class="err">o</code> <code class="err">verbo</code> <code class="err">GET</code> <code class="err">e</code> <code class="err">POST'</code><code class="p">;</code>
<code class="linenos">3 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>No exemplo acima a rota <code>products/create</code> suporte acessos tanto via GET quanto via POST.</p>

<p>Caso queira que uma rota responda para todos os verbos ao mesmo tempo, você pode usar o método <code>any</code> do <code>Route</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">any</code><code class="o">(</code><code class="s1">'products'</code><code class="o">,</code> <code class="nt">function</code><code class="o">()</code><code class="p">{</code>
<code class="linenos">2 </code>	<code class="err">return</code> <code class="err">'Esta</code> <code class="err">rota</code> <code class="err">bate</code> <code class="err">com</code> <code class="err">todos</code> <code class="err">os</code> <code class="err">verbos</code> <code class="err">HTTP</code> <code class="err">mencionados</code> <code class="err">anteriormente'</code><code class="p">;</code>
<code class="linenos">3 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<h3 id="leanpub-auto-view-routes" class="subsection">View Routes</h3>

<p>Em determinados momentos você vai precisar apenas renderizar determinadas views como resultado do acesso a sua rota. Para isso temos o método <code>view</code> do <code>Route</code>, que nos permite setar uma rota, primeiro parâmetro, definir uma view, segundo parâmetro. Se precisarmos passar algum valor para esta view passamos o array associativo com os dados para nossa view, este sendo o terceiro parâmetro do método.</p>

<p>Veja como é simples:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="c1">//Exibindo somente a view: 127.0.0.1:8000/bem-vindo -&gt; view resources/views/bemvindo\</code>
<code class="linenos">2 </code><code class="na">.blade.php</code> 
<code class="linenos">3 </code>
<code class="linenos">4 </code><code class="no">Route</code><code class="p">::</code><code class="no">view</code><code class="p">(</code><code class="err">'/</code><code class="no">bem-vindo</code><code class="err">'</code><code class="p">,</code> <code class="err">'</code><code class="no">bemvindo</code><code class="err">'</code><code class="p">)</code><code class="c1">;</code>
<code class="linenos">5 </code>
<code class="linenos">6 </code><code class="c1">//Exibindo a view e mandando parâmetros para ela</code>
<code class="linenos">7 </code>
<code class="linenos">8 </code><code class="nl">Route:</code><code class="err">:</code><code class="nf">view</code><code class="p">(</code><code class="err">'/</code><code class="no">bem-vindo</code><code class="err">'</code><code class="p">,</code> <code class="err">'</code><code class="no">bemvindo</code><code class="err">'</code><code class="p">,</code> <code class="p">[</code><code class="err">'</code><code class="no">name</code><code class="err">'</code> <code class="err">=&gt;</code> <code class="err">'</code><code class="no">Nanderson</code> <code class="no">Castro</code><code class="err">'</code><code class="p">])</code><code class="c1">;</code>
</pre></div>

</figure>


<p>Bem simples, ao acessarmos a rota <code>bem-vindo</code> em nosso browser, carregaremos a view <code>bemvindo.blade.php</code> diretamente como resultado.</p>

<h3 id="leanpub-auto-parmetros-dinmicos" class="subsection">Parâmetros dinâmicos</h3>

<p>Continuando, vamos conhecer um ponto bem importante sobre rotas que é a possibilidade de informamos parâmetros dinâmicos. Parâmetros estes que podem servir para identificar determinado recurso, como uma postagem em um blog por exemplo.</p>

<p>Veja a rota definida abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'/products/{slug}'</code><code class="o">,</code> <code class="nt">function</code><code class="o">($</code><code class="nt">slug</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">2 </code>    <code class="err">return</code> <code class="err">$slug</code><code class="p">;</code>
<code class="linenos">3 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Temos a rota <code>/products/</code> após isso definimos um parâmetro dinâmico chamado <code>slug</code>, dentro de chaves como é solicitado pelo componente de rotas. Em nossa função anônima passamos o parâmetro <code>$slug</code> que receberá o valor dinâmico e assim, poderemos utilizar ele dentro da nossa função. </p>

<p>Se eu estiver usando um controller e seu método, basta informarmos no método o parâmetro correspondente como informamos na função anônima e assim utilizamos tranquilamente o valor do parâmetro dinâmico.</p>

<p>Com esta rota defininda em nosso arquivo <code>web.php</code> e nosso server levantado, podemos acessar em nosso browser a seguinte url: <code>http://127.0.0.1:8000/products/teste-parametro-dinamico</code>.</p>

<p>Resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----parametro-dinamico-rota-laravel.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Como retornamos o parâmetro informado, teremos o valor dinâmico exibido em nosa tela como mostra a imagem acima.</p>

<h3 id="leanpub-auto-parmetros-opcionais" class="subsection">Parâmetros Opcionais</h3>

<p>Se você precisar definir parâmetros opcionais para sua rota em questão, basta adicionar a <code>?</code> antes do fechamento da chave do parâmetro, na definição da rota. Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'/products/{slug?}'</code><code class="o">,</code> <code class="nt">function</code><code class="o">($</code><code class="nt">slug</code> <code class="o">=</code> <code class="nt">null</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code>    <code class="err">return</code> <code class="err">!is_null($slug)</code> <code class="err">?</code> <code class="err">$</code><code class="n">slug</code> <code class="p">:</code> <code class="s1">'Comportamento sem a existência do param slug'</code><code class="p">;</code>
<code class="linenos">4 </code>    
<code class="linenos">5 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Agora nosso parâmetro <code>slug</code> é opcional, ou seja, não será necessário informá-lo na rota e isso nos abre precedente para validarmos ou exibirmos os resultados com base na não existência do parâmetro.</p>

<p>Mais um ponto bem útil nas rotas no Laravel.</p>

<h3 id="leanpub-auto-regex-em-parmetros" class="subsection">Regex em parâmetros</h3>

<p>Podemos validar o formato dos parâmetros aceitos em nossas rotas por meio de expressões regulares para um melhor controle. Para isso podemos utilizar o método <code>where</code> com este fim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'/user/{id}'</code><code class="o">,</code> <code class="nt">function</code><code class="o">($</code><code class="nt">slug</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">2 </code>    <code class="err">return</code> <code class="err">$slug</code><code class="p">;</code>
<code class="linenos">3 </code><code class="p">}</code><code class="o">)</code>
<code class="linenos">4 </code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">where</code><code class="o">(</code><code class="cp">[</code><code class="s1">'id'</code> <code class="o">=&gt;</code> <code class="s1">'[0-9]+'</code><code class="cp">]</code><code class="o">);</code>
</pre></div>

</figure>


<p>O método <code>where</code> espera um array associativo, sendo a chave o nome do parâmetro e o valor a expressão regular (Regex) a ser validada no parâmetro informado. </p>

<p>Se você tiver mais de um parâmetro dinâmico e quiser informar uma regex para tal, basta ir adicionando no array associativo, respeitando o pensamento chave sendo o parâmetro e valor sendo a experessão regular que irá validar o parâmetro informado, verificando se ele respeita a regra da Regex escrita.</p>

<h3 id="leanpub-auto-apelido-para-rotas" class="subsection">Apelido para rotas</h3>

<p>Outro ponto bem importante em nossas rotas são apelidos. Mas para que servem? Até agora conhecemos o valor real ou nome real da rota mas podemos chamá-las por meio de seus apelidos também, isso nos ajuda quando precisamos, em um futuro, alterar o nome real das rotas(se isso for necessário de alguma forma).</p>

<p>Quando fazemos referência aos apelidos, podemos alterar tranquilamente o nome real da rota que o peso desta modificação não será tão impactante assim. E como utilizar este apelido?</p>

<p>Vamos pegar nossa última rota do parâmetro dinâmico:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'/products/{slug}'</code><code class="o">,</code> <code class="nt">function</code><code class="o">($</code><code class="nt">slug</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">2 </code>    <code class="err">return</code> <code class="err">$slug</code><code class="p">;</code>
<code class="linenos">3 </code><code class="p">}</code><code class="o">)</code>
<code class="linenos">4 </code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'products.single'</code><code class="o">);</code>
</pre></div>

</figure>


<p>Perceba a adição simples que fiz após o método <code>get</code> antes de fechar com o <code>;</code>. Chamei o método <code>name</code> que me permite adicionar um apelido para a rota em questão, neste caso agora posso chamar o apelido <code>products.single</code> toda vez que eu precisar usar a rota <code>products/{slug}</code>. </p>

<p>Em um link em nossa view ao invés de usarmos o link da rota desta maneira:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"/products/primeiro-produto"</code><code class="nt">&gt;</code>Primeiro Produto<code class="nt">&lt;/a&gt;</code>
</pre></div>

</figure>


<p>Vamos utilizar desta maneira:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'products.single'</code><code class="o">,</code> <code class="o">[</code><code class="s1">'slug'</code> <code class="o">=&gt;</code> <code class="s1">'primeiro-produto'</code><code class="o">])</code><code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>Primeiro Prod\
<code class="linenos">2 </code>uto<code class="nt">&lt;/a&gt;</code>
</pre></div>

</figure>


<p>Perceba acima que estamos em uma suposta view e utilizamos um método helper do Blade que é o <code>route</code> em nosso atributo href da âncora. O primeiro parâmetro do <code>route</code> é o apelido da rota e se a rota tiver parâmetros dinâmicos, que é o nosso caso, podemos informar o valor do parâmetro, dentro de um array, no segundo parâmetro do helper <code>route</code>, informando o nome do parâmetro dinâmico e o seu valor.</p>

<p>O método route irá gerar a url correta, informando o parâmetro dinâmico no local correto. Com isso fica mais simples, se precisarmos futuramente modificar o nome real da rota, uma vez que chamamos a rota pelo apelido ao invés de seu nome real.</p>

<h3 id="leanpub-auto-grupo-de-rotas--prefixo" class="subsection">Grupo de Rotas &amp; Prefixo</h3>

<p>Podemos definir determinadas configurações para um grupo específico de rotas e para conhecermos o poder do método group, decidi mostrar ele aqui com a definição de um prefixo, método existente no Route também.</p>

<p>Vamos ao código abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'products'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code><code class="o">()</code><code class="p">{</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'index'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">name</code><code class="err">\</code>
<code class="linenos"> 4 </code><code class="p">(</code><code class="s1">'products.index'</code><code class="p">);</code>
<code class="linenos"> 5 </code>    
<code class="linenos"> 6 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/create'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'create'</code><code class="cp">]</code><code class="err">\</code>
<code class="linenos"> 7 </code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'products.create'</code><code class="p">);</code>
<code class="linenos"> 8 </code>    
<code class="linenos"> 9 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">post</code><code class="p">(</code><code class="s1">'/save'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'save'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="err">\</code>
<code class="linenos">10 </code><code class="nf">name</code><code class="p">(</code><code class="s1">'products.save'</code><code class="p">);</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Perceba no trecho de rotas acima, que utilizei incialmente o método <code>prefix</code> para definir esse prefixo para o grupo de rotas dentro do método group.</p>

<p>Agora, as rotas dentro do group serão prefixadas com o <code>products</code>, ficando desta maneira:</p>

<ul>
  <li>
<b>/products/</b>;</li>
  <li>
<b>/products/create</b>;</li>
  <li>
<b>/products/save</b>.</li>
</ul>

<p>Duas rotas acessíveis via GET e uma acessível via POST. </p>

<p>O grupo nos permite esse tipo de configuração, quando precisamos organizar melhor determinadas configurações que se repetirão para mais de um set de rota. Isso melhora até a escrita dos nossos arquivos de rotas e definições.</p>

<h3 id="leanpub-auto-grupo-de-rotas--apelidos" class="subsection">Grupo de Rotas &amp; Apelidos</h3>

<p>Vamos melhorar ainda mais nosso set de rotas do momento passado. Podemos, também, definir um apelido base para um grupo de rotas, então vamos melhorar nosso grupo anterior.</p>

<p>Veja como ficou:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'products'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'products.'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code><code class="o">()</code><code class="p">{</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'index'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">name</code><code class="err">\</code>
<code class="linenos"> 4 </code><code class="p">(</code><code class="s1">'index'</code><code class="p">);</code>
<code class="linenos"> 5 </code>    
<code class="linenos"> 6 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/create'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'create'</code><code class="cp">]</code><code class="err">\</code>
<code class="linenos"> 7 </code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'create'</code><code class="p">);</code>
<code class="linenos"> 8 </code>    
<code class="linenos"> 9 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">post</code><code class="p">(</code><code class="s1">'/save'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'save'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="err">\</code>
<code class="linenos">10 </code><code class="nf">name</code><code class="p">(</code><code class="s1">'save'</code><code class="p">);</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Perceba que agora isolei a parte <code>products.</code>, referente ao apelido das rotas, após a definição do prefixo. Agora as rotas deste grupo além de receberem um prefixo, irão receber um apelido base que será concatenado com os apelidos de cada rota do grupo.</p>

<p>Os apelidos ficarão desta forma:</p>

<ul>
  <li>
<b>products.index</b>;</li>
  <li>
<b>products.create</b>;</li>
  <li>
<b>products.save</b>.</li>
</ul>

<p>Esses serão os apelidos das rotas, o mesmo que seria anteriormente mas agora com o detalhe de termos organizado e isolado, centralizando o que era repetido, ou seja, o <code>products.</code>.</p>

<p>Assim como o prefixo e o apelido podemos centralizar outras configurações nestes arquivos, como middlewares, controllers e muitas outras opções que veremos mais a frente aqui nesta jornada.</p>

<h2 id="leanpub-auto-controllers" class="section">Controllers</h2>

<p>Já tivemos nosso primeiro contato com controllers anteriormente. Os controllers são parte importantíssima nesta organização, utilizando o Laravel. </p>

<p>Relembrando, de forma simples, os controllers são o ponto de delegação entre Model e View, recebendo a requisição e entregando para quem é de direito.</p>

<p>Utilizando o <b>artisan</b> podemos gerar, como já fizemos, os nossos controllers. Como fizemos, no capítulo passado, ao executarmos o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller HelloWorldController
</pre></div>

</figure>


<p>Agora vamos explorar mais opções dentro deste comando e buscar mais produtividade na execução de nossos projetos.</p>

<h3 id="leanpub-auto-controllers-como-recurso" class="subsection">Controllers como Recurso</h3>

<p>Podemos gerar controllers com métodos para cada operação de CRUD e por meio de uma configuração de rota termos também, as rotas automáticas para cada um destes métodos.</p>

<p>Este tipo de controller chamamos de controller como recurso ou em muitos casos chamamos também de RESTFull Controllers. Vamos gerar e entender como são. </p>

<p>Em seu terminal na raiz do seu projeto execute o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller UserController --resource
</pre></div>

</figure>


<blockquote>
  <p>A opção <code>--resource</code> pode ser chamada também como <code>-r</code></p>
</blockquote>

<p>Perceba agora que usei o mesmo comando para gerar um novo controller mas, caso acima, adicionei a opção <code>--resource</code> que criará um controller com os seguintes métodos abaixo:</p>

<ul>
  <li>index;</li>
  <li>create;</li>
  <li>store;</li>
  <li>show;</li>
  <li>edit;</li>
  <li>update;</li>
  <li>destroy;</li>
</ul>

<p>Perceba que quando iniciamos o controller como recurso, já temos um controller com os métodos acima definidos só no ponto para colocarmos nossas lógicas de inserção, leitura e etc.</p>

<p>Veja o controller gerado abaixo na íntegra:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">UserController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Display</code> <code class="n">a</code> <code class="n">listing</code> <code class="n">of</code> <code class="n">the</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*</code>
<code class="linenos">12 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Response</code>
<code class="linenos">13 </code>     <code class="o">*/</code>
<code class="linenos">14 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>        <code class="o">//</code>
<code class="linenos">17 </code>    <code class="p">}</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="o">/**</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="n">Show</code> <code class="n">the</code> <code class="n">form</code> <code class="k">for</code> <code class="n">creating</code> <code class="n">a</code> <code class="n">new</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">21 </code>     <code class="o">*</code>
<code class="linenos">22 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Response</code>
<code class="linenos">23 </code>     <code class="o">*/</code>
<code class="linenos">24 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">create</code><code class="p">()</code>
<code class="linenos">25 </code>    <code class="p">{</code>
<code class="linenos">26 </code>        <code class="o">//</code>
<code class="linenos">27 </code>    <code class="p">}</code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>    <code class="o">/**</code>
<code class="linenos">30 </code>     <code class="o">*</code> <code class="n">Store</code> <code class="n">a</code> <code class="n">newly</code> <code class="n">created</code> <code class="n">resource</code> <code class="ow">in</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">31 </code>     <code class="o">*</code>
<code class="linenos">32 </code>     <code class="o">*</code> <code class="err">@</code><code class="n">param</code>  \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code>  <code class="o">$</code><code class="n">request</code>
<code class="linenos">33 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Response</code>
<code class="linenos">34 </code>     <code class="o">*/</code>
<code class="linenos">35 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">store</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos">36 </code>    <code class="p">{</code>
<code class="linenos">37 </code>        <code class="o">//</code>
<code class="linenos">38 </code>    <code class="p">}</code>
<code class="linenos">39 </code>
<code class="linenos">40 </code>    <code class="o">/**</code>
<code class="linenos">41 </code>     <code class="o">*</code> <code class="n">Display</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">42 </code>     <code class="o">*</code>
<code class="linenos">43 </code>     <code class="o">*</code> <code class="err">@</code><code class="n">param</code>  <code class="nb nb-Type">int</code>  <code class="o">$</code><code class="n">id</code>
<code class="linenos">44 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Response</code>
<code class="linenos">45 </code>     <code class="o">*/</code>
<code class="linenos">46 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">show</code><code class="p">(</code><code class="o">$</code><code class="n">id</code><code class="p">)</code>
<code class="linenos">47 </code>    <code class="p">{</code>
<code class="linenos">48 </code>        <code class="o">//</code>
<code class="linenos">49 </code>    <code class="p">}</code>
<code class="linenos">50 </code>
<code class="linenos">51 </code>    <code class="o">/**</code>
<code class="linenos">52 </code>     <code class="o">*</code> <code class="n">Show</code> <code class="n">the</code> <code class="n">form</code> <code class="k">for</code> <code class="n">editing</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">53 </code>     <code class="o">*</code>
<code class="linenos">54 </code>     <code class="o">*</code> <code class="err">@</code><code class="n">param</code>  <code class="nb nb-Type">int</code>  <code class="o">$</code><code class="n">id</code>
<code class="linenos">55 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Response</code>
<code class="linenos">56 </code>     <code class="o">*/</code>
<code class="linenos">57 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">edit</code><code class="p">(</code><code class="o">$</code><code class="n">id</code><code class="p">)</code>
<code class="linenos">58 </code>    <code class="p">{</code>
<code class="linenos">59 </code>        <code class="o">//</code>
<code class="linenos">60 </code>    <code class="p">}</code>
<code class="linenos">61 </code>
<code class="linenos">62 </code>    <code class="o">/**</code>
<code class="linenos">63 </code>     <code class="o">*</code> <code class="n">Update</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code> <code class="ow">in</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">64 </code>     <code class="o">*</code>
<code class="linenos">65 </code>     <code class="o">*</code> <code class="err">@</code><code class="n">param</code>  \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code>  <code class="o">$</code><code class="n">request</code>
<code class="linenos">66 </code>     <code class="o">*</code> <code class="err">@</code><code class="n">param</code>  <code class="nb nb-Type">int</code>  <code class="o">$</code><code class="n">id</code>
<code class="linenos">67 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Response</code>
<code class="linenos">68 </code>     <code class="o">*/</code>
<code class="linenos">69 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">update</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">,</code> <code class="o">$</code><code class="n">id</code><code class="p">)</code>
<code class="linenos">70 </code>    <code class="p">{</code>
<code class="linenos">71 </code>        <code class="o">//</code>
<code class="linenos">72 </code>    <code class="p">}</code>
<code class="linenos">73 </code>
<code class="linenos">74 </code>    <code class="o">/**</code>
<code class="linenos">75 </code>     <code class="o">*</code> <code class="n">Remove</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code> <code class="n">from</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">76 </code>     <code class="o">*</code>
<code class="linenos">77 </code>     <code class="o">*</code> <code class="err">@</code><code class="n">param</code>  <code class="nb nb-Type">int</code>  <code class="o">$</code><code class="n">id</code>
<code class="linenos">78 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> \<code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Response</code>
<code class="linenos">79 </code>     <code class="o">*/</code>
<code class="linenos">80 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">destroy</code><code class="p">(</code><code class="o">$</code><code class="n">id</code><code class="p">)</code>
<code class="linenos">81 </code>    <code class="p">{</code>
<code class="linenos">82 </code>        <code class="o">//</code>
<code class="linenos">83 </code>    <code class="p">}</code>
<code class="linenos">84 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Agora com o controller como recurso gerado, podemos expor rotas para cada um dos métodos acima. Neste caso, para facilitar mais ainda nossas vidas, temos um método dentro do <code>Route</code> chamado de <code>resource</code> que já expõe para nós as rotas apontando para cada um dos métodos vistos acima, simplificando ainda mais as coisas.</p>

<p>Em seu arquivo de rotas web adicione a rota abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">resource</code><code class="o">(</code><code class="s1">'/users'</code><code class="o">,</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Http</code><code class="err">\</code><code class="nt">Controllers</code><code class="err">\</code><code class="nt">UserController</code><code class="p">::</code><code class="nd">class</code><code class="o">);</code>
</pre></div>

</figure>


<p>Se nós debugarmos as rotas existentes em nosso projeto até o momento, podemos encontrar, focando no controller como recurso e em suas rotas, o resultado destacado abaixo na imagem. </p>

<p>Para debugarmos as rotas existentes no Laravel, definidas dentro de sua aplicação, basta executar na raiz do seu projeto o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan route:list
</pre></div>

</figure>


<p>Obtendo a lista de rotas de sua aplicação. Veja o destaque nas rotas criadas pelo método <code>resource</code> do <code>Route</code>:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----route-list.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Além de termos gerado o controller com os métodos para serem utilizados dentro de um CRUD completo, temos também a criação das rotas para cada um dos métodos deste controller, por meio da chamada de apenas um método, o método <code>resource</code> do <code>Route</code>. </p>

<p>O método <code>resource</code> recebe o nome da rota, tal qual um prefixo, como primeiro parâmetro e o nome do controller, gerado como recurso, no segundo parâmetro, simples como vimos.</p>

<p>Perceba que na imagem acima: temos as rotas, temos também apelidos para estas rotas e ainda temos rotas para cada um dos verbos HTTP.</p>

<p>Entenda abaixo:</p>

<ul>
  <li>Temos uma rota principal, que serve para listagem de todos os dados, neste caso usuários. Esta rota é <code>/users</code> que aponta para o método <code>index</code> do <code>UserController</code>;</li>
  <li>Temos a rotas <code>users/create</code> que aponta para o método create do <code>Usercontroller</code> que se refere a tela de exibição do form de criação. A rota <code>users/store</code> aponta para o método store de <code>UserController</code> e se refere ao salvar de fato os dados vindos do form de criação;</li>
  <li>Temos ainda a rota para visualização de um dado específico, neste caso, podemos usar tanto a <code>users/{user}</code> (aponta para <code>UserController@show</code>) ou <code>users/{user}/edit</code> (aponta para <code>UserController@edit</code>) via GET, o edit aqui seria exatamente para uma tela com form de edição;</li>
  <li>Para atualização temos a rota <code>users/{user}</code> que aponta para o método update de <code>UserController</code>.</li>
  <li>Temos também a rota <code>users/{user}</code> e aponta para o método <code>destroy</code> do <code>UserController</code>, indicando a remoção de um dado.</li>
</ul>

<p>Perceba acima ou pela imagem que temos rotas com nomes parecidos, em outros cenários a rota mais recente em ordem cima pra baixo seria a primeira a ser executada mas o que difere cada acesso é o verbo HTTP que também vemos na listagem do <code>route:list</code> ou na lista abaixo eu mostro.</p>

<p>Melhorando a visualização e simplificando:</p>

<ul>
  <li>rota: <code>/users/</code>, verbo: <code>GET</code>, controller@método: <code>UserController@index</code>;</li>
  <li>rota: <code>/users/</code>, verbo: <code>POST</code>, controller@método: <code>UserController@store</code>;</li>
  <li>rota: <code>/users/create</code>, verbo: <code>GET</code>, controller@método: <code>UserController@create</code>;</li>
  <li>rota: <code>/users/{user}</code>, verbo: <code>GET</code>, controller@método: <code>UserController@show</code>;</li>
  <li>rota: <code>/users/{user}</code>, verbo: <code>PUT ou PATCH</code>, controller@método: <code>UserController@update</code>;</li>
  <li>rota: <code>/users/{user}</code>, verbo: <code>DELETE</code>, controller@método: <code>UserController@destroy</code>;</li>
  <li>rota: <code>/users/{user}/edit</code>, verbo: <code>GET</code>, controller@método: <code>UserController@edit</code>;</li>
</ul>

<p>Lembrando que você precisa adicionar sua lógica para cada um dos métodos, entretanto, todas as rotas já estão definidas como vimos acima e quando geramos o controller temos as definições dos métodos também.</p>

<h2 id="leanpub-auto-concluses-2" class="section">Conclusões</h2>

<p>Vimos aqui neste capítulo diversas possibilidades sobre as rotas de nossa aplicação e mais opções referentes aos nossos controllers. É claro, que temos mais opções, tanto dentro das rotas quanto na exploração dos controllers.</p>

<p>A cada capítulo vamos conhecendo mais opções para rotas, por exemplo a opção dos middlewares, quando conhecermos os conceitos envolvendo esta parte!</p>

<p>No próximo capítulo iremos falar sobre o envio de dados de um formulário para nosso backend e a manipulação das <code>requests</code> e do nosso <code>response</code>.</p>

<p>Até lá!</p>


<h1 id="leanpub-auto-formulrios-request--response" class="chapter">Formulários, Request &amp; Response</h1>

<p>Neste capítulo vamos conhecer um ponto bem importante n criação das nossas aplicações, como manipular informações recebidas em nossas requests e as particularidades do response HTTP dentro do Laravel.</p>

<p>Aproveito também e já abordo essas requisições com dados vindos de um formulário, onde teremos pontos importantes a serem abordados neste aspecto.</p>

<p>Então vamos lá!</p>

<h2 id="leanpub-auto-iniciando-pelo-formulrio" class="section">Iniciando pelo formulário</h2>

<p>Para começar, vamos criar um formulário para envio dos dados para nosso controller. Para isso crie um arquivo chamado de <code>create.blade.php</code> dentro da pasta de views, colocando ele dentro da pasta <code>products</code>, então crie esta pasta também. O caminho completo até o arquivo ficará assim:</p>

<p><code>resources/views/products/create.blade.php</code></p>

<p>Veja o formulário abaixo a ser adicionado no <code>create.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'products.store'</code><code class="o">)</code><code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"post"</code><code class="nt">&gt;</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 4 </code>        <code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"block mb-2"</code><code class="nt">&gt;</code>Nome<code class="nt">&lt;/label&gt;</code>
<code class="linenos"> 5 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>
<code class="linenos"> 6 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 9 </code>        <code class="nt">&lt;label&gt;</code>Descrição<code class="nt">&lt;/label&gt;</code>
<code class="linenos">10 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"description"</code>  <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>
<code class="linenos">11 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">14 </code>        <code class="nt">&lt;label&gt;</code>Conteúdo<code class="nt">&lt;/label&gt;</code>
<code class="linenos">15 </code>        <code class="nt">&lt;textarea</code> <code class="na">name=</code><code class="s">"body"</code> <code class="na">id=</code><code class="s">""</code> <code class="na">cols=</code><code class="s">"30"</code> <code class="na">rows=</code><code class="s">"10"</code>  <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>\
<code class="linenos">16 </code><code class="nt">&lt;/textarea&gt;</code>
<code class="linenos">17 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">20 </code>        <code class="nt">&lt;label&gt;</code>Preço<code class="nt">&lt;/label&gt;</code>
<code class="linenos">21 </code>       <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"price"</code>  <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>
<code class="linenos">22 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">23 </code>
<code class="linenos">24 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">25 </code>        <code class="nt">&lt;label&gt;</code>Slug<code class="nt">&lt;/label&gt;</code>
<code class="linenos">26 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"slug"</code>  <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>
<code class="linenos">27 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>    <code class="nt">&lt;button</code> <code class="na">class=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-white\</code>
<code class="linenos">30 </code><code class="s"> font-thin"</code><code class="nt">&gt;</code>Criar Produto<code class="nt">&lt;/button&gt;</code>
<code class="linenos">31 </code><code class="nt">&lt;/form&gt;</code>
</pre></div>

</figure>


<p>No formulário temos 5 campos diretamente, são eles:</p>

<ul>
  <li>Nome;</li>
  <li>Descrição;</li>
  <li>Conteúdo;</li>
  <li>Preço;</li>
  <li>Slug (futuramente vamos automatizar esta geração);</li>
</ul>

<blockquote>
  <p>Obs.: Utilizei a estrutrua do form pensando no TailwindCSS, mais a frente no livro vamos configurar esse framework css em nosso projeto. O TailwindCSS é um framework css pensado mais no utilitário, ou seja, classes que representam o estilo aplicado. Nele você também pode componentizar como Bootstrap por exemplo e pra isso você mesmo precisa criar seus código pra reutilização.</p>
</blockquote>

<p>Nosso formulário trabalhará com envio dos dados via método <code>POST</code> e já adicionamos, na action do formulário, a chamada de uma rota pelo seu apelido, a <code>products.store</code>. Vamos gerar nosso controller e nossas rotas para que possamos fazer esse form funcionar.</p>

<p>Gere o controller a partir do seu terminal, com o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller Admin/ProductController
</pre></div>

</figure>


<p>Perceba mais um aprendizado acima, como coloquei <code>Admin/</code> antes do nome do nosso controller, ele será criado dentro da pasta <code>Admin</code> dentro da pasta de controllers. Isso simplifica também nossas gerações, onde podemos especificar pastas a dentro para uma melhor organização dos controllers.</p>

<p>Para este exemplo não vou gerar este controller como recurso porque nosso foco ainda não é gerarmos um crud e sim conhecermos esse trabalho entre as requisições e o envio de dados.</p>

<p>Uma vez criado o controller, adicione os dois métodos abaixo nele:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nv">public</code> <code class="nv">function</code> <code class="nv">create</code><code class="ss">()</code>
<code class="linenos">2 </code>{
<code class="linenos">3 </code>	<code class="k">return</code> <code class="nv">view</code><code class="ss">(</code><code class="s1">'</code><code class="s">products.create</code><code class="s1">'</code><code class="ss">)</code><code class="c1">;</code>
<code class="linenos">4 </code>}
</pre></div>

</figure>


<p>e também:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>public function store(Request $request)
<code class="linenos">2 </code>{
<code class="linenos">3 </code>
<code class="linenos">4 </code>}
</pre></div>

</figure>


<p>O primeiro método será para exibição de nossa view do formulário e o segundo para manipularmos o que for enviado do formulário de criação. Este segundo método veremos mais adiante seu conteúdo.</p>

<p>Até o momento nosso controller fica desta maneira:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Admin</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code><code class="k">class</code> <code class="n">ProductController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos"> 9 </code><code class="p">{</code>
<code class="linenos">10 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">create</code><code class="p">()</code>
<code class="linenos">11 </code>    <code class="p">{</code>
<code class="linenos">12 </code>		<code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'products.create'</code><code class="p">);</code>
<code class="linenos">13 </code>    <code class="p">}</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">store</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos">16 </code>    <code class="p">{</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="p">}</code>
<code class="linenos">19 </code><code class="p">}</code>
</pre></div>

</figure>


<p>View criada, controller e métodos definidos vamos adicionar no arquivo de rotas <code>web.php</code> nossas definições de rota para este trabalho. Vamos lá!</p>

<p>Veja as rotas adicionadas abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'admin'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code><code class="o">()</code><code class="p">{</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code>	<code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">prefix</code><code class="p">(</code><code class="s1">'products'</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'products.'</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">group</code><code class="p">(</code><code class="nf">function</code><code class="p">()</code><code class="err">{</code>
<code class="linenos"> 4 </code>	
<code class="linenos"> 5 </code>		<code class="n">Route</code><code class="err">::</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/create'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Admin</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'crea</code><code class="se">\</code><code class="s1"></code>
<code class="linenos"> 6 </code><code class="s1">te'</code><code class="cp">]</code><code class="p">)</code><code class="o">-</code><code class="err">&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'create'</code><code class="p">)</code><code class="err">;</code>
<code class="linenos"> 7 </code>		
<code class="linenos"> 8 </code>		<code class="n">Route</code><code class="err">::</code><code class="nf">post</code><code class="p">(</code><code class="s1">'/store'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Admin</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'stor</code><code class="se">\</code><code class="s1"></code>
<code class="linenos"> 9 </code><code class="s1">e'</code><code class="cp">]</code><code class="p">)</code><code class="o">-</code><code class="err">&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'store'</code><code class="p">)</code><code class="err">;</code>
<code class="linenos">10 </code>		
<code class="linenos">11 </code>	<code class="err">}</code><code class="p">);</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Perceba acima que isolei o prefixo <b>admin</b>  para o grupo de rotas que contêm o nossas rotas de <code>product</code>. E também isolei o prefixo <b>products</b>, bem como o seu apelido <b>products.</b>, para o conjunto de rotas pensadas para este capítulo.</p>

<p>No fim ao acessarmos <b>/admin/products/create</b> veremos nosso formulário, ainda sem estilo, carregado em nossa tela. E também ao enviarmos nosso form ele mandará os dados para nossa rota <b>/admin/products/store</b>.</p>

<p>Com nosso servidor ligado, através do comando <code>php artisan serve</code> podemos acessar nosso link <b>http://127.0.0.1:8000/admin/products/create</b> chegando ao resultado da imagem abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----form-create.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Feito isso vamos conhecer o request!</p>

<h2 id="leanpub-auto-request-manipulando-requisies" class="section">Request, manipulando requisições</h2>

<p>Vamos começar este trecho tentando enviar qualquer dado para o nosso backend a partir do formulário. Podemos enviar até o form vazio mesmo, então vamos clicar em <b>Criar Produto</b>, enviando nosso formulário.</p>

<p>Se você recebeu a tela de expirado abaixo, não se preocupe! rsrsrsrsrsr!</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----exp.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Por que isso aconteceu? Perceba, pela sua barra de endereços, que ele enviou a requisição para a rota correta: <b>/admin/products/store</b>, então porque recebemos uma tela de requisição expirada?</p>

<p>Quando enviamos dados via POST, PUT ou PATCH o Laravel faz uma validação na requisição para evitar que fontes externas enviem dados ou falsifiquem nossa requisição. Esse controle é chamado de <b>CSRF</b> (Cross Site Request Forgery).</p>

<blockquote>
  <p>Obs.: O CSRF não é algo exclusivo do Laravel, é um tópico de segurança e recomendo fortemente a leitura sobre o assunto.</p>
</blockquote>

<p>Agora como podemos adicionar este controle de segurança em nosso formulário? Vamos lá então, adicione após a abertura da tag form o seguinte input abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="x">&lt;input type="hidden" name="_token" value="</code><code class="cp">{{</code><code class="nv">csrf_token</code><code class="o">()</code><code class="cp">}}</code><code class="x">"&gt;</code>
</pre></div>

</figure>


<p>Acima estamos enviando o token csrf, para validar a procedência e envio dos dados do nosso formulário, através da requisição. Feito isso, volte para a página do formulário atualize e tente enviar novamente.</p>

<p>Agora você verá tudo branco e a página de expirado já não existe mais, como não temos nada definido no método <code>store</code>, lá no controller, o resultado será mesmo uma página em branco mas nossa requisição post, vinda do formulário, já bate na execução do método corretamente.</p>

<p>O input acima, com o token csrf, pode ser substituido completamente pelo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="x"> </code><code class="cp">{{</code><code class="nv">csrf_field</code><code class="o">()</code><code class="cp">}}</code><code class="x"></code>
</pre></div>

</figure>


<p>Que adicionará o input completo como fizemos na mão anteriormente. Ou ainda podemos simplificar mais, utilizando uma diretiva disponível do blade, segue abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="w"> </code><code class="nv">@csrf</code><code class="w"></code>
</pre></div>

</figure>


<p>Que também adiciona o input como fizemos anteriormente. O formulário agora fica desta forma:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code> <code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'products.store'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"post"</code><code class="nt">&gt;</code>
<code class="linenos"> 2 </code>    @csrf
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 5 </code>        <code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"block mb-2"</code><code class="nt">&gt;</code>Nome<code class="nt">&lt;/label&gt;</code>
<code class="linenos"> 6 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>
<code class="linenos"> 7 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">10 </code>        <code class="nt">&lt;label&gt;</code>Descrição<code class="nt">&lt;/label&gt;</code>
<code class="linenos">11 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"description"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>
<code class="linenos">12 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">15 </code>        <code class="nt">&lt;label&gt;</code>Conteúdo<code class="nt">&lt;/label&gt;</code>
<code class="linenos">16 </code>        <code class="nt">&lt;textarea</code> <code class="na">name=</code><code class="s">"body"</code> <code class="na">id=</code><code class="s">""</code> <code class="na">cols=</code><code class="s">"30"</code> <code class="na">rows=</code><code class="s">"10"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code><code class="err">&lt;</code>\
<code class="linenos">17 </code>/textarea&gt;
<code class="linenos">18 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">21 </code>        <code class="nt">&lt;label&gt;</code>Preço<code class="nt">&lt;/label&gt;</code>
<code class="linenos">22 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"price"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>
<code class="linenos">23 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">24 </code>
<code class="linenos">25 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">26 </code>        <code class="nt">&lt;label&gt;</code>Slug<code class="nt">&lt;/label&gt;</code>
<code class="linenos">27 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"slug"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>
<code class="linenos">28 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">29 </code>
<code class="linenos">30 </code>    <code class="nt">&lt;button</code> <code class="na">class=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-white\</code>
<code class="linenos">31 </code><code class="s"> font-thin"</code><code class="nt">&gt;</code>Criar Produto<code class="nt">&lt;/button&gt;</code>
<code class="linenos">32 </code><code class="nt">&lt;/form&gt;</code>
</pre></div>

</figure>


<p>Agora que nosso form já está ‘funcionando’ e nossa requisição está chegando no método como podemos manipular os dados dentro do método <code>store</code>?</p>

<h2 id="leanpub-auto-manipulando-os-dados-da-requisio" class="section">Manipulando os dados da requisição</h2>

<p>Se voltarmos ao método <code>store</code> do <code>ProductController</code>, vamos perceber que em sua assinatura temos a definição de um parâmetro.</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>public function store(Request $request)
<code class="linenos">2 </code>{
<code class="linenos">3 </code>
<code class="linenos">4 </code>}
</pre></div>

</figure>


<p>O parâmetro <code>$request</code>, e seu tipo esperado é um objeto <code>Request</code> do próprio Laravel. O objeto <code>Request</code> vêm do namespace <code>Illuminate\Http\Request</code> e ele é automaticamente resolvido pelo container de injeção de dependências do Laravel, mais a frente falaremos sobre esse container.</p>

<p>Com isso, por meio do parâmetro <code>$request</code> temos a possibilidade de acesso, das mais variadas formas, aos dados enviados na requisição para nosso método, e em nosso caso, vindos do formulário.</p>

<p>Vamos ver um panorama geral dos dados enviados. Adicione o seguinte trecho dentro do método <code>store</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">dd</code><code class="p">(</code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">());</code>
</pre></div>

</figure>


<p>Acima temos contato com mais uma função helper do Laravel, o <code>dd</code> que simplesmente faz uma dump mais customizado dos dados informados a ele e em seguida joga um die travando a continuação da execução do código. Por isso o <code>dd</code> ou <code>dump and die</code>.</p>

<p>Continuando…</p>

<p>Preencha dados em seu formulário e envie novamente a requisição. Veja o resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----dd.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>O resultado acima são todos os campos vindos do nosso formulário, o resultado do dump é o que temos acima mas os dados estão sendo resgatados por meio do método <code>all</code> do objeto <code>Request</code>, que traz todos os dados enviados por meio desta requisição tal qual pegassemos diretamente do nosso conhecido <code>$_POST</code>.</p>

<h3 id="leanpub-auto-recuperando-valores-especficos" class="subsection">Recuperando valores específicos</h3>

<p>Você pode acessar os campos diretamente, por exemplo, se você quiser acessar o nome do produto, enviado do formulário, você pode acessar das seguintes maneiras:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">dd</code><code class="p">(</code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">get</code><code class="p">(</code><code class="s">'name'</code><code class="p">));</code>
</pre></div>

</figure>


<p>ou</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">dd</code><code class="p">(</code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">);</code>
</pre></div>

</figure>


<p>ou ainda</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">dd</code><code class="p">(</code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">input</code><code class="p">(</code><code class="s">'name'</code><code class="p">));</code>
</pre></div>

</figure>


<p>Isso vale para cada campo que você envia e que deseja recuperar o valor.</p>

<blockquote>
  <p>Obs.: Só uma observação, e frisando novamente, estou usando o <code>dd</code> aqui apenas para debug. Mais a frente vamos concluir esta etapa de manipulação, como por exemplo, pegar estes valores e salvar no banco de dados.</p>
</blockquote>

<h3 id="leanpub-auto-verificando-a-existncia-de-um-dado-na-requisio" class="subsection">Verificando a existência de um dado na requisição</h3>

<p>Podemos verificar ainda se determinado campo, parâmetro ou input foi informado em nossa requisição. Para isso podemos utilizar o método <code>has</code> do objeto request.</p>

<p>Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nf">if</code><code class="p">(</code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">has</code><code class="p">(</code><code class="s">'name'</code><code class="p">))</code> <code class="p">{</code>
<code class="linenos">2 </code>    <code class="n">dd</code><code class="p">(</code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">);</code>
<code class="linenos">3 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Com isso podemos realizar determinadas operações para a existência ou não existência dos campos. Se você deseja verificar a existência de vários inputs, você pode utilizar o método <code>hasAny</code>, veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nf">if</code><code class="p">(</code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">hasAny</code><code class="p">([</code><code class="s">'name'</code><code class="p">,</code> <code class="s">'body'</code><code class="p">,</code> <code class="s">'slug'</code><code class="p">]))</code> <code class="p">{</code>
<code class="linenos">2 </code>    <code class="n">dd</code><code class="p">(</code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">);</code>
<code class="linenos">3 </code><code class="p">}</code>
</pre></div>

</figure>


<h3 id="leanpub-auto-recuperando-campos-especficos" class="subsection">Recuperando campos específicos</h3>

<p>Podemos recuperar x inputs se precisarmos. Por exemplo, se você quiser recuperar apenas o campo <code>name</code> e o campo <code>slug</code> da request:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">only</code><code class="p">([</code><code class="s">'name'</code><code class="p">,</code> <code class="s">'slug'</code><code class="p">]);</code>
</pre></div>

</figure>


<p>Desta maneira vamos receber um array com os dois campos informados e seus respectivos valores.</p>

<p>Caso você queira ignorar campos específicos, também é possivel, por exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">except</code><code class="p">([</code><code class="s">'name'</code><code class="p">]);</code>
</pre></div>

</figure>


<p>Neste caso receberemos um array com todos os campos e somente o campo <code>name</code> não estará presente neste array. São método bem úteis quando precisamos destes comportamentos.</p>

<h3 id="leanpub-auto-trabalhando-com-query-strings-ou-parmetros-de-url" class="subsection">Trabalhando com Query Strings ou Parâmetros de URL</h3>

<p>Parâmetros de url, as famosas query strings, são parâmetros informados em nossa url sempre após a <code>?</code> e respeitando <code>chave=valor</code> e quando temos mais de um parâmetro são concatenados pelo <code>&amp;</code>. A querystring é a forma que a requisição envia os dados mantendo seu estado na própria URL com já conhecemos quando estudamos no PHP Básico.</p>

<p>Por exemplo, como eu poderia recuperar o parâmetro <code>search</code> da seguinte url <code>http://127.0.0.1:8000?search=teste</code>?</p>

<p>Para acessarmos seu valor, nós podemos utilizar o método <code>query</code> para recuperar este input exclusivo vindo da url.</p>

<p>Por exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">query</code><code class="p">(</code><code class="s">'search'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Este método, o <code>query</code>, assim como o <code>get</code> e o <code>input</code>, aceita um segundo parâmetro pro caso da não existência do parâmetro ou input solicitado. Podemos definir um valor default que será carregado caso não tenhamos valor no acesso em questão. </p>

<p>Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">query</code><code class="p">(</code><code class="s">'search'</code><code class="p">,</code> <code class="s">'este valor será retornado caso não tenhamos o parâmetro s\</code>
<code class="linenos"> 2 </code><code class="s">earch na query string'</code><code class="p">);</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code><code class="c1">//Pro input e pro get</code>
<code class="linenos"> 5 </code>
<code class="linenos"> 6 </code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">get</code><code class="p">(</code><code class="s">'title'</code><code class="p">,</code> <code class="s">'este valor será retornado caso não tenhamos o parâmetro titl\</code>
<code class="linenos"> 7 </code><code class="s">e na requisição'</code><code class="p">);</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">input</code><code class="p">(</code><code class="s">'title'</code><code class="p">,</code> <code class="s">'este valor será retornado caso não tenhamos o parâmetro ti\</code>
<code class="linenos">10 </code><code class="s">tle na requisição'</code><code class="p">);</code>
</pre></div>

</figure>


<blockquote>
  <p>PS.: por padrão esse valor do segundo parâmetro é NULL então você também pode testar direto por seu retorno se o dado veio ou não com valor. Caso queira verificar se tal chave existe aí recorremos ao has como vismo anteriormente.</p>
</blockquote>

<h2 id="leanpub-auto-response-manipulando-respostas" class="section">Response: manipulando respostas</h2>

<p>Dentro das linguagens Web é importante entendermos o protocolo HTTP e a base dessa arquitetura que é a Web, onde trabalhamos com Requests &amp; Responses e no meio temos os processamentos no backend, seja lá qual for a linguagem.</p>

<p>Manipulamos nossa requisição e de certa forma realizamos processamentos até o momento, agora precisamos conhecer a manipulação das responses ou respostas HTTP. </p>

<p>É claro que abordarei aqui dentro da estrutura do framework mas já deixo uma recomendação de, se caso você não tenha conhecimento básico do http pelo menos, procure mais informações sobre o assunto para entender melhor a arquitetura da web, isso vai te abrir muito a mente.</p>

<p>Então, como podemos manipular esse tal response ou respostas http?</p>

<h3 id="leanpub-auto-manipulando-as-respostas-http" class="subsection">Manipulando as respostas HTTP</h3>

<p>Podemos manipular as respostas http em nossos controllers ou funções anônimas de nossas rotas, utilizando a função helper <code>response</code>. </p>

<p>Veja abaixo uma utilização simples:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="k">return</code> <code class="nv">response</code><code class="ss">(</code><code class="s1">'</code><code class="s">Retornando uma resposta</code><code class="s1">'</code>, <code class="mi">200</code><code class="ss">)</code><code class="c1">;</code>
</pre></div>

</figure>


<p>Acima retornei uma resposta com o conteúdo <code>Retornando uma resposta</code> e o status code http 200, que se refere a status de sucesso.</p>

<p>Podemos definir cabeçalhos HTTP em nossa resposta também. Por exemplo, posso dizer que o tipo da minha resposta é um json da seguinte maneira:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="kr">return</code> <code class="n">response</code><code class="p">([</code><code class="s">'msg'</code> <code class="o">=&gt;</code> <code class="s">'Retorno do tipo json'</code><code class="p">],</code> <code class="mi">200</code><code class="p">)</code>
<code class="linenos">2 </code>            <code class="o">-&gt;</code><code class="kr">header</code><code class="p">(</code><code class="s">'Content-Type'</code><code class="p">,</code> <code class="s">'application/json'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Agora o tipo da resposta, que por default seria do tipo <b>‘text/html’</b>, será do tipo <b>‘application/json’</b> por meio da manipulação do cabeçalho http <code>Content-Type</code> e informando o mime-type por meio deste cabeçalho, em  nosso caso, colocando o tipo para json: <code>application/json</code>.</p>

<p>Podemos ainda manipular cookies e enviar quantos cabeçalhos forem necessários por meio do objeto response. Por exemplo, se você quiser retornar um cookie em uma determinada resposta, basta utilizar como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="kr">return</code> <code class="n">response</code><code class="p">([</code><code class="s">'msg'</code> <code class="o">=&gt;</code> <code class="s">'Retorno do tipo json'</code><code class="p">],</code> <code class="mi">200</code><code class="p">)</code>
<code class="linenos">2 </code>            <code class="o">-&gt;</code><code class="n">cookie</code><code class="p">(</code><code class="s">'nome_cookie'</code><code class="p">,</code> <code class="s">'valor_cookie'</code><code class="p">,</code> <code class="s">'tempo_em_minutos_de_validade_do\</code>
<code class="linenos">3 </code><code class="s">_cookie'</code><code class="p">);</code>
</pre></div>

</figure>


<h3 id="leanpub-auto-redirecionamentos" class="subsection">Redirecionamentos</h3>

<p>Dentro desta manipulação do response, que têm a ver com o retorno de nossas rotas (quer seja em função anônima quer seja no método de um controller), precisamos abordar, também, sobre redirecionamentos.</p>

<p>Em alguns momentos vamos precisar apenas retornar um redirecionamento pós realização de uma determinada execução. Para isso temos a função helper <code>redirect</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="k">return</code> <code class="nv">redirect</code><code class="ss">(</code><code class="s1">'</code><code class="s">/</code><code class="s1">'</code><code class="ss">)</code><code class="c1">;</code>
</pre></div>

</figure>


<p>Acima creio que está bem intuitivo mas não custa comentar. </p>

<p>Após um determinado processo posso redirecionar o usuário para uma determinada url, acima redireciono ele para a página inicial do nosso website mas podemos melhorar ainda mais esses redirecionamentos. No trecho acima redirecionei ele para uma url chamando o nome real da rota, entretanto, eu te disse anteriormente que é melhor trabalharmos com os apelidos da rota ao invés do seu nome real, correto?</p>

<p>Correto, então não se preocupe! </p>

<p>Podemos redirecionar o usuário para a rota desejada por meio do apelido desta rota. </p>

<p>Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'home'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Chamo a função redirect sem parâmetros, com isso temos o retorno do objeto <code>\Illuminate\Routing\Redirector</code> e com isso posso ter acesso ao método <code>route</code>, que inclusive já utilizamos aqui no livro. Agora basta que eu informe o apelido da rota desejada, e  se essa rota possuir parâmetros dinâmicos basta informar em um array no segundo parâmetro do <code>route</code> como já vimos anteriormente também.</p>

<p>Podemos utilizar também um redirect para o estado anterior de uma requisição, isso é perfeito para momentos de erro no processamento de determinado acesso ou envio de dados. Por exemplo, quando enviamos os dados de um formulário para o backend e temos algum erro de validação nos dados. </p>

<p>Para isso temos a função helper <code>back</code>.</p>

<p>Por exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="k">return</code> <code class="nv">back</code><code class="ss">()</code><code class="c1">;</code>
</pre></div>

</figure>


<p>Que retornará o usuário para o estado anterior da requisição assim como o botão back do browser ou melhor simulando esse comportamento.</p>

<p>Geralmente usamos essa função <code>back</code> para momentos de erro de processo ou validações, e nestes casos você precisa voltar o usuário pro momento anterior, caso o usuário tenha mandado dados de um formulário podemos retornar os campos já digitados por ele também, como podemos ver abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="kr">return</code> <code class="n">back</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">withInput</code><code class="p">();</code>
</pre></div>

</figure>


<p>Acima além de voltarmos pro estado da requisição anterior, estamos mandando de volta os inputs digitados. Para manipularmos lá na view, no form e exibir os valores vindos do <code>withInput</code> podemos usar a função helper <code>old</code> nos inputs do nosso formulário.</p>

<p>Lembra do nosso formulário? Olha como ele fica após adicionarmos essa possibilidade de pegar o valor novamente dos campos digitados anteriormente pelo usuário:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'products.store'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"post"</code><code class="nt">&gt;</code>
<code class="linenos"> 2 </code>    @csrf
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 5 </code>        <code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"block mb-2"</code><code class="nt">&gt;</code>Nome<code class="nt">&lt;/label&gt;</code>
<code class="linenos"> 6 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">old</code><code class="o">(</code><code class="s1">'nam\</code>
<code class="linenos"> 7 </code><code class="s1">e'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos"> 8 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">11 </code>        <code class="nt">&lt;label&gt;</code>Descrição<code class="nt">&lt;/label&gt;</code>
<code class="linenos">12 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"description"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">o</code><code class="err">\</code>
<code class="linenos">13 </code><code class="nv">ld</code><code class="o">(</code><code class="s1">'description'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">14 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">15 </code>
<code class="linenos">16 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">17 </code>        <code class="nt">&lt;label&gt;</code>Conteúdo<code class="nt">&lt;/label&gt;</code>
<code class="linenos">18 </code>        <code class="nt">&lt;textarea</code> <code class="na">name=</code><code class="s">"body"</code> <code class="na">id=</code><code class="s">""</code> <code class="na">cols=</code><code class="s">"30"</code> <code class="na">rows=</code><code class="s">"10"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>{\
<code class="linenos">19 </code>{ old('body') }}<code class="nt">&lt;/textarea&gt;</code>
<code class="linenos">20 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">21 </code>
<code class="linenos">22 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">23 </code>        <code class="nt">&lt;label&gt;</code>Preço<code class="nt">&lt;/label&gt;</code>
<code class="linenos">24 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"price"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">old</code><code class="o">(</code><code class="s1">'pr\</code>
<code class="linenos">25 </code><code class="s1">ice'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">26 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">27 </code>
<code class="linenos">28 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">29 </code>        <code class="nt">&lt;label&gt;</code>Slug<code class="nt">&lt;/label&gt;</code>
<code class="linenos">30 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"slug"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">old</code><code class="o">(</code><code class="s1">'slu\</code>
<code class="linenos">31 </code><code class="s1">g'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">32 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code>    <code class="nt">&lt;button</code> <code class="na">class=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-white\</code>
<code class="linenos">35 </code><code class="s"> font-thin"</code><code class="nt">&gt;</code>Criar Produto<code class="nt">&lt;/button&gt;</code>
<code class="linenos">36 </code><code class="nt">&lt;/form&gt;</code>
</pre></div>

</figure>


<p>Perceba no <code>textarea</code> e nos atributos <b><i>value</i></b> de cada input, onde temos agora o print do retorno da função helper <code>old</code>. Nesta função helper informamos o nome do campo que queremos recuperar o valor digitado anteriormente. </p>

<p>Caso aquele campo em questão não esteja na requisição, adicionado pelo <code>withInput</code>, o campo simplesmente fica em branco e o usuário preenche tranquilamente ou altera, se necessitar, o valor previamente digitado.</p>

<p>Isso é perfeito para o usuário, que não precisará digitar tudo novamente caso tenha algum problema no backend e nós se precisarmos retornar ele pro estado anterior pós uma validação não satisfeita por exemplo.</p>

<h2 id="leanpub-auto-concluses-3" class="section">Conclusões</h2>

<p>Neste capítulo trabalhamos com o envio de dados de um formulário para uma determinada rota e aprendemos também a manipular estes valores além de conhecermos mais detalhes sobre o objeto Request e Response. </p>

<p>Vimos ainda, particularidades sobre as repostas HTTP nos resultados de nossos processos, além de conhecermos as possibilidades de redirecionamento que estão diretamente atrelados aos responses uma vez que os redirecionamentos também são uma execução pós-processos.</p>

<p>Agora que já entendemos essas manipulações, vamos conhecer como o Laravel trabalha com banco de dados e como podemos manipular a parte do Model fechando o ciclo MVC dentro do nosso livro.</p>

<p>Nos vemos no próximo capítulo.</p>


<h1 id="leanpub-auto-database-migrations-seeds--factories" class="chapter">Database: Migrations, Seeds &amp; Factories</h1>

<p>Neste capítulo vamos entrar na área, provavelmente a mais esperada, do banco de dados. Conhecendo como o Laravel nos permite realizar a persistência dos dados em nossas aplicações web.</p>

<p>Preciso ressaltar que temos algumas camadas dentro do framework quando tratamos de banco de dados, uma delas é a que vamos abordar neste capítulo, a camada mais baixa, a camada mais estrutural composta por: <code>migrations</code>, <code>seeds</code> &amp; <code>model factories</code>.</p>

<p>Vamos entender o que cada ponto têm de importante aqui.</p>

<p>Comecemos pelas migrations.</p>

<h2 id="leanpub-auto-migrations" class="section">Migrations</h2>

<p>As migrations ou migrações são ferramentas que nos auxiliam no versionamento da estrutura de nossas bases de dados. Funciona basicamente como uma documentação da linha histórica com respeito ao crescrimento estrutural do banco, criação das tabelas, ligações e etc.</p>

<p>Vale ressaltar que o conceito migrações não é algo do Laravel mas que ele se utiliza para trazer mais essa opção e facilidade para quem está desenvolvendo. Criar tabelas e seus aparatos se torna mais fácil quando realizamos isso do ponto de vista de código, que após um comando via artisan é traduzido para o banco em questão.</p>

<p>As migrations dentro do nosso projeto podem ser encontradas dentro da pasta <code>database/migrations</code>. Nesta pasta você já vai encontrar alguns arquivos de migração iniciais, como a migração para a tabela de usuários dentre outras migrações referentes a tabela de jobs(usada para a parte de filas) e algumas a mais.</p>

<p>Vamos da uma olhada na migration da tabela de usuários e entender como é formado um arquivo de migração. </p>

<p>Veja abaixo o arquivo <code>0001_01_01_000000_create_users_table.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Migrations</code>\<code class="n">Migration</code><code class="p">;</code>
<code class="linenos"> 4 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Schema</code>\<code class="n">Blueprint</code><code class="p">;</code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">Facades</code>\<code class="n">Schema</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">return</code> <code class="n">new</code> <code class="k">class</code> <code class="k">extends</code> <code class="n">Migration</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Run</code> <code class="n">the</code> <code class="n">migrations</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">up</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">create</code><code class="p">(</code><code class="s1">'users'</code><code class="p">,</code> <code class="n">function</code> <code class="p">(</code><code class="n">Blueprint</code> <code class="o">$</code><code class="n">table</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">15 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">();</code>
<code class="linenos">16 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'name'</code><code class="p">);</code>
<code class="linenos">17 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'email'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">unique</code><code class="p">();</code>
<code class="linenos">18 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">timestamp</code><code class="p">(</code><code class="s1">'email_verified_at'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">nullable</code><code class="p">();</code>
<code class="linenos">19 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'password'</code><code class="p">);</code>
<code class="linenos">20 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">rememberToken</code><code class="p">();</code>
<code class="linenos">21 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">timestamps</code><code class="p">();</code>
<code class="linenos">22 </code>        <code class="p">});</code>
<code class="linenos">23 </code>
<code class="linenos">24 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">create</code><code class="p">(</code><code class="s1">'password_reset_tokens'</code><code class="p">,</code> <code class="n">function</code> <code class="p">(</code><code class="n">Blueprint</code> <code class="o">$</code><code class="n">table</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">25 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'email'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">primary</code><code class="p">();</code>
<code class="linenos">26 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'token'</code><code class="p">);</code>
<code class="linenos">27 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">timestamp</code><code class="p">(</code><code class="s1">'created_at'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">nullable</code><code class="p">();</code>
<code class="linenos">28 </code>        <code class="p">});</code>
<code class="linenos">29 </code>
<code class="linenos">30 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">create</code><code class="p">(</code><code class="s1">'sessions'</code><code class="p">,</code> <code class="n">function</code> <code class="p">(</code><code class="n">Blueprint</code> <code class="o">$</code><code class="n">table</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">31 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">primary</code><code class="p">();</code>
<code class="linenos">32 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">foreignId</code><code class="p">(</code><code class="s1">'user_id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">nullable</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">index</code><code class="p">();</code>
<code class="linenos">33 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'ip_address'</code><code class="p">,</code> <code class="mi">45</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">nullable</code><code class="p">();</code>
<code class="linenos">34 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">text</code><code class="p">(</code><code class="s1">'user_agent'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">nullable</code><code class="p">();</code>
<code class="linenos">35 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">longText</code><code class="p">(</code><code class="s1">'payload'</code><code class="p">);</code>
<code class="linenos">36 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">integer</code><code class="p">(</code><code class="s1">'last_activity'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">index</code><code class="p">();</code>
<code class="linenos">37 </code>        <code class="p">});</code>
<code class="linenos">38 </code>    <code class="p">}</code>
<code class="linenos">39 </code>
<code class="linenos">40 </code>    <code class="o">/**</code>
<code class="linenos">41 </code>     <code class="o">*</code> <code class="n">Reverse</code> <code class="n">the</code> <code class="n">migrations</code><code class="o">.</code>
<code class="linenos">42 </code>     <code class="o">*/</code>
<code class="linenos">43 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">down</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">44 </code>    <code class="p">{</code>
<code class="linenos">45 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">dropIfExists</code><code class="p">(</code><code class="s1">'users'</code><code class="p">);</code>
<code class="linenos">46 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">dropIfExists</code><code class="p">(</code><code class="s1">'password_reset_tokens'</code><code class="p">);</code>
<code class="linenos">47 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">dropIfExists</code><code class="p">(</code><code class="s1">'sessions'</code><code class="p">);</code>
<code class="linenos">48 </code>    <code class="p">}</code>
<code class="linenos">49 </code><code class="p">};</code>
</pre></div>

</figure>


<p>Perceba acima que a classe de migração, inicialmente extende de uma classe base chamada <b>Migration</b> e traz a definição de dois métodos, o método <code>up</code> e o método <code>down</code>.</p>

<p>O método <code>up</code> será chamado quando essa migração for executada em nosso banco de dados. E o método <code>down</code> contêm a definição do inverso do método <code>up</code>, no método <code>down</code> nós definimos a remoção do que foi aplicado no método <code>up</code>, isso nos permite voltarmos para estados anteriores pré-execução do último lote de migrações.</p>

<p>Vamos da uma atenção ao método <code>up</code>, focando no trecho da criação da tabela <code>users</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">up</code><code class="o">()</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>	<code class="n">Schema</code><code class="p">:</code><code class="o">:</code><code class="nf">create</code><code class="p">(</code><code class="s1">'users'</code><code class="p">,</code> <code class="n">function</code> <code class="err">(</code><code class="n">Blueprint</code> <code class="err">$</code><code class="kc">table</code><code class="p">)</code> <code class="err">{</code>
<code class="linenos"> 4 </code>        <code class="err">$</code><code class="kc">table</code><code class="o">-&gt;</code><code class="nf">id</code><code class="p">();</code>
<code class="linenos"> 5 </code>        <code class="err">$table-&gt;string('name')</code><code class="p">;</code>
<code class="linenos"> 6 </code>        <code class="err">$table-&gt;string('email')-&gt;unique()</code><code class="p">;</code>
<code class="linenos"> 7 </code>        <code class="err">$table-&gt;timestamp('email_verified_at')-&gt;nullable()</code><code class="p">;</code>
<code class="linenos"> 8 </code>        <code class="err">$table-&gt;string('password')</code><code class="p">;</code>
<code class="linenos"> 9 </code>        <code class="err">$table-&gt;rememberToken()</code><code class="p">;</code>
<code class="linenos">10 </code>        <code class="err">$table-&gt;timestamps()</code><code class="p">;</code>
<code class="linenos">11 </code>    <code class="p">}</code><code class="o">);</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="o">//...</code>
<code class="linenos">14 </code><code class="err">}</code>
</pre></div>

</figure>


<p>Temos uma classe base responsável pela definição dos schemas (<b>Schema</b>) da base de dados e é com ela que criamos nossa tabela por meio do método <code>create</code>, informando como primeiro parâmetro o nome da tabela e o segundo parâmetro será um callback (ou função anônima) onde definiremos os campos e estrutura da tabela em questão, no trecho acima a tabela <code>users</code>.</p>

<p>Para definir os campos de nossa tabela precisamos do objeto <code>Blueprint</code>, que nos permite criar os campos e tipos por meio de seus métodos, por isso tipamos o parâmetro <code>$table</code>, do callback, como <code>Blueprint</code>.</p>

<p>O <code>Blueprint</code> contêm métodos para tudo o que é necessário de manipulação de nossa tabela como: geração e remoção de colunas, os mais variados tipos de dados para as colunas em questão, definição de chaves estrangeiras, criação de índices e muito mais.</p>

<p>Podemos criar nossas chaves primárias e auto-incrementáveis utilizando o método <code>id</code> (método este que já vêm na migration, quando fazemos a criação do arquivo pelo artisan), como temos na linha abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">();</code>
</pre></div>

</figure>


<p>Podemos definir campos do tipo string (Varchar), como ocorre abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'name'</code><code class="p">);</code>
<code class="linenos">2 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'email'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">unique</code><code class="p">();</code>
</pre></div>

</figure>


<p>Acima temos a definição de dois campos Varchar e por default recebe 255 caracteres, caso queira especificar um tamanho para o campo, basta preencher o segundo parâmetro com o valor inteiro, correspondente ao tamanho do campo desejado.</p>

<p>Perceba também, que para o e-mail atribuimos uma definição na coluna, assinalando este campo como <code>unique</code> ou seja evitando a duplicação de linhas com o mesmo email, tornando assim, a partir da base, o usuário único por email.</p>

<p>Podemos definir campos de data e hora por meio do método timestamp, veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">timestamp</code><code class="p">(</code><code class="s">'email_verified_at'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">nullable</code><code class="p">();</code>
</pre></div>

</figure>

<p class="fake-para">O campo <code>email_verified_at</code> tabém permitirá nulo, isso definido pelo método nullable.</p>

<p>Temos também a definição de mais um campo tipo VARCHAR para a coluna <code>password</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'password'</code><code class="p">);</code>
</pre></div>

</figure>

<p class="fake-para">E por fim temos a chamada do método <code>rememberToken()</code> e também do <code>timestamps()</code>, o que são esses métodos ou que eles fazem?</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">rememberToken</code><code class="p">();</code>
<code class="linenos">2 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">timestamps</code><code class="p">();</code>
</pre></div>

</figure>


<p>O método <code>rememberToken</code> irá criar uma coluna chamada de <b>remember_token</b>, varchar com tamanho 100 e aceitando o valor nulo. Já o método <code>timestamps</code> irá criar dois campos do tipo timestamp, um chamado de <code>created_at</code> e outro chamada de <code>updated_at</code>, ambos para representarem a data de criação e atualização do dado.</p>

<p>Um ponto interessante é que o Laravel controla os valores destes dois campos(created_at, updated_at), para data de criação e atualização de registros, automaticamente via Models.</p>

<p>Se o método <code>up</code> define a criacão da tabela de <code>users</code>(usuários) o <code>down</code> define a remoção desta tabela. Veja como está a definição do método <code>down</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">down</code><code class="o">()</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>        <code class="n">Schema</code><code class="p">:</code><code class="o">:</code><code class="nf">dropIfExists</code><code class="p">(</code><code class="s1">'users'</code><code class="p">);</code>
<code class="linenos">4 </code>        <code class="n">Schema</code><code class="p">:</code><code class="o">:</code><code class="nf">dropIfExists</code><code class="p">(</code><code class="s1">'password_reset_tokens'</code><code class="p">);</code>
<code class="linenos">5 </code>        <code class="n">Schema</code><code class="p">:</code><code class="o">:</code><code class="nf">dropIfExists</code><code class="p">(</code><code class="s1">'sessions'</code><code class="p">);</code>
<code class="linenos">6 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O método <code>dropIfExists</code>, do objeto <code>Schema</code>, permite a remoção da tabela da base se ela existir, conretizando o inverso do método <code>up</code>. Isso facilita pois podemos voltar um passo anterior, na linha de execução das migrations, desfazendo alterações propostas pela migração em questão.</p>

<blockquote>
  <p>Desde o Laravel 11 a migração para a tabela de users vêm com as definições para mais duas tabelas, como é muito tranquilo entender a estrutura dessas migrations, e claro, aqui espero que você entenda bem do banco de dados, deixo pra você olhar as outras definições existentes neste arquivo de migração atual.</p>
</blockquote>

<p>Agora como pegamos esse código Orientado a Objetos e jogamos para uma base relacional? É o que vamo ver a seguir.</p>

<h2 id="leanpub-auto-executando-primeira-migrao" class="section">Executando primeira migração</h2>

<p>Para executarmos as migrações existentes no projeto podemos utilizar o comando: <code>php artisan migrate</code>.</p>

<p>Este comando sempre vai executar as migrações mais novas na base de dados, as migrações que já foram executadas são registradas na tabela migrations. A tabela migrations é criada pelo Laravel justamente para controlar quais arquivos de migração foram executados. </p>

<p>Aqui te lembro que quando iniciamos o projeto as migrações já foram executadas, ou seja, essas migrações padrões vindas no framework já estão executadas na nossa base de dados (dê uma olhada na tua base depois). O nome da tua base é o nome que você deu pro seu projeto e o Laravel também cria essa base automaticamente baseada nesse nome, lembrando também, que as variáveis de acesso ao banco estão no arquivo <b><i>.env</i></b>.</p>

<p>Veja abaixo como está no projeto atualmente:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>#<code class="nv">Par</code>â<code class="nv">metros</code> <code class="nv">dentro</code> <code class="k">do</code> <code class="nv">arquivo</code> .<code class="nv">env</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="nv">DB_CONNECTION</code><code class="o">=</code><code class="nv">mysql</code>
<code class="linenos">4 </code><code class="nv">DB_HOST</code><code class="o">=</code><code class="mi">127</code>.<code class="mi">0</code>.<code class="mi">0</code>.<code class="mi">1</code>
<code class="linenos">5 </code><code class="nv">DB_PORT</code><code class="o">=</code><code class="mi">3306</code>
<code class="linenos">6 </code><code class="nv">DB_DATABASE</code><code class="o">=</code><code class="nv">store_app</code>
<code class="linenos">7 </code><code class="nv">DB_USERNAME</code><code class="o">=</code><code class="nv">root</code>
<code class="linenos">8 </code><code class="nv">DB_PASSWORD</code><code class="o">=</code>
</pre></div>

</figure>


<p>Caso você queira utilizar outro banco de dados, que não mysql, será necessário alterar o drive na variável <code>DB_CONNECTION</code>.  </p>

<p>Por exemplo, temos os seguintes drives disponiveis por padrão:</p>

<ul>
  <li>Mysql: <b>mysql</b>;</li>
  <li>Sqlite: <b>sqlite</b> (Se for usar sqlite, comente com #  as linhas HOST, DATABASE, USERNAME E PASSWORD e crie um arquivo database.sqlite na pasta database);</li>
  <li>PostgresSql: <b>pgsql</b>;</li>
  <li>SQL Server: <b>sqlsrv</b>;</li>
  <li>MariaDB: <b>mariadb</b>.</li>
</ul>

<p>Ao alterar seu drive você pode rodar o <code>php artisan migrate</code> novamente e caso teu banco não exista o Laravel perguntará se você deseja que ele crie e assim as migration serão executadas.</p>

<p>Sempre que formos rodar as migrações em nosso projeto, e repetindo, o comando será:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate
</pre></div>

</figure>


<p>Veja a imagem abaixo, ele é da versõa anterior do livro mas representa bem o resultado de migratons executadas na base. O log de sucesso será sempre neste caminho:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----migrate.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Se você for na sua base de dados, encontrará a tabela migrations como comentei anteriormente. Nesta tabela está registrada as migrations já executadas em nosso projeto:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----table.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>E é claro as tabelas também foram criadas e estão em nosso banco agora e o número de tabelas é maior pois o Laravel resumiu várias execuções por arquivo e não mais um arquivo por criação de tabela, como é visto na própria migration de users.</p>

<p>Mas, você me pergunta, como posso criar minhas migrações para tabelas do meu projeto? Certo, vamos fazer isso agora!</p>

<h2 id="leanpub-auto-criando-nossas-migraes" class="section">Criando Nossas Migrações</h2>

<p>Primeiro passo é irmos ao nosso terminal e executarmos o comando para geração de nosso primeiro arquivo de migração:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:migration create_products_table
</pre></div>

</figure>


<p>O comando acima criará nosso primeiro arquivo de migração dentro da pasta de migrações, chamado de <code>2025_03_25_150613_create_products_table.php</code>, o nome do arquivo de migração respeita a data de criação e o nome escolhido, em nosso caso: <code>create_products_table</code>. </p>

<p>Essa definição da data e timestamp, do momento de geração desta migration, permite o Laravel organizar a ordem  das migrações e a linha em que elas devem ser executadas, no caso, sempre da mais antiga para a mais nova/recém criada. </p>

<p>Um ponto interessante é que, como colocamos o nome da migração como <b>create_products_table</b>, o Laravel automaticamente preenche o conteúdo dos métodos <b>up</b> e <b>down</b>, da migration, e adiciona algumas colunas base para a tabela, como <b>id</b> e a definição para as colunas <b>created_at</b> e <b>updated_at</b>. </p>

<p>Isso facilita muito nossa vida durante o desenvolvimento. Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Migrations</code>\<code class="n">Migration</code><code class="p">;</code>
<code class="linenos"> 4 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Schema</code>\<code class="n">Blueprint</code><code class="p">;</code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">Facades</code>\<code class="n">Schema</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">return</code> <code class="n">new</code> <code class="k">class</code> <code class="k">extends</code> <code class="n">Migration</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Run</code> <code class="n">the</code> <code class="n">migrations</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">up</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">create</code><code class="p">(</code><code class="s1">'products'</code><code class="p">,</code> <code class="n">function</code> <code class="p">(</code><code class="n">Blueprint</code> <code class="o">$</code><code class="n">table</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">15 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">();</code>
<code class="linenos">16 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">timestamps</code><code class="p">();</code>
<code class="linenos">17 </code>        <code class="p">});</code>
<code class="linenos">18 </code>    <code class="p">}</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>    <code class="o">/**</code>
<code class="linenos">21 </code>     <code class="o">*</code> <code class="n">Reverse</code> <code class="n">the</code> <code class="n">migrations</code><code class="o">.</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">down</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">dropIfExists</code><code class="p">(</code><code class="s1">'products'</code><code class="p">);</code>
<code class="linenos">26 </code>    <code class="p">}</code>
<code class="linenos">27 </code><code class="p">};</code>
</pre></div>

</figure>


<p>Agora vamos as nossas adições, a adição dos nossos campos para nossa tabela de produtos. Criaremos os seguintes campos:</p>

<ul>
  <li>name: string 255;</li>
  <li>description: string 255;</li>
  <li>body: text;</li>
  <li>price: integer; //irei explicar em breve como vamos manipular</li>
  <li>in_stock: interger;</li>
  <li>slug: string 255;</li>
  <li>is_active: boolean.</li>
</ul>

<p>Veja abaixo o código a ser adicionado após o método id, na migração:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>    <code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'name'</code><code class="p">);</code>
<code class="linenos">2 </code>    <code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'description'</code><code class="p">);</code>
<code class="linenos">3 </code>    <code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">text</code><code class="p">(</code><code class="s">'body'</code><code class="p">);</code>
<code class="linenos">4 </code>    <code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">integer</code><code class="p">(</code><code class="s">'price'</code><code class="p">);</code>
<code class="linenos">5 </code>    <code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">integer</code><code class="p">(</code><code class="s">'in_stock'</code><code class="p">);</code>
<code class="linenos">6 </code>    <code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'slug'</code><code class="p">);</code>
<code class="linenos">7 </code>    <code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">boolean</code><code class="p">(</code><code class="s">'is_active'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Simples, acima realizamos as definições dos nossos campos. Agora estamos aptos a executar esta migração em nosso banco de dados, para isso vamos ao nosso terminal executar o comando que já conhecemos.</p>

<p>Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate
</pre></div>

</figure>


<p>Ao executarmos o comando acima novamente, o Laravel só executará as migrações que ainda não foram executadas, por isso que temos o registro na tabela migrations feita automaticamente pelo framework. Veremos que apenas a migração para a tabela de produtos é que será executada desta vez.</p>

<p>Veja o resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----migration-retorno-products-table.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Este processo de trabalho com migrations será parte do seu desenvolvimento e mais a frente dedicaremos um capítulo aos relacionamentos na base e dentro dos models (que ainda veremos também).</p>

<p>É importante salientar que aqui na camada de banco é importante que você entenda bem desta parte para lhe dá melhor no que se trata a tua base de dados e as facilidades que o framework traz para você.</p>

<p>O Laravel possui definições, a partir do Blueprint, de tudo que é necessário para o mapeamento dos tipos das tuas colunas, configuração de CONSTRAINTS e muito mais. Lembrando que pro processo reverso também temos métodos especificos para remover chaves estrangeiras, remover colunas etc, ou seja, nas migrações temos o aparato necessário para a tratativa estutural do nosso banco de dados.</p>

<p>Por hora vamos aos <b>seeds</b> e as <b>factories</b>.</p>

<h2 id="leanpub-auto-seeds" class="section">Seeds</h2>

<p>Quando estamos em nosso ambiente de desenvolvimento sempre precisamos de dados no banco para testes e como sabemos, isso é um saco durante o processo de desenvolvimento. Os seeds nos permitem automatizar este processo simplificando nosso trabalho. Podemos, por meio das seeds, alimentar nosso banco de dados com informações para que possamos testar nossos CRUDs por exemplo.</p>

<p>Você pode encontrar os seeds do sistema dentro da pasta <code>database/seeders</code>, dentro desta pasta você vai encontrar o arquivo <code>DatabaseSeeder.php</code> que é o arquivo principal que executa todas as outras seeds que tivermos nesta pasta ou pode concentrar nele as execuções diretamente. </p>

<p>Veja seu conteúdo atual do arquivo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">Database</code>\<code class="n">Seeders</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">User</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="o">//</code> <code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Console</code>\<code class="n">Seeds</code>\<code class="n">WithoutModelEvents</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Seeder</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="n">DatabaseSeeder</code> <code class="k">extends</code> <code class="n">Seeder</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="o">/**</code>
<code class="linenos">12 </code>     <code class="o">*</code> <code class="n">Seed</code> <code class="n">the</code> <code class="n">application</code><code class="s1">'s database.</code>
<code class="linenos">13 </code>     <code class="o">*/</code>
<code class="linenos">14 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">run</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>        <code class="o">//</code> <code class="n">User</code><code class="p">::</code><code class="n">factory</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">();</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>        <code class="n">User</code><code class="p">::</code><code class="n">factory</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">([</code>
<code class="linenos">19 </code>            <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="s1">'Test User'</code><code class="p">,</code>
<code class="linenos">20 </code>            <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="s1">'test@example.com'</code><code class="p">,</code>
<code class="linenos">21 </code>        <code class="p">]);</code>
<code class="linenos">22 </code>    <code class="p">}</code>
<code class="linenos">23 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba a linha comentada <code>//User::factory(10)-&gt;create();</code>: esta linha é um exemplo para a chamada de uma factory, que nos permite gerar dados fakes em massa.</p>

<p>Já o trecho abaixo, que também é uma chamada de factory:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="k">User</code><code class="o">::</code><code class="n">factory</code><code class="p">()</code><code class="o">-&gt;</code><code class="k">create</code><code class="p">(</code><code class="o">[</code><code class="n"></code>
<code class="linenos">2 </code><code class="n">    'name' =&gt; 'Test User',</code>
<code class="linenos">3 </code><code class="n">    'email' =&gt; 'test@example.com',</code>
<code class="linenos">4 </code><code class="o">]</code><code class="p">);</code><code class="w"></code>
</pre></div>

</figure>

<p class="fake-para">Cria apenas um usuário, baseado na classe factory <code>UserFactory</code> da pasta <code>database/factories</code>, diretamente na base de dados, claro preciso executar o comando para rodar a seed e veremos em breve.</p>

<p>Vamos criar dois arquivos de seed para este momento, primeiro o arquivo que já temos referenciado acima, o <code>UsersTableSeeder</code> e também vamos criar o <code>ProductsTableSeeder</code>. </p>

<p>Tá! Mas como podemos criar isso? Eu te mostro, é bem simples!</p>

<p>Execute os comandos abaixo, primeiro executando a geração de um, depois do outro:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:seeder UsersTableSeeder
</pre></div>

</figure>


<p>Após a execução acima, execute a criação do outro arquivo seeder:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:seeder ProductsTableSeeder
</pre></div>

</figure>


<p>Veja o resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----criando-seeds.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Após a criação, veja que temos dois arquivos, a mais, criados dentro da pasta de seeders, o <code>UsersTableSeeder.php</code> e também o <code>ProductsTableSeeder.php</code>. </p>

<p>Agora o que faremos com eles?</p>

<p>Podemos utilizar ambos os arquivos de seed para gerarmos 1 usuário e 1 produto para nossa base. Como fazer isso?</p>

<p>Abra o arquivo <code>UsersTableSeeder.php</code> e adicione o código abaixo no método <code>run</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nl">DB</code><code class="p">:</code><code class="err">:</code><code class="nc">table</code><code class="p">(</code><code class="s1">'users'</code><code class="p">)</code><code class="o">-&gt;</code><code class="k">insert</code><code class="p">(</code><code class="o">[</code><code class="n"></code>
<code class="linenos">2 </code><code class="n">    'name'     =&gt; 'Primeiro Usuário',</code>
<code class="linenos">3 </code><code class="n">    'email'    =&gt; 'email@email.com',</code>
<code class="linenos">4 </code><code class="n">    'password' =&gt; bcrypt('secret')</code>
<code class="linenos">5 </code><code class="o">]</code><code class="p">);</code><code class="w">   </code>
</pre></div>

</figure>

<blockquote>
  <p>PS.: Não esqueça de add o namespace pro DB: <code>use Illuminate\Support\Facades\DB;</code></p>
</blockquote>

<p>Acima temos o primeiro contato com o objeto <code>DB</code>, que nos permite a execução de queries SQL no mais baixo nível, em relação a parte do ORM que veremos mais a frente. Nele informo a tabela que quero realizar a inserção do dado, por meio do método <code>table</code> e logo após, aninhando, chamo o método <code>insert</code> informando um array associativo, respeitando as colunas como chave e seus valores a serem salvos.</p>

<p>Perceba que no campo de senha do usuário utilizo o helper <b>bcrypt</b> para encryptar a senha do nosso usuário.</p>

<p>Após isso adicione o conteúdo do método <code>run</code> do <code>ProductsTableSeeder</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">DB</code><code class="p">::</code><code class="nd">table</code><code class="o">(</code><code class="s1">'products'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">insert</code><code class="o">(</code><code class="cp">[</code>
<code class="linenos">2 </code>    <code class="s1">'name'</code>       <code class="o">=&gt;</code> <code class="s1">'Primeiro Produto'</code><code class="p">,</code>
<code class="linenos">3 </code>    <code class="s1">'description'</code> <code class="o">=&gt;</code> <code class="s1">'Produto teste com seeds'</code><code class="p">,</code>
<code class="linenos">4 </code>    <code class="s1">'body'</code>     <code class="o">=&gt;</code> <code class="s1">'Conteúdo do Produto'</code><code class="p">,</code>
<code class="linenos">5 </code>    <code class="s1">'in_stock'</code>    <code class="o">=&gt;</code> <code class="mi">34</code><code class="p">,</code>
<code class="linenos">6 </code>    <code class="s1">'price'</code>       <code class="o">=&gt;</code> <code class="p">(</code><code class="mf">14.99</code> <code class="o">*</code> <code class="mi">100</code><code class="p">),</code>
<code class="linenos">7 </code>    <code class="s1">'is_active'</code>   <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code>
<code class="linenos">8 </code>    <code class="s1">'slug'</code>        <code class="o">=&gt;</code> <code class="s1">'primeira-produto'</code>
<code class="linenos">9 </code><code class="cp">]</code><code class="o">);</code>
</pre></div>

</figure>


<p>Agora vamos voltar lá no <code>DatabaseSeeder</code> e adicionar a chamada para estas duas classes Seed, que acabamos de criar e definir: <code>UsersTableSeeder</code> &amp; <code>ProductsTableSeeder</code>. </p>

<p>O conteúdo do arquivo <code>DatabaseSeeder</code> ficará assim, veja ele todo na íntegra abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">Database</code>\<code class="n">Seeders</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">User</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="o">//</code> <code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Console</code>\<code class="n">Seeds</code>\<code class="n">WithoutModelEvents</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Seeder</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="n">DatabaseSeeder</code> <code class="k">extends</code> <code class="n">Seeder</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="o">/**</code>
<code class="linenos">12 </code>     <code class="o">*</code> <code class="n">Seed</code> <code class="n">the</code> <code class="n">application</code><code class="s1">'s database.</code>
<code class="linenos">13 </code>     <code class="o">*/</code>
<code class="linenos">14 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">run</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>        <code class="o">//</code> <code class="n">User</code><code class="p">::</code><code class="n">factory</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">();</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>        <code class="o">//</code> <code class="n">User</code><code class="p">::</code><code class="n">factory</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">([</code>
<code class="linenos">19 </code>        <code class="o">//</code>     <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="s1">'Test User'</code><code class="p">,</code>
<code class="linenos">20 </code>        <code class="o">//</code>     <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="s1">'test@example.com'</code><code class="p">,</code>
<code class="linenos">21 </code>        <code class="o">//</code> <code class="p">]);</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>        <code class="o">//</code><code class="n">Chamada</code> <code class="n">dos</code> <code class="n">nosso</code> <code class="n">seeders</code>
<code class="linenos">24 </code>        <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">call</code><code class="p">(</code><code class="n">UsersTableSeeder</code><code class="p">::</code><code class="k">class</code><code class="p">);</code>
<code class="linenos">25 </code>        <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">call</code><code class="p">(</code><code class="n">ProductsTableSeeder</code><code class="p">::</code><code class="k">class</code><code class="p">);</code>
<code class="linenos">26 </code>    <code class="p">}</code>
<code class="linenos">27 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Este passo feito, vamos ao terminal e conhecer mais um comando. Desta vez para execução dos nossos seeds, alimentando dados em nossa base.</p>

<p>Em seu terminal e na raiz do projeto execute o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan db:seed
</pre></div>

</figure>


<p>Veja o resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----excutando-seeds.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Se você for ao seu banco e consultar as tabelas verá que os dados foram criados corretamente como definimos nas classes de seed. </p>

<p>Se precisarmos de mais dados, como por exemplo, inserir 30 produtos e fazer isso só com seeds teríamos um trabalho colossal mas este trabalho se simplifica por meio do que chamamos de <b>Model Factories</b>. </p>

<p>Então vamos crescer mais dentro do Laravel conhecendo mais esta funcionalidade que nos auxilia neste camada/etapa do desenvolvimento.</p>

<p>Vamos continuando…</p>

<h2 id="leanpub-auto-factories" class="section">Factories</h2>

<p>Quando precisamos realizar a geração de muitos dados de forma mais automatizada podemos utilizar as <b>Factories</b> ou <b>Model Factories</b> para realizar este trabalho.</p>

<p>Aqui, de certa forma, teremos algum contato sobre models mas não vou me ater a eles (Models) no momento, pois o próximo capítulo será sobre esta camada e o tratamento com banco de dados. Como precisamos de models, para uso das Factories, na geração automatizada de dados para nossa aplicação, vou começar primeiramente com o model que já vem no projeto recém criado, o model Users.</p>

<p>As factories definem as regras para criação de dados fictícios em nossas tabelas, com base no model escolhido e conforme a quantidade especificada. No fim das contas, são chamados de factories ou fábricas por serem um esboço para criação de dados e junto com os seeds realizamos a inserção dos dados na base. </p>

<p>Você pode encontrar os arquivos de factories na pasta <code>database/factories</code>.</p>

<p>Nesta pasta já temos um arquivo de factory, o <code>UserFactory.php</code>. Veja o conteúdo dele abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">Database</code>\<code class="n">Factories</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Factories</code>\<code class="n">Factory</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">Facades</code>\<code class="n">Hash</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">Str</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="o">/**</code>
<code class="linenos">10 </code> <code class="o">*</code> <code class="err">@</code><code class="k">extends</code> \<code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Factories</code>\<code class="n">Factory</code><code class="o">&lt;</code>\<code class="n">App</code>\<code class="n">Models</code>\<code class="n">User</code><code class="o">&gt;</code>
<code class="linenos">11 </code> <code class="o">*/</code>
<code class="linenos">12 </code><code class="k">class</code> <code class="n">UserFactory</code> <code class="k">extends</code> <code class="n">Factory</code>
<code class="linenos">13 </code><code class="p">{</code>
<code class="linenos">14 </code>    <code class="o">/**</code>
<code class="linenos">15 </code>     <code class="o">*</code> <code class="n">The</code> <code class="n">current</code> <code class="n">password</code> <code class="n">being</code> <code class="n">used</code> <code class="n">by</code> <code class="n">the</code> <code class="n">factory</code><code class="o">.</code>
<code class="linenos">16 </code>     <code class="o">*/</code>
<code class="linenos">17 </code>    <code class="n">protected</code> <code class="k">static</code> <code class="err">?</code><code class="n">string</code> <code class="o">$</code><code class="n">password</code><code class="p">;</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="o">/**</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="n">Define</code> <code class="n">the</code> <code class="n">model</code><code class="s1">'s default state.</code>
<code class="linenos">21 </code>     <code class="o">*</code>
<code class="linenos">22 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> <code class="n">mixed</code><code class="o">&gt;</code>
<code class="linenos">23 </code>     <code class="o">*/</code>
<code class="linenos">24 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">definition</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">25 </code>    <code class="p">{</code>
<code class="linenos">26 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">27 </code>            <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="n">fake</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">(),</code>
<code class="linenos">28 </code>            <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="n">fake</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">unique</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">safeEmail</code><code class="p">(),</code>
<code class="linenos">29 </code>            <code class="s1">'email_verified_at'</code> <code class="o">=&gt;</code> <code class="n">now</code><code class="p">(),</code>
<code class="linenos">30 </code>            <code class="s1">'password'</code> <code class="o">=&gt;</code> <code class="k">static</code><code class="p">::</code><code class="o">$</code><code class="n">password</code> <code class="err">??</code><code class="o">=</code> <code class="n">Hash</code><code class="p">::</code><code class="n">make</code><code class="p">(</code><code class="s1">'password'</code><code class="p">),</code>
<code class="linenos">31 </code>            <code class="s1">'remember_token'</code> <code class="o">=&gt;</code> <code class="n">Str</code><code class="p">::</code><code class="n">random</code><code class="p">(</code><code class="mi">10</code><code class="p">),</code>
<code class="linenos">32 </code>        <code class="p">];</code>
<code class="linenos">33 </code>    <code class="p">}</code>
<code class="linenos">34 </code>
<code class="linenos">35 </code>    <code class="o">/**</code>
<code class="linenos">36 </code>     <code class="o">*</code> <code class="n">Indicate</code> <code class="n">that</code> <code class="n">the</code> <code class="n">model</code><code class="s1">'s email address should be unverified.</code>
<code class="linenos">37 </code>     <code class="o">*/</code>
<code class="linenos">38 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">unverified</code><code class="p">():</code> <code class="k">static</code>
<code class="linenos">39 </code>    <code class="p">{</code>
<code class="linenos">40 </code>        <code class="k">return</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">state</code><code class="p">(</code><code class="n">fn</code> <code class="p">(</code><code class="n">array</code> <code class="o">$</code><code class="n">attributes</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos">41 </code>            <code class="s1">'email_verified_at'</code> <code class="o">=&gt;</code> <code class="nb nb-Type">null</code><code class="p">,</code>
<code class="linenos">42 </code>        <code class="p">]);</code>
<code class="linenos">43 </code>    <code class="p">}</code>
<code class="linenos">44 </code><code class="p">}</code>
</pre></div>

</figure>


<p>As Factories, no Laravel desde a v8, receberam diversos incrementos e o primeiro deles é a estrutura de classe que foi adicionada em sua escrita. Antes as factories eram arquivos php com o código definido de forma imperativa.</p>

<p>Esta classe factory, do UserFactory, e outras classes que iremos gerar no futuro, são bem tranquilas de entender. Primeiramente o Laravel faz o autodiscover da classe de factory por meio do padrão &lt;Model&gt;Factory e sempre que precisarmos executar a criação destes dados fazemos por meio do model, que recebe uma trait pra lhe dá corretamente com a sua classe factory.</p>

<p>No método <b>definition</b>, podemos definir o esboço para geração dos nossos dados fakes, perceba que o array retornado neste método respeita exatamente a estrutura da tabela users. É importante ressaltar que os dados fakes são gerados pelo pacote <i>Faker</i> que já está associado na classe base a qual nossa classe factory extende e este pacote faker nos permite gerar todo tipo de dado falso(pra testes), como números de telefone, nomes, frases, textos e muitos mais.</p>

<p>Esta classe UserFactory, possui ainda mais um método que se utiliza do pensamento de estado durante a execução desta factory, que foi adicionado as factories no Laravel 8. Basicamente podemos criar métodos que podem ser chamados durante a execução desta factory de forma a gerar x dados com status específicos, como você pode ver exatamamente na ideia do método unverified. Posso criar x usuários com o status de email não verificado.</p>

<p>PS.: Sempre que precisar de dados fake para sua coluna em questão, dê uma olhada nas possibilidades disponiveis no link https://github.com/fzaninotto/Faker#formatters.</p>

<p>Como podemos executar esta factory existente?</p>

<p>Vamos ver a seguir.</p>

<h2 id="leanpub-auto-model-factories-com-seeds" class="section">Model Factories com Seeds</h2>

<p>Como comentado, vamos executar nossa inserção de dados utilizando o dado esboçado pela factory. Como o título do trecho diz, precisamos combinar a geração dos dados, utilizando a factory, junto com a execução via seeds. Agora, vamos alterar nosso UsersTableSeeder para utilizar as factories.</p>

<p>Comente o conteúdo do método <code>run</code> do UsersTableSeeder e adicione a chamada abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">User</code><code class="p">::</code><code class="nd">factory</code><code class="o">(</code><code class="nt">10</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">create</code><code class="o">();</code>
</pre></div>

</figure>


<p>Ao invés de usarmos o objeto <code>DB</code>, como fizemos anteriormente, chamaremos a partir do model User o método factory, que recebe como parâmetro a quantidade de dados que queremos criar, neste caso 10 e logo após podemos chamar o método create que é quem irá de fato alimentar a tabela com estes dados. </p>

<p>Depois desta definição na classe <code>UsersTableSeeder</code> vamos ao terminal e vamos rodar somente o seed para a classe de seed de usuário. </p>

<p>Para isto execute o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan db:seed --class=UsersTableSeeder
</pre></div>

</figure>


<p>Resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----users-seeder.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Acima conhecemos mais uma possibilidade dos seeds, podemos executar seeds especificando a classe que queremos executar, em nosso caso apenas o conteúdo do UsersTableSeeder informando o parâmetro <code>--class</code> e o nome da classe. </p>

<p>Se você for ao seu banco, além do dado que já haviamos inserido no momento anterior com o seed, você verá mais 10 registros que foram gerados neste último comando, por meio da execução da factory via execução dos seeds. Perceba que isso simplifica bastante nossas vidas, pois se quisermos mais dados fakes, basta definirmos a quantidade desejada no parâmetro do método factory.</p>

<p>Por hora sobre factories e seeds é o que queria mostrar dado o escopo do nosso capítulo, em breve, nos próximos capítulos trabalharemos mais com estas camadas quando começarmos a focar nos conhecimentos dos Models e darmos largada de vez ao nosso app exemplo aqui do livro.</p>

<h2 id="leanpub-auto-migrations-revertendo-coisas" class="section">Migrations! Revertendo coisas!</h2>

<p>Agora que já conhecemos como criar tabelas e como alimentá-las com dados falsos para nosso desenvolvimento, vamos entender como podemos reverter as coisas quando tratamos das migrações e suas criações e alterações.</p>

<p>Primeramente caso precisemos voltar o último lote de migrações executados, podemos usar o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate:rollback
</pre></div>

</figure>


<p>O comando <b>migrate:rollback</b>, como comentado, desfará tudo que as migrações do último lote de execução fizeram. Em nosso caso, foi a criação da tabela de produtos. Você pode voltar também as execução por meio de passos, informando o parâmetro <code>--step</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate:rollback --step=2
</pre></div>

</figure>

<p class="fake-para">Neste caso acima, ele desfará as duas migrações mais recentes, nesse desfazer de coisas que o método down da migration faz em suas definições.</p>

<blockquote>
  <p>Lembrando que nos processos de reverter coisas em migrations os métodos <code>down</code> é que serão chamadas e executados das migrações mais novas para as mais antigas.</p>
</blockquote>

<p>Podemos ainda realizar operações em cima de todas as migrações, desfazendo-as, de uma vez só com o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate:reset
</pre></div>

</figure>


<p>O comando desfará todas as migrações executadas em sua base, deixando apenas a tabela migrations mas vazia. Caso queiramos resetar e re-executar as migrações novamente de uma vez só, podemos executar o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate:refresh
</pre></div>

</figure>


<p>Ou ainda executar tudo do zero novamente com o comando fresh, que apaga todas as tabelas e executa as migrations novamente:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate:fresh
</pre></div>

</figure>


<p>Este comando acima, o <code>migrate:fresh</code>, executa um drop table na base antes de re-executar as migrations então tome cuidado caso tenha tabelas que não estão mapeadas por migrations, pois com o drop elas podem ser removidas e este ponto é o que diferencia o fresh do refresh.</p>

<p>O refresh faz um rollback e re-executa as migrações sem mexer na base no que diz respeito a coisas fora das migrações e o fresh faz um drop (ALL) table para poder executar as migrações novamente.</p>

<h3 id="leanpub-auto-refresh-com-execuo-de-seeds" class="subsection">Refresh com execução de seeds</h3>

<p>Caso queira voltar todos os passos executados nas migrations e na re-execução, executar as seeds junto, podemos informar o parâmetro <code>--seed</code> como opção ao comando <code>refresh</code>. </p>

<p>Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate:refresh --seed
</pre></div>

</figure>


<p>Com isso teremos a execução reversa das migrações, sua re-execução e ainda a execução das seeds no banco de dados. Veja o resultado do comando abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----migracoes-seeds.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Isso facilita muito nossas vidas!</p>

<p>Podemos usar o parâmetro <code>--seed</code> tanto no <b>migrate:refresh</b>, como no <b>migrate:fresh</b> e também na execução do comando <b>migrate</b>.</p>

<h2 id="leanpub-auto-concluses-4" class="section">Conclusões</h2>

<p>Bom, este capítulo foi bem denso e trabalhoso mas com muitas vantagens demonstradas pelo framework Laravel. Recomendo fortemente que você execute bastante os comandos aprendidos aqui e teste cada nuance dos comandos para reverter coisas no banco via migrations.</p>

<p>No próximo capítulo vamos subir o nível de utilização da camada de banco, tratando diretamente com os Models e suas representações. </p>

<p>Então até lá!</p>


<h1 id="leanpub-auto-eloquent-trabalhando-com-models" class="chapter">Eloquent, trabalhando com Models</h1>

<p>Continuando nosso trabalho com a camada de dados e persitência, vamos subir o nível, conhecendo a camada dos models e como podemos trabalhar buscas, inserções, atualizações, remoções via objetos.</p>

<p>Vamos começar primeiro pelas queries e ir crescendo nosso conhecimento no decorrer deste capítulo. Para isto vamos usar nosso controller <code>ProductController</code> que se encontra dentro da pasta <code>Admin</code> em controllers.</p>

<p>Mas antes…</p>

<h2 id="leanpub-auto-os-models" class="section">Os Models!</h2>

<p>No Laravel, os models são a representação, do ponto de vista de objetos, das tabelas do nosso banco de dados.</p>

<p>Por exemplo, por convenção do framework, se eu tenho uma tabela chamada <code>products</code> na base, a representação em model desta tabela será uma classe chamada de <code>Product</code>. Se eu tenho uma tabela <code>users</code>, sua representação via model será uma classe chamada de <code>User</code>.</p>

<p>O Laravel automaticamente tentará, por convenção, resolver sua tabela no plural por ter o pensamento, na base, de uma coleção de dados, ou seja, se tenho um model Product e como comentado, o Laravel tentará buscar os dados da tabela products.</p>

<p>É possível mudar essa mágica do framework, sobscrevendo a propriedade protegida <code>$table</code> dentro do model que deseja mudar, colocando o nome da sua tabela caso ela não siga a convenção do plural resolvida pelo Laravel.</p>

<p>Vamos começar a entender como interagir com os dados.</p>

<p>Por exemplo, como posso pegar todos as postagens via Model? Para isto temos um método chamada de <code>all</code> que faz este trabalho para nós.</p>

<p>Por exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">return</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">Product</code><code class="p">::</code><code class="nd">all</code><code class="o">();</code>
</pre></div>

</figure>


<p>O resultado do método acima se fossemos pensar em uma query na base, seria uma sql como esta:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>select * from products
</pre></div>

</figure>


<p>Lembrando que ainda não criamos nosso primeiro model, então vamos a esta tarefa. Execute na raiz do projeto o seguinte comando gerador:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:model Product
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----criando-primeiro-model.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Veja o conteúdo do model abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Models</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Model</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">Product</code> <code class="k">extends</code> <code class="n">Model</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">//</code>
<code class="linenos">10 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Veja nosso model acima, bem simples inclusive, basicamente todo o processo para manipular o banco é herdado da classe Model, do Eloquent que é o ORM responsável por trabalhar esta camada de Objeto para o Relacional do Banco de Dados. </p>

<p>Neste model, caso tivessemos gerado a factory junto, ele viria com a trait para manipulação das factories, factories essas que vimos anteriormente aqui na jornada.</p>

<p>Se, por ventura, você quiser utilizar um nome de tabela de sua escolha e não quiser que o Laravel resolva o nome dela de forma mágica, você pode sobscrever o atributo <code>$table</code> dentro do seu model como mostrado no conteúdo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Models</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Model</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">Product</code> <code class="k">extends</code> <code class="n">Model</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="n">protected</code> <code class="o">$</code><code class="n">table</code> <code class="o">=</code> <code class="s1">'nome_da_sua_tabela'</code><code class="p">;</code>
<code class="linenos">10 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Acima ao invés do Laravel tentar encontrar a tabela no plural ele pegará o valor do atributo <code>$table</code>.</p>

<p>Deixarei o conteúdo acima para exemplo mas utilizarei a convenção em nossos models sem a utilização do atributo <code>$table</code>.  </p>

<p>Certo mas então o que é o Eloquent?</p>

<h2 id="leanpub-auto-eloquent" class="section">Eloquent?</h2>

<p>O Eloquent é o ORM padrão do Laravel, é a camada, via objetos, para manipulação dos dados de seu banco. O ORM é a camada que traduz sua estrutura de objetos, Models, para a camada relacional do seu banco de dados.</p>

<p>Veja um exemplo de inserção de um produto utilizando o Eloquent:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="c1">//O códiga poderia está em um método do controller</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="err">$</code><code class="n">product</code> <code class="o">=</code> <code class="n">new</code> <code class="err">\</code><code class="n">App</code><code class="err">\</code><code class="n">Models</code><code class="err">\</code><code class="n">Product</code><code class="p">();</code>
<code class="linenos"> 4 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">name</code>       <code class="o">=</code> <code class="s">'Product salvo com eloquent e active record'</code><code class="p">;</code>
<code class="linenos"> 5 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">description</code> <code class="o">=</code> <code class="s">'Descrição product'</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">body</code>     <code class="o">=</code> <code class="s">'Conteúdo do product'</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">slug</code>        <code class="o">=</code> <code class="s">'product-salvo-com-eloquent-e-active-record'</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">in_stock</code>    <code class="o">=</code> <code class="mi">30</code><code class="p">;</code>
<code class="linenos"> 9 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code>       <code class="o">=</code> <code class="p">(</code><code class="mf">299.90</code> <code class="o">*</code> <code class="mi">100</code><code class="p">);</code>
<code class="linenos">10 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">is_active</code>   <code class="o">=</code> <code class="kr">true</code><code class="p">;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code><code class="c1">//Aqui a inserção do produto é , de fato, realizado na tabela.</code>
<code class="linenos">13 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">save</code><code class="p">();</code> 
</pre></div>

</figure>


<p>Veja como é simples, dou inicio uma nova instância de <code>Product</code> , chamo as colunas como atributos do objeto e por fim para salvar os dados atribuídos a cada um dos atributos, utilizo o método <code>save</code> do model para realizar a operação de criação do nosso produto.</p>

<p>Aqui no livro vou abordar mais conceitos do Eloquent de forma prática e pontuando os comportamentos. Me utilizarei, para salvar e atualizar os dados, do conceito de <b>Mass Assignment</b> que explicarei mais a frente.</p>

<blockquote>
  <p>PS.: Antes de prosseguirmos, recomendo fortemente a leitura sobre <b>Active Record</b> caso queira conhecer esse padrão, o modelo de inserção apresentado acima se utiliza deste padrão. Padrão este que têm muitos contras por parte da comunidade mas vale o conhecimento toda via.</p>
</blockquote>

<h2 id="leanpub-auto-eloquent-na-prtica" class="section">Eloquent na prática</h2>

<p>Lembra que já temos um controller para utilização e criação de um CRUD para produtos? </p>

<p>Por meio deste CRUD vamos focar nos pontos mais cruciais para você conhecer o trabalho do Eloquent em nossas aplicações. Nosso controller encontra-se na pasta dos controllers, dentro da pasta <code>Admin</code> e o controller <code>ProductController</code>.</p>

<p>Primeiramente vamos definir nosso método index. Trabalhando do ponto de vista dos models eu consigo realizar operações de busca dos dados em minhas tabelas, como mostrado anteriormente posso buscar todos os registros do banco de dados por meio do método <code>all</code>. </p>

<p>Trecho abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">return</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">Product</code><code class="p">::</code><code class="nd">all</code><code class="o">();</code>
</pre></div>

</figure>


<p>Ou posso retornar os dados paginados, para exibição em uma tabela html na view. Então vamos começar a implementar o método index no controller <code>ProductController</code> que está na pasta <code>Admin</code>. </p>

<p>Veja o conteúdo dele abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">index</code><code class="o">()</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>	<code class="err">$products</code> <code class="err">=</code> <code class="n">Post</code><code class="p">:</code><code class="o">:</code><code class="nf">paginate</code><code class="p">(</code><code class="mi">15</code><code class="p">);</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code>	<code class="err">dd($products)</code><code class="p">;</code> <code class="err">//no</code> <code class="err">próximo</code> <code class="err">capítulo</code> <code class="err">vamos</code> <code class="err">mandar</code> <code class="err">para</code> <code class="err">view...</code>
<code class="linenos">6 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Veja o código acima, por enquanto, ainda não vamos utilizar a view, retornaremos a ela e os pontos do Blade no próximo capítulo. Voltando ao código acima, perceba que chamei o <code>Product::paginate</code>, informando que quero <i>15</i> produtos, neste caso, os dados vão vir do banco paginados e teremos os <i>15</i> produtos por cada tela da paginação.</p>

<p>Não esqueça de importar o Model Product em seu controller:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>use App\Models\Product;
</pre></div>

</figure>


<p>Agora, vamos lá no arquivo de rotas e realizar uma pequena alteração no que já havíamos feito, para o conjunto de rotas de produto, então, o que está assim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'admin'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code> <code class="o">()</code> <code class="p">{</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">prefix</code><code class="p">(</code><code class="s1">'products'</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'products.'</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">group</code><code class="p">(</code><code class="n">function</code> <code class="err">(</code><code class="p">)</code> <code class="err">{</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>        <code class="n">Route</code><code class="o">::</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/create'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Admin</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code><code class="o">\</code>
<code class="linenos"> 6 </code> <code class="s1">'create'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'create'</code><code class="p">);</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code>        <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">post</code><code class="p">(</code><code class="s1">'/store'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Admin</code><code class="o">\</code><code class="nx">ProductController</code><code class="nl">::class</code><code class="p">,</code><code class="o">\</code>
<code class="linenos"> 9 </code> <code class="s1">'store'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'store'</code><code class="p">);</code>
<code class="linenos">10 </code>    <code class="p">}</code><code class="o">);</code>
<code class="linenos">11 </code><code class="err">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Vamos atualizar para a chamada do controller como recurso, ficando como vemos abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'admin'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code><code class="o">()</code><code class="p">{</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code>	<code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">resource</code><code class="p">(</code><code class="s1">'products'</code><code class="p">,</code> <code class="err">\</code><code class="n">App</code><code class="err">\</code><code class="n">Http</code><code class="err">\</code><code class="n">Controllers</code><code class="err">\</code><code class="n">Admin</code><code class="err">\</code><code class="n">ProductController</code><code class="err">::</code><code class="n">class</code><code class="p">);</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Perceba, que agora simplificamos mais ainda nossas rotas dentro do grupo para o admin. Quando trabalhamos no capítulo sobre request e response, os métodos <code>create</code> e <code>store</code>, que já existem no controller, foram pensados já para deixá-los no pensamento do método <code>resource</code> e os controllers como recurso.</p>

<p>Se você for ao seu browser agora e acessar <code>http://127.0.0.1:8000/admin/products</code> você verá o resultado abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----paginate.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Veja que expandi o atributo <code>items</code> e seu nivel a dentro, onde temos a coleção de dados retornada. Veja que tivemos <i>1</i> item retornado, em nosso caso o produto criado durante o aprendizado de seeds. </p>

<p>Quandos se trata de navegação nos dados paginados o passo é bem simples, basta informarmos na url o parâmetro <code>page=&lt;pagina-que-queremos&gt;</code> (como querystring) por exemplo.</p>

<p>O retorno do método <code>paginate</code> do eloquent, e como podemos ver na imagem anterior, é um objeto do tipo <code>Illuminate\Pagination\LengthAwarePaginator</code> que dentre muitos detalhes possui também o método para exibir a paginação em nossas telas na camada de views.</p>

<p>Quando formos trabalhar com as views e o Blade, veremos uma forma simples de criar a páginação no frontend, simplificando esta navegação.</p>

<h3 id="leanpub-auto-buscando-apenas-um-produto" class="subsection">Buscando apenas um produto</h3>

<p>Para buscarmos dados específicos,  podemos trabalhar com diversos métodos. Por exemplo, se você quiser buscar um produto pelo id dele, você pode usar o método <code>find</code>. </p>

<p>Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Product</code><code class="p">::</code><code class="nd">find</code><code class="o">(</code><code class="nt">1</code><code class="o">);</code>
</pre></div>

</figure>


<p>Ou ainda, buscando pelo id, você pode usar o método <code>findOrFail</code>, que caso o Eloquent não encontre o produto em questão, irá lançar uma Exception causando um <code>404 NOT Found</code>. Podemos usar desta maneira:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Product</code><code class="p">::</code><code class="nd">findOrFail</code><code class="o">(</code><code class="nt">1</code><code class="o">);</code>
</pre></div>

</figure>


<p>Vamos criar agora o método em nosso controller <code>ProductController</code> para recuperação de um produto, para nossa tela de edição. Veja o conteúdo do método <code>edit</code> e já adicione ele em seu controler:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">edit</code><code class="o">($</code><code class="nt">product</code><code class="o">)</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>	<code class="err">$product</code> <code class="err">=</code> <code class="n">Product</code><code class="p">:</code><code class="o">:</code><code class="nf">findOrFail</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="p">);</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code>	<code class="err">dd($product)</code><code class="p">;</code> <code class="err">//em</code> <code class="err">breve</code> <code class="err">mandaremos</code> <code class="err">pra</code> <code class="err">view</code>
<code class="linenos">6 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Usarei o <code>findOrFail</code> para termos o melhor controle para quando o produto não for encontrado, comportamento mencionado anteriormente. Já aproveite e adicione o método <code>show</code> no controller e nele apenas vamos redirecionar para a tela de edição uma vez que não teremos uma tela de visualização de um produto específico.</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">show</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'products.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s">'product'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">product</code><code class="p">]);</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Abaixo eu destaco só o atributo <code>original</code> que traz o dados retornados do método <code>findOrFail</code>, visualizamos acessando <code>http://127.0.0.1:8000/admin/products/1/edit</code>:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----find.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Nosso controller até o momento está abaixo, com os dois métodos criados no capítulo sobre requests e junto do <code>index</code>, <code>edit</code> e o <code>show</code> criados agora. </p>

<p>Veja na íntegra:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Admin</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">Product</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="n">ProductController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">12 </code>    <code class="p">{</code>
<code class="linenos">13 </code>        <code class="o">$</code><code class="n">products</code> <code class="o">=</code> <code class="n">Product</code><code class="p">::</code><code class="n">paginate</code><code class="p">(</code><code class="mi">15</code><code class="p">);</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>        <code class="n">dd</code><code class="p">(</code><code class="o">$</code><code class="n">products</code><code class="p">);</code> <code class="o">//</code><code class="n">no</code> <code class="n">próximo</code> <code class="n">capítulo</code> <code class="n">vamos</code> <code class="n">mandar</code> <code class="n">para</code> <code class="n">view</code><code class="o">...</code>
<code class="linenos">16 </code>    <code class="p">}</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">create</code><code class="p">()</code>
<code class="linenos">19 </code>    <code class="p">{</code>
<code class="linenos">20 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'products.create'</code><code class="p">);</code>
<code class="linenos">21 </code>    <code class="p">}</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">store</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="n">dd</code><code class="p">(</code><code class="o">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">());</code>
<code class="linenos">26 </code>    <code class="p">}</code>
<code class="linenos">27 </code>
<code class="linenos">28 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">show</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">29 </code>    <code class="p">{</code>
<code class="linenos">30 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'products.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="p">]);</code>
<code class="linenos">31 </code>    <code class="p">}</code>
<code class="linenos">32 </code>
<code class="linenos">33 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">edit</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">34 </code>    <code class="p">{</code>
<code class="linenos">35 </code>        <code class="o">$</code><code class="n">product</code> <code class="o">=</code> <code class="n">Product</code><code class="p">::</code><code class="n">findOrFail</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">);</code>
<code class="linenos">36 </code>
<code class="linenos">37 </code>        <code class="n">dd</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">);</code> <code class="o">//</code><code class="n">em</code> <code class="n">breve</code> <code class="n">mandaremos</code> <code class="n">pra</code> <code class="n">view</code>
<code class="linenos">38 </code>    <code class="p">}</code>
<code class="linenos">39 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Agora vamos ao método <code>store</code> pois nele vamos trabalhar a inserção de dados propriamente dita!</p>

<h2 id="leanpub-auto-inserindo-dados-com-eloquent" class="section">Inserindo dados com Eloquent</h2>

<p>Como mencionei anteriormente, poderíamos utilizar a criação de dados usando <b>Active Record</b>, por meio da referência dos atributos dinâmicos, baseado nas colunas do banco para aquela tabela (produtos) e por meio do método <code>save</code> criar um dado.</p>

<p>Como estamos tratando aqui de criação, vou mostrar a título de conhecimento o salvar dos dados usando Active Record dentro de nosso método, veja como ficaria.</p>

<p>Altere o conteúdo do método <code>store</code>, já existente, para o conteúdo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="kr">function</code> <code class="kr">store</code><code class="p">(</code><code class="n">Request</code> <code class="err">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$</code><code class="kt">data</code> <code class="o">=</code> <code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">();</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="cm">/**</code>
<code class="linenos"> 6 </code><code class="cm">    Preço recebido, exe.: 19,99 -&gt; passa pelo replace -&gt; 19.99 e salvamos ele como i\</code>
<code class="linenos"> 7 </code><code class="cm">nteiro multiplicando por 100 jogando as casa decimais 2 casas para direita.</code>
<code class="linenos"> 8 </code><code class="cm">    */</code>
<code class="linenos"> 9 </code>    <code class="err">$</code><code class="n">price</code> <code class="o">=</code> <code class="p">(</code><code class="n">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="s">'.'</code><code class="p">,</code> <code class="s">','</code><code class="p">],</code> <code class="p">[</code><code class="s">''</code><code class="p">,</code> <code class="s">'.'</code><code class="p">],</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'price'</code><code class="p">]);</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="err">$</code><code class="n">product</code> <code class="o">=</code> <code class="n">new</code> <code class="n">Product</code><code class="p">();</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">name</code>        <code class="o">=</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'name'</code><code class="p">];</code>
<code class="linenos">14 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">description</code> <code class="o">=</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'description'</code><code class="p">];</code>
<code class="linenos">15 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">body</code>        <code class="o">=</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'body'</code><code class="p">];</code>
<code class="linenos">16 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">in_stock</code>    <code class="o">=</code> <code class="mi">48</code><code class="p">;</code> <code class="c1">//está fixo mas vamos adiciona-lo no formulário ainda</code>
<code class="linenos">17 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code>       <code class="o">=</code> <code class="err">$</code><code class="n">price</code> <code class="o">*</code> <code class="mi">100</code><code class="p">;</code>
<code class="linenos">18 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">slug</code>        <code class="o">=</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'slug'</code><code class="p">];</code>
<code class="linenos">19 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">is_active</code>   <code class="o">=</code> <code class="kr">true</code><code class="p">;</code>
<code class="linenos">20 </code>
<code class="linenos">21 </code>    <code class="n">dd</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">save</code><code class="p">());</code> <code class="c1">//veja o resultado no browser</code>
<code class="linenos">22 </code><code class="p">}</code>
</pre></div>

</figure>

<p class="fake-para">Veja que agora pego os dados de cada campo a partir da request, vindas do formulário, e repasso para cada atributo de nosso model e na chamada do método <code>save</code> nós criamos este produto na base.</p>

<blockquote>
  <p>PS.: Aqui no ebook irei trabalhar o preço dos produtos como inteiro para termos mais precisão nas ações de lidar com as manipulações em produtos, por isso faço o replace que seria feito de fato para salvar o dado como float mas aqui estamos trabalhando com inteiro, então, multiplicamos por 100 esse preço ao salvar o dado, movendo a virgula duas casa para a direita deixando nosso preço como inteiro.</p>

  <p>PS2.: Em breve vamos delegar estas manipulações para nosso model para limpar melhor nossos controllers e ao recuperar o dado vamos trabalhar ele de forma flutuante com precisão 2, para isso vamos dividir o preço por 100 trazendo a vírgula 2 casa para esquerda. </p>
</blockquote>

<p>Para testarmos, vamos ao nosso link <code>http://127.0.0.1/admin/products/create</code> e envie os dados via form. Veja o resultado na imagem abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----inserindo-post-ar.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Perceba que o resultado do método <code>save</code> foi o valor boleano <code>true</code>, confirmando assim a criação do registro em nossa base. Se você quiser atualizar um registro usando Active Record, basta, ao invés de instanciar um model post, passar o resultado de um find por exemplo ou um dado buscado na base:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">$</code><code class="nt">price</code> <code class="o">=</code> <code class="o">(</code><code class="nt">float</code><code class="o">)</code> <code class="nt">str_replace</code><code class="o">(</code><code class="cp">[</code><code class="s1">'.'</code><code class="p">,</code> <code class="s1">','</code><code class="cp">]</code><code class="o">,</code> <code class="cp">[</code><code class="s1">''</code><code class="p">,</code> <code class="s1">'.'</code><code class="cp">]</code><code class="o">,</code> <code class="o">$</code><code class="nt">data</code><code class="cp">[</code><code class="s1">'price'</code><code class="cp">]</code><code class="o">);</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="o">$</code><code class="nt">product</code> <code class="o">=</code> <code class="nt">Product</code><code class="p">::</code><code class="nd">findOrFail</code><code class="o">(</code><code class="nt">1</code><code class="o">);</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">name</code>        <code class="o">=</code> <code class="o">$</code><code class="nt">data</code><code class="cp">[</code><code class="s1">'name'</code><code class="cp">]</code><code class="o">;</code>
<code class="linenos"> 6 </code><code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">description</code> <code class="o">=</code> <code class="o">$</code><code class="nt">data</code><code class="cp">[</code><code class="s1">'description'</code><code class="cp">]</code><code class="o">;</code>
<code class="linenos"> 7 </code><code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">body</code>        <code class="o">=</code> <code class="o">$</code><code class="nt">data</code><code class="cp">[</code><code class="s1">'body'</code><code class="cp">]</code><code class="o">;</code>
<code class="linenos"> 8 </code><code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">in_stock</code>    <code class="o">=</code> <code class="nt">48</code><code class="o">;</code> 
<code class="linenos"> 9 </code><code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">price</code>       <code class="o">=</code> <code class="o">$</code><code class="nt">price</code> <code class="o">*</code> <code class="nt">100</code><code class="o">;</code>
<code class="linenos">10 </code><code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">slug</code>        <code class="o">=</code> <code class="o">$</code><code class="nt">data</code><code class="cp">[</code><code class="s1">'slug'</code><code class="cp">]</code><code class="o">;</code>
<code class="linenos">11 </code><code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">is_active</code>   <code class="o">=</code> <code class="nt">true</code><code class="o">;</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code><code class="nt">dd</code><code class="o">($</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">save</code><code class="o">());</code> <code class="o">//</code><code class="nt">aqui</code> <code class="nt">ele</code> <code class="nt">vai</code> <code class="nt">atualizar</code>
</pre></div>

</figure>


<p>Como temos a referência na variável <code>$product</code> de um dado recém-buscado na base, ao chamarmos o método <code>save</code> o Eloquent irá atualizar este registro ao invés de criar um novo. </p>

<blockquote>
  <p>Lembrando que você, ao atualizar, pode chamar apenas as colunas que deseja atualizar o dado de fato.</p>
</blockquote>

<p>Este trecho foi um rápido desmontrativo do <b>Active Record</b> no Eloquent, quero te mostrar uma técnica mais direta e que é mais utilizada hoje em dia dentro do Laravel, via Eloquent. Esta técnica é o que chamamos de <code>Mass Assignment</code> ou <code>Atribuição em Massa</code>.</p>

<p>Vamos conhecer esta técnica.</p>

<h2 id="leanpub-auto-mass-assignment" class="section">Mass Assignment</h2>

<p>Mass Assignment ou Atribuição em Massa é uma forma de inserir ou atualizar os dados por meio de uma única chamada e de uma vez só quando necessitamos de realizar estas operações.</p>

<p>Por exemplo, eu poderia passar todo o array vindo da request e já salvar isso direto no banco por meio de um método do <code>Eloquent</code>, o método <code>create</code>.</p>

<p>Então vamos a alteração, mais uma vez, do nosso método <code>store</code>, que está assim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="kr">function</code> <code class="kr">store</code><code class="p">(</code><code class="n">Request</code> <code class="err">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$</code><code class="kt">data</code> <code class="o">=</code> <code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">();</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="err">$</code><code class="n">price</code> <code class="o">=</code> <code class="p">(</code><code class="n">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="s">'.'</code><code class="p">,</code> <code class="s">','</code><code class="p">],</code> <code class="p">[</code><code class="s">''</code><code class="p">,</code> <code class="s">'.'</code><code class="p">],</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'price'</code><code class="p">]);</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="err">$</code><code class="n">product</code> <code class="o">=</code> <code class="n">new</code> <code class="n">Product</code><code class="p">();</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">name</code>        <code class="o">=</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'name'</code><code class="p">];</code>
<code class="linenos">10 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">description</code> <code class="o">=</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'description'</code><code class="p">];</code>
<code class="linenos">11 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">body</code>        <code class="o">=</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'body'</code><code class="p">];</code>
<code class="linenos">12 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">in_stock</code>    <code class="o">=</code> <code class="mi">48</code><code class="p">;</code> <code class="c1">//está fixo mas vamos adiciona-lo no formulário ainda</code>
<code class="linenos">13 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code>       <code class="o">=</code> <code class="err">$</code><code class="n">price</code> <code class="o">*</code> <code class="mi">100</code><code class="p">;</code>
<code class="linenos">14 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">slug</code>        <code class="o">=</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'slug'</code><code class="p">];</code>
<code class="linenos">15 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">is_active</code>   <code class="o">=</code> <code class="kr">true</code><code class="p">;</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="n">dd</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">save</code><code class="p">());</code> <code class="c1">//veja o resultado no browser</code>
<code class="linenos">18 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Agora, passará a ficar assim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">store</code><code class="o">(</code><code class="nt">Request</code> <code class="o">$</code><code class="nt">request</code><code class="o">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$data</code> <code class="err">=</code> <code class="err">$request-&gt;all()</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="err">$price</code> <code class="err">=</code> <code class="err">(float)</code> <code class="err">str_replace(</code><code class="cp">[</code><code class="s1">'.'</code><code class="p">,</code> <code class="s1">','</code><code class="cp">]</code><code class="err">,</code> <code class="cp">[</code><code class="s1">''</code><code class="p">,</code> <code class="s1">'.'</code><code class="cp">]</code><code class="err">,</code> <code class="err">$data</code><code class="cp">[</code><code class="s1">'price'</code><code class="cp">]</code><code class="err">)</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="err">$data</code><code class="cp">[</code><code class="s1">'in_stock'</code><code class="cp">]</code>   <code class="err">=</code> <code class="err">48</code><code class="p">;</code>
<code class="linenos"> 8 </code>    <code class="err">$data</code><code class="cp">[</code><code class="s1">'price'</code><code class="cp">]</code>      <code class="err">=</code> <code class="err">$price</code> <code class="err">*</code> <code class="err">100</code><code class="p">;</code>
<code class="linenos"> 9 </code>    <code class="err">$data</code><code class="cp">[</code><code class="s1">'is_active'</code><code class="cp">]</code>  <code class="err">=</code> <code class="err">true</code><code class="p">;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="err">dd(</code><code class="n">Product</code><code class="p">:</code><code class="o">:</code><code class="nf">create</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">));</code> <code class="err">//veja</code> <code class="err">o</code> <code class="err">resultado</code> <code class="err">no</code> <code class="err">browser</code>
<code class="linenos">12 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba a redução acima, ao invés de chamarmos cada atributo baseado na coluna de nossa tabela, chamamos apenas o método <code>create</code> passando para ele nosso array recuperado da request, lembrando que este array associativo respeita chave(coluna da tabela) e valor desta chave, o valor a ser inserido.</p>

<p>Se você for ao browser e testar isso enviando os dados do formulário, perceberá que teremos uma exception sobre a adição de um campo na propriedade <code>$fillable</code> do model, aqui entra um ponto importante.</p>

<p>Antes de comentar o erro, você pode está se perguntando: Esta atribuição em massa não pode ser problemática, já que ela pelo visto aceita tudo?!</p>

<p>Veja a exception lançada:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----exception-mass.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Para resolver a exception lançada acima, sobre o atributo <code>$fillable</code> e o seu questionamento ao mesmo tempo, nós precisamos de fato definir este bendito atributo <code>$fillable</code> lá no model, o model do momento <code>Product</code>.</p>

<p>Agora para que serve este atributo? Tecnicamente ele é bem simples.</p>

<p>Como estamos passando esta atribuição de uma vez só, precisamos indicar para o Model/Eloquent que ao salvarmos ou atualizarmos os dados usando a atribuição em massa quais são os atributos que ele deve permitir o passar dos valores a serem salvos na tabela representada pelo Model. </p>

<p>Não esqueça que o array associativo, passado ao métodos create, deve respeitar as colunas da tabela como chave de cada linha do array a ser inserido. No model definimos uma lista com as colunas/atributos permitdos na Atribuição em Massa, definindo a propriedade <code>$fillable</code> e apenas aqueles campos listado neste atributo é que receberão o valor a ser inserido.</p>

<p>Então vamos adicionar ele em nosso model <code>Product</code> e logo após comentarmos mais um pouco sobre este detalhe. </p>

<p>Veja a alteração em <code>Product.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Models</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Factories</code>\<code class="n">HasFactory</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Model</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code><code class="k">class</code> <code class="n">Product</code> <code class="k">extends</code> <code class="n">Model</code>
<code class="linenos"> 9 </code><code class="p">{</code>
<code class="linenos">10 </code>    <code class="n">protected</code> <code class="o">$</code><code class="n">fillable</code> <code class="o">=</code> <code class="p">[</code>
<code class="linenos">11 </code>		<code class="s1">'name'</code><code class="p">,</code>
<code class="linenos">12 </code>	    <code class="s1">'description'</code><code class="p">,</code>
<code class="linenos">13 </code>	    <code class="s1">'body'</code><code class="p">,</code>
<code class="linenos">14 </code>	    <code class="s1">'slug'</code><code class="p">,</code>
<code class="linenos">15 </code>	    <code class="s1">'is_active'</code><code class="p">,</code>
<code class="linenos">16 </code>	    <code class="s1">'in_stock'</code><code class="p">,</code>
<code class="linenos">17 </code>        <code class="s1">'price'</code>
<code class="linenos">18 </code>    <code class="p">];</code>
<code class="linenos">19 </code><code class="p">}</code>
</pre></div>

</figure>

<p class="fake-para">Agora com os campos adicionados no atributo <code>$fillable</code> vamos enviar os dados novamente e atualizando o link com o erro anterior e clicando em reenviar no browser.</p>

<p>Veja o resultado do dd, vindo do método <code>create</code> do Eloquent, em nossa tela: </p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----resultado-create.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>O método <code>create</code> ao criar um dado, retorna este dado criado junto com seu id na base como resultado populado no model em questão, aqui o model Product. Veja o conteúdo da informação abrindo a propriedade <code>original</code>.</p>

<p>A segurança do método <code>create</code>, usando a atribuição em massa, se dá pela propriedade <code>$fillable</code> no model que uma vez definida e tendo as colunas permitidas, só teremos o preechimento das informações para a coluna mapeada nesta propriedade.</p>

<p>Agora como fazemos a atualização do dados massa?</p>

<p>Vamos lá.</p>

<h3 id="leanpub-auto-atualizando-dados-em-massa" class="subsection">Atualizando Dados em Massa</h3>

<p>Para atualizarmos os dados, vamos trabalhar aqui com nossa view de edição e conhecer mais alguns detalhes do Laravel, crie lá dentro da pasta <code>resources/views/products</code> o arquivo <code>edit.blade.php</code> e adicione o conteúdo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'products.update'</code><code class="o">,</code> <code class="o">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="nv">product-</code><code class="o">&gt;</code><code class="nv">id</code><code class="o">])</code> <code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"p\</code>
<code class="linenos"> 2 </code><code class="s">ost"</code><code class="nt">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    @csrf
<code class="linenos"> 5 </code>    @method('PUT')
<code class="linenos"> 6 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 7 </code>        <code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"block mb-2"</code><code class="nt">&gt;</code>Nome<code class="nt">&lt;/label&gt;</code>
<code class="linenos"> 8 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="err">$</code><code class="nv">product</code><code class="err">\</code>
<code class="linenos"> 9 </code><code class="o">-&gt;</code><code class="nv">name</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">10 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">13 </code>        <code class="nt">&lt;label&gt;</code>Descrição<code class="nt">&lt;/label&gt;</code>
<code class="linenos">14 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"description"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="err">$\</code>
<code class="linenos">15 </code><code class="nv">product-</code><code class="o">&gt;</code><code class="nv">description</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">16 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">19 </code>        <code class="nt">&lt;label&gt;</code>Conteúdo<code class="nt">&lt;/label&gt;</code>
<code class="linenos">20 </code>        <code class="nt">&lt;textarea</code> <code class="na">name=</code><code class="s">"body"</code> <code class="na">id=</code><code class="s">""</code> <code class="na">cols=</code><code class="s">"30"</code> <code class="na">rows=</code><code class="s">"10"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code><code class="nt">&gt;</code>{\
<code class="linenos">21 </code>{ $product-&gt;body }}<code class="nt">&lt;/textarea&gt;</code>
<code class="linenos">22 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">23 </code>
<code class="linenos">24 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">25 </code>        <code class="nt">&lt;label&gt;</code>Preço<code class="nt">&lt;/label&gt;</code>
<code class="linenos">26 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"price"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">number_</code><code class="err">\</code>
<code class="linenos">27 </code><code class="nv">format</code><code class="o">(</code><code class="err">$</code><code class="nv">product-</code><code class="o">&gt;</code><code class="nv">price</code><code class="o">,</code> <code class="m">2</code><code class="o">,</code> <code class="s1">','</code><code class="o">,</code> <code class="s1">'.'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">28 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">29 </code>
<code class="linenos">30 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">31 </code>        <code class="nt">&lt;label&gt;</code>Slug<code class="nt">&lt;/label&gt;</code>
<code class="linenos">32 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"slug"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="err">$</code><code class="nv">product</code><code class="err">\</code>
<code class="linenos">33 </code><code class="o">-&gt;</code><code class="nv">slug</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">34 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">35 </code>
<code class="linenos">36 </code>    <code class="nt">&lt;button</code> <code class="na">class=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-white\</code>
<code class="linenos">37 </code><code class="s"> font-thin"</code><code class="nt">&gt;</code>Atualizar
<code class="linenos">38 </code>        Produto<code class="nt">&lt;/button&gt;</code>
<code class="linenos">39 </code><code class="nt">&lt;/form&gt;</code>
</pre></div>

</figure>


<p>Agora, lá no método <code>edit</code> do <code>ProductController</code> substitua a linha do <code>dd</code> pelo trecho abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code> <code class="o">=</code> <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code> <code class="o">/</code> <code class="mi">100</code><code class="p">;</code> <code class="c1">//voltando pro ponto flutuante</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="kr">return</code> <code class="n">view</code><code class="p">(</code><code class="s">'products.edit'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s">'product'</code><code class="p">));</code>
</pre></div>

</figure>


<p>Se você acessar o link <code>http://127.0.0.1:8000/admin/products/1/edit</code> você obterá o resultado abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----edit.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Veja nosso formulário de edição acima já preenchido com os valores pegos do banco pelo Eloquent e enviados para a view.</p>

<p>Agora vamos entender os códigos do formulário de edição acima. Vamos lá.</p>

<p>Primeiramente atente a chamada da rota na action do formulário: </p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="x">&lt;form action="</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'products.update'</code><code class="o">,</code> <code class="o">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="nv">product-</code><code class="o">&gt;</code><code class="nv">id</code><code class="o">])</code> <code class="cp">}}</code><code class="x">" method="p\</code>
<code class="linenos">2 </code><code class="x">ost"&gt;</code>
</pre></div>

</figure>


<p>Enviaremos nossos dados para a rota de apelido <code>products.update</code> atribuída pelo método <code>resource</code> do <code>Route</code>, informamos o nome do parâmetro dinâmico da rota no array do segundo parâmetro da função helper <code>route</code> que será o id do produto, estes dados serão enviados para o método <code>update</code> lá do <code>ProductController</code>, que vamos criar ainda.</p>

<p>Temos agora mais uma alteração/novidade, a chamada da diretiva <code>@method</code>. Vamos entender ela:</p>

<p>Sabemos que os formulários html só suportam os verbos http: <code>post</code> e <code>get</code>. Por meio da diretiva <code>@method</code> fazemos o Laravel interpretar o formulário em questão com o verbo definido na diretiva, ou seja, como usei o valor <code>PUT</code> este formulário será interpretado pelo Laravel como sendo enviado via verbo <b>PUT</b> e cairá para a execução do método <code>update</code> do controller, que é o método que recebe as solicitações quando usamos o verbo <code>PUT</code> ou <code>PATCH</code> em nossa requisição.</p>

<blockquote>
  <p>Caso você ainda não tenha ouvido falar deste verbos HTTP além do GET e POST, basicamente o HTTP permite que realizemos requisições com mais contexto do que simplesmente recuperar(GET) e salvar (POST). Temos verbos HTTP para o pensamento de cada operação de manipulação de um dado, que normalmente chamamos de Recurso no âmbito da requisição. Os verbos HTTP mais conhecidos são:</p>

  <ul>
    <li>
<b>GET</b>: traz o pensamento de recuperar um dado, basicamente sempre que acessamos um link na web usamos este verbo;</li>
    <li>
<b>POST</b>: traz o pensamento de criação de um novo dado;</li>
    <li>
<b>PUT</b>: traz o pensamento de atualizar um dado por completo;</li>
    <li>
<b>PATCH</b>: traz o pensamento de atualizar partes de um dado;</li>
    <li>
<b>DELETE</b>: o nome é intuitivo, traz o pensamento de remover um dado;</li>
    <li>
<b>OPTIONS</b>: retorna os verbos aceitos em um determinado endpoint;</li>
  </ul>
</blockquote>

<p>Continuando, agora em nossos inputs recebemos os valores vindos lá do controller e adicionado no atributo value de cada input. Quando fazemos uma busca pela postagem desejada, ele retorna um objeto populado com os dados desta postagem, o que nos resta é acessarmos eles respeitando os nomes das colunas mas chamando como atributos do objeto e isto pode ser visto em cada atributo <code>value</code> dos inputs do nosso formulário de edição.</p>

<p>Agora precisamos definir o método para manipulação dos dados enviados do formulário de edição, para isso crie um método chamado de <code>update</code> em seu controller com o conteúdo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="k">function</code> <code class="n">update</code><code class="p">(</code><code class="n">$product</code><code class="p">,</code> <code class="n">Request</code> <code class="n">$request</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="c1">//Atualizando com mass assignment</code>
<code class="linenos"> 4 </code>    <code class="n">$data</code> <code class="o">=</code> <code class="n">$request</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">();</code>
<code class="linenos"> 5 </code>    <code class="n">$price</code> <code class="o">=</code> <code class="p">(</code><code class="n">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="sc">'.'</code><code class="p">,</code> <code class="sc">','</code><code class="p">],</code> <code class="p">['',</code> <code class="sc">'.'</code><code class="p">],</code> <code class="n">$data</code><code class="p">['</code><code class="n">price</code><code class="p">']);</code>
<code class="linenos"> 6 </code>    <code class="n">$data</code><code class="p">['</code><code class="n">price</code><code class="p">']</code> <code class="o">=</code> <code class="n">$price</code> <code class="o">*</code> <code class="mh">100</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code>    <code class="n">$product</code> <code class="o">=</code> <code class="n">Product</code><code class="o">::</code><code class="n">findOrFail</code><code class="p">(</code><code class="n">$product</code><code class="p">);</code>
<code class="linenos"> 9 </code>    <code class="n">$product</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">(</code><code class="n">$data</code><code class="p">);</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">('</code><code class="n">products</code><code class="p">.</code><code class="n">edit</code><code class="p">',</code> <code class="p">['</code><code class="n">product</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">12 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba que busquei o produto usando o método <code>findOrFail</code> e passando o id vindo da <code>url</code>, no parâmetro dinâmico. Neste caso, como quero atualizar, o método para este processo em massa, é o método do eloquent chamado de <code>update</code>, que me retorna um booleano para o sucesso ou falha desta execução.</p>

<p>Você pode testar sua edição acessando <code>http://127.0.0.1:8000/admin/products/&lt;id-produto&gt;/edit</code>, o sucesso da atualização é o redirecionamento para a tela de edição então verifique se o dado que você atualizou persistiu atualizando a própria página do browser na tela de edição após submeter o formulário e ele redirecionar para a edição novamente.</p>

<p>Vamos ao passo final do CRUD, a remoção de um dado com Eloquent.</p>

<h3 id="leanpub-auto-deletando-registros" class="subsection">Deletando Registros</h3>

<p>Bom, agora para completarmos nosso ciclo de CRUD, vamos deletar produtos de nossa base. Isso será realizado pelo método <code>delete</code> do <code>Eloquent</code>. </p>

<p>Veja o método abaixo a ser adicionado no <code>ProductController</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">destroy</code><code class="o">($</code><code class="nt">product</code><code class="o">)</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">$product</code> <code class="err">=</code> <code class="n">Product</code><code class="p">:</code><code class="o">:</code><code class="nf">findOrFail</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="p">);</code>
<code class="linenos">4 </code>    
<code class="linenos">5 </code>    <code class="err">dd($product-&gt;delete())</code><code class="p">;</code>
<code class="linenos">6 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O método do controller como recurso que responde a chamada para remoção de um dado é o <code>destroy</code>, entretanto, o método do <code>Eloquent</code> que irá remover um dado é o <code>delete</code> que retorna um boleano para o caso de sucesso ou falha da operação de remoção do dado na base. </p>

<p>Perceba que, como queremos remover uma postagem, precisamos buscar por ela via <code>Eloquent</code> para então removermos.</p>

<p>Agora precisamos adicionar o botão de remoção lá na tela de edição, neste caso como precisamos simular o envio do verbo http <b>DELETE</b>, vou precisar usar um form para o botão de remoção. </p>

<p>Adicione o form abaixo, após o formulário de edição:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'products.destroy'</code><code class="o">,</code> <code class="o">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="nv">product-</code><code class="o">&gt;</code><code class="nv">id</code><code class="o">])</code><code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"po\</code>
<code class="linenos">2 </code><code class="s">st"</code><code class="nt">&gt;</code>
<code class="linenos">3 </code>    @csrf
<code class="linenos">4 </code>    @method('DELETE')
<code class="linenos">5 </code>    <code class="nt">&lt;button</code> <code class="na">type=</code><code class="s">"submit"</code><code class="nt">&gt;</code>Remover Produto<code class="nt">&lt;/button&gt;</code>
<code class="linenos">6 </code><code class="nt">&lt;/form&gt;</code>
</pre></div>

</figure>


<p>Perceba também que temos adicionado o controle <b>csrf</b> para esta operação, além da definição da diretiva @method com o verbo http <code>DELETE</code>. </p>

<p>A tela de edição fica assim:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----removendo-coisas.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Ao clicar no botão remover, você verá o resultado na tela, <b>true</b> para sucesso na remoção ou <b>false</b> para o caso de falha. Após removido se tentarmos acessar a mesma postagem teremos uma tela de 404 em nossa cara:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----post-nao-encontrado.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Um pequeno e último detalhe ao invés de realizarmos um dd após o processo de remoção vamos redirecionar para a listagem de produtos. Veja o método <code>destroy</code> agora:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">destroy</code><code class="o">($</code><code class="nt">product</code><code class="o">)</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">$product</code> <code class="err">=</code> <code class="n">Product</code><code class="p">:</code><code class="o">:</code><code class="nf">findOrFail</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="p">);</code>
<code class="linenos">4 </code>    <code class="err">$product-&gt;delete()</code><code class="p">;</code>
<code class="linenos">5 </code>
<code class="linenos">6 </code>    <code class="err">return</code> <code class="err">redirect()-&gt;route('products.index')</code><code class="p">;</code>
<code class="linenos">7 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Façamos o mesmo no método store, como retorno do método <code>store</code> coloque o redirect para a tela de edição do produto recém criado, como mostrado no método completo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">store</code><code class="o">(</code><code class="nt">Request</code> <code class="o">$</code><code class="nt">request</code><code class="o">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$data</code> <code class="err">=</code> <code class="err">$request-&gt;all()</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="err">$price</code> <code class="err">=</code> <code class="err">(float)</code> <code class="err">str_replace(</code><code class="cp">[</code><code class="s1">'.'</code><code class="p">,</code> <code class="s1">','</code><code class="cp">]</code><code class="err">,</code> <code class="cp">[</code><code class="s1">''</code><code class="p">,</code> <code class="s1">'.'</code><code class="cp">]</code><code class="err">,</code> <code class="err">$data</code><code class="cp">[</code><code class="s1">'price'</code><code class="cp">]</code><code class="err">)</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="err">$data</code><code class="cp">[</code><code class="s1">'in_stock'</code><code class="cp">]</code>    <code class="err">=</code> <code class="err">48</code><code class="p">;</code> <code class="err">//está</code> <code class="err">fixo</code> <code class="err">mas</code> <code class="err">vamos</code> <code class="err">adiciona-lo</code> <code class="err">no</code> <code class="err">formulário</code> <code class="err">ainda</code>
<code class="linenos"> 8 </code>    <code class="err">$data</code><code class="cp">[</code><code class="s1">'price'</code><code class="cp">]</code>       <code class="err">=</code> <code class="err">$price</code> <code class="err">*</code> <code class="err">100</code><code class="p">;</code>
<code class="linenos"> 9 </code>    <code class="err">$data</code><code class="cp">[</code><code class="s1">'is_active'</code><code class="cp">]</code>      <code class="err">=</code> <code class="err">true</code><code class="p">;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="err">$product</code> <code class="err">=</code> <code class="n">Product</code><code class="p">:</code><code class="o">:</code><code class="nf">create</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="err">return</code> <code class="err">redirect()-&gt;route('products.edit',</code> <code class="cp">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="nv">$product</code><code class="o">-&gt;</code><code class="nb">id</code><code class="cp">]</code><code class="err">)</code><code class="p">;</code>
<code class="linenos">14 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Agora completamos as 4 etapas de um CRUD utilizando o Eloquent, que nos permite trabalhar com o banco pela visão de objetos.</p>

<h2 id="leanpub-auto-concluses-5" class="section">Conclusões</h2>

<p>Neste capítulo conhecemos diversas possibilidades usando o Eloquent, o ORM padrão do Laravel. Com isso realizamos a criação de um CRUD completo usando nosso Model <code>Product</code> por meio dos métodos disponíveis e herdados do <code>Model</code> do Eloquent, que nos permitiu realizar estas operações: seleção, criação, atualização e ainda remoção de produto no banco de dados.</p>

<p>Para completarmos o ciclo e deixarmos as coisas mais dinâmicas e integradas, precisamos conhecer o <b>Blade</b>, o famoso <i>template engine</i> do Laravel e que nos permite escrever views de forma mais dinâmica e rápida.</p>

<p>Conheceremos o Blade no próximo capítulo. Até lá!</p>


<h1 id="leanpub-auto-blade-template-engine-do-laravel" class="chapter">Blade, Template Engine do Laravel</h1>

<p>Olá tudo bem? Vamos continuar nosso livro e desta vez vamos conhecer o famoso template engine do Laravel, o Blade. </p>

<p>O Blade é o template engine default do Laravel e traz consigo diversas estruturas que simplificam muito nosso trabalho: </p>

    - na criação das views;<br>    - estruturas condicionais;<br>    - estruturas de repetição;<br>    - e possui diversas diretivas que nos permitem criar controles de forma simples e rápida;<br>    - em versões mais recentes, que é o nosso caso, temos também o pensamento de Tag Componentes.<br>    - e muito mais com foco em simplificar esta camada.<br>
<p>O Blade ao longo do tempo veio e vem recebendo diversos incrementos e pretendo mostrar, na prática, estas possibilidades usando seu poder para construirmos nossas views.</p>

<p>Então vamos criar as views de nossa aplicação utilizando o poder do Blade!</p>

<h2 id="leanpub-auto-layouts" class="section">Layouts</h2>

<p>Vamos começar pelo layout, em nosso Hello World com Laravel nós tivemos um contato com o blade quando mandamos nossa mensagem (Hello World) para a view e exibimos ela com o interpolador <code>{{ }}</code>, que nos permite exibir informações passadas a ele. Antes de entrarmos em pontos como este que comentei, vamos definir e organizar um template base usando o blade para melhor dispor as views do nosso painel.</p>

<p>Primeiramente crie uma pasta chamada de <code>layouts</code> dentro da pasta de views e dentro da pasta layouts crie o arquivo <code>app.blade.php</code>. Adicione o seguinte conteúdo e logo após farei os comentários:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;!doctype html&gt;</code>
<code class="linenos"> 2 </code><code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code><code class="nt">&lt;head&gt;</code>
<code class="linenos"> 5 </code>    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code><code class="nt">&gt;</code>
<code class="linenos"> 6 </code>    <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code>
<code class="linenos"> 7 </code>        <code class="na">content=</code><code class="s">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-sc\</code>
<code class="linenos"> 8 </code><code class="s">ale=1.0, minimum-scale=1.0"</code><code class="nt">&gt;</code>
<code class="linenos"> 9 </code>    <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code><code class="nt">&gt;</code>
<code class="linenos">10 </code>    <code class="nt">&lt;title&gt;</code>Loja - Code Experts<code class="nt">&lt;/title&gt;</code>
<code class="linenos">11 </code>    <code class="nt">&lt;script</code> <code class="na">src=</code><code class="s">"https://cdn.tailwindcss.com"</code><code class="nt">&gt;&lt;/script&gt;</code>
<code class="linenos">12 </code><code class="nt">&lt;/head&gt;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code><code class="nt">&lt;body&gt;</code>
<code class="linenos">15 </code>    <code class="nt">&lt;nav</code> <code class="na">class=</code><code class="s">"w-full mb-10 flex justify-between bg-gray-900 px-4"</code><code class="nt">&gt;</code>
<code class="linenos">16 </code>        <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"/"</code> <code class="na">class=</code><code class="s">"text-white py-4"</code><code class="nt">&gt;</code>Experts Store 12<code class="nt">&lt;/a&gt;</code>
<code class="linenos">17 </code>        <code class="nt">&lt;ul&gt;</code>
<code class="linenos">18 </code>            <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">19 </code>                <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'products.index'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code>
<code class="linenos">20 </code>                    <code class="na">class=</code><code class="s">"text-white px-6 py-4 hover:bg-purple-800 transition ease-\</code>
<code class="linenos">21 </code><code class="s">in-out duration-300"</code><code class="nt">&gt;</code>Produtos<code class="nt">&lt;/a&gt;</code>
<code class="linenos">22 </code>            <code class="nt">&lt;/li&gt;</code>
<code class="linenos">23 </code>        <code class="nt">&lt;/ul&gt;</code>
<code class="linenos">24 </code>    <code class="nt">&lt;/nav&gt;</code>
<code class="linenos">25 </code>    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"container"</code> <code class="na">class=</code><code class="s">"max-w-7xl mx-auto p-6"</code><code class="nt">&gt;</code>
<code class="linenos">26 </code>        <code class="c">&lt;!-- Aqui será inserido o conteúdo das páginas filhas --&gt;</code>
<code class="linenos">27 </code>
<code class="linenos">28 </code>        @yield('content')
<code class="linenos">29 </code>
<code class="linenos">30 </code>        <code class="c">&lt;!-- Aqui será inserido o conteúdo das páginas filhas --&gt;</code>
<code class="linenos">31 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">32 </code><code class="nt">&lt;/body&gt;</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code><code class="nt">&lt;/html&gt;</code>
</pre></div>

</figure>


<p>Acima temos a definição do nosso layout base, aqui entramos no primeiro conceito do Blade, neste caso, na herança de templates. Se você perceber no layout, defini dentro do body na <code>div#container</code> uma diretiva chamada de <code>@yield</code> que me permite apontar onde os templates devem exibir seus conteúdos.</p>

<p>Por exemplo, vamos entender como isso funciona fazendo nossa view <code>create.blade.php</code> herdar do nosso layout <code>app.blade.php</code>. Veja as alterações que fiz na view <code>create.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('products.store') }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-g\</code>
<code class="linenos">10 </code><code class="s">ray-900"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('name') }}"</code><code class="o">&gt;</code>
<code class="linenos">11 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Descrição</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">15 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"description"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border b\</code>
<code class="linenos">16 </code><code class="s">order-gray-900"</code>
<code class="linenos">17 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('description') }}"</code><code class="o">&gt;</code>
<code class="linenos">18 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">21 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Conteúdo</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">22 </code>            <code class="o">&lt;</code><code class="n">textarea</code> <code class="n">name</code><code class="o">=</code><code class="s">"body"</code> <code class="kt">id</code><code class="o">=</code><code class="s">""</code> <code class="n">cols</code><code class="o">=</code><code class="s">"30"</code> <code class="n">rows</code><code class="o">=</code><code class="s">"10"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounde\</code>
<code class="linenos">23 </code><code class="s">d border border-gray-900"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">old</code><code class="p">(</code><code class="err">'</code><code class="n">body</code><code class="err">'</code><code class="p">)</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">textarea</code><code class="o">&gt;</code>
<code class="linenos">24 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">25 </code>
<code class="linenos">26 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">27 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Preço</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">28 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"price"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-\</code>
<code class="linenos">29 </code><code class="s">gray-900"</code>
<code class="linenos">30 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('price') }}"</code><code class="o">&gt;</code>
<code class="linenos">31 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">32 </code>
<code class="linenos">33 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">34 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Slug</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">35 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"slug"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-g\</code>
<code class="linenos">36 </code><code class="s">ray-900"</code>
<code class="linenos">37 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('slug') }}"</code><code class="o">&gt;</code>
<code class="linenos">38 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">39 </code>
<code class="linenos">40 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-w\</code>
<code class="linenos">41 </code><code class="s">hite font-thin"</code><code class="o">&gt;</code><code class="n">Criar</code> <code class="n">Produto</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">42 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">43 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<blockquote>
  <p>O trecho de template acima, além da adição dos trecho de herança, eu adicionei algumas classes nos inputs para exibir uma borda neles. Lembre de pegar este código e atualizar em seu projeto.</p>
</blockquote>

<p>Aqui temos o conteúdo do formulário envolvido por uma diretiva chamada de <code>@section</code> que recebe o valor <code>content</code> e a definição de onde essa diretiva termina, indicada pelo <code>@endsection</code>. O que isso quer dizer?!</p>

<p>A diretiva <code>@section</code> define o conteúdo que será substituido no layout principal, ou seja, quando eu acessar essa view ele vai herdar o que tem em <code>app.blade.php</code> e onde eu defini o <code>@yield('content')</code> , será adicionado o conteúdo que temos na diretiva <code>@section</code>, no caso da view <code>create.blade.php</code> o que estiver na section <code>content</code> e exibirá o conteúdo do formulário junto do layout base.</p>

<p>Mas Nanderson, onde está definido que o <code>create.blade.php</code> herda de <code>layout.blade.php</code>? Não comentei de propósito mas ele se encontra como sendo a primeira linha da nossa view, veja a definição que aponta de qual template <code>create.blade.php</code> herda, por meio da diretiva <code>@extends</code>, o layout pai. Neste caso digo que a view <code>create.blade.php</code> herda de <code>app.blade.php</code> informando a diretiva <code>@extends</code> da seguinte maneira: <code>@extends('layouts.app')</code>.</p>

<p>Sendo que <code>layouts</code> é a pasta dentro de views e <code>app</code> o arquivo <code>app.blade.php</code>, onde sabemos que o Laravel irá incluir a extensão internamente e linkar o caminho completo até a pasta layouts.</p>

<p>Alterei também a view <code>edit.blade.php</code>, segue o conteúdo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code><code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('products.update', ['product' =&gt; $product-&gt;id]) }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"p\</code>
<code class="linenos"> 5 </code><code class="s">ost"</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 7 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">PUT</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 8 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">10 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-g\</code>
<code class="linenos">11 </code><code class="s">ray-900"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ $product-&gt;name }}"</code><code class="o">&gt;</code>
<code class="linenos">12 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">15 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Descrição</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">16 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"description"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border b\</code>
<code class="linenos">17 </code><code class="s">order-gray-900"</code>
<code class="linenos">18 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $product-&gt;description }}"</code><code class="o">&gt;</code>
<code class="linenos">19 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">20 </code>
<code class="linenos">21 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">22 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Conteúdo</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">23 </code>            <code class="o">&lt;</code><code class="n">textarea</code> <code class="n">name</code><code class="o">=</code><code class="s">"body"</code> <code class="kt">id</code><code class="o">=</code><code class="s">""</code> <code class="n">cols</code><code class="o">=</code><code class="s">"30"</code> <code class="n">rows</code><code class="o">=</code><code class="s">"10"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounde\</code>
<code class="linenos">24 </code><code class="s">d border border-gray-900"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">body</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">textarea</code><code class="o">&gt;</code>
<code class="linenos">25 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">28 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Preço</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">29 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"price"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-\</code>
<code class="linenos">30 </code><code class="s">gray-900"</code>
<code class="linenos">31 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ number_format($product-&gt;price, 2, ',', '.') }}"</code><code class="o">&gt;</code>
<code class="linenos">32 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">35 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Slug</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">36 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"slug"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-g\</code>
<code class="linenos">37 </code><code class="s">ray-900"</code>
<code class="linenos">38 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $product-&gt;slug }}"</code><code class="o">&gt;</code>
<code class="linenos">39 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">40 </code>
<code class="linenos">41 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-w\</code>
<code class="linenos">42 </code><code class="s">hite font-thin"</code><code class="o">&gt;</code><code class="n">Atualizar</code>
<code class="linenos">43 </code>            <code class="n">Produto</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">44 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">45 </code>
<code class="linenos">46 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('products.destroy', ['product' =&gt; $product-&gt;id]) }}"</code> <code class="n">meth</code>\
<code class="linenos">47 </code><code class="n">od</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">48 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">49 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">50 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="n">type</code><code class="o">=</code><code class="s">"submit"</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-red-700 border border-red-900 roun\</code>
<code class="linenos">51 </code><code class="s">ded text-white font-thin mt-8"</code><code class="o">&gt;</code><code class="n">Remover</code>
<code class="linenos">52 </code>            <code class="n">Produto</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">53 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">54 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>

<blockquote>
  <p>Alterei as bordas dos inputs aqui também além de adicionar alguns estilos no button do form de remoção.</p>
</blockquote>

<p>Veja o formulário na íntegra na imagem abaixo:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----edicao-pos-layout.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Aqui já temos alguns estilos aplicados por conta que desde o ínicio nosso form já possuía algumas classes utilitárias do TailwindCSS(tailwindcss.com), não comentarei muito dele aqui neste ebook mas tentarei na maior parte das vezes explicar os trechos que forem importantes e claro, se você conhece bem CSS o tailwindcss será algo mais tranquilo pra você.</p>

<p>Lá no Layout base, o <code>app.blade.php</code>, por hora mantêm o link do cdn do tailwindcss. O trecho do layout base que uso o cdn é destacado abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;script</code> <code class="na">src=</code><code class="s">"https://cdn.tailwindcss.com"</code><code class="nt">&gt;&lt;/script&gt;</code> 
</pre></div>

</figure>


<p>Agora vamos para a nossa listagem dos produtos e conhecer mais possibilidades do Blade.</p>

<h2 id="leanpub-auto-laos-de-repetio--condicionais" class="section">Laços de Repetição &amp; Condicionais</h2>

<p>Sabemos que para iterarmos em cima de uma coleção de dados precisamos usar laços de repetição, o Blade nos traz algumas possibilidades interessantes. A primeira delas é a possibilidade de utilição do foreach, como vemos abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">@</code><code class="n">foreach</code><code class="p">(</code><code class="n">$products</code> <code class="n">as</code> <code class="n">$product</code><code class="p">)</code>
<code class="linenos">2 </code>	<code class="o">&lt;</code><code class="n">li</code><code class="o">&gt;</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">name</code><code class="o">&lt;/</code><code class="n">li</code><code class="o">&gt;</code>
<code class="linenos">3 </code><code class="p">@</code><code class="n">endforeach</code>
</pre></div>

</figure>


<p>Desta maneira a iteração na coleção de produtos, vindas do banco de dados, será no mesmos moldes do foreach do PHP, e claro, no procesamento desta view essa diretiva se tornará um foreach nativo.</p>

<p>Mas aqui, quero utilizar um foreach não muito convencional, na forma que vamos escrever, mas é claro que com condicionais e combinando com os laços chegaríamos no mesmo resultado. </p>

<p>Mas Nanderson, do que você está falando!?</p>

<p>Por exemplo, poderíamos fazer um controle condicional pro caso de não existirem produtos na base e somente, se existirem, exibissemos a tabela com os produtos. </p>

<p>Por exemplo, veja o trecho abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">count</code><code class="p">(</code><code class="n">$products</code><code class="p">))</code>
<code class="linenos">2 </code>    <code class="p">@</code><code class="n">foreach</code><code class="p">(</code><code class="n">$products</code> <code class="n">as</code> <code class="n">$product</code><code class="p">)</code>
<code class="linenos">3 </code>		<code class="o">&lt;</code><code class="n">li</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">name</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">li</code><code class="o">&gt;</code>
<code class="linenos">4 </code>	<code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">5 </code><code class="p">@</code><code class="k">else</code> 
<code class="linenos">6 </code>   <code class="o">&lt;</code><code class="n">h2</code><code class="o">&gt;</code> <code class="n">Nenhum</code> <code class="n">produto</code> <code class="n">cadastrada</code><code class="o">!&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos">7 </code><code class="p">@</code><code class="n">endif</code>
</pre></div>

</figure>


<p>Acima te apresento o controle condicional ou como usar os se…senão (if…else) via diretivas do Blade. Primeiramente verificamos se o valor de <code>$products</code> é verdadeiro, se verdadeiro nós realizamos os loops, senão, exibimos uma mensagem padrão. O verdadeiro aqui pra <code>$products</code> é termos produtos na coleção.</p>

<p>Agora podemos melhorar ainda mais essa escrita usando outra diretiva do blade. Com a diretiva de loop chamada de <code>@forelse</code> conseguimos chegar no mesmo resultado acima com pouco esforço e é ela que vamos utilizar, então vamos ao conteúdo do nosso <code>index.blade.php</code>, que não existe ainda, então crie o arquivo <code>index.blade.php</code> lá dentro da pasta das views de produto: <code>resources/views/products/</code>. </p>

<p>Veja seu conteúdo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-10 flex justify-between"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>        <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"font-bold text-xl"</code><code class="o">&gt;</code><code class="n">Produtos</code><code class="o">&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>        <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{ route('products.create') }}"</code>
<code class="linenos"> 7 </code>            <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-white\</code>
<code class="linenos"> 8 </code><code class="s"> font-thin"</code><code class="o">&gt;</code><code class="n">Criar</code> <code class="n">Produto</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">10 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-5"</code><code class="o">&gt;</code>
<code class="linenos">11 </code>        <code class="o">&lt;</code><code class="n">table</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full"</code><code class="o">&gt;</code>
<code class="linenos">12 </code>            <code class="o">&lt;</code><code class="n">thead</code><code class="o">&gt;</code>
<code class="linenos">13 </code>                <code class="o">&lt;</code><code class="n">tr</code> <code class="k">class</code><code class="o">=</code><code class="s">"border-b border-gray-600"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="err">#</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">15 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="n">Produto</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">16 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="n">Status</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">17 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="n">Criado</code> <code class="n">em</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">18 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="n">Ações</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">19 </code>                <code class="o">&lt;/</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">20 </code>            <code class="o">&lt;/</code><code class="n">thead</code><code class="o">&gt;</code>
<code class="linenos">21 </code>            <code class="o">&lt;</code><code class="n">tbody</code><code class="o">&gt;</code>
<code class="linenos">22 </code>                <code class="p">@</code><code class="n">forelse</code><code class="p">(</code><code class="n">$products</code> <code class="n">as</code> <code class="n">$product</code><code class="p">)</code>
<code class="linenos">23 </code>                    <code class="o">&lt;</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">24 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="kt">id</code> \
<code class="linenos">25 </code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">26 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">nam</code>\
<code class="linenos">27 </code><code class="n">e</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">28 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code>
<code class="linenos">29 </code>                            <code class="p">@</code><code class="k">if</code> <code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">is_active</code><code class="p">)</code>
<code class="linenos">30 </code>                                <code class="o">&lt;</code><code class="n">span</code> <code class="k">class</code><code class="o">=</code><code class="s">"p-1 rounded bg-green-500 text-green-900\</code>
<code class="linenos">31 </code><code class="s">"</code><code class="o">&gt;</code><code class="n">Ativo</code><code class="o">&lt;/</code><code class="n">span</code><code class="o">&gt;</code>
<code class="linenos">32 </code>                            <code class="p">@</code><code class="k">else</code>
<code class="linenos">33 </code>                                <code class="o">&lt;</code><code class="n">span</code> <code class="k">class</code><code class="o">=</code><code class="s">"p-1 rounded bg-red-500 text-red-900"</code><code class="o">&gt;</code><code class="n">In</code>\
<code class="linenos">34 </code><code class="n">ativo</code><code class="o">&lt;/</code><code class="n">span</code><code class="o">&gt;</code>
<code class="linenos">35 </code>                            <code class="p">@</code><code class="n">endif</code>
<code class="linenos">36 </code>                        <code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">37 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">cre</code>\
<code class="linenos">38 </code><code class="n">ated_at</code><code class="o">-&gt;</code><code class="n">format</code><code class="p">(</code><code class="err">'</code><code class="n">d</code><code class="o">/</code><code class="n">m</code><code class="o">/</code><code class="n">Y</code> <code class="nl">H</code><code class="p">:</code><code class="n">i</code><code class="err">'</code><code class="p">)</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">39 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[15%] px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code>
<code class="linenos">40 </code>                            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"flex justify-around gap-x-2"</code><code class="o">&gt;</code>
<code class="linenos">41 </code>                                <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{ route('products.show', ['product' =&gt; $pr\</code>
<code class="linenos">42 </code><code class="s">oduct-&gt;id]) }}"</code>
<code class="linenos">43 </code>                                    <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-blue-700 border border-blue-\</code>
<code class="linenos">44 </code><code class="s">900 rounded text-white font-thin"</code><code class="o">&gt;</code>
<code class="linenos">45 </code>                                    <code class="n">Editar</code>
<code class="linenos">46 </code>                                <code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">47 </code>                                <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('products.destroy', ['product\</code>
<code class="linenos">48 </code><code class="s">' =&gt; $product-&gt;id]) }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">49 </code>                                    <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">50 </code>                                    <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">51 </code>                                    <code class="o">&lt;</code><code class="n">button</code> <code class="n">type</code><code class="o">=</code><code class="s">"submit"</code>
<code class="linenos">52 </code>                                        <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-red-700 border border-re\</code>
<code class="linenos">53 </code><code class="s">d-900 rounded text-white font-thin"</code><code class="o">&gt;</code><code class="n">Remover</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">54 </code>                                <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">55 </code>                            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">56 </code>                        <code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">57 </code>                    <code class="o">&lt;/</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">58 </code>                <code class="p">@</code><code class="n">empty</code>
<code class="linenos">59 </code>                    <code class="o">&lt;</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">60 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="n">colspan</code><code class="o">=</code><code class="s">"4"</code><code class="o">&gt;</code><code class="n">Nada</code> <code class="n">encontrado</code><code class="o">!&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">61 </code>                    <code class="o">&lt;/</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">62 </code>                <code class="p">@</code><code class="n">endforelse</code>
<code class="linenos">63 </code>            <code class="o">&lt;/</code><code class="n">tbody</code><code class="o">&gt;</code>
<code class="linenos">64 </code>        <code class="o">&lt;/</code><code class="n">table</code><code class="o">&gt;</code>
<code class="linenos">65 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">66 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<p>Não esqueça de substituir, lá no controller <code>ProductController</code>, no método <code>index</code>, a linha do <code>dd</code> pela linha abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="k">return</code> <code class="nv">view</code><code class="ss">(</code><code class="s1">'</code><code class="s">products.index</code><code class="s1">'</code>, <code class="nv">compact</code><code class="ss">(</code><code class="s1">'</code><code class="s">products</code><code class="s1">'</code><code class="ss">))</code><code class="c1">;</code>
</pre></div>

</figure>


<p>Vamos aos pontos principais da view <code>index.blade.php</code>. Perceba que aqui usei a diretiva:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">@</code><code class="n">forelse</code><code class="p">(</code><code class="n">$products</code> <code class="n">as</code> <code class="n">$product</code><code class="p">)</code>
<code class="linenos">2 </code>  <code class="p">...</code>
<code class="linenos">3 </code><code class="p">@</code><code class="n">empty</code>
<code class="linenos">4 </code>  <code class="p">...</code>
<code class="linenos">5 </code><code class="p">@</code><code class="n">endforelse</code>
</pre></div>

</figure>

<p class="fake-para">Para iterar as produtos vindas do controller, neste caso o <code>@forelse</code> fará o seguinte: </p>

<p>Se não existir produtos, ele cairá na execução do bloco <code>@empty</code>, onde adicionamos um <code>tr</code> com <code>td</code> e a mensagem <code>Nada Encontrado!</code>. Veja o bloco do <code>@empty</code> abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">@</code><code class="n">empty</code>
<code class="linenos">2 </code>    <code class="o">&lt;</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">3 </code>        <code class="o">&lt;</code><code class="n">td</code> <code class="n">colspan</code><code class="o">=</code><code class="s">"4"</code><code class="o">&gt;</code><code class="n">Nada</code> <code class="n">encontrado</code><code class="o">!&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">4 </code>    <code class="o">&lt;/</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">5 </code><code class="p">@</code><code class="n">endforelse</code>
</pre></div>

</figure>

<p class="fake-para">Existindo produtos, que é o nosso caso, teremos a exibição da tabela com os produtos corretamente exibida. Vamos analisar o bloco do <code>@forelse</code>. </p>

<p>Veja somente ele abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">...</code>
<code class="linenos"> 2 </code><code class="p">@</code><code class="n">forelse</code><code class="p">(</code><code class="n">$products</code> <code class="n">as</code> <code class="n">$product</code><code class="p">)</code>
<code class="linenos"> 3 </code>    <code class="o">&lt;</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos"> 4 </code>        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="kt">id</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">name</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code>
<code class="linenos"> 7 </code>            <code class="p">@</code><code class="k">if</code> <code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">is_active</code><code class="p">)</code>
<code class="linenos"> 8 </code>                <code class="o">&lt;</code><code class="n">span</code> <code class="k">class</code><code class="o">=</code><code class="s">"p-1 rounded bg-green-500 text-green-900"</code><code class="o">&gt;</code><code class="n">Ativo</code><code class="o">&lt;/</code><code class="n">span</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>            <code class="p">@</code><code class="k">else</code>
<code class="linenos">10 </code>                <code class="o">&lt;</code><code class="n">span</code> <code class="k">class</code><code class="o">=</code><code class="s">"p-1 rounded bg-red-500 text-red-900"</code><code class="o">&gt;</code><code class="n">Inativo</code><code class="o">&lt;/</code><code class="n">span</code><code class="o">&gt;</code>
<code class="linenos">11 </code>            <code class="p">@</code><code class="n">endif</code>
<code class="linenos">12 </code>        <code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">13 </code>        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">created_at</code><code class="o">-&gt;</code><code class="n">format</code><code class="p">(</code>\
<code class="linenos">14 </code><code class="err">'</code><code class="n">d</code><code class="o">/</code><code class="n">m</code><code class="o">/</code><code class="n">Y</code> <code class="nl">H</code><code class="p">:</code><code class="n">i</code><code class="err">'</code><code class="p">)</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">15 </code>        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[15%] px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code>
<code class="linenos">16 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"flex justify-around gap-x-2"</code><code class="o">&gt;</code>
<code class="linenos">17 </code>                <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{ route('products.show', ['product' =&gt; $product-&gt;id]) }}"</code>
<code class="linenos">18 </code>                    <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-blue-700 border border-blue-900 rounded text\</code>
<code class="linenos">19 </code><code class="s">-white font-thin"</code><code class="o">&gt;</code>
<code class="linenos">20 </code>                    <code class="n">Editar</code>
<code class="linenos">21 </code>                <code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">22 </code>                <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('products.destroy', ['product' =&gt; $product-&gt;i\</code>
<code class="linenos">23 </code><code class="s">d]) }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">24 </code>                    <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">25 </code>                    <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">26 </code>                    <code class="o">&lt;</code><code class="n">button</code> <code class="n">type</code><code class="o">=</code><code class="s">"submit"</code>
<code class="linenos">27 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-red-700 border border-red-900 rounded te\</code>
<code class="linenos">28 </code><code class="s">xt-white font-thin"</code><code class="o">&gt;</code><code class="n">Remover</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">29 </code>                <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">30 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">31 </code>        <code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">32 </code>    <code class="o">&lt;/</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">33 </code>    <code class="p">@</code><code class="n">empty</code>
<code class="linenos">34 </code>    <code class="p">...</code>
</pre></div>

</figure>


<p>O que vale destacar aqui é a utilização da diretiva de controle condicional para exibição da mensagem <code>Ativo</code> ou <code>Inativo</code>, usei também, no campo da data de criação da postagem, o método format a parti da propriedade <code>created_at</code> para formatar a data a lá BR.</p>

<blockquote>
  <p>Nota: Os campos <b>created_at</b> e <b>updated_at</b>, internamente no Laravel, sempre recebem uma instância do pacote chamado de <i>Carbon</i>, que é um pacote para manipulação de datas e vêm junto no Laravel, apesar de não ser do framework. Com isso podemos formatar estas duas datas chamando o método format diretamente da propriedade, exemplo <code>{{ $produto-&gt;created_at-&gt;format('d/m/Y H:i:s') }}</code>.</p>
</blockquote>

<p>Temos ainda, para a coluna de <b>Ações</b>, o botão de edição onde linkamos a rota de edição usando o apelido dela por meio da função helper <code>route</code> e passando o id dinâmico do produto como segundo parâmetro.</p>

<p>Sobre o botão da remoção do produto, apenas peguei o form que tinhamos criado para remoção do produto no último capítulo. </p>

<p>Veja o resultado da nossa tela de listagem das postagens:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----index-blog.png">
    <figcaption></figcaption>
  </figure>
</div>


<h2 id="leanpub-auto-paginao-na-view" class="section">Paginação na View</h2>

<p>Antes de trabalharmos a paginação, na verdade exibi-la em nossa tela, vamos criar uma factory para nossos produtos. Neste ponto como já trabalhamos bastante com models e juntando com o conhecimento prévio de factories do capítulo 5, estamos bem para este ponto.</p>

<h3 id="leanpub-auto-criando-nossa-factory" class="subsection">Criando nossa factory</h3>

<p>Execute a criação da factory por meio do comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:factory ProductFactory
</pre></div>

</figure>


<p>Em sua classe <code>ProductFactory</code> adicione a definição da geração dos dados fakes. Segue o exemplo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">definition</code><code class="p">()</code><code class="o">:</code> <code class="n">array</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$</code><code class="n">name</code> <code class="o">=</code> <code class="n">fake</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">words</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code> <code class="kr">true</code><code class="p">);</code>
<code class="linenos"> 4 </code>    <code class="kr">return</code> <code class="p">[</code>
<code class="linenos"> 5 </code>        <code class="s">'name'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">name</code><code class="p">,</code>
<code class="linenos"> 6 </code>        <code class="s">'description'</code> <code class="o">=&gt;</code> <code class="n">fake</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">sentence</code><code class="p">,</code>
<code class="linenos"> 7 </code>        <code class="s">'body'</code>        <code class="o">=&gt;</code> <code class="n">fake</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">paragraphs</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code> <code class="kr">true</code><code class="p">),</code>
<code class="linenos"> 8 </code>        <code class="s">'price'</code>       <code class="o">=&gt;</code> <code class="n">fake</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">randomFloat</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">3000</code><code class="p">)</code> <code class="o">*</code> <code class="mi">100</code><code class="p">,</code>
<code class="linenos"> 9 </code>        <code class="s">'in_stock'</code>    <code class="o">=&gt;</code> <code class="n">rand</code><code class="p">(</code><code class="mi">30</code><code class="p">,</code> <code class="mi">1000</code><code class="p">),</code>
<code class="linenos">10 </code>        <code class="s">'slug'</code>        <code class="o">=&gt;</code> <code class="n">str</code><code class="p">(</code><code class="err">$</code><code class="n">name</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">slug</code><code class="p">(),</code>
<code class="linenos">11 </code>        <code class="s">'is_active'</code>   <code class="o">=&gt;</code> <code class="n">rand</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>
<code class="linenos">12 </code>    <code class="p">];</code>
<code class="linenos">13 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Os métodos vindos do fake são bem intuitivos e todos que uso vêm a partir do helper <code>fake</code>, para randomizar os inteiros do stock e is_active usei o rand do próprio PHP.</p>

<p>Um ponto a comentar é que pro slug usei o helper <code>str</code> do Laravel que me permite, mediante o passar de uma string nele, manipular de diversas formas a string em questão. Aqui na factory uso para gerarmos o slug baseado no nome randômico do produto.</p>

<p>Antes de usarmos nossa factory precisamos configurar ela em nosso model. Um ponto importante pro seu futuro, caso queira poupar este trabalho que faremos abaixo você pode no futuro gerar seu model junto de uma factory e ele já vir configurado. Para isso basta informar o parâmetro <code>-f</code> na geração do model:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:model &lt;SEU_MODEL&gt; -f
</pre></div>

</figure>


<p>Caso queira gerar uma migração junto, você pode informar o parâmetro <code>-m</code> ou aninhar na geração da factory junto a geração do model. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:model &lt;SEU_MODEL&gt; -fm
</pre></div>

</figure>


<p>Como geramos o model sem associação com factories precisamos configurar e é bem simples na verdade. Em seu model Product, importe a trait de factories como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>use Illuminate\Database\Eloquent\Factories\HasFactory;
</pre></div>

</figure>


<p>E utilizar a trait em seu model Product:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>use HasFactory;
</pre></div>

</figure>


<p>Nosso model Product até o momento está assim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Models</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Model</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Factories</code>\<code class="n">HasFactory</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code><code class="k">class</code> <code class="n">Product</code> <code class="k">extends</code> <code class="n">Model</code>
<code class="linenos"> 9 </code><code class="p">{</code>
<code class="linenos">10 </code>    <code class="n">use</code> <code class="n">HasFactory</code><code class="p">;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code>    <code class="n">protected</code> <code class="o">$</code><code class="n">fillable</code> <code class="o">=</code> <code class="p">[</code>
<code class="linenos">13 </code>        <code class="s1">'name'</code><code class="p">,</code>
<code class="linenos">14 </code>        <code class="s1">'description'</code><code class="p">,</code>
<code class="linenos">15 </code>        <code class="s1">'body'</code><code class="p">,</code>
<code class="linenos">16 </code>        <code class="s1">'slug'</code><code class="p">,</code>
<code class="linenos">17 </code>        <code class="s1">'is_active'</code><code class="p">,</code>
<code class="linenos">18 </code>        <code class="s1">'in_stock'</code><code class="p">,</code>
<code class="linenos">19 </code>        <code class="s1">'price'</code>
<code class="linenos">20 </code>    <code class="p">];</code>
<code class="linenos">21 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Feito isso vamos modificar nosso seeder para chamarmos a factory ProductFactory.</p>

<p>Para usarmos nossa factory vamos adicioná-la, tal qual fizemos com a UserFactory, lá no <code>ProductsTableSeeder</code>.</p>

<p>Veja como ficou o método run:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">run</code><code class="o">():</code> <code class="nt">void</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">//</code> <code class="n">DB</code><code class="p">:</code><code class="o">:</code><code class="nf">table</code><code class="p">(</code><code class="s1">'products'</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">insert</code><code class="p">(</code><code class="cp">[</code>
<code class="linenos"> 4 </code>    <code class="c1">//     'name'       =&gt; 'Primeiro Produto',</code>
<code class="linenos"> 5 </code>    <code class="c1">//     'description' =&gt; 'Produto teste com seeds',</code>
<code class="linenos"> 6 </code>    <code class="c1">//     'body'     =&gt; 'Conteúdo do Produto',</code>
<code class="linenos"> 7 </code>    <code class="c1">//     'in_stock'    =&gt; 34,</code>
<code class="linenos"> 8 </code>    <code class="c1">//     'price'       =&gt; (14.99 * 100),</code>
<code class="linenos"> 9 </code>    <code class="c1">//     'is_active'   =&gt; 1,</code>
<code class="linenos">10 </code>    <code class="c1">//     'slug'        =&gt; 'primeira-produto'</code>
<code class="linenos">11 </code>    <code class="c1">// ]);</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Models</code><code class="o">\</code><code class="nx">Product</code><code class="nl">::factory</code><code class="p">(</code><code class="mi">30</code><code class="p">)</code><code class="o">-&gt;</code><code class="nb">create</code><code class="p">();</code>
<code class="linenos">14 </code><code class="p">}</code>
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----factory-product.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Coloquei para gerar 30 produtos aleatórios, a quantidade aqui fica a seu critério. Com isso temos dados suficientes para vermos e testarmos a paginaçõa na tela de Listagem.</p>

<h3 id="leanpub-auto-a-paginao" class="subsection">A paginação</h3>

<p>Como usamos o método <code>paginate</code> lá no nosso controller, podemos por meio da coleção de produtos que recebemos na view, dentro da variável <code>$products</code>, exibir a paginação de forma bem simples e direta!</p>

<p>Adicione o trecho abaixo, logo após o fechamento da tag <code>table</code> da sua view <code>index.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mt-10"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    <code class="cp">{{</code> <code class="err">$</code><code class="nv">products-</code><code class="o">&gt;</code><code class="nv">links</code><code class="o">()</code> <code class="cp">}}</code>
<code class="linenos">3 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>O seguinte trecho exibirá nosso html de navegação entre cada tela da paginação, veja o resultado obtido:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----paginacao.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Simples assim, agora já temos uma paginação tanto nos dados vindos do banco quando na exibição dos links da navegação de forma simples e direta!</p>

<blockquote>
  <p>PS.: No Laravel 8 o layout padrão do paginate mudou de Bootstrap para um framework CSS chamado de TailwindCSS. Caso esteja usando bootstrapcss no estilo da paginação, procure o arquivo <b>app/Providers/AppServiceProvider.php</b> e no método <b>boot</b> deste arquivo, adicione o seguinte trecho: <code>Paginator::useBootstrap();</code>. </p>

  <p>Não esqueça de importar o Paginator: <code>use Illuminate\Pagination\Paginator;</code></p>

  <p>Desta forma o paginator irá usar o layout com bootstrap ao invés do tailwindcss e o <code>AppServiceProvider</code> disponibiliza esta config de forma global para nós.</p>
</blockquote>

<h2 id="leanpub-auto-concluses-6" class="section">Conclusões</h2>

<p>Neste capítulo nós fechamos o ciclo MVC iniciado lá no começo do livro. Além de termos tido contato com diversas diretivas do blade, que juntadas as que vimos aqui já te dão uma excelente base de aprendizado e aplicação!</p>

<p>É claro que ainda veremos mais opções do blade mas isso vou diluindo no decorrer dos próximos capítulos. </p>

<p>Agora que temos nosso CRUD completo, em se tratando de persitência no banco e retornando para as views os resultados, além de termos dado um tapa nas nossas views, vamos para o próximo capítulo onde vamos trabalhar os relacionamentos de banco de dados tanto na base de dados como em nossos models.</p>

<p>Vamos lá!</p>


<h1 id="leanpub-auto-relacionamentos-com-eloquent" class="chapter">Relacionamentos com Eloquent</h1>

<p>Olá, tudo bem? Espero que sim!</p>

<p>Vamos começar agora um trecho que é necessário ter bastante atenção e cuidado, vamos falar sobre relacionamentos de uma base relacional (nosso banco de dados) e a representação destes relacionamentos do ponto de vista de Objetos, representadados por nossos Models junto com o Eloquent.</p>

<p>Como venho fazendo vamos mostrar os relacionamentos e suas nuances aplicados em nossa Loja, onde teremos as seguintes representações:</p>

<ul>
  <li>Relacionamento 1:N (Um para Muitos): Produto x Fotos;</li>
  <li>Relacionamento N:N (Muitos para Muitos): Produtos x Categorias;</li>
</ul>

<p>Vamos iniciar pelo primeiro relacionamento, o 1:N entre Produto e Fotos.</p>

<h2 id="leanpub-auto-relacionamento-1n-um-para-muitos-e-inverso" class="section">Relacionamento 1:N (Um para Muitos e Inverso)</h2>

<p>Primeiramente vamos criar nosso model para a tabela de Fotos do Produto. Para isso crie o model, com uma factory e uma migration junto:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:model ProductPhoto -mf
</pre></div>

</figure>


<p>Feito isso, adicione na migration gerada <code>&lt;timestamp&gt;-create_product_photos_table</code> as seguintes colunas:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">foreignId</code><code class="p">(</code><code class="s1">'product_id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">constrained</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">cascadeOnDelete</code><code class="p">();</code>
<code class="linenos">2 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'photo'</code><code class="p">);</code>
</pre></div>

</figure>


<blockquote>
  <p>Já execute as migrações assim que incluir as colunas da tabela product_photos, que será criada com base nessa migration recém adicionada no projeto.</p>
</blockquote>

<p>Acima destaco apenas a primeira linha, onde criamos nossa coluna para referência da chave estrangeira que apontará para a tabela de produtos. Lembrando que se você chegou neste ponto em sua carreira o banco de dados não deve ser problema mais para você!</p>

<p>Ao definirmos a coluna <code>product_id</code> como foreignId automaticamente o laravel colocará ela como bingInteger &amp; unsigned. O método <code>constrained</code> fará a criação da chave estrangeira adicionando a referência para a coluna <code>id</code> lá da tabela <code>products</code>.</p>

<p>O Laravel buscará com base no parâmetro do foreignId o nome da tabela, ignorando o <code>_id</code> e buscando a tabela no plura, no caso products e neste caso ela satisfaz pois o nome da nossa tabela de fato é <code>products</code>. Caso tenha uma tabela que foge dessa convenção pode informar como primeiro parâmetro do método <code>constrained</code> e tendo a coluna remota diferente de id pode informá-la no segundo parâmetro do mesmo método.</p>

<p>O método, aninhado, <code>cascadeOnDelete</code> indica que ao removermos um produto seus dados associados serão apagados. Essa estratégia é uma das opções ligadas a chave estrangeira e não é uma verdade pois dependerá muito da sua regra esse tipo de comportamento.</p>

<p>Com estas configurações definidas na tabela <code>product_photos</code> vamos mapear esse relacionamento do ponto de vista dos models.</p>

<p>Primeiramente vamos criar o método do ponto de vista de Product em relação ao model ProductPhoto. Veja o método abaixo adicionado ao model <code>Product</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">photos</code><code class="o">():</code> <code class="nt">HasMany</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">return</code> <code class="err">$this-&gt;hasMany(</code><code class="n">ProductPhoto</code><code class="p">:</code><code class="o">:</code><code class="n">class</code><code class="p">);</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Não esqueça de importar o <code>use Illuminate\Database\Eloquent\Relations\HasMany;</code>.</p>

<p>Definimos o método acima para representar a ligação do ponto de vista de Product, ponto de vista esse que indica que o produto pode ter 1 ou mais fotos relacionadas a ele.</p>

<p>O método <code>hasMany</code> indicará essa ligação e por padrão e baseada no nome do model buscará a coluna, em product_photos, chamada de <code>product_id</code> por isso criamos ela com este padrão inclusive.</p>

<p>Se por ventura você usou um nome de coluna diferente, que representa a referência na sua tabela. Por exemplo, não usou o <code>product_id</code> mas sim <code>produtos_id</code>. Neste caso você precisa informar para o Eloquent o nome da coluna, veja um trecho exemplo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">return</code> <code class="o">$</code><code class="nt">this-</code><code class="o">&gt;</code><code class="nt">hasMany</code><code class="o">(</code><code class="nt">ProductPhoto</code><code class="p">::</code><code class="nd">class</code><code class="o">,</code>  <code class="s1">'produtos_id'</code><code class="o">);</code>
</pre></div>

</figure>


<p>Agora como digo que o model <code>ProductPhoto</code> pertence a um produto? Vamos lá no model <code>ProductPhoto</code> e defini o método de ligação:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">product</code><code class="o">():</code> <code class="nt">BelongsTo</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">return</code> <code class="err">$this-&gt;belongsTo(</code><code class="n">Product</code><code class="p">:</code><code class="o">:</code><code class="n">class</code><code class="p">);</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Não esqueça do import: <code>use Illuminate\Database\Eloquent\Relations\BelongsTo;</code> e já que estamos aqui adicone em ProductPhoto a propriedade $fillable como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>public $fillable = ['photo'];
</pre></div>

</figure>


<p>Pontos importantes, aqui em <code>ProductPhoto</code> adicionei um método de ligação que indica que este model pertence(belongs) ao(to) model <code>Product</code>. O método belongsTo resolverá o nome da coluna referência por meio do nome do método de ligação.</p>

<p>Como o método de ligação é <code>product</code> o Laravel entenderá que o nome da coluna é <code>product_id</code>, se por ventura o método fosse produto ele entenderia que a coluna é <code>produto_id</code>. Se o nome da sua coluna está diferente você pode manipular tanto informando o nome do segundo parâmetro do método <code>belongsTo</code>(chamando dentro do método <code>product</code> que é nosso método de ligação) ou manipular o nome do método de ligação de forma que o laravel manipule e coloque o nome da coluna corretamente.</p>

<p>Da forma que mapeamos já estamos respeitando, em ambos os lados, as configurações de relacionamento corretamente.</p>

<p>As definições do ponto de vista do Model são estas, agora, para entendermos melhor vamos realizar algumas queries para testarmos esta relação.</p>

<h3 id="leanpub-auto-factories-com-relacionamentos" class="subsection">Factories com relacionamentos</h3>

<p>Antes de fazermos algumas queries neste relacionamento, precisamos criar alguns dados para tal. Neste ponto precisamos entender como gerar dados fakes relacionados, no caso criar X Produtos com X Fotos por exemplo.</p>

<p>Por enquanto não trabalharemos com upload de arquivos, manteremos as fotos somente via dados fake, então, em seu ProductPhotoFactory adicione o seguinte conteúdo no método <code>definition</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">return</code> <code class="cp">[</code>
<code class="linenos">2 </code>    <code class="s1">'photo'</code> <code class="o">=&gt;</code> <code class="nx">fake</code><code class="p">()</code><code class="o">-&gt;</code><code class="nx nx-Member">imageUrl</code><code class="p">(</code><code class="nx">width</code><code class="p">:</code> <code class="mi">480</code><code class="p">,</code> <code class="nx">height</code><code class="p">:</code> <code class="mi">480</code><code class="p">)</code>
<code class="linenos">3 </code><code class="cp">]</code><code class="o">;</code>
</pre></div>

</figure>


<p>Na web temos diversos sites que permitem que chamemos links com configurações de larguraxaltura e estes links já retorna uma imagem fake para gente. Usando o método <code>imageUrl</code>, do faker, teremos isso de forma facilitada.</p>

<p>Uma vez definido a factory de photos, vamos alterar nosso ProductTableSeeder. Veja o código abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">Product</code><code class="p">::</code><code class="nd">factory</code><code class="o">(</code><code class="nt">30</code><code class="o">)</code>
<code class="linenos">2 </code>            <code class="nt">-</code><code class="o">&gt;</code><code class="nt">hasPhotos</code><code class="o">(</code><code class="nt">5</code><code class="o">)</code> <code class="o">//</code><code class="nt">linha</code> <code class="nt">adicionada</code>
<code class="linenos">3 </code>            <code class="nt">-</code><code class="o">&gt;</code><code class="nt">create</code><code class="o">();</code>
</pre></div>

</figure>


<p>Perceba que adicionei o método <code>hasPhotos</code> indicando que quero criar 5 fotos e essas fotos já associadas ao produto que será criado. Perceba que o nome do método <code>hasPhotos</code>, tirando o has, respeita exatamente o nome de ligação dentro do model Product.</p>

<p>O laravel entenderá e buscará por este método de ligação para realizar a criação dos dados associados e como estamos no contexto de factories utilizará a factory, também, do ProductPhoto.</p>

<p>Vamos resetar os dados da nossa base e já executar as migrações juntos:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate:refresh --seed
</pre></div>

</figure>


<p>Resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----refresh-relations-factory.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Agora que temos o mapeamento 1:N~N:1(Um pra Muitos &amp; Muitos pra Um) tanto nos models quanto na base e temos os dados associados. Testaremos e entenderemos alguns acessos via os métodos de ligação.</p>

<h3 id="leanpub-auto-query-via-relaes-no-eloquent-models" class="subsection">Query via Relações no Eloquent (Models)</h3>

<p>Primeiramente vamos realizar algumas queries via model Product. Por exemplo caso queiramos pegar as fotos do Produto, podemos fazer como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">$</code><code class="nt">product</code> <code class="o">=</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">Product</code><code class="p">::</code><code class="nd">find</code><code class="o">(</code><code class="nt">2</code><code class="o">);</code>
<code class="linenos">2 </code><code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">photos</code><code class="o">;</code>
</pre></div>

</figure>


<p>Para melhor mostrar esses testes e queries vou utilizar um terminal inteligente que vêm no artisan chamado de <code>Tinker</code>. O tinker permite que façamos diversas interações com nossa aplicação como ponto de teste.</p>

<p>Para acessar vamos executar o comando abaixo em nosso terminal ou cmd:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan tinker
</pre></div>

</figure>


<p>Veja:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tinker.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Peguemos o trecho anterior e executemos dentro desse cli inteligente:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tinker-2.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Então peguemos agora as fotos do produto:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tinker-3.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Ao acessarmos, a partir de um model buscado na base, a propriedade que têm o mesmo nome do método de ligação o Laravel já retorna os objetos associados a este model depedendo da ligação mapeada.</p>

<p>Aí comentado acima está uma grande diferença entre acessar a ligação como propriedade e como o método, método este que está lá mapeado.</p>

<p>Se eu chamar o método o retorno será, tal qual está mapeado no próprio model e esse comportamento serve pra todos os tipos de ligação. Comportamento de acessar a ligação como método ou propriedade.</p>

<p>Veja:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tinker-10.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Acessando como atributo temos acesso a collection, que já traz os dados associados. Já acessando o método, que de fato está definido no model, temos o retorno do objeto HasMany.</p>

<p>Caso você precise realizar mais queries a partir desta relação lembre sempre de chamar o método de ligação, isso vale pra toda as relações via Model.</p>

<p>Podemos verificar, também quantos dados temos associados. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">photos</code><code class="o">-&gt;</code><code class="nf">count</code><code class="p">();</code>
</pre></div>

</figure>

<p class="fake-para">Acima chamamos o count existente na collection, esse método também existe no query builder então podemos chamá-lo também a partir do método:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">photos</code><code class="p">()</code><code class="o">-&gt;</code><code class="nf">count</code><code class="p">();</code>
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tinker-4.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Do ponto de vista de ProductPhoto podemos trabalhar a ligação com o mesmo pensamento, só têm uma diferença nos dados. Como estamos ligados a 1 produto, os retornos serão o dado pai populado em um model Product e não uma collection.</p>

<p>Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">$</code><code class="nt">productPhoto</code> <code class="o">=</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">ProductPhoto</code><code class="p">::</code><code class="nd">find</code><code class="o">(</code><code class="nt">1</code><code class="o">);</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="o">$</code><code class="nt">productPhoto-</code><code class="o">&gt;</code><code class="nt">product</code><code class="o">;</code>
</pre></div>

</figure>


<p>Destaco na foto apenas a chamada do produto pai da foto de id 1:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----product-photo-relation-1.png">
    <figcaption></figcaption>
  </figure>
</div>


<blockquote>
  <p>O pensamento acessar o método de ligação como propriedade ou método é o mesmo aqui também.</p>

  <p>Quando você precisar realizar queries na relação lembre sempre de chamar o método de ligação.</p>
</blockquote>

<p>Por hora é isso que quero mostrar aqui no mapeamento 1:N, vamos conhecer o MuitosPraMuitos(M:M).</p>

<p>Ah, pra sair do <code>tinker</code> digite <code>quit</code> e dê <code>ENTER</code>. rsrsrs…</p>

<h2 id="leanpub-auto-manytomany-com-eloquent-categorias-e-produtos" class="section">ManyToMany com Eloquent: Categorias e Produtos</h2>

<p>Agora neste ponto vamos começar a parte da relação de Muitos para Muitos, a relação aqui será entre Produtos e Categorias. Primeiramente vamos criar o model Category(Categoria), suas migrations e todo o CRUD deste participante. </p>

<p>Podemos já começar criando nosso model com todo o aparato necessário de uma vez só, criar o model, a migration e o controller como recurso de uma vez só!</p>

<p>Execute na raiz do seu projeto o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:model Category -mcr
</pre></div>

</figure>


<p>Considerações:</p>

<ul>
  <li>
<code>-m</code>: cria a migration deste model;</li>
  <li>
<code>-c</code>: cria o controller deste model;</li>
  <li>
<code>-r</code>: cria o controller como recurso para este model.</li>
</ul>

<blockquote>
  <p>PS.: Você pode passar os parâmetros separados, ou como na imagem juntos.</p>
</blockquote>

<p>Veja o resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----model-cat.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Obs.: O comando irá criar o controller na pasta de Controllers normalmente, apenas mova este controller para a pasta <code>Admin</code> e corrija o namespace, de <code>namespace App\Http\Controllers;</code> para <code>namespace App\Http\Controllers\Admin;</code> e adicione o import do controller base: <code>use App\Http\Controllers\Controller;</code>.</p>

<p>Veja o controller na íntegra depois das observações acima:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Admin</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">Category</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="n">CategoryController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="o">/**</code>
<code class="linenos">12 </code>     <code class="o">*</code> <code class="n">Display</code> <code class="n">a</code> <code class="n">listing</code> <code class="n">of</code> <code class="n">the</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">13 </code>     <code class="o">*/</code>
<code class="linenos">14 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>        <code class="o">//</code>
<code class="linenos">17 </code>    <code class="p">}</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="o">/**</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="n">Show</code> <code class="n">the</code> <code class="n">form</code> <code class="k">for</code> <code class="n">creating</code> <code class="n">a</code> <code class="n">new</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">21 </code>     <code class="o">*/</code>
<code class="linenos">22 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">create</code><code class="p">()</code>
<code class="linenos">23 </code>    <code class="p">{</code>
<code class="linenos">24 </code>        <code class="o">//</code>
<code class="linenos">25 </code>    <code class="p">}</code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>    <code class="o">/**</code>
<code class="linenos">28 </code>     <code class="o">*</code> <code class="n">Store</code> <code class="n">a</code> <code class="n">newly</code> <code class="n">created</code> <code class="n">resource</code> <code class="ow">in</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">29 </code>     <code class="o">*/</code>
<code class="linenos">30 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">store</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos">31 </code>    <code class="p">{</code>
<code class="linenos">32 </code>        <code class="o">//</code>
<code class="linenos">33 </code>    <code class="p">}</code>
<code class="linenos">34 </code>
<code class="linenos">35 </code>    <code class="o">/**</code>
<code class="linenos">36 </code>     <code class="o">*</code> <code class="n">Display</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">37 </code>     <code class="o">*/</code>
<code class="linenos">38 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">show</code><code class="p">(</code><code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">39 </code>    <code class="p">{</code>
<code class="linenos">40 </code>        <code class="o">//</code>
<code class="linenos">41 </code>    <code class="p">}</code>
<code class="linenos">42 </code>
<code class="linenos">43 </code>    <code class="o">/**</code>
<code class="linenos">44 </code>     <code class="o">*</code> <code class="n">Show</code> <code class="n">the</code> <code class="n">form</code> <code class="k">for</code> <code class="n">editing</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">45 </code>     <code class="o">*/</code>
<code class="linenos">46 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">edit</code><code class="p">(</code><code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">47 </code>    <code class="p">{</code>
<code class="linenos">48 </code>        <code class="o">//</code>
<code class="linenos">49 </code>    <code class="p">}</code>
<code class="linenos">50 </code>
<code class="linenos">51 </code>    <code class="o">/**</code>
<code class="linenos">52 </code>     <code class="o">*</code> <code class="n">Update</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code> <code class="ow">in</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">53 </code>     <code class="o">*/</code>
<code class="linenos">54 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">update</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">,</code> <code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">55 </code>    <code class="p">{</code>
<code class="linenos">56 </code>        <code class="o">//</code>
<code class="linenos">57 </code>    <code class="p">}</code>
<code class="linenos">58 </code>
<code class="linenos">59 </code>    <code class="o">/**</code>
<code class="linenos">60 </code>     <code class="o">*</code> <code class="n">Remove</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code> <code class="n">from</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">61 </code>     <code class="o">*/</code>
<code class="linenos">62 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">destroy</code><code class="p">(</code><code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">63 </code>    <code class="p">{</code>
<code class="linenos">64 </code>        <code class="o">//</code>
<code class="linenos">65 </code>    <code class="p">}</code>
<code class="linenos">66 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Por enquanto vamos deixá-lo assim, vamos da uma atenção lá para nossa migration, acesse a pasta de migrations e abra o arquivo: <code>&lt;ARQUIVO_TIMESTAMP&gt;_create_categories_table.php</code>.</p>

<p>Adicione o seguintes campos abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'name'</code><code class="p">);</code>
<code class="linenos">2 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'description'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">nullable</code><code class="p">();</code>
<code class="linenos">3 </code><code class="err">$</code><code class="nf">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s">'slug'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Como você pode ver o Laravel pegou o nome do nosso model e já preparou nossa migration para o plural, pela convenção já comentada aqui. </p>

<p>Neste caso teremos a tabela <code>categories</code> com os campos:</p>

<ul>
  <li>id;</li>
  <li>name;</li>
  <li>description;</li>
  <li>slug;</li>
  <li>created_at;</li>
  <li>updated_at;</li>
</ul>

<p>Após as alterações que comentei anteriormente, vamos criar uma nova migration, a migração para nossa tabela pivot ou intermediária, para a relação M:M. </p>

<p>Muitos para Muitos permite que um produto tenha várias categorias e uma categoria tenha vários produtos, desta forma precisamos de uma tabela intermediária para manter esta relação/ligação.</p>

<p>Execute em seu terminal o comando abaixo para criação da migração para esta tabela intermediária:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:migration create_category_product_table
</pre></div>

</figure>


<p>Veja o conteúdo na íntegra da migração já com as configs da tabela:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Migrations</code>\<code class="n">Migration</code><code class="p">;</code>
<code class="linenos"> 4 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Schema</code>\<code class="n">Blueprint</code><code class="p">;</code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">Facades</code>\<code class="n">Schema</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">return</code> <code class="n">new</code> <code class="k">class</code> <code class="k">extends</code> <code class="n">Migration</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Run</code> <code class="n">the</code> <code class="n">migrations</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">up</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">create</code><code class="p">(</code><code class="s1">'category_product'</code><code class="p">,</code> <code class="n">function</code> <code class="p">(</code><code class="n">Blueprint</code> <code class="o">$</code><code class="n">table</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">15 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">();</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">foreignId</code><code class="p">(</code><code class="s1">'category_id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">constrained</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">cascadeOnDelete</code><code class="p">();</code>
<code class="linenos">18 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">foreignId</code><code class="p">(</code><code class="s1">'product_id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">constrained</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">cascadeOnDelete</code><code class="p">();</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>            <code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">timestamps</code><code class="p">();</code>
<code class="linenos">21 </code>        <code class="p">});</code>
<code class="linenos">22 </code>    <code class="p">}</code>
<code class="linenos">23 </code>
<code class="linenos">24 </code>    <code class="o">/**</code>
<code class="linenos">25 </code>     <code class="o">*</code> <code class="n">Reverse</code> <code class="n">the</code> <code class="n">migrations</code><code class="o">.</code>
<code class="linenos">26 </code>     <code class="o">*/</code>
<code class="linenos">27 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">down</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">28 </code>    <code class="p">{</code>
<code class="linenos">29 </code>        <code class="n">Schema</code><code class="p">::</code><code class="n">dropIfExists</code><code class="p">(</code><code class="s1">'category_product'</code><code class="p">);</code>
<code class="linenos">30 </code>    <code class="p">}</code>
<code class="linenos">31 </code><code class="p">};</code>
</pre></div>

</figure>


<p>Nesta tabela precisamos apenas das referências, uma apontando para o produto e o outro para a categoria, além das chaves estrangeiras referenciando cada tabela para o id de cada uma mediante uso dos métodos que já conhecemos.</p>

<p>Agora podemos executar estas migrações na base de dados, vamos ao terminal executar o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate
</pre></div>

</figure>


<p>Veja o resultado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----migrate-cat-posts.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Com as tabelas no ponto e definidas, como podemos mapear nossa relação do ponto de vista do model? </p>

<p>Existe no Eloquent o método para esta relação, o <code>belongsToMany</code>(traduzindo Pertence a Muitos) que estará nos dois models por conta da tabela intermediária. </p>

<p>Então, vamos adicionar o método abaixo dentro do nosso model <code>Product</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">categories</code><code class="o">()</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>	<code class="err">return</code> <code class="err">$this-&gt;belongsToMany(</code><code class="n">Category</code><code class="p">:</code><code class="o">:</code><code class="n">class</code><code class="p">);</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<p>E no model <code>Category</code> adicione o método abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">products</code><code class="o">()</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>	<code class="err">return</code> <code class="err">$this-&gt;belongsToMany(</code><code class="n">Product</code><code class="p">:</code><code class="o">:</code><code class="n">class</code><code class="p">);</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O método <code>belongsToMany</code> nos permite o mapeamento na relação de muitos p/ muitos entre os dois models, como ambos apontam para a mesma tabela, o método de ambos os lados também é o mesmo.</p>

<p>Aqui vale um aprendizado e um adendo, o segundo parâmetro do método <code>belongsToMany</code> é o nome da tabela intermediária e o Laravel já resolve o nome dela procurando uma tabela com o nome de ambos os models no singular e em ordem alfabética. Então seria Category, Product ficando assim: <code>category_product</code> exatamente como colocamos.</p>

<p>Caso sua tabela fuja desse padrão informe o nome dela como segundo parâmetro do método <code>belongsToMany</code>.</p>

<p>Antes de criarmos nosso produto com suas categorias, vamos criar rapidamente o CRUD de categorias com alguns detalhes a mais a serem adicionados também em nosso CRUD de produtos melhorando assim nossa aplicação.</p>

<h2 id="leanpub-auto-crud-de-categorias" class="section">CRUD de Categorias</h2>

<p>Vamos criar nosso CRUD de categorias, praticamente algo que já conhecemos então irei organizar as coisas um pouco diferente.</p>

<p>Agora vamos ao nosso controller, irei colocar método por método do controller de Categorias, o <code>CategoryController</code>, para vermos os pontos importantes sobre cada método. Ao final coloco ele na íntegra para conferência.</p>

<p>Vamos ao primeiro método, o método index e o construtor:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="n">function</code> <code class="n">__construct</code><code class="p">(</code><code class="n">private</code> <code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>	<code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">category</code> <code class="o">=</code> <code class="o">$</code><code class="n">category</code><code class="p">;</code>
<code class="linenos"> 4 </code><code class="p">}</code>
<code class="linenos"> 5 </code>
<code class="linenos"> 6 </code><code class="o">/**</code>
<code class="linenos"> 7 </code> <code class="o">*</code> <code class="n">Display</code> <code class="n">a</code> <code class="n">listing</code> <code class="n">of</code> <code class="n">the</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos"> 8 </code> <code class="o">*/</code>
<code class="linenos"> 9 </code><code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="o">$</code><code class="n">categories</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">paginate</code><code class="p">(</code><code class="mi">15</code><code class="p">);</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'categories.index'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'categories'</code><code class="p">));</code>
<code class="linenos">14 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O primeiro ponto importante é a utilização do nosso model como dependência do construtor da classe controller. Com isso teremos por meio do container de serviços do Laravel a instância do nosso model sempre que nosso controller for chamado. Isso simplifica muito as coisas e nos ajuda a mantermos nosso controller mais focado.</p>

<p>Continuando para o método <code>index</code>, a difernça direta aqui é que ao invés de chamar o <code>paginate</code> assim <code>Category::paginate(15)</code>, chamamos pelo atributo do controller, $category, que receberá a instância do nosso model.</p>

<p>O método a seguir é o create, que dispensa comentários até então, veja ele:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="cm">/**</code>
<code class="linenos">2 </code><code class="cm"> * Show the form for creating a new resource.</code>
<code class="linenos">3 </code><code class="cm"> */</code><code class="w"></code>
<code class="linenos">4 </code>public<code class="w"> </code>function<code class="w"> </code>create<code class="o">()</code><code class="w"></code>
<code class="linenos">5 </code><code class="err">{</code><code class="w"></code>
<code class="linenos">6 </code><code class="w">    </code><code class="kr">return</code><code class="w"> </code>view<code class="o">(</code><code class="s">'categories.create'</code><code class="o">)</code><code class="err">;</code><code class="w"></code>
<code class="linenos">7 </code><code class="err">}</code><code class="w"></code>
</pre></div>

</figure>


<p>Vamos continuando para o método store, onde de fato persistimos nossos dados, neste caso categoria. Veja ele e logo após os comentários:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cm">/**</code>
<code class="linenos"> 2 </code><code class="cm"> * Store a newly created resource in storage.</code>
<code class="linenos"> 3 </code><code class="cm"> */</code>
<code class="linenos"> 4 </code><code class="n">public</code> <code class="kr">function</code> <code class="kr">store</code><code class="p">(</code><code class="n">Request</code> <code class="err">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos"> 5 </code><code class="p">{</code>
<code class="linenos"> 6 </code>	<code class="err">$</code><code class="kt">data</code> <code class="o">=</code> <code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">();</code>
<code class="linenos"> 7 </code>    
<code class="linenos"> 8 </code>    <code class="err">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code>    <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'categories.index'</code><code class="p">);</code>
<code class="linenos">11 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Aqui mais uma referência ao nosso atributo, que contêm a instância do nosso model. Usamos o mass assignment que já conhecemos.</p>

<p>O método show têm um pequeno detalhe que preciso comentar, veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="cm">/**</code>
<code class="linenos">2 </code><code class="cm"> * Display the specified resource.</code>
<code class="linenos">3 </code><code class="cm"> */</code>
<code class="linenos">4 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">show</code><code class="p">(</code><code class="n">Category</code> <code class="err">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">5 </code><code class="p">{</code>
<code class="linenos">6 </code>   <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'categories.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s">'category'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">7 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba de cara o parâmetro tipado do método <code>show</code>, tipado para aceitar apenas instâncias do nosso model Category. </p>

<p>Um ponto importante aqui é que quando temos um parâmetro tipado assim, o Laravel automaticamente vai converter este parâmetro para um objeto populado para o id informado via url, por isso que não estou realizando um <code>find</code> ou <code>findOrFail</code> aqui, porque quando chegarmos na execução deste método do  controller, já teremos a instância do objeto <code>Category</code> populada com os dados do banco, a este processo damos o nome de <b>Route Model Biding</b>.</p>

<p>O método <code>show</code> apenas redireciona para a tela de edição que também vêm com a ideia de <code>Route Model Biding</code>.</p>

<p>Veja nosso edit e também nosso update abaixo, o update já com o uso do Update em Massa, como já conhecemos também:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cm">/**</code>
<code class="linenos"> 2 </code><code class="cm">* Show the form for editing the specified resource.</code>
<code class="linenos"> 3 </code><code class="cm">*/</code>
<code class="linenos"> 4 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">edit</code><code class="p">(</code><code class="n">Category</code> <code class="err">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos"> 5 </code><code class="p">{</code>
<code class="linenos"> 6 </code>    <code class="kr">return</code> <code class="n">view</code><code class="p">(</code><code class="s">'categories.edit'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s">'category'</code><code class="p">));</code>
<code class="linenos"> 7 </code><code class="p">}</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="cm">/**</code>
<code class="linenos">10 </code><code class="cm">* Update the specified resource in storage.</code>
<code class="linenos">11 </code><code class="cm">*/</code>
<code class="linenos">12 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">update</code><code class="p">(</code><code class="n">Request</code> <code class="err">$</code><code class="n">request</code><code class="p">,</code> <code class="n">Category</code> <code class="err">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">13 </code><code class="p">{</code>
<code class="linenos">14 </code>    <code class="err">$</code><code class="kt">data</code> <code class="o">=</code> <code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">();</code>
<code class="linenos">15 </code>
<code class="linenos">16 </code>    <code class="err">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'categories.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s">'category'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">19 </code><code class="p">}</code>
</pre></div>

</figure>


<p>A remoção/delete também segue o mesmo pensamento, veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="cm">/**</code>
<code class="linenos">2 </code><code class="cm">* Remove the specified resource from storage.</code>
<code class="linenos">3 </code><code class="cm">*/</code>
<code class="linenos">4 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">destroy</code><code class="p">(</code><code class="n">Category</code> <code class="err">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">5 </code><code class="p">{</code>
<code class="linenos">6 </code>    <code class="err">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">delete</code><code class="p">();</code>
<code class="linenos">7 </code>
<code class="linenos">8 </code>    <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'categories.index'</code><code class="p">);</code>
<code class="linenos">9 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba que por conta do Route Model Binding o passo de <code>find</code> ou <code>findOrFail</code> são cortados pois o Laravel já injetará o model populado no método do controller que recebe a tipagem do model no parâmetro que espera o valor dinâmico vindo da rota. Caso o model não seja encontrado o Laravel já lança o 404 NOT FOUND.</p>

<blockquote>
  <p>Não esqueça dos parâmetros convertidos automaticamente para o model populado com base no id, resolvido dinâmicamente pelo Laravel.</p>
</blockquote>

<p>Ah, e não esqueça do atributo <code>$fillable</code> lá no model Category, para o mass assignment:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>protected $fillable = [
<code class="linenos">2 </code>	'name', 
<code class="linenos">3 </code>	'description', 
<code class="linenos">4 </code>	'slug'
<code class="linenos">5 </code>];
</pre></div>

</figure>


<p>Veja o controller <code>CategoryController</code> na íntegra:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Admin</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">Category</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="n">CategoryController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">__construct</code><code class="p">(</code><code class="n">private</code> <code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">12 </code>    <code class="p">{</code>
<code class="linenos">13 </code>        <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">category</code> <code class="o">=</code> <code class="o">$</code><code class="n">category</code><code class="p">;</code>
<code class="linenos">14 </code>    <code class="p">}</code>
<code class="linenos">15 </code>
<code class="linenos">16 </code>    <code class="o">/**</code>
<code class="linenos">17 </code>     <code class="o">*</code> <code class="n">Display</code> <code class="n">a</code> <code class="n">listing</code> <code class="n">of</code> <code class="n">the</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">18 </code>     <code class="o">*/</code>
<code class="linenos">19 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">20 </code>    <code class="p">{</code>
<code class="linenos">21 </code>        <code class="o">$</code><code class="n">categories</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">paginate</code><code class="p">(</code><code class="mi">15</code><code class="p">);</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'categories.index'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'categories'</code><code class="p">));</code>
<code class="linenos">24 </code>    <code class="p">}</code>
<code class="linenos">25 </code>
<code class="linenos">26 </code>    <code class="o">/**</code>
<code class="linenos">27 </code>     <code class="o">*</code> <code class="n">Show</code> <code class="n">the</code> <code class="n">form</code> <code class="k">for</code> <code class="n">creating</code> <code class="n">a</code> <code class="n">new</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">28 </code>     <code class="o">*/</code>
<code class="linenos">29 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">create</code><code class="p">()</code>
<code class="linenos">30 </code>    <code class="p">{</code>
<code class="linenos">31 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'categories.create'</code><code class="p">);</code>
<code class="linenos">32 </code>    <code class="p">}</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code>    <code class="o">/**</code>
<code class="linenos">35 </code>     <code class="o">*</code> <code class="n">Store</code> <code class="n">a</code> <code class="n">newly</code> <code class="n">created</code> <code class="n">resource</code> <code class="ow">in</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">36 </code>     <code class="o">*/</code>
<code class="linenos">37 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">store</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos">38 </code>    <code class="p">{</code>
<code class="linenos">39 </code>        <code class="o">$</code><code class="n">data</code> <code class="o">=</code> <code class="o">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">();</code>
<code class="linenos">40 </code>
<code class="linenos">41 </code>        <code class="o">$</code><code class="n">category</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">(</code><code class="o">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos">42 </code>
<code class="linenos">43 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'categories.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'category'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">44 </code>    <code class="p">}</code>
<code class="linenos">45 </code>
<code class="linenos">46 </code>    <code class="o">/**</code>
<code class="linenos">47 </code>     <code class="o">*</code> <code class="n">Display</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">48 </code>     <code class="o">*/</code>
<code class="linenos">49 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">show</code><code class="p">(</code><code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">50 </code>    <code class="p">{</code>
<code class="linenos">51 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'categories.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'category'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">52 </code>    <code class="p">}</code>
<code class="linenos">53 </code>
<code class="linenos">54 </code>    <code class="o">/**</code>
<code class="linenos">55 </code>     <code class="o">*</code> <code class="n">Show</code> <code class="n">the</code> <code class="n">form</code> <code class="k">for</code> <code class="n">editing</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code><code class="o">.</code>
<code class="linenos">56 </code>     <code class="o">*/</code>
<code class="linenos">57 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">edit</code><code class="p">(</code><code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">58 </code>    <code class="p">{</code>
<code class="linenos">59 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'categories.edit'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'category'</code><code class="p">));</code>
<code class="linenos">60 </code>    <code class="p">}</code>
<code class="linenos">61 </code>
<code class="linenos">62 </code>    <code class="o">/**</code>
<code class="linenos">63 </code>     <code class="o">*</code> <code class="n">Update</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code> <code class="ow">in</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">64 </code>     <code class="o">*/</code>
<code class="linenos">65 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">update</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">,</code> <code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">66 </code>    <code class="p">{</code>
<code class="linenos">67 </code>        <code class="o">$</code><code class="n">data</code> <code class="o">=</code> <code class="o">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">();</code>
<code class="linenos">68 </code>
<code class="linenos">69 </code>        <code class="o">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">(</code><code class="o">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos">70 </code>
<code class="linenos">71 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'categories.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'category'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">72 </code>    <code class="p">}</code>
<code class="linenos">73 </code>
<code class="linenos">74 </code>    <code class="o">/**</code>
<code class="linenos">75 </code>     <code class="o">*</code> <code class="n">Remove</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">resource</code> <code class="n">from</code> <code class="n">storage</code><code class="o">.</code>
<code class="linenos">76 </code>     <code class="o">*/</code>
<code class="linenos">77 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">destroy</code><code class="p">(</code><code class="n">Category</code> <code class="o">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">78 </code>    <code class="p">{</code>
<code class="linenos">79 </code>        <code class="o">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="n">delete</code><code class="p">();</code>
<code class="linenos">80 </code>
<code class="linenos">81 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'categories.index'</code><code class="p">);</code>
<code class="linenos">82 </code>    <code class="p">}</code>
<code class="linenos">83 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Agora, vamos as views.</p>

<p>As views não têm novidades, mas antes, crie a pasta <code>categories</code>, dentro da pasta views, e dentro os arquivos:</p>

<ul>
  <li>index.blade.php;</li>
  <li>create.blade.php;</li>
  <li>edit.blade.php.</li>
</ul>

<p>Com os conteúdos:</p>

<p><b>index.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-10 flex justify-between"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>        <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"font-bold text-xl"</code><code class="o">&gt;</code><code class="n">Categorias</code><code class="o">&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>        <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{ route('categories.create') }}"</code>
<code class="linenos"> 7 </code>            <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-white\</code>
<code class="linenos"> 8 </code><code class="s"> font-thin"</code><code class="o">&gt;</code><code class="n">Criar</code> <code class="n">Categoria</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">10 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-5"</code><code class="o">&gt;</code>
<code class="linenos">11 </code>        <code class="o">&lt;</code><code class="n">table</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full"</code><code class="o">&gt;</code>
<code class="linenos">12 </code>            <code class="o">&lt;</code><code class="n">thead</code><code class="o">&gt;</code>
<code class="linenos">13 </code>                <code class="o">&lt;</code><code class="n">tr</code> <code class="k">class</code><code class="o">=</code><code class="s">"border-b border-gray-600"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="err">#</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">15 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="n">Categoria</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">16 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="n">Criado</code> <code class="n">em</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">17 </code>                    <code class="o">&lt;</code><code class="n">th</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-xl text-left"</code><code class="o">&gt;</code><code class="n">Ações</code><code class="o">&lt;/</code><code class="n">th</code><code class="o">&gt;</code>
<code class="linenos">18 </code>                <code class="o">&lt;/</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">19 </code>            <code class="o">&lt;/</code><code class="n">thead</code><code class="o">&gt;</code>
<code class="linenos">20 </code>            <code class="o">&lt;</code><code class="n">tbody</code><code class="o">&gt;</code>
<code class="linenos">21 </code>                <code class="p">@</code><code class="n">forelse</code><code class="p">(</code><code class="n">$categories</code> <code class="n">as</code> <code class="n">$category</code><code class="p">)</code>
<code class="linenos">22 </code>                    <code class="o">&lt;</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">23 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$category</code><code class="o">-&gt;</code><code class="kt">id</code>\
<code class="linenos">24 </code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">25 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$category</code><code class="o">-&gt;</code><code class="n">na</code>\
<code class="linenos">26 </code><code class="n">me</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">27 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$category</code><code class="o">-&gt;</code><code class="n">cr</code>\
<code class="linenos">28 </code><code class="n">eated_at</code><code class="o">-&gt;</code><code class="n">format</code><code class="p">(</code><code class="err">'</code><code class="n">d</code><code class="o">/</code><code class="n">m</code><code class="o">/</code><code class="n">Y</code> <code class="nl">H</code><code class="p">:</code><code class="n">i</code><code class="err">'</code><code class="p">)</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">29 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[15%] px-4 py-2 text-normal text-left"</code><code class="o">&gt;</code>
<code class="linenos">30 </code>                            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"flex justify-around gap-x-2"</code><code class="o">&gt;</code>
<code class="linenos">31 </code>                                <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{ route('categories.show', ['category' =&gt; \</code>
<code class="linenos">32 </code><code class="s">$category-&gt;id]) }}"</code>
<code class="linenos">33 </code>                                    <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-blue-700 border border-blue-\</code>
<code class="linenos">34 </code><code class="s">900 rounded text-white font-thin"</code><code class="o">&gt;</code>
<code class="linenos">35 </code>                                    <code class="n">Editar</code>
<code class="linenos">36 </code>                                <code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">37 </code>                                <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('categories.destroy', ['categ\</code>
<code class="linenos">38 </code><code class="s">ory' =&gt; $category-&gt;id]) }}"</code>
<code class="linenos">39 </code>                                    <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">40 </code>                                    <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">41 </code>                                    <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">42 </code>                                    <code class="o">&lt;</code><code class="n">button</code> <code class="n">type</code><code class="o">=</code><code class="s">"submit"</code>
<code class="linenos">43 </code>                                        <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-red-700 border border-re\</code>
<code class="linenos">44 </code><code class="s">d-900 rounded text-white font-thin"</code><code class="o">&gt;</code><code class="n">Remover</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">45 </code>                                <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">46 </code>                            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">47 </code>                        <code class="o">&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">48 </code>                    <code class="o">&lt;/</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">49 </code>                <code class="p">@</code><code class="n">empty</code>
<code class="linenos">50 </code>                    <code class="o">&lt;</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">51 </code>                        <code class="o">&lt;</code><code class="n">td</code> <code class="n">colspan</code><code class="o">=</code><code class="s">"4"</code><code class="o">&gt;</code><code class="n">Nada</code> <code class="n">encontrado</code><code class="o">!&lt;/</code><code class="n">td</code><code class="o">&gt;</code>
<code class="linenos">52 </code>                    <code class="o">&lt;/</code><code class="n">tr</code><code class="o">&gt;</code>
<code class="linenos">53 </code>                <code class="p">@</code><code class="n">endforelse</code>
<code class="linenos">54 </code>            <code class="o">&lt;/</code><code class="n">tbody</code><code class="o">&gt;</code>
<code class="linenos">55 </code>        <code class="o">&lt;/</code><code class="n">table</code><code class="o">&gt;</code>
<code class="linenos">56 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">57 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-10"</code><code class="o">&gt;</code>
<code class="linenos">58 </code>        <code class="p">{{</code> <code class="n">$categories</code><code class="o">-&gt;</code><code class="n">links</code><code class="p">()</code> <code class="p">}}</code>
<code class="linenos">59 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">60 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<p><b>create.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('categories.store') }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-g\</code>
<code class="linenos">10 </code><code class="s">ray-900"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('name') }}"</code><code class="o">&gt;</code>
<code class="linenos">11 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Descrição</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">15 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"description"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border b\</code>
<code class="linenos">16 </code><code class="s">order-gray-900"</code>
<code class="linenos">17 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('description') }}"</code><code class="o">&gt;</code>
<code class="linenos">18 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">21 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Slug</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">22 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"slug"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-g\</code>
<code class="linenos">23 </code><code class="s">ray-900"</code>
<code class="linenos">24 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('slug') }}"</code><code class="o">&gt;</code>
<code class="linenos">25 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-w\</code>
<code class="linenos">28 </code><code class="s">hite font-thin"</code><code class="o">&gt;</code><code class="n">Criar</code> <code class="n">Categoria</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">29 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">30 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<p><b>edit.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('categories.update', ['category' =&gt; $category-&gt;id]) }}"</code> <code class="n">m</code>\
<code class="linenos"> 5 </code><code class="n">ethod</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 7 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">PUT</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 8 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">10 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-g\</code>
<code class="linenos">11 </code><code class="s">ray-900"</code>
<code class="linenos">12 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $category-&gt;name }}"</code><code class="o">&gt;</code>
<code class="linenos">13 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">16 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Descrição</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">17 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"description"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border b\</code>
<code class="linenos">18 </code><code class="s">order-gray-900"</code>
<code class="linenos">19 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $category-&gt;description }}"</code><code class="o">&gt;</code>
<code class="linenos">20 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">21 </code>
<code class="linenos">22 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">23 </code>            <code class="o">&lt;</code><code class="n">label</code><code class="o">&gt;</code><code class="n">Slug</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">24 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"slug"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-g\</code>
<code class="linenos">25 </code><code class="s">ray-900"</code>
<code class="linenos">26 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $category-&gt;slug }}"</code><code class="o">&gt;</code>
<code class="linenos">27 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-w\</code>
<code class="linenos">30 </code><code class="s">hite font-thin"</code><code class="o">&gt;</code><code class="n">Atualizar</code>
<code class="linenos">31 </code>            <code class="n">Categoria</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">32 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('categories.destroy', ['category' =&gt; $category-&gt;id]) }}"</code> \
<code class="linenos">35 </code><code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">36 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">37 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">38 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="n">type</code><code class="o">=</code><code class="s">"submit"</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-red-700 border border-red-900 roun\</code>
<code class="linenos">39 </code><code class="s">ded text-white font-thin mt-8"</code><code class="o">&gt;</code><code class="n">Remover</code>
<code class="linenos">40 </code>            <code class="n">Categoria</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">41 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">42 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<p>Ah e não esqueça de linkar no menu do <code>layout.blade.php</code> o menu de categorias, veja o trecho adicionado logo após o link de produtos:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'categories.index'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code>
<code class="linenos">3 </code>        <code class="na">class=</code><code class="s">"text-white px-6 py-4 hover:bg-purple-800 transition ease-in-out durat\</code>
<code class="linenos">4 </code><code class="s">ion-300"</code><code class="nt">&gt;</code>Categorias<code class="nt">&lt;/a&gt;</code>
<code class="linenos">5 </code><code class="nt">&lt;/li&gt;</code>
</pre></div>

</figure>


<p>Na tag do elemento <code>ul</code> destes menus coloque mais uma classe chamada de flex para alinharmos os menus horizontalmente. Veja o ul completo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code> <code class="nt">&lt;ul</code> <code class="na">class=</code><code class="s">"flex"</code><code class="nt">&gt;</code>
<code class="linenos"> 2 </code>    <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos"> 3 </code>        <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'products.index'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code>
<code class="linenos"> 4 </code>            <code class="na">class=</code><code class="s">"text-white px-6 py-4 hover:bg-purple-800 transition ease-in-out d\</code>
<code class="linenos"> 5 </code><code class="s">uration-300"</code><code class="nt">&gt;</code>Produtos<code class="nt">&lt;/a&gt;</code>
<code class="linenos"> 6 </code>    <code class="nt">&lt;/li&gt;</code>
<code class="linenos"> 7 </code>    <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos"> 8 </code>        <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'categories.index'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code>
<code class="linenos"> 9 </code>            <code class="na">class=</code><code class="s">"text-white px-6 py-4 hover:bg-purple-800 transition ease-in-out d\</code>
<code class="linenos">10 </code><code class="s">uration-300"</code><code class="nt">&gt;</code>Categorias<code class="nt">&lt;/a&gt;</code>
<code class="linenos">11 </code>    <code class="nt">&lt;/li&gt;</code>
<code class="linenos">12 </code><code class="nt">&lt;/ul&gt;</code>
</pre></div>

</figure>


<p>Outro ponto que não podemos esquecer é a definição de rota para nossa área de categorias, no arquivo de rotas <b>web.php</b> adicione o trecho abaixo logo após o trecho das rotas de produto:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">resource</code><code class="o">(</code><code class="s1">'categories'</code><code class="o">,</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Http</code><code class="err">\</code><code class="nt">Controllers</code><code class="err">\</code><code class="nt">Admin</code><code class="err">\</code><code class="nt">CategoryController</code><code class="p">::</code><code class="nd">class</code><code class="o">);</code>
</pre></div>

</figure>


<p>Até o momento nossas rotas estão assim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">use</code> <code class="nx">Illuminate\Support\Facades\Route</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>
<code class="linenos"> 6 </code>    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'welcome'</code><code class="p">);</code>
<code class="linenos"> 7 </code><code class="p">});</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="nx">Route</code><code class="o">::</code><code class="na">prefix</code><code class="p">(</code><code class="s1">'admin'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="nx">Route</code><code class="o">::</code><code class="na">resource</code><code class="p">(</code><code class="s1">'products'</code><code class="p">,</code> <code class="nx">\App\Http\Controllers\Admin\ProductController</code><code class="o">::</code><code class="na">class\</code>
<code class="linenos">12 </code><code class="p">);</code>
<code class="linenos">13 </code>    <code class="nx">Route</code><code class="o">::</code><code class="na">resource</code><code class="p">(</code><code class="s1">'categories'</code><code class="p">,</code> <code class="nx">\App\Http\Controllers\Admin\CategoryController</code><code class="o">::</code><code class="na">cl\</code>
<code class="linenos">14 </code><code class="nx">ass</code><code class="p">);</code>
<code class="linenos">15 </code><code class="p">});</code>
</pre></div>

</figure>


<p>Agora que nosso CRUD de categorias está pronto, faça alguns testes e crie algumas categorias para termos insumo no momento da inclusão das categorias para um produto via form.</p>

<h2 id="leanpub-auto-alteraes-em-productcontroller" class="section">Alterações em ProductController</h2>

<p>Abaixo, deixo nosso controller <code>ProductController</code> alterado com os pensamentos feitos no controller de categorias. </p>

<p>Como não criamos ele diretamente como recursos pelo terminal, ele vai está sem alguns comentários como vimos no <code>CategoryController</code> mas isso são detalhes.</p>

<p>Veja ele na íntegra:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Admin</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">Product</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="n">ProductController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">__construct</code><code class="p">(</code><code class="n">private</code> <code class="n">Product</code> <code class="o">$</code><code class="n">product</code><code class="p">)</code> <code class="p">{}</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">14 </code>    <code class="p">{</code>
<code class="linenos">15 </code>        <code class="o">$</code><code class="n">products</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">paginate</code><code class="p">(</code><code class="mi">15</code><code class="p">);</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'products.index'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'products'</code><code class="p">));</code>
<code class="linenos">18 </code>    <code class="p">}</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">create</code><code class="p">()</code>
<code class="linenos">21 </code>    <code class="p">{</code>
<code class="linenos">22 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'products.create'</code><code class="p">);</code>
<code class="linenos">23 </code>    <code class="p">}</code>
<code class="linenos">24 </code>
<code class="linenos">25 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">store</code><code class="p">(</code><code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos">26 </code>    <code class="p">{</code>
<code class="linenos">27 </code>        <code class="o">$</code><code class="n">data</code> <code class="o">=</code> <code class="o">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">();</code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>        <code class="o">$</code><code class="n">price</code> <code class="o">=</code> <code class="p">(</code><code class="nb nb-Type">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="s1">'.'</code><code class="p">,</code> <code class="s1">','</code><code class="p">],</code> <code class="p">[</code><code class="s1">''</code><code class="p">,</code> <code class="s1">'.'</code><code class="p">],</code> <code class="o">$</code><code class="n">data</code><code class="p">[</code><code class="s1">'price'</code><code class="p">]);</code>
<code class="linenos">30 </code>
<code class="linenos">31 </code>        <code class="o">$</code><code class="n">data</code><code class="p">[</code><code class="s1">'in_stock'</code><code class="p">]</code>    <code class="o">=</code> <code class="mi">48</code><code class="p">;</code> <code class="o">//</code><code class="n">está</code> <code class="n">fixo</code> <code class="n">mas</code> <code class="n">vamos</code> <code class="n">adiciona</code><code class="o">-</code><code class="n">lo</code> <code class="n">no</code> <code class="n">formulário</code> <code class="n">a</code>\
<code class="linenos">32 </code><code class="n">inda</code>
<code class="linenos">33 </code>        <code class="o">$</code><code class="n">data</code><code class="p">[</code><code class="s1">'price'</code><code class="p">]</code>       <code class="o">=</code> <code class="o">$</code><code class="n">price</code> <code class="o">*</code> <code class="mi">100</code><code class="p">;</code>
<code class="linenos">34 </code>        <code class="o">$</code><code class="n">data</code><code class="p">[</code><code class="s1">'is_active'</code><code class="p">]</code>      <code class="o">=</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">35 </code>
<code class="linenos">36 </code>        <code class="o">$</code><code class="n">product</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">(</code><code class="o">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos">37 </code>
<code class="linenos">38 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'products.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">39 </code>    <code class="p">}</code>
<code class="linenos">40 </code>
<code class="linenos">41 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">show</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">42 </code>    <code class="p">{</code>
<code class="linenos">43 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'products.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="p">]);</code>
<code class="linenos">44 </code>    <code class="p">}</code>
<code class="linenos">45 </code>
<code class="linenos">46 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">edit</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">47 </code>    <code class="p">{</code>
<code class="linenos">48 </code>        <code class="o">$</code><code class="n">product</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">findOrFail</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">);</code>
<code class="linenos">49 </code>
<code class="linenos">50 </code>        <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code> <code class="o">=</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code> <code class="o">/</code> <code class="mi">100</code><code class="p">;</code>
<code class="linenos">51 </code>
<code class="linenos">52 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'products.edit'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'product'</code><code class="p">));</code>
<code class="linenos">53 </code>    <code class="p">}</code>
<code class="linenos">54 </code>
<code class="linenos">55 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">update</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">,</code> <code class="n">Request</code> <code class="o">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos">56 </code>    <code class="p">{</code>
<code class="linenos">57 </code>        <code class="o">//</code><code class="n">Atualizando</code> <code class="n">com</code> <code class="n">mass</code> <code class="n">assignment</code>
<code class="linenos">58 </code>        <code class="o">$</code><code class="n">data</code> <code class="o">=</code> <code class="o">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">();</code>
<code class="linenos">59 </code>        <code class="o">$</code><code class="n">price</code> <code class="o">=</code> <code class="p">(</code><code class="nb nb-Type">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="s1">'.'</code><code class="p">,</code> <code class="s1">','</code><code class="p">],</code> <code class="p">[</code><code class="s1">''</code><code class="p">,</code> <code class="s1">'.'</code><code class="p">],</code> <code class="o">$</code><code class="n">data</code><code class="p">[</code><code class="s1">'price'</code><code class="p">]);</code>
<code class="linenos">60 </code>        <code class="o">$</code><code class="n">data</code><code class="p">[</code><code class="s1">'price'</code><code class="p">]</code> <code class="o">=</code> <code class="o">$</code><code class="n">price</code> <code class="o">*</code> <code class="mi">100</code><code class="p">;</code>
<code class="linenos">61 </code>
<code class="linenos">62 </code>        <code class="o">$</code><code class="n">product</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">findOrFail</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">);</code>
<code class="linenos">63 </code>        <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">(</code><code class="o">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos">64 </code>
<code class="linenos">65 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'products.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">66 </code>    <code class="p">}</code>
<code class="linenos">67 </code>
<code class="linenos">68 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">destroy</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">69 </code>    <code class="p">{</code>
<code class="linenos">70 </code>        <code class="o">$</code><code class="n">product</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">findOrFail</code><code class="p">(</code><code class="o">$</code><code class="n">product</code><code class="p">);</code>
<code class="linenos">71 </code>        <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">delete</code><code class="p">();</code>
<code class="linenos">72 </code>
<code class="linenos">73 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'products.index'</code><code class="p">);</code>
<code class="linenos">74 </code>    <code class="p">}</code>
<code class="linenos">75 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Não fiz a adição do Route Model Biding aqui no ProductController, caso queira praticar pode se basear no CategoryController para tal.</p>

<p>Aplicada as melhorias no controller <code>ProductController</code>, vamos para à alterações necessárias para inserção da relação muitos para muitos entre Produtos e Categorias.</p>

<h2 id="leanpub-auto-inserindo-muitos-para-muitos-product-x-category" class="section">Inserindo Muitos para Muitos (Product x Category)</h2>

<p>Para inserção de muitos para muitos, nós temos 3 métodos principais, o método <code>attach</code>, o <code>detach</code> e o <code>sync</code> que particularmente gosto de utilizar. Utilizarei aqui o <code>sync</code> mas darei uma rápida amostra do que os 2 outros fazem.</p>

<p>O método <code>attach</code> recebe um array com os ids a serem incluídos na referência, se estivermos salvando do ponto de vista de Product os ids serão de categorias e vice-versa. </p>

<p>Veja o exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">attach</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">]);</code>
</pre></div>

</figure>

<p class="fake-para">Com o attach acima estou adicionando para um produto duas categorias, as de id 1 e 2 respectivamente. Se em uma tela de edição eu quiser remover a categoria 1 deste produto, eu posso utilizar o detach, como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">detach</code><code class="p">([</code><code class="mi">1</code><code class="p">]);</code>
</pre></div>

</figure>


<p>Agora como o <code>sync</code> funciona, ele é bem simples. Basicamente ele irá sincronizar as referências da ligação, por exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">sync</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">]);</code>
</pre></div>

</figure>


<p>Acima o <code>sync</code> irá inserir as duas referências caso elas não existam na ligação, dentro da tabela intermediária. Uma vez salva, se eu utilizar o <code>sync</code> novamente da maneira abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">sync</code><code class="p">([</code><code class="mi">1</code><code class="p">]);</code>
</pre></div>

</figure>


<p>Ele irá remover os ids que não estiverem no array informado a ele, neste caso, a categoria de id 2 será removida da ligação, então, no sync o que vale são os ids informados a ele.</p>

<p>Ainda é possível utilizar o método toggle, que remove os dados ligados que estiverem na ligação e adiciona os que não estiverem. Isso no modelo de liga-desliga de fato. No sync o que prevalece sempre é o que está no array passado ao sync.</p>

<p>Exemplo da chamada do toggle:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">toggle</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">]);</code>
</pre></div>

</figure>


<h2 id="leanpub-auto-alterando-rea-de-produtos-para-insero-nn" class="section">Alterando área de Produtos para Inserção N:N</h2>

<p>Vamos adicionar a possibilidade de adição de categorias em nossa criação e edição de produtos. O primeiro passo é mandarmos para as views de criação e edição nossas categorias.</p>

<p>Veja como ficou os métodos <code>create</code> e <code>edit</code> lá no <code>ProductController</code>:</p>

<p><b>create</b></p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">create</code><code class="p">(</code><code class="n">Category</code> <code class="err">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">$</code><code class="n">categories</code> <code class="o">=</code> <code class="err">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">([</code><code class="s">'id'</code><code class="p">,</code> <code class="s">'name'</code><code class="p">]);</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code>    <code class="kr">return</code> <code class="n">view</code><code class="p">(</code><code class="s">'products.create'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s">'categories'</code><code class="p">));</code>
<code class="linenos">6 </code><code class="p">}</code>
</pre></div>

</figure>


<p><b>edit</b></p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">edit</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="p">,</code> <code class="n">Category</code> <code class="err">$</code><code class="n">category</code><code class="p">)</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">$</code><code class="n">product</code> <code class="o">=</code> <code class="err">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">findOrFail</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="p">);</code>
<code class="linenos">4 </code>    <code class="err">$</code><code class="n">categories</code> <code class="o">=</code> <code class="err">$</code><code class="n">category</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">([</code><code class="s">'id'</code><code class="p">,</code> <code class="s">'name'</code><code class="p">]);</code>
<code class="linenos">5 </code>
<code class="linenos">6 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code> <code class="o">=</code> <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code> <code class="o">/</code> <code class="mi">100</code><code class="p">;</code>
<code class="linenos">7 </code>
<code class="linenos">8 </code>    <code class="kr">return</code> <code class="n">view</code><code class="p">(</code><code class="s">'products.edit'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s">'product'</code><code class="p">,</code> <code class="s">'categories'</code><code class="p">));</code>
<code class="linenos">9 </code><code class="p">}</code>
</pre></div>

</figure>


<blockquote>
  <p>Não esqueça de importar o model Category no ProductController</p>
</blockquote>

<p>Agora mandamos para cada view as categorias existentes em nossa base, neste caso passei um array para o método <code>all</code> que me retornará apenas o id e o nome de cada categoria, que é o que necessitamos pra este momento. A query final para esta busca de categorias seria algo como: <code>select id, name from categories</code>.</p>

<p>Perceba também que injetei o model Category nos métodos <code>create</code>e <code>edit</code>, desta forma o Laravel me entregará uma instância de Category e posso trabalhar minhas queries como eu quiser, como fizemos com o método <code>all</code> por exemplo.</p>

<p>Agora precisamos exibir essas categorias em nossos formulários de criação e edição do Produto. Adicione o trecho abaixo em ambos os formulários:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-4"</code><code class="o">&gt;</code><code class="n">Categorias</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-5 grid grid-cols-3"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>        <code class="p">@</code><code class="n">foreach</code> <code class="p">(</code><code class="n">$categories</code> <code class="n">as</code> <code class="n">$category</code><code class="p">)</code>
<code class="linenos"> 6 </code>            <code class="o">&lt;</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 7 </code>                <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"checkbox"</code> <code class="n">name</code><code class="o">=</code><code class="s">"categories[]"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ $category-&gt;id }\</code>
<code class="linenos"> 8 </code><code class="s">}"</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>                <code class="p">{{</code> <code class="n">$category</code><code class="o">-&gt;</code><code class="n">name</code> <code class="p">}}</code>
<code class="linenos">10 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">11 </code>        <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">12 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">13 </code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>Este trecho exibirá diversas checkboxes com as categorias e seus ids como valores para cada checkbox. </p>

<p>Perceba um detalhe importante, o checkbox nos permite marcarmos quantos itens quisermos, neste caso como preciso mandar um array de ids(das categorias) para sincronizar, usei a notação no nome do campo com colchetes(<code>[]</code>) desta maneira: <code>categories[]</code>. Assim enviaremos na requisição um array com os ids selecionados no campo <code>categories</code>, vindo dos checkboxes.</p>

<p>Uma vez feita esta alteração, vamos adicionar a possibilidade de save da relação, adicionando assim as categorias do produto. Para isto, basta adicionarmos logo após a linha de criação e atualização dentro dos seus métodos (<code>strore</code>, <code>update</code>), a chamada do sync como vemos abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">sync</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'categories'</code><code class="p">]);</code>
</pre></div>

</figure>


<p>Veja o método store e o update (<code>ProductController</code>) na íntegra, pós alteração:</p>

<p><b>store</b></p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="kr">function</code> <code class="kr">store</code><code class="p">(</code><code class="n">Request</code> <code class="err">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$</code><code class="kt">data</code> <code class="o">=</code> <code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">();</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="err">$</code><code class="n">price</code> <code class="o">=</code> <code class="p">(</code><code class="n">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="s">'.'</code><code class="p">,</code> <code class="s">','</code><code class="p">],</code> <code class="p">[</code><code class="s">''</code><code class="p">,</code> <code class="s">'.'</code><code class="p">],</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'price'</code><code class="p">]);</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'in_stock'</code><code class="p">]</code>    <code class="o">=</code> <code class="mi">48</code><code class="p">;</code> <code class="c1">//está fixo mas vamos adiciona-lo no formulário ainda</code>
<code class="linenos"> 8 </code>    <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'price'</code><code class="p">]</code>       <code class="o">=</code> <code class="err">$</code><code class="n">price</code> <code class="o">*</code> <code class="mi">100</code><code class="p">;</code>
<code class="linenos"> 9 </code>    <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'is_active'</code><code class="p">]</code>      <code class="o">=</code> <code class="kr">true</code><code class="p">;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="err">$</code><code class="n">product</code> <code class="o">=</code> <code class="err">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">sync</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'categories'</code><code class="p">]);</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>    <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'products.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s">'product'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">16 </code><code class="p">}</code>
</pre></div>

</figure>


<p><b>update</b></p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="k">function</code> <code class="n">update</code><code class="p">(</code><code class="n">$product</code><code class="p">,</code> <code class="n">Request</code> <code class="n">$request</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="c1">//Atualizando com mass assignment</code>
<code class="linenos"> 4 </code>    <code class="n">$data</code> <code class="o">=</code> <code class="n">$request</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">();</code>
<code class="linenos"> 5 </code>    <code class="n">$price</code> <code class="o">=</code> <code class="p">(</code><code class="n">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="sc">'.'</code><code class="p">,</code> <code class="sc">','</code><code class="p">],</code> <code class="p">['',</code> <code class="sc">'.'</code><code class="p">],</code> <code class="n">$data</code><code class="p">['</code><code class="n">price</code><code class="p">']);</code>
<code class="linenos"> 6 </code>    <code class="n">$data</code><code class="p">['</code><code class="n">price</code><code class="p">']</code> <code class="o">=</code> <code class="n">$price</code> <code class="o">*</code> <code class="mh">100</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code>    <code class="n">$product</code> <code class="o">=</code> <code class="n">$this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">findOrFail</code><code class="p">(</code><code class="n">$product</code><code class="p">);</code>
<code class="linenos"> 9 </code>    <code class="n">$product</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">(</code><code class="n">$data</code><code class="p">);</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="n">$product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">sync</code><code class="p">(</code><code class="n">$data</code><code class="p">['</code><code class="n">categories</code><code class="p">']);</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">('</code><code class="n">products</code><code class="p">.</code><code class="n">edit</code><code class="p">',</code> <code class="p">['</code><code class="n">product</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">14 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Desta forma já adicionamos a possibilidade de inserção e edição das categorias para o produto. </p>

<p>Agora precisamos selecionar as categorias do produto na edição, para sabermos quais as categorias deste produto quando entrarmos na tela de edição.</p>

<p>Como temos uma relação de muitos para muitos, se acessarmos por exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">;</code>
</pre></div>

</figure>


<p>Teremos uma <code>Collection</code>, como vimos anteriormente, com as categorias existentes para o produto buscado. Essa Collection nos permite, dentre outras coisas, verificar se determinado Objeto existe dentro da coleção, por meio do método <code>contains</code>. </p>

<p>O que precisamos é marcar com <code>checked</code> cada input que bater com a categoria existente na relação, dentro do loop de categorias teremos cada categoria em questão, o que precisamos fazer é passar para o método <code>contains</code> cada linha do loop, para que o Laravel verifique se aquela categoria  existe na relação do produto, que está aberto na tela de edição!</p>

<p>Vamos a alteração para entedermos melhor. Na view de edição (<code>edit.blade.php</code>) de produto: o que está asssim, dentro do loop de categorias:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;div&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"categories[]"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="err">$</code><code class="nv">category-</code><code class="o">&gt;</code><code class="nv">id</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">3 </code><code class="cp">{{</code> <code class="err">$</code><code class="nv">category-</code><code class="o">&gt;</code><code class="nv">name</code> <code class="cp">}}</code>
<code class="linenos">4 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>Ficará assim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">&lt;div&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"categories[]"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="err">$</code><code class="nv">category-</code><code class="o">&gt;</code><code class="nv">id</code> <code class="cp">}}</code><code class="s">"</code> <code class="err">@checked(\</code>
<code class="linenos">3 </code><code class="err">$product-</code><code class="nt">&gt;</code>categories-&gt;contains($category))&gt;
<code class="linenos">4 </code>
<code class="linenos">5 </code>    <code class="cp">{{</code> <code class="err">$</code><code class="nv">category-</code><code class="o">&gt;</code><code class="nv">name</code> <code class="cp">}}</code>
<code class="linenos">6 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>Perceba que no input checkbos usei uma diretiva do Laravel, a <code>@checked</code>, que me permite facilmente habilitar ou não o check para o inpit em questão e isso baseado no valor passado como parâmetro pro <code>@checked</code> que deve ser um teste booleano.</p>

<p>Como estamos fazendo o laço nas categorias, em cada linha teremos o objeto Category populado com a categoria em questão. Com isso podemos verificar se na relação, do Produto editado, existe aquele objeto disponível na relação usando o método <code>contains</code>. </p>

<p>Veja melhor a linha:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="w"> </code><code class="nv">@checked</code><code class="p">(</code><code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="o">-&gt;</code><code class="k">contains</code><code class="p">(</code><code class="err">$</code><code class="n">category</code><code class="p">))</code><code class="w"></code>
</pre></div>

</figure>


<p>Se a categoria existir na ligação com o Produto, o <code>contains</code> retornará verdadeiro, dando o check no nosso input. Selecione uma categoria e atualize seu produto, verifique que agora a(s) categoria(s) pertencentes ao produto estará ou estarão checkada(s).</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----cat-check.png">
    <figcaption></figcaption>
  </figure>
</div>


<blockquote>
  <p>Na tela de inserção só precisamos selecionar as categorias que desejarmos que elas já serão salvas pelo <code>sync</code> e isso já fizemos. Faça seus testes!</p>
</blockquote>

<p>Com isso chegamos ao ponto final proposto aqui para este capítulo.</p>

<h2 id="leanpub-auto-concluses-7" class="section">Conclusões</h2>

<p>O conteúdo abordado aqui foi bem denso e nos custou bastante alteração, entretanto, agora temos um projeto bem mais robusto e mais organizado do ponto de vista de execuções, relação e organização que ainda pode melhorar mais!</p>

<p>No próximo capítulo vamos conhecer a parte que compete a autenticação e como podemos privar o acesso aos nossos CRUDs a apenas usuários autenticados.</p>

<p>Até lá!</p>


<h1 id="leanpub-auto-autenticao" class="chapter">Autenticação</h1>

<p>Neste capítulo vamos criar a autenticação para acesso ao painel administrativo. O mais interessante é que o Laravel já vêm com praticamente tudo pronto para criarmos esta autenticação de forma rápida e produtiva quer seja codificando quer seja usando paineis chamados de Starter Kits.</p>

<p>Na versão 12 o Laravel simplificou a quantidade de Starter Kits disponíveis deixando apenas um de forma visual mas com 3 opções de escolha com comentei lá no ínicio. O escopo deste livro não abordará esse Starter Kit com algum stack pois requer conhecimentos que não iremos abordar aqui neste volume, então criaremos nossa autenticação mas usando tudo que o Laravel têm que serve de automação para este fim, autenticar usuários.</p>

<h2 id="leanpub-auto-logando-usurios" class="section">Logando usuários</h2>

<p>O Laravel já têm todo o aparato para criarmos ou, melhor, habilitarmos a parte de auth no projeto. Internamente o framework possui o conceito de Guards. Guards servem para gerenciar a parte de autenticação de forma guiada a driver, onde poderemos ter guards para o gerenciamento de autenticação em APIs, na área Web e se necessitarmos de algo customizados podemos criar nosso próprio Guard customizado.</p>

<p>O framework também já traz toda a parte de autenticação configurada para o model user e os arquivos referentes a parte de configurações ligadas a autenticação se encontram em <code>config/auth.php</code>. Neste arquivo encontramos o drive Guard padrão, que seria o web, e onde o Laravel busca sua fonte de dados para validar o usuário que está tentando autenticar!</p>

<p>Com essas ponderações vamos falar alguns detalhes sobre sessions no Laravel para iniciarmos nossa autenticação.</p>

<blockquote>
  <p>Imagino que session não seja problema para você, uma vez que Session aprendemos lá no ínicio com PHP.</p>
</blockquote>

<h2 id="leanpub-auto-sessions-no-laravel" class="section">Sessions no Laravel</h2>

<p>Trabalhar com sessions no Laravel é algo bem bem tranquilo e para isso temos um helper que nos auxilia, o helper: <code>session</code>.</p>

<p>O helper session nos auxilia a salvar, resgatar e atualizar os dados de sessão e possui alguns métodos para isso.</p>

<p>Por padrão o drive de armazenamento de sessão é o database. Os dados de sessão são armazenado na tabela sessions.</p>

<p>O Laravel suporta diversos drivers para sessão, abaixo listo alguns deles:</p>

<ul>
  <li>File: armazenados em arquivo na pasta <code>storage/framework/sessions</code>;</li>
  <li>Cookie: armazenados em cookies seguros e encriptados;</li>
  <li>Array: armazenados em arquivos PHP como arrays e não são persistidos;</li>
  <li>Memcached/Redis: Podemos armazenar em um destes para acesso rápido.</li>
</ul>

<p>Existem outros suportes mas aqui listei os principais. Vamos as manipulações.</p>

<h3 id="leanpub-auto-salvando-dado-na-sesso" class="subsection">Salvando dado na sessão</h3>

<p>Podemos colocar dados na sessão de duas formas. Primeira:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>session(['key' =&gt; 'value']);
</pre></div>

</figure>


<p>ou podemos chamar o helper session sem parâmetros, com isso teremos uma instância de <code>Illuminate\Session\SessionManager</code> e com isso podemos chamar o método de gerenciamento desejado:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">put</code><code class="p">(</code><code class="s">'key'</code><code class="p">,</code> <code class="s">'value'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Podemos ainda armazenar arrays na sessão e lidar com a notação de <code>.</code> para salvar dados para chaves específicas. Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">put</code><code class="p">(</code><code class="s">'user'</code><code class="p">,</code> <code class="p">[</code><code class="s">'name'</code> <code class="o">=&gt;</code> <code class="s">'Teste'</code><code class="p">]);</code>
</pre></div>

</figure>


<p>Posso adicionar uma nova chave ao user da sessão:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="k">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">push</code><code class="p">(</code><code class="s1">'user.email'</code><code class="p">,</code><code class="w"> </code><code class="s1">'email@email.com'</code><code class="p">);</code><code class="w"></code>
</pre></div>

</figure>


<p>Acima estamos adicionando para o array de user na sessão a chave email e o email deste usuário.</p>

<h3 id="leanpub-auto-recuperando-valores-da-sesso" class="subsection">Recuperando valores da sessão</h3>

<p>Para recuperar valores da sessão podemos informar a chave diretamente no helper <code>session</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>session('user');
</pre></div>

</figure>


<p>ou podemos chamar o método <code>get</code> a partir da instância de <code>SessionManager</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">get</code><code class="p">(</code><code class="s">'user'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Podemos ainda recuperar o valor da sessão e já remover ele na mesma chamada, com o <code>pull</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="nf">pull</code><code class="p">(</code><code class="s">'user'</code><code class="p">,</code> <code class="s">'posso_passar_um_valor_default_de_retorno_aqui_caso_a_chave_\</code>
<code class="linenos">2 </code><code class="s">nao_exista'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Se você estiver trabalhando com contadores na sessão o session também possui métodos de incremento e decremento:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">increment</code><code class="p">(</code><code class="s">'contador);</code>
</pre></div>

</figure>



<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">decrement</code><code class="p">(</code><code class="s">'contador);</code>
</pre></div>

</figure>


<p>Esses dois métodos possuem um segundo parâmetro caso seu incremento e decremento precisem ser modificados em <code>&gt;=2</code>.</p>

<h3 id="leanpub-auto-removendo-coisas-da-sesso" class="subsection">Removendo coisas da sessão</h3>

<p>Removendo uma chave específica da sessão:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">forget</code><code class="p">(</code><code class="s">'key'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Ou uma lista de chaves:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">forget</code><code class="p">([</code><code class="s">'key1'</code><code class="p">,</code> <code class="s">'key2'</code><code class="p">]);</code>
</pre></div>

</figure>


<p>Ou ainda, podemos limpar toda a sessão:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">flush</code><code class="p">();</code>
</pre></div>

</figure>


<h3 id="leanpub-auto-mais-da-session" class="subsection">Mais da session</h3>

<p>Podemos regerar o ID da sessão também, para evitar problemas como <code>session fixation</code>. Para isso você pode usar como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">regenerate</code><code class="p">();</code>
</pre></div>

</figure>


<p>E podemos ainda regerar o ID da sessão removendo todos os dados com o:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">invalidate</code><code class="p">();</code>
</pre></div>

</figure>


<h3 id="leanpub-auto-session-flash" class="subsection">Session flash</h3>

<p>Existe uma possibilidade nas sessões do Laravel no qual podemos armazenar dados que serão removidos assim que forem lidos. Esse mecanismo via session é o que chamamos de flash e serve perfeitamente para, dentre outras coisas, armazenamos mensagens de execução entre uma URL e outra como forma de avisar o usuário do processo que ele está fazendo.</p>

<p>Para isso podemos usar da forma abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">flash</code><code class="p">(</code><code class="s">'success'</code><code class="p">,</code> <code class="s">'Produto Criado com Sucesso!'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Desta forma poderíamos utilizar para enviar mensagens de feedback, e faremos isso em breve!</p>

<blockquote>
  <p>Podemos acessar o session a partir da instância do Request, exemplo: <code>$request-&gt;session()...</code>. Caso precise utilizar a sessão a partir da Requisição atual.</p>
</blockquote>

<h2 id="leanpub-auto-criando-nosso-login" class="section">Criando nosso login</h2>

<p>Vamos começar gerando nosso controller para a autenticação, para isso execute o comando de geração abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller Auth/LoginController
</pre></div>

</figure>


<p>Adicione o método login neste controller. Segue abaixo e logo depois vamos as explicações:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="k">function</code> <code class="n">login</code><code class="p">(</code><code class="n">Request</code> <code class="n">$request</code><code class="p">)</code><code class="o">:</code> <code class="n">RedirectResponse</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="n">$credentials</code> <code class="o">=</code> <code class="n">$request</code><code class="o">-&gt;</code><code class="n">only</code><code class="p">('</code><code class="n">email</code><code class="p">',</code> <code class="p">'</code><code class="n">password</code><code class="p">');</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="n">Auth</code><code class="o">::</code><code class="n">attempt</code><code class="p">(</code><code class="n">$credentials</code><code class="p">,</code> <code class="p">(</code><code class="n">bool</code><code class="p">)</code> <code class="n">$request</code><code class="o">-&gt;</code><code class="n">rememberme</code><code class="p">))</code> <code class="p">{</code>
<code class="linenos"> 6 </code>        <code class="n">abort</code><code class="p">(</code><code class="mh">401</code><code class="p">);</code>
<code class="linenos"> 7 </code>    <code class="p">}</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="n">$request</code><code class="o">-&gt;</code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">regenerate</code><code class="p">();</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">intended</code><code class="p">(</code><code class="n">route</code><code class="p">('</code><code class="n">products</code><code class="p">.</code><code class="n">index</code><code class="p">',</code> <code class="nl">absolute:</code> <code class="n">false</code><code class="p">));</code>
<code class="linenos">12 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Em primeiro pegamos da requisição apenas o email e senha do usuário, algo que já conhecemos mas aqui como o método only pego apenas os campos que quero. Desta forma teremos na variável credentials o array como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">[</code><code class="n"></code>
<code class="linenos">2 </code><code class="n">    'email' =&gt; 'email@usuario.com',</code>
<code class="linenos">3 </code><code class="n">    'password' =&gt; 'XYZ'</code>
<code class="linenos">4 </code><code class="o">]</code><code class="w"></code>
</pre></div>

</figure>


<p>Por meio da facade <code>Auth</code> chamo o método <code>attempt</code> que tentará fazer o login do usuário, login esse que será satisfeito se as credenciais estiverem corretas. O <code>attempt</code> ainda aceita um segundo parâmetro, parâmetro booleano que indica o famoso <b>Lembrar de mim</b>, que também vamos adicionar no formulário de login mais abaixo.</p>

<p>No if checkamos o retorno do attempt, se verdadeiro passamos adiante mas caso falso(o usuário errou a sua senha ou email) abortamos a aplicação com o status code 401 (não autenticado).</p>

<blockquote>
  <p>Em breve faremos um redirect aí voltando para a tela de login com a mensagem de validação. Faremos essas melhorias nos capítulos posteriores.</p>
</blockquote>

<p>As credenciais estando corretas nós regeramos o ID da sessão e redirecionamos o usuário para a URL que ele estava anteriormente, se ele veio de um REFER anterior claro, caso não tenha vindo o redirecionamento será para a listagem de Produtos no Admin.</p>

<p>Abaixo segue na íntegra nossa view de login, criei essa view no caminho abaixo dentro da pasta de views:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>auth/login.blade.php
</pre></div>

</figure>


<p>Segue o código:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="linenos"> 2 </code><code class="p">&lt;</code><code class="nt">html</code> <code class="na">lang</code><code class="o">=</code><code class="s">"en"</code><code class="p">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code><code class="p">&lt;</code><code class="nt">head</code><code class="p">&gt;</code>
<code class="linenos"> 5 </code>    <code class="p">&lt;</code><code class="nt">meta</code> <code class="na">charset</code><code class="o">=</code><code class="s">"UTF-8"</code><code class="p">&gt;</code>
<code class="linenos"> 6 </code>    <code class="p">&lt;</code><code class="nt">meta</code> <code class="na">name</code><code class="o">=</code><code class="s">"viewport"</code> <code class="na">content</code><code class="o">=</code><code class="s">"width=device-width, initial-scale=1.0"</code><code class="p">&gt;</code>
<code class="linenos"> 7 </code>    <code class="p">&lt;</code><code class="nt">meta</code> <code class="na">http-equiv</code><code class="o">=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content</code><code class="o">=</code><code class="s">"ie=edge"</code><code class="p">&gt;</code>
<code class="linenos"> 8 </code>    <code class="p">&lt;</code><code class="nt">title</code><code class="p">&gt;</code>Logar - Painel Administrativo<code class="p">&lt;/</code><code class="nt">title</code><code class="p">&gt;</code>
<code class="linenos"> 9 </code>    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://cdn.tailwindcss.com"</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
<code class="linenos">10 </code><code class="p">&lt;/</code><code class="nt">head</code><code class="p">&gt;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code><code class="p">&lt;</code><code class="nt">body</code> <code class="na">class</code><code class="o">=</code><code class="s">"bg-fixed bg-gradient-to-b from-10% to-80% from-purple-800 to-black"</code><code class="p">&gt;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code>    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"w-full h-full absolute flex justify-center items-center"</code><code class="p">&gt;</code>
<code class="linenos">15 </code>
<code class="linenos">16 </code>        <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"w-[390px] p-5 rounded bg-black shadow shadow-purple-600"</code><code class="p">&gt;</code>
<code class="linenos">17 </code>            <code class="p">&lt;</code><code class="nt">h2</code> <code class="na">class</code><code class="o">=</code><code class="s">"w-full text-center mb-4 text-2xl font-extrabold text-white"</code><code class="p">&gt;</code>E\
<code class="linenos">18 </code>xperts Store
<code class="linenos">19 </code>            <code class="p">&lt;/</code><code class="nt">h2</code><code class="p">&gt;</code>
<code class="linenos">20 </code>            <code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'login'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code> <code class="na">method</code><code class="o">=</code><code class="s">"post"</code><code class="p">&gt;</code>
<code class="linenos">21 </code>                @csrf
<code class="linenos">22 </code>                <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="p">&gt;</code>
<code class="linenos">23 </code>                    <code class="p">&lt;</code><code class="nt">label</code> <code class="na">for</code><code class="o">=</code><code class="s">"email"</code> <code class="na">class</code><code class="o">=</code><code class="s">"text-white mb-2"</code><code class="p">&gt;</code>E-mail<code class="p">&lt;/</code><code class="nt">label</code><code class="p">&gt;</code>
<code class="linenos">24 </code>                    <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"email"</code> <code class="na">name</code><code class="o">=</code><code class="s">"email"</code> <code class="na">id</code><code class="o">=</code><code class="s">"email"</code> <code class="na">placeholder</code><code class="o">=</code><code class="s">"Seu e-m\</code>
<code class="linenos">25 </code><code class="s">ail..."</code> <code class="na">required</code>
<code class="linenos">26 </code>                        <code class="na">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-gray-900"</code><code class="p">&gt;</code>
<code class="linenos">27 </code>                <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>                <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="p">&gt;</code>
<code class="linenos">30 </code>                    <code class="p">&lt;</code><code class="nt">label</code> <code class="na">for</code><code class="o">=</code><code class="s">"password"</code> <code class="na">class</code><code class="o">=</code><code class="s">"text-white mb-2"</code><code class="p">&gt;</code>Senha<code class="p">&lt;/</code><code class="nt">label</code><code class="p">&gt;</code>
<code class="linenos">31 </code>                    <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"password"</code> <code class="na">name</code><code class="o">=</code><code class="s">"password"</code> <code class="na">id</code><code class="o">=</code><code class="s">"password"</code> <code class="na">placeholder</code><code class="err">\</code>
<code class="linenos">32 </code><code class="err">="</code><code class="na">Sua</code> <code class="na">senha</code><code class="err">..."</code>
<code class="linenos">33 </code>                        <code class="na">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-gray-900"</code><code class="p">&gt;</code>
<code class="linenos">34 </code>                <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
<code class="linenos">35 </code>
<code class="linenos">36 </code>                <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"w-full mb-6 flex gap-x-4"</code><code class="p">&gt;</code>
<code class="linenos">37 </code>                    <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"checkbox"</code> <code class="na">name</code><code class="o">=</code><code class="s">"rememberme"</code> <code class="na">id</code><code class="o">=</code><code class="s">"rememberme"</code> <code class="na">class</code><code class="o">=</code><code class="s">"\</code>
<code class="linenos">38 </code><code class="s">p-2 rounded border border-gray-900"</code><code class="p">&gt;</code>
<code class="linenos">39 </code>                    <code class="p">&lt;</code><code class="nt">label</code> <code class="na">for</code><code class="o">=</code><code class="s">"rememberme"</code> <code class="na">class</code><code class="o">=</code><code class="s">"text-white"</code><code class="p">&gt;</code>Lembrar de mim<code class="p">&lt;/</code><code class="nt">label</code><code class="p">&gt;</code>
<code class="linenos">40 </code>                <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
<code class="linenos">41 </code>
<code class="linenos">42 </code>                <code class="p">&lt;</code><code class="nt">button</code>
<code class="linenos">43 </code>                    <code class="na">class</code><code class="o">=</code><code class="s">"py-2 px-4 text-thin text-xl rounded border border-purple-\</code>
<code class="linenos">44 </code><code class="s">900 bg-black text-purple-900 hover:bg-purple-900 hover:text-white transition ease-in\</code>
<code class="linenos">45 </code><code class="s">-out duration-300"</code><code class="p">&gt;</code>Acessar<code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code>
<code class="linenos">46 </code>            <code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code>
<code class="linenos">47 </code>
<code class="linenos">48 </code>        <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
<code class="linenos">49 </code>    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>
<code class="linenos">50 </code><code class="p">&lt;/</code><code class="nt">body</code><code class="p">&gt;</code>
<code class="linenos">51 </code>
<code class="linenos">52 </code><code class="p">&lt;/</code><code class="nt">html</code><code class="p">&gt;</code>
</pre></div>

</figure>


<p>Essa tela de login não estende de nenhum template então nela já contêm tudo que precisamos tanto os inputs como o apontar para o processamento desta tela e também seus estilos.</p>

<blockquote>
  <p>Sobre estilos até o momento, meu intuito não é abordar o TailwindCSS aqui mas em breve vamos ambientar ele no projeto na camada de assets frontend e lá explico os principais detalhes que o permeiam. Por hora veja os códigos e tente ir se familiarizando com as classes, inclusive se você já entende bem de CSS as classes são mais fáceis de entender.</p>
</blockquote>

<p>Abaixo segue as duas rotas, tanto para view de login como para o processamento lá no controller AuthController:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">view</code><code class="o">(</code><code class="s1">'login'</code><code class="o">,</code> <code class="s1">'auth.login'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'login.view'</code><code class="o">);</code>
<code class="linenos">2 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">post</code><code class="o">(</code><code class="s1">'login'</code><code class="o">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nb">Auth</code><code class="o">\</code><code class="nx">LoginController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'login'</code><code class="cp">]</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="err">\</code>
<code class="linenos">3 </code><code class="nt">name</code><code class="o">(</code><code class="s1">'login'</code><code class="o">);</code>
</pre></div>

</figure>


<p>Usei o route view para exibir a tela de login e a definição pro post vindo do formulário irá pro nosso método login do AuthController. Coloque estas rotas antes ou depois do grupo do Admin, eu coloquei antes.</p>

<p>Para título de situação, nosso arquivo de rotas está assim até o momento:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">use</code> <code class="nx">Illuminate\Support\Facades\Route</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>
<code class="linenos"> 6 </code>    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'welcome'</code><code class="p">);</code>
<code class="linenos"> 7 </code><code class="p">});</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="nx">Route</code><code class="o">::</code><code class="na">view</code><code class="p">(</code><code class="s1">'login'</code><code class="p">,</code> <code class="s1">'auth.login'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">(</code><code class="s1">'login.view'</code><code class="p">);</code>
<code class="linenos">10 </code><code class="nx">Route</code><code class="o">::</code><code class="na">post</code><code class="p">(</code><code class="s1">'login'</code><code class="p">,</code> <code class="p">[</code><code class="nx">\App\Http\Controllers\Auth\LoginController</code><code class="o">::</code><code class="na">class</code><code class="p">,</code> <code class="s1">'login'</code><code class="p">])</code><code class="o">-&gt;</code><code class="na">\</code>
<code class="linenos">11 </code><code class="nx">name</code><code class="p">(</code><code class="s1">'login'</code><code class="p">);</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code><code class="nx">Route</code><code class="o">::</code><code class="na">prefix</code><code class="p">(</code><code class="s1">'admin'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>    <code class="nx">Route</code><code class="o">::</code><code class="na">resource</code><code class="p">(</code><code class="s1">'products'</code><code class="p">,</code> <code class="nx">\App\Http\Controllers\Admin\ProductController</code><code class="o">::</code><code class="na">class\</code>
<code class="linenos">16 </code><code class="p">);</code>
<code class="linenos">17 </code>    <code class="nx">Route</code><code class="o">::</code><code class="na">resource</code><code class="p">(</code><code class="s1">'categories'</code><code class="p">,</code> <code class="nx">\App\Http\Controllers\Admin\CategoryController</code><code class="o">::</code><code class="na">cl\</code>
<code class="linenos">18 </code><code class="nx">ass</code><code class="p">);</code>
<code class="linenos">19 </code><code class="p">});</code>
</pre></div>

</figure>


<h2 id="leanpub-auto-vamos-ao-logout" class="section">Vamos ao logout</h2>

<p>Abaixo está nosso método <code>logout</code> para colocarmos no AuthController:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">public</code> <code class="k">function</code> <code class="n">logout</code><code class="p">(</code><code class="n">Request</code> <code class="n">$request</code><code class="p">)</code><code class="o">:</code> <code class="n">RedirectResponse</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="n">Auth</code><code class="o">::</code><code class="n">guard</code><code class="p">('</code><code class="n">web</code><code class="p">')</code><code class="o">-&gt;</code><code class="n">logout</code><code class="p">();</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code>    <code class="n">$request</code><code class="o">-&gt;</code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">invalidate</code><code class="p">();</code>
<code class="linenos">6 </code>    <code class="n">$request</code><code class="o">-&gt;</code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">regenerateToken</code><code class="p">();</code>
<code class="linenos">7 </code>
<code class="linenos">8 </code>    <code class="k">return</code> <code class="n">redirect</code><code class="p">('</code><code class="o">/</code><code class="n">login</code><code class="p">');</code>
<code class="linenos">9 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba que uso o guard web para deslogar o usuário ativo nesse guard apenas, depois invlidamos nossa sessão e regeramos o token CSRF. Por fim mando o usuário de volta pra tela de login.</p>

<p>Processo bem simples, direto e usando os recursos do próprio Laravel.</p>

<p>Vamos criar nossa rota pro logout e linkar em nosso painel o link desse logout.</p>

<p>Rota, coloquei depois das rotas do login:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">post</code><code class="o">(</code><code class="s1">'logout'</code><code class="o">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nb">Auth</code><code class="o">\</code><code class="nx">LoginController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'logout'</code><code class="cp">]</code><code class="o">)</code><code class="err">\</code>
<code class="linenos">2 </code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'logout'</code><code class="o">);</code>
</pre></div>

</figure>

<p class="fake-para">Abaixo adicione mais um link no nav do app.blade.php:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'logout'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"post"</code> <code class="na">id=</code><code class="s">"logout"</code><code class="nt">&gt;</code>@csrf<code class="nt">&lt;/form&gt;</code>
<code class="linenos">3 </code>
<code class="linenos">4 </code>    <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"#"</code>
<code class="linenos">5 </code>        <code class="na">class=</code><code class="s">"px-6 py-4 bg-red-800 hover:bg-red-950 text-white transition ease-in-o\</code>
<code class="linenos">6 </code><code class="s">ut duration-300"</code>
<code class="linenos">7 </code>        <code class="na">onclick=</code><code class="s">"event.preventDefault(); document.querySelector('form#logout').submi\</code>
<code class="linenos">8 </code><code class="s">t()"</code><code class="nt">&gt;</code>Sair<code class="nt">&lt;/a&gt;</code>
<code class="linenos">9 </code><code class="nt">&lt;/li&gt;</code>
</pre></div>

</figure>


<p>Aqui fiz uma pequena manipulação de Javascript para submeter nosso form e deslogar o usuário. Mantemos o form e o envio do logout via POST para termos o controle CSRF em nossa requisição.</p>

<p>Defini o form dentro da <code>li</code> que contêm a ação pra rota logout e o envio via POST, dentro do controle apenas seto nossa diretiva <code>@csrf</code> que já conhecemos. O link do menu será o gatilho deste form, por isso defino o atributo <code>onclick</code>, que ao clicarmos no link ignoramos o comportamento deste elemento com <code>event.preventDefault()</code>.</p>

<p>Ainda no <code>onclick</code>, após ignorar o comportamento padrão do link, eu busco pelo form de id <code>logout</code> e eu mesmo submeto ele, enviando assim nossa requisição post e mandando o controle <code>CSRF</code> junto.</p>

<p>Desta forma teremos nossa autenticação funcionando corretamente, tanto login como logout agora e devidamente linkados.</p>

<h3 id="leanpub-auto-limitado-acesso-ao-panel-a-usurios-autenticados" class="subsection">Limitado acesso ao paínel a usuários autenticados</h3>

<p>Vamos agora colocar o controle de acesso ao paínel apenas a usuários autenticados, para isso vamos difinir o middleware auth em nosso grupo do <code>Admin</code> mas antes o que seria esse tal de middleware?</p>

<p>Middlewares em aplicações web são pedaços de lógicas que são colocadas entre a requisição do usuário e a execução propriamente dita da nossa rota. O Laravel possui diversos middlewares padrão, por exemplo o próprio middleware de check do usuário autenticado.</p>

<p>Podemos criar nossos próprios middlewares e mais a frente aqui na jornada vamos fazer isso mas por hora adicione o método middleware, como abaixo, em seu grupo do admin:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">-&gt;</code><code class="n">middleware</code><code class="p">(</code><code class="s">'auth'</code><code class="p">)</code>
</pre></div>

</figure>


<p>Ficando assim, o trecho do grupo admin no arquivo web.php da pasta routes:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'admin'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">middleware</code><code class="o">(</code><code class="s1">'auth'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code> <code class="o">()</code> <code class="p">{</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">resource</code><code class="p">(</code><code class="s1">'products'</code><code class="p">,</code> <code class="err">\</code><code class="n">App</code><code class="err">\</code><code class="n">Http</code><code class="err">\</code><code class="n">Controllers</code><code class="err">\</code><code class="n">Admin</code><code class="err">\</code><code class="n">ProductController</code><code class="err">::</code><code class="n">class</code><code class="err">\</code>
<code class="linenos">4 </code><code class="p">);</code>
<code class="linenos">5 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">resource</code><code class="p">(</code><code class="s1">'categories'</code><code class="p">,</code> <code class="err">\</code><code class="n">App</code><code class="err">\</code><code class="n">Http</code><code class="err">\</code><code class="n">Controllers</code><code class="err">\</code><code class="n">Admin</code><code class="err">\</code><code class="n">CategoryController</code><code class="err">::</code><code class="n">cl</code><code class="err">\</code>
<code class="linenos">6 </code><code class="n">ass</code><code class="p">);</code>
<code class="linenos">7 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Desta forma tudo que estiver dentro do grupo será protegido e apenas poderá ser acessado por usuários logados/autenticados.</p>

<p>Teste seu acesso, a esta altura devemos ter pelo menos um usuário na base. Procure o email deste usuário e combine com a senha padrão gerada que é <code>password</code>.</p>

<p>Antes de tentar logar você pode tentar acessar sua rota de admin/products e verá que você será redirecionado para a tela de login. Teste e veja tudo funcionando corretamente!</p>

<p>Antes de vermos como acessar as info do usuário logado, nossa tela de login ficou desta forma:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tela-login.png">
    <figcaption></figcaption>
  </figure>
</div>


<h3 id="leanpub-auto-acessando-dados-do-usurio-autenticado" class="subsection">Acessando dados do usuário autenticado</h3>

<p>Podemos acessar tanto nos controllers como nas views nosso usuário autenticado por meio do helper <code>auth()</code>, o método <code>user</code> vindo deste helper nos traz as informações do usuário atualmente autenticado.</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">auth</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">user</code><code class="p">();</code>
</pre></div>

</figure>


<p>Podemos utilizar em nossos controller essas informações através da request também. Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">user</code><code class="p">();</code>
</pre></div>

</figure>


<p>Caso precise pegar apenas o id do usuário pode utilizar o método <code>id()</code> diretamente:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">auth</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">();</code>
</pre></div>

</figure>


<p>Vamos exibir em nosso paínel o nome do nosso usuário autenticado, adicione a <code>li</code> abaixo na sua ul do nav no arquivo <code>app.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">" font-thin ml-4 text-white"</code><code class="nt">&gt;</code>Olá, <code class="cp">{{</code> <code class="nv">auth</code><code class="o">()-&gt;</code><code class="nv">user</code><code class="o">()-&gt;</code><code class="nv">name</code> <code class="cp">}}</code><code class="nt">&lt;/span&gt;</code>
<code class="linenos">3 </code><code class="nt">&lt;/li&gt;</code>
</pre></div>

</figure>


<p>Se quiser exibir apenas o primeiro nome, pode fazer como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">" font-thin ml-4 text-white"</code><code class="nt">&gt;</code>Olá, {{ str(auth()-&gt;user()-&gt;name)-&gt;expl\
<code class="linenos">3 </code>ode(' ')[0] }}<code class="nt">&lt;/span&gt;</code>
<code class="linenos">4 </code><code class="nt">&lt;/li&gt;</code>
</pre></div>

</figure>


<p>Usamos o helper <code>str()</code> para manipular o nome do nosso usuário autenticado, fazemos o explode nos espaços e pegamos a primeira casa do array dos nomes, no qual será o primeiro nome do usuário.</p>

<h2 id="leanpub-auto-concluses-8" class="section">Conclusões</h2>

<p>Neste capítulo conhecemos a parte de autenticação no Laravel e de fato percebemos que com poucos esforços conseguimos criar toda a estrutura de autenticação e controle para nosso painel administrativo.</p>

<p>Claro que quanto mais você avançar no Laravel perceberá que este processo será mais simplificado ainda pois o Laravel dispões de Starter Kit + Stack (Livewire, React ou Vue) para facilitar justamente este processo onde já na inicialização de um novo projeto você já pode trazer o painel com autenticação com poucos esforços.</p>

<p>As opções de stack pro starter kit oficial do Laravel 12 fogem do escopo do nosso livro pois cada stack requer conhecimentos específicos que precisariam ser colocadas em um livro focado mas toda a base que você precisa de Laravel estamos abordado aqui e em um futuro será mais simples você adotar um starter kit de escolha.</p>

<p>Então é isso, no vemos no próximo capítulo onde vamos trabalhar a parte de Validação dos Dados.</p>

<p>No vemos lá!</p>


<h1 id="leanpub-auto-validao" class="chapter">Validação</h1>

<p>Olá tudo bem, espero que sim! </p>

<p>Estamos quase chegando na reta final da nossa jornada e neste capítulo iremos conhecer as validações dentro do Laravel. Lembrando que continuaremos abordando os conceitos como parte prática dentro do nosso projeto feito até aqui.</p>

<p>Podemos usar validação de duas maneiras incialmente. Uma delas é usando <b>Form Requests</b> e a outra é usando o objeto <b>Validator</b> e criando nossas validações customizadas direto em nossos controllers.</p>

<p>Para este capítulo e em nossa jornada vamos conhecer o uso de validações por meio do Form Request, pois ele nos ajuda a tirar esta lógica do nosso controller e isola em uma classe exclusiva para este fim. Então vamos entender como gerar este form request dentro do laravel e em nossa aplicação.</p>

<p>Vamos lá!</p>

<h2 id="leanpub-auto-form-request-e-validaes" class="section">Form Request e Validações</h2>

<p>Primeiramente vamos gerar nosso primeiro form request e logo em seguida iremos comentar sobre o código desta classe. Em seu terminal execute o comando abaixo, na raiz do seu projeto:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:request ProductRequest
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----form-request-geracao.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Uma pasta será criada dentro da pasta <code>Http</code>, a pasta <code>Requests</code>, e lá estará nosso ProductRequest. Veja o conteúdo dele abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">ProductRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">false</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">26 </code>            <code class="o">//</code>
<code class="linenos">27 </code>        <code class="p">];</code>
<code class="linenos">28 </code>    <code class="p">}</code>
<code class="linenos">29 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O Form Request trará de cara dois métodos iniciais, o <code>authorize</code> e o <code>rules</code>. Vamos entender para que servem:</p>

<ul>
  <li>
<code>authorize</code>: Este método é serve para verificar se determinado acesso está autorizado na sua aplicação, retornando false a requisição é automaticamente bloqueada na rota em que você utilizar este Form Request e retornando true a requisição passará normalmente, caindo para as regras de validação em <code>rules</code>. No <code>authorize</code> você poderia verificar, por exemplo, se determinado usuário teria a permissão necessária para o acesso requisitado checando se este usuário, por exemplo, é dono do dado que está tentando criar/atualizar no momento;</li>
  <li>
<code>rules</code>: No método <b>rules</b> você define as regras para validação e assim que a requisição do formulário for enviada, o Laravel usa estas regras e valida os dados antes mesmo de chegarem em seu controller e no método correspondente.</li>
</ul>

<p>Podemos usar o Form Request para substituir o Request em nossos métodos que necessitam dele, isso trará a pitada extra de validação que será executada antes da requisição bater na execução do nosso método.</p>

<p>Vamos entender como montar as regras de nossa validação.</p>

<h2 id="leanpub-auto-montando-regras-de-validao" class="section">Montando Regras de Validação</h2>

<p>A estrutura para as validações respeitam basicamente o nome dos campos dos inputs de seu formulário e o uso das validações disponiveis, para cada tipo de dado, disponibilizados pelo Laravel. O Laravel possui diversos validadores, como por exemplo, citando alguns e deixando referência para os outros:</p>

<ul>
  <li>required: para campos obrigatórios;</li>
  <li>email: valida se um e-mail é válido;</li>
  <li>unique: garante que aquele valor é único no seu banco de dados e já testa se existe algum registro com aquele valor passado;</li>
  <li>array: valida se o valor é um array;</li>
  <li>image: valida se o valor é uma imagem válida: jpeg, png, bmp, gif, svg, or webp.</li>
  <li>confirm: faz o match entre dois campos para verificar se os valores digitados são iguais. Excelente para confirmação de senha.</li>
</ul>

<p>Existem diversos validadores e recomendo que você veja o que se enquadra melhor para a validação dentro da sua aplicação. Para visualizar as opções acesse: <a href="https://laravel.com/docs/12.x/validation#available-validation-rules">https://laravel.com/docs/12.x/validation#available-validation-rules</a>.</p>

<p>Dito isso, vamos montar nossas regras de validação para os campos do nosso formulário de criação e edição do Produto. Vamos lá.</p>

<p>Primeiramente irei colocar alguns campos como obrigatórios para termos um primeiro contato com as validações, veja o trecho do método <code>rules</code> do <code>ProductRequest</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cm">/**</code>
<code class="linenos"> 2 </code><code class="cm">* Get the validation rules that apply to the request.</code>
<code class="linenos"> 3 </code><code class="cm">*</code>
<code class="linenos"> 4 </code><code class="cm">* @return array&lt;string, \Illuminate\Contracts\Validation\ValidationRule|array&lt;mixed&gt;\</code>
<code class="linenos"> 5 </code><code class="cm">|string&gt;</code>
<code class="linenos"> 6 </code><code class="cm">*/</code><code class="w"></code>
<code class="linenos"> 7 </code><code class="k">public</code><code class="w"> </code><code class="k">function</code><code class="w"> </code><code class="n">rules</code><code class="p">()</code><code class="err">:</code><code class="w"> </code><code class="k">array</code><code class="w"></code>
<code class="linenos"> 8 </code><code class="err">{</code><code class="w"></code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code><code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="o">[</code><code class="n"></code>
<code class="linenos">11 </code><code class="n">        'name'           =&gt; 'required',</code>
<code class="linenos">12 </code><code class="n">        'description'    =&gt; 'nullable',</code>
<code class="linenos">13 </code><code class="n">        'body'           =&gt; 'required',</code>
<code class="linenos">14 </code><code class="n">        'price'          =&gt; 'required',</code>
<code class="linenos">15 </code><code class="n">        'in_stock'       =&gt; 'required',</code>
<code class="linenos">16 </code><code class="n">        'is_active'      =&gt; 'required',</code>
<code class="linenos">17 </code><code class="n">        'slug'           =&gt; 'required',</code>
<code class="linenos">18 </code><code class="n">        'categories'     =&gt; 'required'</code>
<code class="linenos">19 </code><code class="n">    </code><code class="o">]</code><code class="p">;</code><code class="w"></code>
<code class="linenos">20 </code><code class="err">}</code><code class="w"></code>
</pre></div>

</figure>


<p>Acima listei no array, de retorno do método <code>rules</code>, o nome dos nossos campos do formulário e defini para cada campo a validação para campos obrigatórios.</p>

<p>Podemos ainda utilizar mais validadores para cada um dos campos, e isso é possivel quando usamos o pipe <code>|</code> e informamos outro validador para o campo escolhido. Se esse validador aceitar parâmetros nós informados por meio de um <code>:</code>, como por exemplo no validador abaixo.</p>

<p>Posso colocar um tamanho minimo ou máximo para nossa descrição(<code>description</code>), veja o método alterado:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cm">/**</code>
<code class="linenos"> 2 </code><code class="cm">* Get the validation rules that apply to the request.</code>
<code class="linenos"> 3 </code><code class="cm">*</code>
<code class="linenos"> 4 </code><code class="cm">* @return array&lt;string, \Illuminate\Contracts\Validation\ValidationRule|array&lt;mixed&gt;\</code>
<code class="linenos"> 5 </code><code class="cm">|string&gt;</code>
<code class="linenos"> 6 </code><code class="cm">*/</code><code class="w"></code>
<code class="linenos"> 7 </code><code class="k">public</code><code class="w"> </code><code class="k">function</code><code class="w"> </code><code class="n">rules</code><code class="p">()</code><code class="err">:</code><code class="w"> </code><code class="k">array</code><code class="w"></code>
<code class="linenos"> 8 </code><code class="err">{</code><code class="w"></code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code><code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="o">[</code><code class="n"></code>
<code class="linenos">11 </code><code class="n">        'name'           =&gt; 'required',</code>
<code class="linenos">12 </code><code class="n">        'description'    =&gt; 'nullable|min:20',</code>
<code class="linenos">13 </code><code class="n">        'body'           =&gt; 'required',</code>
<code class="linenos">14 </code><code class="n">        'price'          =&gt; 'required',</code>
<code class="linenos">15 </code><code class="n">        'in_stock'       =&gt; 'required',</code>
<code class="linenos">16 </code><code class="n">        'is_active'      =&gt; 'required',</code>
<code class="linenos">17 </code><code class="n">        'slug'           =&gt; 'required',</code>
<code class="linenos">18 </code><code class="n">        'categories'     =&gt; 'required'</code>
<code class="linenos">19 </code><code class="n">    </code><code class="o">]</code><code class="p">;</code><code class="w"></code>
<code class="linenos">20 </code><code class="err">}</code><code class="w"></code>
</pre></div>

</figure>


<p>Acima digo que nosso campo de descrição além de não ser obrigatório com o validador <code>nullable</code>, também deve ter um valor minimo a ser digitado e esse valor minimo, informado depois do <code>:</code> é 20 caracteres. O validador <code>nullable</code> ignora o campo se ele vier vazio mas ao termos valor e existindo outras regras de validação pro campo, essas regras serão aplicadas.</p>

<p>Lembrando que no exemplo acima mostrei a organização dos validadores como string mas se você preferir pode utilizar em lista via array. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>...
<code class="linenos">2 </code>'description' =&gt; ['nullable', 'min:20'],
<code class="linenos">3 </code>...
</pre></div>

</figure>


<p>Agora, como utilizar o Form Request e também exibir estas validação em nossas views? </p>

<p>Antes de prosseguirmos vamos adicionar o input do status em nosso formulário e modificar o trecho do input de preço adicinoando o campo referente ao estoque. Altere seu <code>create.blade.php</code> do Produto com o input abaixo:</p>

<p><b>input Status</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 2 </code>    <code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"w-full mb-4"</code><code class="nt">&gt;</code>Status<code class="nt">&lt;/label&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 5 </code>        <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"is_active"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray-900"</code><code class="nt">&gt;</code>
<code class="linenos"> 6 </code>            <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">""</code><code class="nt">&gt;</code>Selecione o status do produto<code class="nt">&lt;/option&gt;</code>
<code class="linenos"> 7 </code>            <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"1"</code> <code class="err">@selected(old('is_active'))</code><code class="nt">&gt;</code>Ativo<code class="nt">&lt;/option&gt;</code>
<code class="linenos"> 8 </code>            <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"0"</code> <code class="err">@selected(!old('is_active'))</code><code class="nt">&gt;</code>Inativo<code class="nt">&lt;/option&gt;</code>
<code class="linenos"> 9 </code>        <code class="nt">&lt;/select&gt;</code>
<code class="linenos">10 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">11 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>O mesmo input status, para o <b>edit.blade.php</b> do produto: </p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 2 </code>    <code class="nt">&lt;label</code> <code class="na">class=</code><code class="s">"w-full mb-4"</code><code class="nt">&gt;</code>Status<code class="nt">&lt;/label&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 5 </code>        <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"is_active"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray-900"</code><code class="nt">&gt;</code>
<code class="linenos"> 6 </code>            <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">""</code><code class="nt">&gt;</code>Selecione o status do produto<code class="nt">&lt;/option&gt;</code>
<code class="linenos"> 7 </code>            <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"1"</code> <code class="err">@selected($product-</code><code class="nt">&gt;</code>is_active)&gt;Ativo<code class="nt">&lt;/option&gt;</code>
<code class="linenos"> 8 </code>            <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"0"</code> <code class="err">@selected(!$product-</code><code class="nt">&gt;</code>is_active)&gt;Inativo<code class="nt">&lt;/option&gt;</code>
<code class="linenos"> 9 </code>        <code class="nt">&lt;/select&gt;</code>
<code class="linenos">10 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">11 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>Perceba aqui uma nova diretiva do blade, usei o <code>@selected</code> que assim como o <code>@checked</code> espera um valor booleano para ativar ou não ativar o atributo selected desta tag do elemento select. No criar eu verifico o valor do helper old, já no editar pegamos o valor direto do produto recebido do controller.</p>

<p>PS.: Eu coloquei ele antes do trecho dos inputs das categorias.</p>

<p>Abaixo segue o input preço + o estoque, neste caso remova a div do preço atual e coloque esta. Segue o da tela de criação e edição:</p>

<p>Trecho no <b>create.blade.php</b></p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6 flex gap-x-4"</code><code class="nt">&gt;</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-[50%]"</code><code class="nt">&gt;</code>
<code class="linenos"> 4 </code>        <code class="nt">&lt;label&gt;</code>Preço<code class="nt">&lt;/label&gt;</code>
<code class="linenos"> 5 </code>    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"price"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray-900"</code>
<code class="linenos"> 6 </code>        <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">old</code><code class="o">(</code><code class="s1">'price'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos"> 7 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-[50%]"</code><code class="nt">&gt;</code>
<code class="linenos">10 </code>        <code class="nt">&lt;label&gt;</code>Estoque<code class="nt">&lt;/label&gt;</code>
<code class="linenos">11 </code>    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"numer"</code> <code class="na">name=</code><code class="s">"in_stock"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray\</code>
<code class="linenos">12 </code><code class="s">-900"</code>
<code class="linenos">13 </code>        <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">old</code><code class="o">(</code><code class="s1">'in_stock'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">14 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">15 </code>
<code class="linenos">16 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>Trecho no <b>edit.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6 flex gap-x-4"</code><code class="nt">&gt;</code>
<code class="linenos"> 2 </code>    
<code class="linenos"> 3 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-[50%]"</code><code class="nt">&gt;</code>
<code class="linenos"> 4 </code>        <code class="nt">&lt;label&gt;</code>Preço<code class="nt">&lt;/label&gt;</code>
<code class="linenos"> 5 </code>        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"price"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray\</code>
<code class="linenos"> 6 </code><code class="s">-900"</code>
<code class="linenos"> 7 </code>            <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">number_format</code><code class="o">(</code><code class="err">$</code><code class="nv">product-</code><code class="o">&gt;</code><code class="nv">price</code><code class="o">,</code> <code class="m">2</code><code class="o">,</code> <code class="s1">','</code><code class="o">,</code> <code class="s1">'.'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos"> 8 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-[50%]"</code><code class="nt">&gt;</code>
<code class="linenos">11 </code>        <code class="nt">&lt;label&gt;</code>Estoque<code class="nt">&lt;/label&gt;</code>
<code class="linenos">12 </code>    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"numer"</code> <code class="na">name=</code><code class="s">"in_stock"</code> <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray\</code>
<code class="linenos">13 </code><code class="s">-900"</code>
<code class="linenos">14 </code>        <code class="na">value=</code><code class="s">"</code><code class="cp">{{</code> <code class="err">$</code><code class="nv">product-</code><code class="o">&gt;</code><code class="nv">in_stock</code> <code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos">15 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>Alterações feitas, remova do seu controller qualquer chave no método store e no método update referentes ao <code>is_active</code> e ao <code>in_stock</code>.</p>

<p>Feito isso, vamos continuando.</p>

<h2 id="leanpub-auto-usando-o-form-request" class="section">Usando o Form Request</h2>

<p>É um processo bem simples, só precisamos trocar a referência nos métodos que usam o Request, trocando o <code>Request</code> pelo <code>ProductRequest</code> nos métodos <code>store</code>  e <code>update</code>, do <code>ProductController</code>. </p>

<p>Que estão assim:</p>

<p><b>store</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>...
<code class="linenos">2 </code>public function store(Request $request)
<code class="linenos">3 </code>{
<code class="linenos">4 </code>...
</pre></div>

</figure>


<p><b>update</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>...
<code class="linenos">2 </code>public function update($product, Request $request)
<code class="linenos">3 </code>{
<code class="linenos">4 </code>...
</pre></div>

</figure>


<p>Ficarão assim:</p>

<p><b>store</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>...
<code class="linenos">2 </code>
<code class="linenos">3 </code>public function store(ProductRequest $request)
<code class="linenos">4 </code>{
<code class="linenos">5 </code>
<code class="linenos">6 </code>...
</pre></div>

</figure>


<p><b>update</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>...
<code class="linenos">2 </code>public function update($post, ProductRequest $request)
<code class="linenos">3 </code>{
<code class="linenos">4 </code>...
</pre></div>

</figure>


<p>Simples, simples assim. Não precisamos alterar mais nada nos controllers, isso se dá por que o Form Request extende do Request, por isso não precisamos alterar nada, e o acesso aos métodos para manipulação do dados vindos da requisição continuam disponíveis.</p>

<p>Obs.: Como não vamos utilizar regras no método <code>authorize</code> do <code>ProductRequest</code> ao invés de retornar <code>false</code> retorne <code>true</code> e não esqueça de importar o <code>ProductRequest</code> no <code>ProductController</code>.</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>use  App\Http\Requests\ProductRequest;
</pre></div>

</figure>


<p>Veja na íntegra como <code>ProductRequest</code> está:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">ProductRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>
<code class="linenos">26 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">27 </code>            <code class="s1">'name'</code>           <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">28 </code>            <code class="s1">'description'</code>    <code class="o">=&gt;</code> <code class="s1">'nullable'</code><code class="p">,</code>
<code class="linenos">29 </code>            <code class="s1">'body'</code>           <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">30 </code>            <code class="s1">'price'</code>          <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">31 </code>            <code class="s1">'in_stock'</code>       <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">32 </code>            <code class="s1">'is_active'</code>      <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">33 </code>            <code class="s1">'slug'</code>           <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">34 </code>            <code class="s1">'categories'</code>     <code class="o">=&gt;</code> <code class="s1">'required'</code>
<code class="linenos">35 </code>        <code class="p">];</code>
<code class="linenos">36 </code>    <code class="p">}</code>
<code class="linenos">37 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Agora precisamos testar essas validações e exibir pro usuário as mensagens dos validadores de cada input em nosso formulário. Agora sim, vamos exibir as validações e suas mensagens em nossas views.</p>

<blockquote>
  <p>Um ponto importante e recomendo que faça essa alteração. Em seus controllers onde recebe os dados da requisição. Onde chamamos o <code>$request-&gt;all()</code> troque todos as referências por <code>$request-&gt;validated()</code>.</p>

  <p>O método <code>validated</code> trará o array onde somente os dados que foram validados e passaram nessa validação estarão.</p>
</blockquote>

<h2 id="leanpub-auto-exibindo-validaes-nas-views-blade" class="section">Exibindo validações nas Views Blade</h2>

<p>O Laravel disponibiliza uma variável que pode ser acessada em todas as views da aplicação, chamada de <code>$errors</code> . A variável <code>$errors</code> receberá as informações dos dados que não passaram na validação, durante o envio dos dados do formulário. No Laravel podemos interagir com estes erros diretamente através de uma diretiva exclusiva para isso.</p>

<p>Por meio da diretiva <code>@error</code> podemos tratar estas exibições de forma bem simples, vamos entender como ela funciona.</p>

<p>Aplicamos as validações com base nos nomes dos campos de nossos formulários, pois são esses os identificadores das informações enviadas em nossa requisição. Para recuperarmos erros específicos de cada campo podemos usar a diretiva <code>@error</code> como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">2 </code>	<code class="o">&lt;</code><code class="n">h1</code><code class="o">&gt;</code><code class="n">Existe</code> <code class="n">um</code> <code class="n">erro</code> <code class="n">de</code> <code class="n">validação</code> <code class="n">para</code> <code class="n">o</code> <code class="n">input</code> <code class="k">do</code> <code class="n">nome</code> <code class="k">do</code> <code class="n">produto</code><code class="o">&lt;/</code><code class="n">h1</code><code class="o">&gt;</code> 
<code class="linenos">3 </code><code class="p">@</code><code class="n">enderror</code>
</pre></div>

</figure>


<p>A diretiva retornará true caso exista um erro de validação para o campo informado. Desta forma, você pode exibir as mensagens de validação para este campo e esta mensagem está na variável <code>$message</code> criada pela diretiva e que contêm a mensagem real do erro aplicado pela validação.</p>

<p>Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">2 </code>	<code class="o">&lt;</code><code class="n">h1</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">h1</code><code class="o">&gt;</code> 
<code class="linenos">3 </code><code class="p">@</code><code class="n">enderror</code>
</pre></div>

</figure>


<p>Acima, se existir erros de validação para o campo <code>name</code> a mensagem do erro real, lançada pelo Laravel, será exibida dentro do <code>h1</code>.</p>

<p>Agora vamos entender como usar esta diretiva em nossos formulários.</p>

<h2 id="leanpub-auto-exibindo-validaes-nos-formulrio" class="section">Exibindo validações nos formulário</h2>

<p>Vou trazer uma pequena amostragem da aplicação da diretiva <code>@error</code> para um input específico, pois no todo é mais copia e cola e o que difere é o input name passado.</p>

<p>Segue o input name com a diretiva aplicada:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code> <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('name') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('name') b\</code>
<code class="linenos"> 5 </code><code class="s">order-red-900 @else border-gray-900 @enderror"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('name') }}"</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 8 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400 text-re\</code>
<code class="linenos"> 9 </code><code class="s">d-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">10 </code>    <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>Perceba que utilizei a diretiva error e customizei com TailwindCSS o estilo da mensagem de erro para se adequar visualmente a algo que não passou na validação. Perceba o input e a label também, neles apliquei a diretiva <code>@error</code> para exibir a cor da borda do input para vermelho e o texto da label também em vermelhor, neste caso é mais um exemplo que você pode aplicar.</p>

<p>Visualmente veja como fica:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----input-validacao-error.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Agora é só replicarmos este pensamento para cada um dos inputs. Veja o formulário de criação completo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">  1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">  2 </code>
<code class="linenos">  3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">  4 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('products.store') }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">  5 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">  6 </code>
<code class="linenos">  7 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">  8 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('name') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">la</code>\
<code class="linenos">  9 </code><code class="n">bel</code><code class="o">&gt;</code>
<code class="linenos"> 10 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos"> 11 </code><code class="s">name') border-red-900 @else border-gray-900 @enderror"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('name') }}"</code><code class="o">&gt;</code>
<code class="linenos"> 12 </code>
<code class="linenos"> 13 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 14 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 15 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 16 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 17 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 18 </code>
<code class="linenos"> 19 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 20 </code>            <code class="o">&lt;</code><code class="n">label</code>  <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('description') text-red-900 @enderror"</code><code class="o">&gt;</code>\
<code class="linenos"> 21 </code><code class="n">Descrição</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 22 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"description"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border  \</code>
<code class="linenos"> 23 </code><code class="s">@error('description') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos"> 24 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('description') }}"</code><code class="o">&gt;</code>
<code class="linenos"> 25 </code>
<code class="linenos"> 26 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">description</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 27 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 28 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 29 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 30 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 31 </code>
<code class="linenos"> 32 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 33 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('body') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Conteúdo</code>\
<code class="linenos"> 34 </code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 35 </code>            <code class="o">&lt;</code><code class="n">textarea</code> <code class="n">name</code><code class="o">=</code><code class="s">"body"</code> <code class="kt">id</code><code class="o">=</code><code class="s">""</code> <code class="n">cols</code><code class="o">=</code><code class="s">"30"</code> <code class="n">rows</code><code class="o">=</code><code class="s">"10"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounde\</code>
<code class="linenos"> 36 </code><code class="s">d border @error('body') border-red-900 @else border-gray-900 @enderror"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">old</code><code class="p">(</code><code class="err">'</code><code class="n">body</code>\
<code class="linenos"> 37 </code><code class="err">'</code><code class="p">)</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">textarea</code><code class="o">&gt;</code>
<code class="linenos"> 38 </code>
<code class="linenos"> 39 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">body</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 40 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 41 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 42 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 43 </code>
<code class="linenos"> 44 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 45 </code>
<code class="linenos"> 46 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6 flex gap-x-4"</code><code class="o">&gt;</code>
<code class="linenos"> 47 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[50%]"</code><code class="o">&gt;</code>
<code class="linenos"> 48 </code>                <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('price') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Pre</code>\
<code class="linenos"> 49 </code><code class="err">ç</code><code class="n">o</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 50 </code>                <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"price"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @er\</code>
<code class="linenos"> 51 </code><code class="s">ror('price') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos"> 52 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('price') }}"</code><code class="o">&gt;</code>
<code class="linenos"> 53 </code>
<code class="linenos"> 54 </code>                <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">price</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 55 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 56 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 57 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 58 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 59 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[50%]"</code><code class="o">&gt;</code>
<code class="linenos"> 60 </code>                <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('in_stock') text-red-900 @enderror"</code><code class="o">&gt;</code>\
<code class="linenos"> 61 </code><code class="n">Estoque</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 62 </code>                <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"numer"</code> <code class="n">name</code><code class="o">=</code><code class="s">"in_stock"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border\</code>
<code class="linenos"> 63 </code><code class="s"> @error('in_stock') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos"> 64 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('in_stock') }}"</code><code class="o">&gt;</code>
<code class="linenos"> 65 </code>
<code class="linenos"> 66 </code>                <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">in_stock</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 67 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red\</code>
<code class="linenos"> 68 </code><code class="s">-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 69 </code>                <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 70 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 71 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 72 </code>
<code class="linenos"> 73 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 74 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('slug') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Slug</code><code class="o">&lt;/</code><code class="n">la</code>\
<code class="linenos"> 75 </code><code class="n">bel</code><code class="o">&gt;</code>
<code class="linenos"> 76 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"slug"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos"> 77 </code><code class="s">slug') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos"> 78 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('slug') }}"</code><code class="o">&gt;</code>
<code class="linenos"> 79 </code>
<code class="linenos"> 80 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">slug</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 81 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 82 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 83 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 84 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 85 </code>
<code class="linenos"> 86 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 87 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-4 @error('is_active') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">St</code>\
<code class="linenos"> 88 </code><code class="n">atus</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 89 </code>
<code class="linenos"> 90 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 91 </code>                <code class="o">&lt;</code><code class="n">select</code> <code class="n">name</code><code class="o">=</code><code class="s">"is_active"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('is\</code>
<code class="linenos"> 92 </code><code class="s">_active') border-red-900 @else border-gray-900 @enderror"</code><code class="o">&gt;</code>
<code class="linenos"> 93 </code>                    <code class="o">&lt;</code><code class="n">option</code> <code class="n">value</code><code class="o">=</code><code class="s">""</code><code class="o">&gt;</code><code class="n">Selecione</code> <code class="n">o</code> <code class="n">status</code> <code class="k">do</code> <code class="n">produto</code><code class="o">&lt;/</code><code class="n">option</code><code class="o">&gt;</code>
<code class="linenos"> 94 </code>                    <code class="o">&lt;</code><code class="n">option</code> <code class="n">value</code><code class="o">=</code><code class="s">"1"</code> <code class="p">@</code><code class="n">selected</code><code class="p">(</code><code class="n">old</code><code class="p">(</code><code class="err">'</code><code class="n">is_active</code><code class="err">'</code><code class="p">))</code><code class="o">&gt;</code><code class="n">Ativo</code><code class="o">&lt;/</code><code class="n">option</code><code class="o">&gt;</code>
<code class="linenos"> 95 </code>                    <code class="o">&lt;</code><code class="n">option</code> <code class="n">value</code><code class="o">=</code><code class="s">"0"</code> <code class="p">@</code><code class="n">selected</code><code class="p">(</code><code class="o">!</code><code class="n">old</code><code class="p">(</code><code class="err">'</code><code class="n">is_active</code><code class="err">'</code><code class="p">))</code><code class="o">&gt;</code><code class="n">Inativo</code><code class="o">&lt;/</code><code class="n">option</code><code class="o">&gt;</code>
<code class="linenos"> 96 </code>                <code class="o">&lt;/</code><code class="n">select</code><code class="o">&gt;</code>
<code class="linenos"> 97 </code>
<code class="linenos"> 98 </code>                <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">is_active</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 99 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red\</code>
<code class="linenos">100 </code><code class="s">-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">101 </code>                <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">102 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">103 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">104 </code>
<code class="linenos">105 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">106 </code>
<code class="linenos">107 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">categories</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">108 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos">109 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">110 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">111 </code>
<code class="linenos">112 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-4 @error('categories') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">C</code>\
<code class="linenos">113 </code><code class="n">ategorias</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">114 </code>
<code class="linenos">115 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-5 grid grid-cols-3"</code><code class="o">&gt;</code>
<code class="linenos">116 </code>                <code class="p">@</code><code class="n">foreach</code> <code class="p">(</code><code class="n">$categories</code> <code class="n">as</code> <code class="n">$category</code><code class="p">)</code>
<code class="linenos">117 </code>                    <code class="o">&lt;</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">118 </code>                        <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"checkbox"</code> <code class="n">name</code><code class="o">=</code><code class="s">"categories[]"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ $catego\</code>
<code class="linenos">119 </code><code class="s">ry-&gt;id }}"</code><code class="o">&gt;</code>
<code class="linenos">120 </code>                        <code class="p">{{</code> <code class="n">$category</code><code class="o">-&gt;</code><code class="n">name</code> <code class="p">}}</code>
<code class="linenos">121 </code>                    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">122 </code>                <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">123 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">124 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">125 </code>
<code class="linenos">126 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-w\</code>
<code class="linenos">127 </code><code class="s">hite font-thin"</code><code class="o">&gt;</code><code class="n">Criar</code> <code class="n">Produto</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">128 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">129 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<p>Veja o resultado dos inputs já com a validação e essa validação sendo aplicada e exibida:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----form-com-validacao.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>O de edição também seguirá o mesmo pensamento, veja o formulário de edição alterado abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">  1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">  2 </code>
<code class="linenos">  3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">  4 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('products.update', ['product' =&gt; $product-&gt;id]) }}"</code> <code class="n">metho</code>\
<code class="linenos">  5 </code><code class="n">d</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">  6 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">  7 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">PUT</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">  8 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">  9 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2  @error('name') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">l</code>\
<code class="linenos"> 10 </code><code class="n">abel</code><code class="o">&gt;</code>
<code class="linenos"> 11 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos"> 12 </code><code class="s">name') border-red-900 @else border-gray-900 @enderror"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ $product-&gt;name }}"</code><code class="o">&gt;</code>
<code class="linenos"> 13 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 14 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 15 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 16 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 17 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 18 </code>
<code class="linenos"> 19 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 20 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('description') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">D</code>\
<code class="linenos"> 21 </code><code class="n">escrição</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 22 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"description"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @\</code>
<code class="linenos"> 23 </code><code class="s">error('description') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos"> 24 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $product-&gt;description }}"</code><code class="o">&gt;</code>
<code class="linenos"> 25 </code>
<code class="linenos"> 26 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">description</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 27 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 28 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 29 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 30 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 31 </code>
<code class="linenos"> 32 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 33 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('body') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Conteúdo</code>\
<code class="linenos"> 34 </code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 35 </code>            <code class="o">&lt;</code><code class="n">textarea</code> <code class="n">name</code><code class="o">=</code><code class="s">"body"</code> <code class="kt">id</code><code class="o">=</code><code class="s">""</code> <code class="n">cols</code><code class="o">=</code><code class="s">"30"</code> <code class="n">rows</code><code class="o">=</code><code class="s">"10"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounde\</code>
<code class="linenos"> 36 </code><code class="s">d border @error('body') border-red-900 @else border-gray-900 @enderror"</code><code class="o">&gt;</code><code class="p">{{</code> <code class="n">$product</code><code class="o">-</code>\
<code class="linenos"> 37 </code><code class="o">&gt;</code><code class="n">body</code> <code class="p">}}</code><code class="o">&lt;/</code><code class="n">textarea</code><code class="o">&gt;</code>
<code class="linenos"> 38 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">body</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 39 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 40 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 41 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 42 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 43 </code>
<code class="linenos"> 44 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 45 </code>
<code class="linenos"> 46 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 47 </code>
<code class="linenos"> 48 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6 flex gap-x-4"</code><code class="o">&gt;</code>
<code class="linenos"> 49 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[50%]"</code><code class="o">&gt;</code>
<code class="linenos"> 50 </code>                <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('price') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Pre</code>\
<code class="linenos"> 51 </code><code class="err">ç</code><code class="n">o</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 52 </code>                <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"price"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @er\</code>
<code class="linenos"> 53 </code><code class="s">ror('price') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos"> 54 </code>                    <code class="n">value</code><code class="o">=</code><code class="s">"{{ number_format($product-&gt;price, 2, ',', '.') }}"</code><code class="o">&gt;</code>
<code class="linenos"> 55 </code>                <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">price</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 56 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red\</code>
<code class="linenos"> 57 </code><code class="s">-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 58 </code>                <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 59 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 60 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[50%]"</code><code class="o">&gt;</code>
<code class="linenos"> 61 </code>                <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('in_stock') text-red-900 @enderror"</code><code class="o">&gt;</code>\
<code class="linenos"> 62 </code><code class="n">Estoque</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 63 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"numer"</code> <code class="n">name</code><code class="o">=</code><code class="s">"in_stock"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @er\</code>
<code class="linenos"> 64 </code><code class="s">ror('in_stock') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos"> 65 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $product-&gt;in_stock }}"</code><code class="o">&gt;</code>
<code class="linenos"> 66 </code>
<code class="linenos"> 67 </code>                <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">in_stock</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 68 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red\</code>
<code class="linenos"> 69 </code><code class="s">-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 70 </code>                <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 71 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 72 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 73 </code>
<code class="linenos"> 74 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 75 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('slug') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Slug</code><code class="o">&lt;/</code><code class="n">la</code>\
<code class="linenos"> 76 </code><code class="n">bel</code><code class="o">&gt;</code>
<code class="linenos"> 77 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"slug"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos"> 78 </code><code class="s">slug') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos"> 79 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $product-&gt;slug }}"</code><code class="o">&gt;</code>
<code class="linenos"> 80 </code>
<code class="linenos"> 81 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">slug</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 82 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos"> 83 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 84 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos"> 85 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 86 </code>
<code class="linenos"> 87 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 88 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-4 @error('is_active') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">St</code>\
<code class="linenos"> 89 </code><code class="n">atus</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 90 </code>
<code class="linenos"> 91 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 92 </code>                <code class="o">&lt;</code><code class="n">select</code> <code class="n">name</code><code class="o">=</code><code class="s">"is_active"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('is\</code>
<code class="linenos"> 93 </code><code class="s">_active') border-red-900 @else border-gray-900 @enderror"</code><code class="o">&gt;</code>
<code class="linenos"> 94 </code>                    <code class="o">&lt;</code><code class="n">option</code> <code class="n">value</code><code class="o">=</code><code class="s">""</code><code class="o">&gt;</code><code class="n">Selecione</code> <code class="n">o</code> <code class="n">status</code> <code class="k">do</code> <code class="n">produto</code><code class="o">&lt;/</code><code class="n">option</code><code class="o">&gt;</code>
<code class="linenos"> 95 </code>                    <code class="o">&lt;</code><code class="n">option</code> <code class="n">value</code><code class="o">=</code><code class="s">"1"</code> <code class="p">@</code><code class="n">selected</code><code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">is_active</code><code class="p">)</code><code class="o">&gt;</code><code class="n">Ativo</code><code class="o">&lt;/</code><code class="n">option</code><code class="o">&gt;</code>
<code class="linenos"> 96 </code>                    <code class="o">&lt;</code><code class="n">option</code> <code class="n">value</code><code class="o">=</code><code class="s">"0"</code> <code class="p">@</code><code class="n">selected</code><code class="p">(</code><code class="o">!</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">is_active</code><code class="p">)</code><code class="o">&gt;</code><code class="n">Inativo</code><code class="o">&lt;/</code><code class="n">optio</code>\
<code class="linenos"> 97 </code><code class="n">n</code><code class="o">&gt;</code>
<code class="linenos"> 98 </code>                <code class="o">&lt;/</code><code class="n">select</code><code class="o">&gt;</code>
<code class="linenos"> 99 </code>
<code class="linenos">100 </code>                <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">is_active</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">101 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red\</code>
<code class="linenos">102 </code><code class="s">-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">103 </code>                <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">104 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">105 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">106 </code>
<code class="linenos">107 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">108 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">categories</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">109 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos">110 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">111 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">112 </code>
<code class="linenos">113 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-4 @error('categories') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">C</code>\
<code class="linenos">114 </code><code class="n">ategorias</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">115 </code>
<code class="linenos">116 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-5 grid grid-cols-3"</code><code class="o">&gt;</code>
<code class="linenos">117 </code>                <code class="p">@</code><code class="n">foreach</code> <code class="p">(</code><code class="n">$categories</code> <code class="n">as</code> <code class="n">$category</code><code class="p">)</code>
<code class="linenos">118 </code>                    <code class="o">&lt;</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">119 </code>                        <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"checkbox"</code> <code class="n">name</code><code class="o">=</code><code class="s">"categories[]"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ $catego\</code>
<code class="linenos">120 </code><code class="s">ry-&gt;id }}"</code> <code class="p">@</code><code class="n">checked</code><code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="o">-&gt;</code><code class="n">contains</code><code class="p">(</code><code class="n">$category</code><code class="p">))</code><code class="o">&gt;</code>
<code class="linenos">121 </code>                        <code class="p">{{</code> <code class="n">$category</code><code class="o">-&gt;</code><code class="n">name</code> <code class="p">}}</code>
<code class="linenos">122 </code>                    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">123 </code>                <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">124 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">125 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">126 </code>
<code class="linenos">127 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-w\</code>
<code class="linenos">128 </code><code class="s">hite font-thin"</code><code class="o">&gt;</code><code class="n">Atualizar</code>
<code class="linenos">129 </code>            <code class="n">Produto</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">130 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">131 </code>
<code class="linenos">132 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('products.destroy', ['product' =&gt; $product-&gt;id]) }}"</code> <code class="n">meth</code>\
<code class="linenos">133 </code><code class="n">od</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">134 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">135 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">136 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="n">type</code><code class="o">=</code><code class="s">"submit"</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-red-700 border border-red-900 roun\</code>
<code class="linenos">137 </code><code class="s">ded text-white font-thin mt-8"</code><code class="o">&gt;</code><code class="n">Remover</code>
<code class="linenos">138 </code>            <code class="n">Produto</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">139 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">140 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<h2 id="leanpub-auto-validao-em-categorias" class="section">Validação em Categorias</h2>

<p>Como é repeteco vamos as intruções de alteração diretamente!</p>

<p>Primeiramente vamos gerar nosso <code>CategoryRequest</code> para criarmos nossas regras de validação. Execute a geração em seu terminal com o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:request CategoryRequest
</pre></div>

</figure>


<p>Veja abaixo o conteúdo do <code>CategoryRequest</code> completo e com as regras de validação:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">CategoryRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">26 </code>            <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">27 </code>            <code class="s1">'description'</code> <code class="o">=&gt;</code> <code class="s1">'nullable|min:20'</code><code class="p">,</code>
<code class="linenos">28 </code>            <code class="s1">'slug'</code> <code class="o">=&gt;</code> <code class="s1">'required'</code>
<code class="linenos">29 </code>        <code class="p">];</code>
<code class="linenos">30 </code>    <code class="p">}</code>
<code class="linenos">31 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Troque os requests do <code>store</code> e do <code>update</code> do <code>CategoryController</code> assim como fizemos no <code>ProductController</code>. E por fim veja os formulários alterados da área de categorias:</p>

<p><b>create.blade.php</b></p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('categories.store') }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2  @error('name') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">l</code>\
<code class="linenos"> 9 </code><code class="n">abel</code><code class="o">&gt;</code>
<code class="linenos">10 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos">11 </code><code class="s">name') border-red-900 @else border-gray-900 @enderror"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('name') }}"</code><code class="o">&gt;</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">14 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos">15 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">16 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">17 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">20 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2  @error('description') text-red-900 @enderror"</code><code class="o">&gt;</code>\
<code class="linenos">21 </code><code class="n">Descrição</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">22 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"description"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @\</code>
<code class="linenos">23 </code><code class="s">error('description') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos">24 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('description') }}"</code><code class="o">&gt;</code>
<code class="linenos">25 </code>
<code class="linenos">26 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">description</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">27 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos">28 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">29 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">30 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">31 </code>
<code class="linenos">32 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">33 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('slug') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Slug</code><code class="o">&lt;/</code><code class="n">la</code>\
<code class="linenos">34 </code><code class="n">bel</code><code class="o">&gt;</code>
<code class="linenos">35 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"slug"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos">36 </code><code class="s">slug') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos">37 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ old('slug') }}"</code><code class="o">&gt;</code>
<code class="linenos">38 </code>
<code class="linenos">39 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">slug</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">40 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos">41 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">42 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">43 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">44 </code>
<code class="linenos">45 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-w\</code>
<code class="linenos">46 </code><code class="s">hite font-thin"</code><code class="o">&gt;</code><code class="n">Criar</code> <code class="n">Categoria</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">47 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">48 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<p><b>edit.blade.php</b></p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('categories.update', ['category' =&gt; $category-&gt;id]) }}"</code> <code class="n">m</code>\
<code class="linenos"> 5 </code><code class="n">ethod</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 7 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">PUT</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 8 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('name') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Nome</code><code class="o">&lt;/</code><code class="n">la</code>\
<code class="linenos">10 </code><code class="n">bel</code><code class="o">&gt;</code>
<code class="linenos">11 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos">12 </code><code class="s">name') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos">13 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $category-&gt;name }}"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">16 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos">17 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">18 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">19 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">20 </code>
<code class="linenos">21 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">22 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2  @error('description') text-red-900 @enderror"</code><code class="o">&gt;</code>\
<code class="linenos">23 </code><code class="n">Descrição</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">24 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"description"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @\</code>
<code class="linenos">25 </code><code class="s">error('description') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos">26 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $category-&gt;description }}"</code><code class="o">&gt;</code>
<code class="linenos">27 </code>
<code class="linenos">28 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">description</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">29 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos">30 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">31 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">32 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">35 </code>            <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2  @error('slug') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Slug</code><code class="o">&lt;/</code><code class="n">l</code>\
<code class="linenos">36 </code><code class="n">abel</code><code class="o">&gt;</code>
<code class="linenos">37 </code>            <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"slug"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos">38 </code><code class="s">slug') border-red-900 @else border-gray-900 @enderror"</code>
<code class="linenos">39 </code>                <code class="n">value</code><code class="o">=</code><code class="s">"{{ $category-&gt;slug }}"</code><code class="o">&gt;</code>
<code class="linenos">40 </code>
<code class="linenos">41 </code>            <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">slug</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">42 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400\</code>
<code class="linenos">43 </code><code class="s"> text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">44 </code>            <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">45 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">46 </code>
<code class="linenos">47 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-w\</code>
<code class="linenos">48 </code><code class="s">hite font-thin"</code><code class="o">&gt;</code><code class="n">Atualizar</code>
<code class="linenos">49 </code>            <code class="n">Categoria</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">50 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">51 </code>
<code class="linenos">52 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('categories.destroy', ['category' =&gt; $category-&gt;id]) }}"</code> \
<code class="linenos">53 </code><code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">54 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">55 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">56 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="n">type</code><code class="o">=</code><code class="s">"submit"</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-red-700 border border-red-900 roun\</code>
<code class="linenos">57 </code><code class="s">ded text-white font-thin mt-8"</code><code class="o">&gt;</code><code class="n">Remover</code>
<code class="linenos">58 </code>            <code class="n">Categoria</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">59 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">60 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<p>Agora que aplicamos as validações ao nosso formulário e área de categorias vamos adicionar também as validações para nossa área de Login, nosso form de Login.</p>

<p>Também vamos gerar um form request, veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:request Auth/LoginRequest
</pre></div>

</figure>


<p>Perceba que aqui informei uma pasta assim como fizemos pra nossos controllers do Admin, o Laravel irá criar dentro da pasta de requests a pasta <code>Auth</code> e nosso <code>LoginRequest</code> estará lá dentro.</p>

<p>Veja o form login na íntegra:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code>\<code class="n">Auth</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">LoginRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">26 </code>            <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="p">[</code><code class="s1">'required'</code><code class="p">,</code> <code class="s1">'string'</code><code class="p">,</code> <code class="s1">'email'</code><code class="p">],</code>
<code class="linenos">27 </code>            <code class="s1">'password'</code> <code class="o">=&gt;</code> <code class="p">[</code><code class="s1">'required'</code><code class="p">,</code> <code class="s1">'string'</code><code class="p">],</code>
<code class="linenos">28 </code>        <code class="p">];</code>
<code class="linenos">29 </code>    <code class="p">}</code>
<code class="linenos">30 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Aqui é mais do mesmo, não esqueça de, no método <code>login</code> do <code>LoginController</code> adicionar o form request no lugar do request padrão. Adicione também a diretiva <code>@error</code> no seu formulário de login. Como já sabemos fazer, deixarei essa alteração a seu cargo em seu projeto.</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----login-validado.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Existe um pequeno detalhe, e já que estamos falando de validação, no processo de login que podemos modificar. Lembra que ao testarmos se o login está correto via método <code>attempt</code> do AuthManager, retornamos um 401 via abort helper?</p>

<p>Substitua essa linha pelo trecho abaixo, em seu método <code>login</code> no <code>LoginController</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">throw</code> <code class="nt">ValidationException</code><code class="p">::</code><code class="nd">withMessages</code><code class="o">(</code><code class="cp">[</code>
<code class="linenos">2 </code>    <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="s1">'Acesso Inválido...'</code><code class="p">,</code>
<code class="linenos">3 </code><code class="cp">]</code><code class="o">);</code>
</pre></div>

</figure>


<p>Ao invés de realizarmos um abort vamos lançar uma exception do tipo <code>ValidationException</code> onde informamos a chave <code>email</code> referente ao nosso input e indicamos o erro de <code>Acesso inválido</code> pro caso do erro nas credenciais.</p>

<p>Essa mensagem cairá na parte de mensagens de validação e será exibida no trecho da diretiva <code>@error</code> pro nosso e-mail no formulário de login.</p>

<p>Tente passar um email e senha errados e veja o que acontece. No caso veja a tela do formulário ao cair na validação de credenciais inválidas:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----login-credenciais-invalidas.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Veja o método login completo e mais recente:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="k">function</code> <code class="n">login</code><code class="p">(</code><code class="n">LoginRequest</code> <code class="n">$request</code><code class="p">)</code><code class="o">:</code> <code class="n">RedirectResponse</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="n">$credentials</code> <code class="o">=</code> <code class="n">$request</code><code class="o">-&gt;</code><code class="n">only</code><code class="p">('</code><code class="n">email</code><code class="p">',</code> <code class="p">'</code><code class="n">password</code><code class="p">');</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="n">Auth</code><code class="o">::</code><code class="n">attempt</code><code class="p">(</code><code class="n">$credentials</code><code class="p">,</code> <code class="p">(</code><code class="n">bool</code><code class="p">)</code> <code class="n">$request</code><code class="o">-&gt;</code><code class="n">rememberme</code><code class="p">))</code> <code class="p">{</code>
<code class="linenos"> 6 </code>        <code class="n">throw</code> <code class="n">ValidationException</code><code class="o">::</code><code class="n">withMessages</code><code class="p">([</code>
<code class="linenos"> 7 </code>            <code class="p">'</code><code class="n">email</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">'</code><code class="n">Acesso</code> <code class="n">Inválido</code><code class="p">...',</code>
<code class="linenos"> 8 </code>        <code class="p">]);</code>
<code class="linenos"> 9 </code>    <code class="p">}</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="n">$request</code><code class="o">-&gt;</code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">regenerate</code><code class="p">();</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">intended</code><code class="p">(</code><code class="n">route</code><code class="p">('</code><code class="n">products</code><code class="p">.</code><code class="n">index</code><code class="p">',</code> <code class="nl">absolute:</code> <code class="n">false</code><code class="p">));</code>
<code class="linenos">14 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Não esqueça de importar o <code>ValidationException</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>use Illuminate\Validation\ValidationException;
</pre></div>

</figure>


<p>Feito isso vamos entender das traduções pro momento, das nossas mensagens de validação nos Forms Request.</p>

<h2 id="leanpub-auto-mensagens-de-erro" class="section">Mensagens de erro</h2>

<p>Dentro do form request podemos ainda traduzir as mensagens de erro, simplesmente sobscrevendo o método <code>messages</code> que está na classe pai do nosso form request. </p>

<p>Por exemplo, vamos traduzir as mensagens de validação lá do <code>ProductRequest</code>, logo após o método <code>rules</code> adicione o método abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nv">public</code> <code class="nv">function</code> <code class="nv">messages</code><code class="ss">()</code>
<code class="linenos">2 </code>{
<code class="linenos">3 </code>	<code class="k">return</code> [
<code class="linenos">4 </code>		<code class="s1">'</code><code class="s">required</code><code class="s1">'</code> <code class="o">=&gt;</code> <code class="s1">'</code><code class="s">Este campo é obrigatório</code><code class="s1">'</code>,
<code class="linenos">5 </code>		<code class="s1">'</code><code class="s">min</code><code class="s1">'</code>      <code class="o">=&gt;</code> <code class="s1">'</code><code class="s">Sua descrição deve ter pelo menos :min caracteres</code><code class="s1">'</code>
<code class="linenos">6 </code>	]<code class="c1">;</code>
<code class="linenos">7 </code>}
</pre></div>

</figure>


<p>O método messages retornará um array, referenciando o nome dos validadores como indice de cada linha e para cada linha, referentes ao validador, o valor será a mensagem que você quer que seja exibida. Agora sempre que a validação ocorrer, as mensagens escolhidas irão aparecer.</p>

<p>Note que consigo acessar, na chave <code>min</code> o valor digitado para a validação de quantidade mínima de caracteres, por meio da notação <code>:min</code>.</p>

<p>Para saber mais sobre as possibilidades com respeito as mensagens de validações recomendo a documentação: <a href="https://laravel.com/docs/12.x/validation#working-with-error-messages">https://laravel.com/docs/12.x/validation#working-with-error-messages</a>.</p>

<p>Veja o <code>ProductRequest</code> na íntegra:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">ProductRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>
<code class="linenos">26 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">27 </code>            <code class="s1">'name'</code>           <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">28 </code>            <code class="s1">'description'</code>    <code class="o">=&gt;</code> <code class="s1">'nullable|min:20'</code><code class="p">,</code>
<code class="linenos">29 </code>            <code class="s1">'body'</code>           <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">30 </code>            <code class="s1">'price'</code>          <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">31 </code>            <code class="s1">'in_stock'</code>       <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">32 </code>            <code class="s1">'is_active'</code>      <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">33 </code>            <code class="s1">'slug'</code>           <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">34 </code>            <code class="s1">'categories'</code>     <code class="o">=&gt;</code> <code class="s1">'required'</code>
<code class="linenos">35 </code>        <code class="p">];</code>
<code class="linenos">36 </code>    <code class="p">}</code>
<code class="linenos">37 </code>
<code class="linenos">38 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">messages</code><code class="p">()</code>
<code class="linenos">39 </code>    <code class="p">{</code>
<code class="linenos">40 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">41 </code>            <code class="s1">'required'</code> <code class="o">=&gt;</code> <code class="s1">'Este campo é obrigatório'</code><code class="p">,</code>
<code class="linenos">42 </code>            <code class="s1">'min'</code>      <code class="o">=&gt;</code> <code class="s1">'Sua descrição deve ter pelo menos :min caracteres'</code>
<code class="linenos">43 </code>        <code class="p">];</code>
<code class="linenos">44 </code>    <code class="p">}</code>
<code class="linenos">45 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Veja também o CategoryRequest e o LoginRequest já com o método <code>messages</code> adicionado:</p>

<p><b>CategoryRequest</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">CategoryRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">26 </code>            <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="s1">'required'</code><code class="p">,</code>
<code class="linenos">27 </code>            <code class="s1">'description'</code> <code class="o">=&gt;</code> <code class="s1">'nullable|min:20'</code><code class="p">,</code>
<code class="linenos">28 </code>            <code class="s1">'slug'</code> <code class="o">=&gt;</code> <code class="s1">'required'</code>
<code class="linenos">29 </code>        <code class="p">];</code>
<code class="linenos">30 </code>    <code class="p">}</code>
<code class="linenos">31 </code>
<code class="linenos">32 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">messages</code><code class="p">()</code>
<code class="linenos">33 </code>    <code class="p">{</code>
<code class="linenos">34 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">35 </code>            <code class="s1">'required'</code> <code class="o">=&gt;</code> <code class="s1">'Este campo é obrigatório'</code><code class="p">,</code>
<code class="linenos">36 </code>            <code class="s1">'min'</code>      <code class="o">=&gt;</code> <code class="s1">'Sua descrição deve ter pelo menos :min caracteres'</code>
<code class="linenos">37 </code>        <code class="p">];</code>
<code class="linenos">38 </code>    <code class="p">}</code>
<code class="linenos">39 </code><code class="p">}</code>
</pre></div>

</figure>


<p><b>LoginRequest</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code>\<code class="n">Auth</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">LoginRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">26 </code>            <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="p">[</code><code class="s1">'required'</code><code class="p">,</code> <code class="s1">'string'</code><code class="p">,</code> <code class="s1">'email'</code><code class="p">],</code>
<code class="linenos">27 </code>            <code class="s1">'password'</code> <code class="o">=&gt;</code> <code class="p">[</code><code class="s1">'required'</code><code class="p">,</code> <code class="s1">'string'</code><code class="p">],</code>
<code class="linenos">28 </code>        <code class="p">];</code>
<code class="linenos">29 </code>    <code class="p">}</code>
<code class="linenos">30 </code>
<code class="linenos">31 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">messages</code><code class="p">()</code>
<code class="linenos">32 </code>    <code class="p">{</code>
<code class="linenos">33 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">34 </code>            <code class="s1">'required'</code> <code class="o">=&gt;</code> <code class="s1">'Este campo é obrigatório'</code><code class="p">,</code>
<code class="linenos">35 </code>            <code class="s1">'min'</code>      <code class="o">=&gt;</code> <code class="s1">'Sua descrição deve ter pelo menos :min caracteres'</code><code class="p">,</code>
<code class="linenos">36 </code>            <code class="s1">'email'</code>    <code class="o">=&gt;</code> <code class="s1">'Digite um e-mail válido'</code>
<code class="linenos">37 </code>        <code class="p">];</code>
<code class="linenos">38 </code>    <code class="p">}</code>
<code class="linenos">39 </code><code class="p">}</code>
</pre></div>

</figure>


<h2 id="leanpub-auto-concluses-9" class="section">Conclusões</h2>

<p>Neste capítulo nós conhecemos as principais formas de trabalho com validações de dados dentro do Laravel, em particular utilizando os Forms Request que facilitam muito, tanto na concentração da validação e execução desta validação, quanto na organização dos participantes, onde tiramos do nosso controller este detalhe e isolando diretamente na classe Form Request.</p>

<p>O Laravel possui diversos validadores e as possibilidades são imensas, além da simplificidade e facilidade na utilização destes recursos e foi o que vimos aqui. Vamos ao próximo capítulo para trabalharmos a parte de upload dentro do Laravel, onde vamos adicionar o upload das fotos do produto.</p>

<p>Então, até o próximo capítulo!</p>


<h1 id="leanpub-auto-upload-de-arquivos" class="chapter">Upload de Arquivos</h1>

<p>Neste capítulo vamos entender como funciona o upload de arquivos no Laravel, criando o upload das fotos do produto além de entender um pouco do funcionamento geral e configurações de upload no Laravel.</p>

<h2 id="leanpub-auto-conhecendo-upload-no-laravel" class="section">Conhecendo Upload no Laravel</h2>

<p>Primeiramente podemos recuperar um arquivo, vindo de um input do tipo <code>file</code>, usando o método do request, o método <code>file</code>. Por exemplo: quando enviarmos lá da tela de editar o produto o campo fotos, podemos recuperar as informações como abaixo.</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">photos</code> <code class="o">=</code> <code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">file</code><code class="p">(</code><code class="s">'photos'</code><code class="p">);</code>
</pre></div>

</figure>


<p>Poderíamos acessar também como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">photos</code> <code class="o">=</code> <code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">photos</code><code class="p">;</code>
</pre></div>

</figure>


<p>Este método irá retornar um objeto do tipo <code>Illuminate\Http\UploadedFile</code> com as informações do aquivo enviado. Onde poderemos recuperar diversas informações, como por exemplo o nome real do arquivo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">avatar</code><code class="o">-&gt;</code><code class="n">getClientOriginalName</code><code class="p">();</code>
</pre></div>

</figure>


<p>Ou mesmo a extensão do arquivo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">avatar</code><code class="o">-&gt;</code><code class="n">extension</code><code class="p">();</code>
</pre></div>

</figure>


<p>Podemos de cara já realizar o upload  deste arquivo, sem muito esforço, simplesmente chamando o método <code>store</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">path</code> <code class="o">=</code> <code class="err">$</code><code class="n">avatar</code><code class="o">-&gt;</code><code class="kr">store</code><code class="p">(</code><code class="s">'products/photos'</code><code class="p">);</code>
</pre></div>

</figure>


<p>O método <code>store</code> por padrão pegará o caminho do drive default configurado lá no <code>filesystems.php</code> dentro da pasta <code>config</code> do projeto. E moverá a imagem para esta pasta padrão, criando a pasta <code>products/photos</code> se ela não existir e jogando nesta pasta nossos uploads.</p>

<p>O Laravel já manda o arquivo com um nome modificado via hash para evitar conflitos de nome. O caminho padrão é <code>storage/app/private</code> mas se você quiser salvar em outro caminho, por disco, como é chamado a configuração, você precisa informar o segundo parâmetro.</p>

<p>Por exemplo, vamos salvar as imagens no public da storage onde futuramente linkaremos com a pasta public do projeto. O disco que representa este caminho é chamado de <code>public</code> que aponta para <code>storage/app/public</code> e se quisermos referenciar ele, temos que chamar como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">ref</code> <code class="o">=</code> <code class="err">$</code><code class="n">photo</code><code class="o">-&gt;</code><code class="kr">store</code><code class="p">(</code><code class="s">'products/photos'</code><code class="p">,</code> <code class="s">'public'</code><code class="p">);</code>
</pre></div>

</figure>


<p>O retorno do método <code>store</code> é o nome da imagem mais a pasta, por exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>products/photos/loWy0OYzb5CDoyMEN1QGQ86jlyMCvJJmOfEDa5Ue.jpeg
</pre></div>

</figure>


<p>Esse nome + caminho é o que salvaremos na coluna photo da tabela <code>product_photos</code>. Agora vamos conhecer as configurações de armazenamento lá no <code>filesystems.php</code>.</p>

<p><b>config/filesystems.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">return</code> <code class="p">[</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="cm">/*</code>
<code class="linenos"> 6 </code><code class="cm">    |--------------------------------------------------------------------------</code>
<code class="linenos"> 7 </code><code class="cm">    | Default Filesystem Disk</code>
<code class="linenos"> 8 </code><code class="cm">    |--------------------------------------------------------------------------</code>
<code class="linenos"> 9 </code><code class="cm">    |</code>
<code class="linenos">10 </code><code class="cm">    | Here you may specify the default filesystem disk that should be used</code>
<code class="linenos">11 </code><code class="cm">    | by the framework. The "local" disk, as well as a variety of cloud</code>
<code class="linenos">12 </code><code class="cm">    | based disks are available to your application for file storage.</code>
<code class="linenos">13 </code><code class="cm">    |</code>
<code class="linenos">14 </code><code class="cm">    */</code>
<code class="linenos">15 </code>
<code class="linenos">16 </code>    <code class="s1">'default'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'FILESYSTEM_DISK'</code><code class="p">,</code> <code class="s1">'local'</code><code class="p">),</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="cm">/*</code>
<code class="linenos">19 </code><code class="cm">    |--------------------------------------------------------------------------</code>
<code class="linenos">20 </code><code class="cm">    | Filesystem Disks</code>
<code class="linenos">21 </code><code class="cm">    |--------------------------------------------------------------------------</code>
<code class="linenos">22 </code><code class="cm">    |</code>
<code class="linenos">23 </code><code class="cm">    | Below you may configure as many filesystem disks as necessary, and you</code>
<code class="linenos">24 </code><code class="cm">    | may even configure multiple disks for the same driver. Examples for</code>
<code class="linenos">25 </code><code class="cm">    | most supported storage drivers are configured here for reference.</code>
<code class="linenos">26 </code><code class="cm">    |</code>
<code class="linenos">27 </code><code class="cm">    | Supported drivers: "local", "ftp", "sftp", "s3"</code>
<code class="linenos">28 </code><code class="cm">    |</code>
<code class="linenos">29 </code><code class="cm">    */</code>
<code class="linenos">30 </code>
<code class="linenos">31 </code>    <code class="s1">'disks'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos">32 </code>
<code class="linenos">33 </code>        <code class="s1">'local'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos">34 </code>            <code class="s1">'driver'</code> <code class="o">=&gt;</code> <code class="s1">'local'</code><code class="p">,</code>
<code class="linenos">35 </code>            <code class="s1">'root'</code> <code class="o">=&gt;</code> <code class="nx">storage_path</code><code class="p">(</code><code class="s1">'app/private'</code><code class="p">),</code>
<code class="linenos">36 </code>            <code class="s1">'serve'</code> <code class="o">=&gt;</code> <code class="k">true</code><code class="p">,</code>
<code class="linenos">37 </code>            <code class="s1">'throw'</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>
<code class="linenos">38 </code>            <code class="s1">'report'</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>
<code class="linenos">39 </code>        <code class="p">],</code>
<code class="linenos">40 </code>
<code class="linenos">41 </code>        <code class="s1">'public'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos">42 </code>            <code class="s1">'driver'</code> <code class="o">=&gt;</code> <code class="s1">'local'</code><code class="p">,</code>
<code class="linenos">43 </code>            <code class="s1">'root'</code> <code class="o">=&gt;</code> <code class="nx">storage_path</code><code class="p">(</code><code class="s1">'app/public'</code><code class="p">),</code>
<code class="linenos">44 </code>            <code class="s1">'url'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'APP_URL'</code><code class="p">)</code><code class="o">.</code><code class="s1">'/storage'</code><code class="p">,</code>
<code class="linenos">45 </code>            <code class="s1">'visibility'</code> <code class="o">=&gt;</code> <code class="s1">'public'</code><code class="p">,</code>
<code class="linenos">46 </code>            <code class="s1">'throw'</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>
<code class="linenos">47 </code>            <code class="s1">'report'</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>
<code class="linenos">48 </code>        <code class="p">],</code>
<code class="linenos">49 </code>
<code class="linenos">50 </code>        <code class="s1">'s3'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos">51 </code>            <code class="s1">'driver'</code> <code class="o">=&gt;</code> <code class="s1">'s3'</code><code class="p">,</code>
<code class="linenos">52 </code>            <code class="s1">'key'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'AWS_ACCESS_KEY_ID'</code><code class="p">),</code>
<code class="linenos">53 </code>            <code class="s1">'secret'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'AWS_SECRET_ACCESS_KEY'</code><code class="p">),</code>
<code class="linenos">54 </code>            <code class="s1">'region'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'AWS_DEFAULT_REGION'</code><code class="p">),</code>
<code class="linenos">55 </code>            <code class="s1">'bucket'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'AWS_BUCKET'</code><code class="p">),</code>
<code class="linenos">56 </code>            <code class="s1">'url'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'AWS_URL'</code><code class="p">),</code>
<code class="linenos">57 </code>            <code class="s1">'endpoint'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'AWS_ENDPOINT'</code><code class="p">),</code>
<code class="linenos">58 </code>            <code class="s1">'use_path_style_endpoint'</code> <code class="o">=&gt;</code> <code class="nx">env</code><code class="p">(</code><code class="s1">'AWS_USE_PATH_STYLE_ENDPOINT'</code><code class="p">,</code> <code class="k">false</code><code class="p">),</code>
<code class="linenos">59 </code>            <code class="s1">'throw'</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>
<code class="linenos">60 </code>            <code class="s1">'report'</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>
<code class="linenos">61 </code>        <code class="p">],</code>
<code class="linenos">62 </code>
<code class="linenos">63 </code>    <code class="p">],</code>
<code class="linenos">64 </code>
<code class="linenos">65 </code>    <code class="cm">/*</code>
<code class="linenos">66 </code><code class="cm">    |--------------------------------------------------------------------------</code>
<code class="linenos">67 </code><code class="cm">    | Symbolic Links</code>
<code class="linenos">68 </code><code class="cm">    |--------------------------------------------------------------------------</code>
<code class="linenos">69 </code><code class="cm">    |</code>
<code class="linenos">70 </code><code class="cm">    | Here you may configure the symbolic links that will be created when the</code>
<code class="linenos">71 </code><code class="cm">    | `storage:link` Artisan command is executed. The array keys should be</code>
<code class="linenos">72 </code><code class="cm">    | the locations of the links and the values should be their targets.</code>
<code class="linenos">73 </code><code class="cm">    |</code>
<code class="linenos">74 </code><code class="cm">    */</code>
<code class="linenos">75 </code>
<code class="linenos">76 </code>    <code class="s1">'links'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos">77 </code>        <code class="nx">public_path</code><code class="p">(</code><code class="s1">'storage'</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">storage_path</code><code class="p">(</code><code class="s1">'app/public'</code><code class="p">),</code>
<code class="linenos">78 </code>    <code class="p">],</code>
<code class="linenos">79 </code>
<code class="linenos">80 </code><code class="p">];</code>
</pre></div>

</figure>


<p>Perceba que temos a chave default logo de cara, que espera o valor vindo lá do .env na variável <code>FILESYSTEM_DISK</code>, se ela não existir lá no .env, teremos por padrão o valor <code>local</code> como disco para salvarmos nossos arquivos.</p>

<p>Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>'default' =&gt; env('FILESYSTEM_DISK', 'local'),
</pre></div>

</figure>


<p>Logo, seguindo pelo arquivo, temos os discos (<b>disks</b>) disponíveis e configurados para armazenamento de arquivos. São eles:</p>

<ul>
  <li>
<b>local</b>: pasta <code>app/private</code> dentro de <code>storage</code>;</li>
  <li>
<b>public</b>: pasta <code>app/public</code> dentro de <code>storage</code>;</li>
  <li>
<b>s3</b>: S3 AWS, configurações extras do seu bucket <code>S3</code> serão necessárias para armazenamento na nuvem.</li>
</ul>

<p>Veja os discos abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">'</code><code class="n">disks</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code>    <code class="p">'</code><code class="n">local</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos"> 4 </code>        <code class="p">'</code><code class="n">driver</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">'</code><code class="n">local</code><code class="p">',</code>
<code class="linenos"> 5 </code>        <code class="p">'</code><code class="n">root</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">storage_path</code><code class="p">('</code><code class="n">app</code><code class="o">/</code><code class="n">private</code><code class="p">'),</code>
<code class="linenos"> 6 </code>        <code class="p">'</code><code class="n">serve</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">true</code><code class="p">,</code>
<code class="linenos"> 7 </code>        <code class="p">'</code><code class="n">throw</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">false</code><code class="p">,</code>
<code class="linenos"> 8 </code>        <code class="p">'</code><code class="n">report</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">false</code><code class="p">,</code>
<code class="linenos"> 9 </code>    <code class="p">],</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="p">'</code><code class="n">public</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos">12 </code>        <code class="p">'</code><code class="n">driver</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">'</code><code class="n">local</code><code class="p">',</code>
<code class="linenos">13 </code>        <code class="p">'</code><code class="n">root</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">storage_path</code><code class="p">('</code><code class="n">app</code><code class="o">/</code><code class="n">public</code><code class="p">'),</code>
<code class="linenos">14 </code>        <code class="p">'</code><code class="n">url</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">env</code><code class="p">('</code><code class="n">APP_URL</code><code class="p">').'</code><code class="o">/</code><code class="n">storage</code><code class="p">',</code>
<code class="linenos">15 </code>        <code class="p">'</code><code class="n">visibility</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">'</code><code class="n">public</code><code class="p">',</code>
<code class="linenos">16 </code>        <code class="p">'</code><code class="n">throw</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">false</code><code class="p">,</code>
<code class="linenos">17 </code>        <code class="p">'</code><code class="n">report</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">false</code><code class="p">,</code>
<code class="linenos">18 </code>    <code class="p">],</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>    <code class="p">'</code><code class="n">s3</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">[</code>
<code class="linenos">21 </code>        <code class="p">'</code><code class="n">driver</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="p">'</code><code class="n">s3</code><code class="p">',</code>
<code class="linenos">22 </code>        <code class="p">'</code><code class="n">key</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">env</code><code class="p">('</code><code class="n">AWS_ACCESS_KEY_ID</code><code class="p">'),</code>
<code class="linenos">23 </code>        <code class="p">'</code><code class="n">secret</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">env</code><code class="p">('</code><code class="n">AWS_SECRET_ACCESS_KEY</code><code class="p">'),</code>
<code class="linenos">24 </code>        <code class="p">'</code><code class="n">region</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">env</code><code class="p">('</code><code class="n">AWS_DEFAULT_REGION</code><code class="p">'),</code>
<code class="linenos">25 </code>        <code class="p">'</code><code class="n">bucket</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">env</code><code class="p">('</code><code class="n">AWS_BUCKET</code><code class="p">'),</code>
<code class="linenos">26 </code>        <code class="p">'</code><code class="n">url</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">env</code><code class="p">('</code><code class="n">AWS_URL</code><code class="p">'),</code>
<code class="linenos">27 </code>        <code class="p">'</code><code class="n">endpoint</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">env</code><code class="p">('</code><code class="n">AWS_ENDPOINT</code><code class="p">'),</code>
<code class="linenos">28 </code>        <code class="p">'</code><code class="n">use_path_style_endpoint</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">env</code><code class="p">('</code><code class="n">AWS_USE_PATH_STYLE_ENDPOINT</code><code class="p">',</code> <code class="n">false</code><code class="p">),</code>
<code class="linenos">29 </code>        <code class="p">'</code><code class="n">throw</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">false</code><code class="p">,</code>
<code class="linenos">30 </code>        <code class="p">'</code><code class="n">report</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">false</code><code class="p">,</code>
<code class="linenos">31 </code>    <code class="p">],</code>
<code class="linenos">32 </code><code class="p">],</code>
</pre></div>

</figure>


<p>Cada um têm o nome do driver, o caminho, url e a visibilidade, entretanto, o S3, como é um servidor e serviço remoto e ainda privado necessita de configurações extras para que você possa realizar o upload neste disco.</p>

<p>Na última configuração do arquivo, temos a possibilidade de definir caminhos para a linkagem desses caminhos na pasta public do projeto usando o comando:<code>php artisan storage:link</code>. Realizaremos este processo mais a frente mas se você quiser que mais links simbólicos sejam criados no momento desta execução, você pode especificar o caminho no array de configuração abaixo. Sendo a chave o caminho do link simbólico e o valor o caminho para onde link simbólico apontará:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>'links' =&gt; [
<code class="linenos">2 </code>    public_path('storage') =&gt; storage_path('app/public'),
<code class="linenos">3 </code>],
</pre></div>

</figure>


<p>Perceba que a config já traz a possibilidade de criarmos um link simbólico chamado de <code>storage</code> na pasta public do projeto e este link simbólico apontará para, a partir da raiz do projeto, <code>storage/app/public</code>.</p>

<h2 id="leanpub-auto-upload-fotos-produto" class="section">Upload Fotos Produto</h2>

<p>Vamos a adição dos uploads para as fotos do produto. Insumos que formos precisando e que eu já tiver comentado em outros capítulos irei apenas deixar os códigos aqui para leitura e cópia.</p>

<p>Primeiramente vamos criar um controller exclusivo para as fotos do produto. Criamos nosso controller com o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller Admin/ProductPhotoController
</pre></div>

</figure>


<p>Aproveite e já crie um form request para adicionarmos as validações para as fotos enviadas via upload. Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:request ProductPhotoRequest
</pre></div>

</figure>


<p>Veja o conteúdo do request recém criada, onde adicionamos para o campo foto a validação para images:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">ProductPhotoRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">26 </code>            <code class="s1">'photos.*'</code> <code class="o">=&gt;</code> <code class="p">[</code><code class="s1">'image'</code><code class="p">]</code>
<code class="linenos">27 </code>        <code class="p">];</code>
<code class="linenos">28 </code>    <code class="p">}</code>
<code class="linenos">29 </code>
<code class="linenos">30 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">messages</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">31 </code>    <code class="p">{</code>
<code class="linenos">32 </code>        <code class="k">return</code><code class="p">[</code>
<code class="linenos">33 </code>            <code class="s1">'image'</code> <code class="o">=&gt;</code> <code class="s1">'Existe uma imagem inválida dentre as que você está tentando </code><code class="se">\</code>
<code class="linenos">34 </code><code class="s1">enviar...'</code>
<code class="linenos">35 </code>        <code class="p">];</code>
<code class="linenos">36 </code>    <code class="p">}</code>
<code class="linenos">37 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Aqui entra um pequeno detalhe importante. Como vamos receber um array com várias imagens por conta da possibilidade de escolha de múltiplas fotos, precisamos informar a notação <code>.*</code> na chave <code>photos</code>. Essa notação indica ao Laravel que valide individualmente cada arquivo no array que virá, via requisição, contendo as fotos escolhidas.</p>

<p>Vamos começar a montar nosso controller. Aqui teremos mais do que já vimos então serei bem direto nos pontos mostrados aqui. Segue nosso index no ProductPhotoController:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">(</code><code class="n">Product</code> <code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'products.photos-upload'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'product'</code><code class="p">));</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Aqui têm um ponto importante, como vamos aninhar as rotas de fotos sob as rotas de produtos vamos precisar sempre da referência do Produto pai referente ao processo feito com a(s) foto(s).</p>

<p>Vamos ao nosso método store:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">store</code><code class="o">(</code><code class="nt">Product</code> <code class="o">$</code><code class="nt">product</code><code class="o">,</code> <code class="nt">ProductPhotoRequest</code> <code class="o">$</code><code class="nt">request</code><code class="o">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$photos</code> <code class="err">=</code> <code class="err">$request-&gt;validated('photos')</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="err">if(!$photos)</code> <code class="err">{</code>
<code class="linenos"> 6 </code>        <code class="err">throw</code> <code class="n">ValidationException</code><code class="p">:</code><code class="o">:</code><code class="nf">withMessages</code><code class="p">(</code><code class="cp">[</code>
<code class="linenos"> 7 </code>            <code class="s1">'photos.*'</code> <code class="o">=&gt;</code> <code class="s1">'Selecione as fotos pro produto primeiro...'</code><code class="p">,</code>
<code class="linenos"> 8 </code>        <code class="cp">]</code><code class="p">);</code>
<code class="linenos"> 9 </code>    <code class="p">}</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="o">$</code><code class="nt">photosReference</code> <code class="o">=</code> <code class="cp">[]</code><code class="o">;</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="nt">foreach</code><code class="o">($</code><code class="nt">photos</code> <code class="nt">as</code> <code class="o">$</code><code class="nt">photo</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">14 </code>        <code class="err">$photosReference</code><code class="cp">[]</code> <code class="err">=</code> <code class="cp">[</code><code class="s1">'photo'</code> <code class="o">=&gt;</code> <code class="nv">$photo</code><code class="o">-&gt;</code><code class="nx nx-Member">store</code><code class="p">(</code><code class="s1">'product/photos'</code><code class="p">,</code> <code class="s1">'public'</code><code class="p">)</code><code class="cp">]</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">$</code><code class="nt">product-</code><code class="o">&gt;</code><code class="nt">photos</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">createMany</code><code class="o">($</code><code class="nt">photosReference</code><code class="o">);</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="nt">session</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">flash</code><code class="o">(</code><code class="s1">'success'</code><code class="o">,</code> <code class="s1">'Fotos upada com sucesso!'</code><code class="o">);</code>
<code class="linenos">20 </code>    <code class="nt">return</code> <code class="nt">redirect</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">back</code><code class="o">();</code>
<code class="linenos">21 </code><code class="err">}</code>
</pre></div>

</figure>


<p>No trecho acima faço uma validação para o não envio de fotos, por alguma razão a notação de <code>.*</code> não pega no array vazio pro required e individualmente em cada linha. Poderia fazer de outras formas mas esta resolve bem e é algo que já usamos lá no login.</p>

<p>Como recebemos um array de fotos, iteramos sob este array e realizamos o upload como comentado lá no ínicio do capítulo. Aqui têm um ponto bem importante, perceba que monto um array com o retorno do método store e armazeno isso na chave ‘photo’ e criando uma lista de arrays com o formato abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>[
<code class="linenos">2 </code>    ['photo' =&gt; '...'],
<code class="linenos">3 </code>    ['photo' =&gt; '...'],
<code class="linenos">4 </code>]
</pre></div>

</figure>


<p>Dessa forma consigo utilizar o método createMany através do método de ligação do produto com fotos. O método <code>createMany</code> me permite criar vários dados de uma vez, respeitando a mesma ideia do create mas contendo uma coleção de arrays e inserindo todos de uma vez.</p>

<p>Basea-se no array exemplo que mostrei acima, onde teremos todas as fotos(referência) salvas na base e já pegando o ID do Produto pai por conta da ligação.</p>

<blockquote>
  <p>PS.: Perceba que aqui já começo a colocar as mensagens na sessão flash e mais a frente iremos criar nosso trecho de exibição dessas mensagens nas telas.</p>
</blockquote>

<p>Vamos ao método <code>destroy</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">destroy</code><code class="o">(</code><code class="nt">Product</code> <code class="o">$</code><code class="nt">product</code><code class="o">,</code> <code class="nt">string</code> <code class="o">$</code><code class="nt">photo</code><code class="o">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$photo</code> <code class="err">=</code> <code class="err">$product-&gt;photos()-&gt;findOrFail($photo)</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="err">$disk</code> <code class="err">=</code> <code class="n">Storage</code><code class="p">:</code><code class="o">:</code><code class="nf">disk</code><code class="p">(</code><code class="s1">'public'</code><code class="p">);</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="err">if($disk-&gt;exists($photo-&gt;photo))</code> <code class="err">{</code>
<code class="linenos"> 8 </code>        <code class="err">$disk-&gt;delete($photo-&gt;photo)</code><code class="p">;</code>
<code class="linenos"> 9 </code>    <code class="p">}</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="o">$</code><code class="nt">photo-</code><code class="o">&gt;</code><code class="nt">delete</code><code class="o">();</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="nt">session</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">flash</code><code class="o">(</code><code class="s1">'success'</code><code class="o">,</code> <code class="s1">'Foto removida com sucesso!'</code><code class="o">);</code>
<code class="linenos">14 </code>    <code class="nt">return</code> <code class="nt">redirect</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">back</code><code class="o">();</code>
<code class="linenos">15 </code><code class="err">}</code>
</pre></div>

</figure>


<p>Aqui buscamos a fotos por meio da ligação com produto, e o processo de remoção envolve: </p>

<ul>
  <li>Remover a foto da pasta;</li>
  <li>Remover a referência do banco de dados.</li>
</ul>

<p>O método do Storage é bem descritivo, onde podemos escolher um disco e realizar checks e ações nos arquivos deste disco. Aqui verificamos a existência da imagem no disco <code>public</code> e existindo remover ela com o método <code>delete</code> e passando a referência da imagem salva na coluna <code>photo</code>.</p>

<p>Segue abaixo o controller na íntegra para consulta e verificação dos imports também:</p>

<p><code>ProductPhotoController</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Admin</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code>\<code class="n">ProductPhotoRequest</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">Product</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Validation</code>\<code class="n">ValidationException</code><code class="p">;</code>
<code class="linenos"> 9 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos">10 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">Facades</code>\<code class="n">Storage</code><code class="p">;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code><code class="k">class</code> <code class="n">ProductPhotoController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">13 </code><code class="p">{</code>
<code class="linenos">14 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">(</code><code class="n">Product</code> <code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'products.photos-upload'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'product'</code><code class="p">));</code>
<code class="linenos">17 </code>    <code class="p">}</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">store</code><code class="p">(</code><code class="n">Product</code> <code class="o">$</code><code class="n">product</code><code class="p">,</code> <code class="n">ProductPhotoRequest</code> <code class="o">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos">20 </code>    <code class="p">{</code>
<code class="linenos">21 </code>        <code class="o">$</code><code class="n">photos</code> <code class="o">=</code> <code class="o">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">validated</code><code class="p">(</code><code class="s1">'photos'</code><code class="p">);</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>        <code class="k">if</code><code class="p">(</code><code class="o">!$</code><code class="n">photos</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">24 </code>            <code class="n">throw</code> <code class="n">ValidationException</code><code class="p">::</code><code class="n">withMessages</code><code class="p">([</code>
<code class="linenos">25 </code>                <code class="s1">'photos.*'</code> <code class="o">=&gt;</code> <code class="s1">'Selecione as fotos pro produto primeiro...'</code><code class="p">,</code>
<code class="linenos">26 </code>            <code class="p">]);</code>
<code class="linenos">27 </code>        <code class="p">}</code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>        <code class="o">$</code><code class="n">photosReference</code> <code class="o">=</code> <code class="p">[];</code>
<code class="linenos">30 </code>
<code class="linenos">31 </code>        <code class="n">foreach</code><code class="p">(</code><code class="o">$</code><code class="n">photos</code> <code class="k">as</code> <code class="o">$</code><code class="n">photo</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">32 </code>            <code class="o">$</code><code class="n">photosReference</code><code class="p">[]</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'photo'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">photo</code><code class="o">-&gt;</code><code class="n">store</code><code class="p">(</code><code class="s1">'product/photos'</code><code class="p">,</code> <code class="s1">'public</code><code class="se">\</code>
<code class="linenos">33 </code><code class="s1">'</code><code class="p">)];</code>
<code class="linenos">34 </code>        <code class="p">}</code>
<code class="linenos">35 </code>
<code class="linenos">36 </code>        <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">photos</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">createMany</code><code class="p">(</code><code class="o">$</code><code class="n">photosReference</code><code class="p">);</code>
<code class="linenos">37 </code>
<code class="linenos">38 </code>        <code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">flash</code><code class="p">(</code><code class="s1">'success'</code><code class="p">,</code> <code class="s1">'Fotos upada com sucesso!'</code><code class="p">);</code>
<code class="linenos">39 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">back</code><code class="p">();</code>
<code class="linenos">40 </code>    <code class="p">}</code>
<code class="linenos">41 </code>
<code class="linenos">42 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">destroy</code><code class="p">(</code><code class="n">Product</code> <code class="o">$</code><code class="n">product</code><code class="p">,</code> <code class="n">string</code> <code class="o">$</code><code class="n">photo</code><code class="p">)</code>
<code class="linenos">43 </code>    <code class="p">{</code>
<code class="linenos">44 </code>        <code class="o">$</code><code class="n">photo</code> <code class="o">=</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">photos</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">findOrFail</code><code class="p">(</code><code class="o">$</code><code class="n">photo</code><code class="p">);</code>
<code class="linenos">45 </code>
<code class="linenos">46 </code>        <code class="o">$</code><code class="n">disk</code> <code class="o">=</code> <code class="n">Storage</code><code class="p">::</code><code class="n">disk</code><code class="p">(</code><code class="s1">'public'</code><code class="p">);</code>
<code class="linenos">47 </code>
<code class="linenos">48 </code>        <code class="k">if</code><code class="p">(</code><code class="o">$</code><code class="n">disk</code><code class="o">-&gt;</code><code class="n">exists</code><code class="p">(</code><code class="o">$</code><code class="n">photo</code><code class="o">-&gt;</code><code class="n">photo</code><code class="p">))</code> <code class="p">{</code>
<code class="linenos">49 </code>            <code class="o">$</code><code class="n">disk</code><code class="o">-&gt;</code><code class="n">delete</code><code class="p">(</code><code class="o">$</code><code class="n">photo</code><code class="o">-&gt;</code><code class="n">photo</code><code class="p">);</code>
<code class="linenos">50 </code>        <code class="p">}</code>
<code class="linenos">51 </code>
<code class="linenos">52 </code>        <code class="o">$</code><code class="n">photo</code><code class="o">-&gt;</code><code class="n">delete</code><code class="p">();</code>
<code class="linenos">53 </code>
<code class="linenos">54 </code>        <code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">flash</code><code class="p">(</code><code class="s1">'success'</code><code class="p">,</code> <code class="s1">'Foto removida com sucesso!'</code><code class="p">);</code>
<code class="linenos">55 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">back</code><code class="p">();</code>
<code class="linenos">56 </code>    <code class="p">}</code>
<code class="linenos">57 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Vamos para nossa tela de upload, depois adicionamos nossas rotas.</p>

<p>Nossa view da tela para upload conterá um pouco de javascript e muito tailwindcss. Recomendo fortemente que tente lê a parte das classes do tailwindcss para entender bem os estilos ali aplicados e como comentei anteriormente o tailwind é focado no baixo nível, cada classe está mais perto do que é o estilo do que outros frameworks css.</p>

<p>Deixo abaixo a view completo e vamos aos pontos importantes:</p>

<p>View - <code>resources/views/products/photos-upload.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">extends</code><code class="p">(</code><code class="err">'</code><code class="n">layouts</code><code class="p">.</code><code class="n">app</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="p">@</code><code class="n">section</code><code class="p">(</code><code class="err">'</code><code class="n">content</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"mb-10"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>        <code class="o">&amp;</code><code class="n">raquo</code><code class="p">;</code> <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{route('products.edit', ['product' =&gt; $product-&gt;id])}}"</code> <code class="n">cl</code>\
<code class="linenos"> 6 </code><code class="n">ass</code><code class="o">=</code><code class="s">"text-sm underline"</code><code class="o">&gt;</code><code class="n">Edição</code> <code class="n">Produto</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos"> 7 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mx-auto"</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>        <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('photos.store', ['product' =&gt; $product-&gt;id]) }}"</code> <code class="n">meth</code>\
<code class="linenos">10 </code><code class="n">od</code><code class="o">=</code><code class="s">"post"</code> <code class="n">enctype</code><code class="o">=</code><code class="s">"multipart/form-data"</code><code class="o">&gt;</code>
<code class="linenos">11 </code>            <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>                <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('photos.*') text-red-900 @enderror"</code><code class="o">&gt;</code>\
<code class="linenos">15 </code><code class="n">Selecione</code> <code class="n">as</code> <code class="n">fotos</code> <code class="k">do</code> <code class="n">produto</code> <code class="nl">abaixo</code><code class="p">:</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">16 </code>                <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"file"</code> <code class="n">name</code><code class="o">=</code><code class="s">"photos[]"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border \</code>
<code class="linenos">17 </code><code class="s">@error('photos.*') border-red-900 @else border-gray-900 @enderror"</code> <code class="n">multiple</code> <code class="n">required</code>\
<code class="linenos">18 </code><code class="o">&gt;</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>                <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">photos</code><code class="p">.</code><code class="o">*</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">21 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red\</code>
<code class="linenos">22 </code><code class="s">-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">23 </code>                <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">24 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">25 </code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>            <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded te\</code>
<code class="linenos">28 </code><code class="s">xt-white font-thin"</code><code class="o">&gt;</code><code class="n">Salvar</code> <code class="n">Fotos</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">29 </code>        <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">30 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">31 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mx-auto mt-10"</code><code class="o">&gt;</code>
<code class="linenos">32 </code>        <code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">photos</code><code class="o">-&gt;</code><code class="n">count</code><code class="p">())</code>
<code class="linenos">33 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"grid grid-cols-5 gap-x-3 border-t border-gray-400 py-4"</code><code class="o">&gt;</code>
<code class="linenos">34 </code>                <code class="p">@</code><code class="n">foreach</code><code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">photos</code> <code class="n">as</code> <code class="n">$photo</code><code class="p">)</code>
<code class="linenos">35 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"relative group"</code><code class="o">&gt;</code>
<code class="linenos">36 </code>                        <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{route('photos.destroy', ['product' =&gt; $produ\</code>
<code class="linenos">37 </code><code class="s">ct-&gt;id, 'photo' =&gt; $photo-&gt;id])}}"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"submitDestroy{{$photo-&gt;id}}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code><code class="p">@</code><code class="n">c</code>\
<code class="linenos">38 </code><code class="n">srf</code> <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code><code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">39 </code>
<code class="linenos">40 </code>                        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"absolute top-1 right-1 text-white bg-red-700 \</code>
<code class="linenos">41 </code><code class="s">p-2 rounded cursor-pointer hidden group-hover:block"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"destroyPhoto"</code> <code class="n">data</code><code class="o">-</code><code class="n">photo</code><code class="o">=</code><code class="s">"{\</code>
<code class="linenos">42 </code><code class="s">{$photo-&gt;id}}"</code><code class="o">&gt;</code>
<code class="linenos">43 </code>
<code class="linenos">44 </code>                            <code class="o">&lt;</code><code class="n">svg</code> <code class="n">xmlns</code><code class="o">=</code><code class="s">"http://www.w3.org/2000/svg"</code> <code class="n">fill</code><code class="o">=</code><code class="s">"none"</code> <code class="n">view</code>\
<code class="linenos">45 </code><code class="n">Box</code><code class="o">=</code><code class="s">"0 0 24 24"</code> <code class="n">stroke</code><code class="o">-</code><code class="n">width</code><code class="o">=</code><code class="s">"1.5"</code> <code class="n">stroke</code><code class="o">=</code><code class="s">"currentColor"</code> <code class="k">class</code><code class="o">=</code><code class="s">"size-6"</code><code class="o">&gt;</code>
<code class="linenos">46 </code>                                <code class="o">&lt;</code><code class="n">path</code> <code class="n">stroke</code><code class="o">-</code><code class="n">linecap</code><code class="o">=</code><code class="s">"round"</code> <code class="n">stroke</code><code class="o">-</code><code class="n">linejoin</code><code class="o">=</code><code class="s">"round"</code>\
<code class="linenos">47 </code> <code class="n">d</code><code class="o">=</code><code class="s">"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.16\</code>
<code class="linenos">48 </code><code class="s">5L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5\</code>
<code class="linenos">49 </code><code class="s">.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0\</code>
<code class="linenos">50 </code><code class="s">a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 \</code>
<code class="linenos">51 </code><code class="s">0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"</code> <code class="o">/</code>\
<code class="linenos">52 </code><code class="o">&gt;</code>
<code class="linenos">53 </code>                              <code class="o">&lt;/</code><code class="n">svg</code><code class="o">&gt;</code>
<code class="linenos">54 </code>
<code class="linenos">55 </code>                        <code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">56 </code>
<code class="linenos">57 </code>                        <code class="o">&lt;</code><code class="n">img</code> <code class="n">src</code><code class="o">=</code><code class="s">"{{asset('storage/' . $photo-&gt;photo)}}"</code> <code class="n">alt</code><code class="o">=</code><code class="s">""</code> <code class="n">clas</code>\
<code class="linenos">58 </code><code class="n">s</code><code class="o">=</code><code class="s">"p-1 rounded shadow bg-white"</code><code class="o">&gt;</code>
<code class="linenos">59 </code>                    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">60 </code>                <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">61 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">62 </code>        <code class="p">@</code><code class="k">else</code>
<code class="linenos">63 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-4 text-red-700"</code><code class="o">&gt;</code>
<code class="linenos">64 </code>            <code class="n">Sem</code> <code class="n">fotos</code> <code class="n">para</code> <code class="n">este</code> <code class="n">produto</code><code class="o">!</code>
<code class="linenos">65 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">66 </code>        <code class="p">@</code><code class="n">endif</code>
<code class="linenos">67 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">68 </code>
<code class="linenos">69 </code>    <code class="p">@</code><code class="n">push</code><code class="p">(</code><code class="err">'</code><code class="n">scripts</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">70 </code>    <code class="o">&lt;</code><code class="n">script</code><code class="o">&gt;</code>
<code class="linenos">71 </code>        <code class="k">const</code> <code class="n">button</code> <code class="o">=</code> <code class="n">document</code><code class="p">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="err">'</code><code class="n">button</code><code class="err">#</code><code class="n">destroyPhoto</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">72 </code>
<code class="linenos">73 </code>        <code class="n">button</code><code class="p">.</code><code class="n">forEach</code><code class="p">(</code><code class="n">el</code> <code class="o">=&gt;</code> <code class="p">{</code>
<code class="linenos">74 </code>            <code class="n">console</code><code class="p">.</code><code class="n">log</code><code class="p">(</code><code class="n">el</code><code class="p">)</code>
<code class="linenos">75 </code>            <code class="n">el</code><code class="p">.</code><code class="n">addEventListener</code><code class="p">(</code><code class="err">'</code><code class="n">click</code><code class="err">'</code><code class="p">,</code> <code class="n">e</code> <code class="o">=&gt;</code> <code class="p">{</code>
<code class="linenos">76 </code>                <code class="n">e</code><code class="p">.</code><code class="n">preventDefault</code><code class="p">();</code>
<code class="linenos">77 </code>
<code class="linenos">78 </code>                <code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="n">confirm</code><code class="p">(</code><code class="err">'</code><code class="n">Deseja</code> <code class="n">mesmo</code> <code class="n">remover</code> <code class="n">a</code> <code class="n">foto</code><code class="o">?</code><code class="err">'</code><code class="p">))</code> <code class="k">return</code><code class="p">;</code>
<code class="linenos">79 </code>
<code class="linenos">80 </code>                <code class="k">const</code> <code class="n">photoId</code> <code class="o">=</code> <code class="n">el</code><code class="p">.</code><code class="n">dataset</code><code class="p">.</code><code class="n">photo</code><code class="p">;</code>
<code class="linenos">81 </code>
<code class="linenos">82 </code>                <code class="n">document</code><code class="p">.</code><code class="n">querySelector</code><code class="p">(</code><code class="err">`</code><code class="n">form</code><code class="err">#</code><code class="n">submitDestroy$</code><code class="p">{</code><code class="n">photoId</code><code class="p">}</code><code class="err">`</code><code class="p">).</code><code class="n">submit</code><code class="p">();</code>
<code class="linenos">83 </code>            <code class="p">})</code>
<code class="linenos">84 </code>        <code class="p">});</code>
<code class="linenos">85 </code>    <code class="o">&lt;/</code><code class="n">script</code><code class="o">&gt;</code>
<code class="linenos">86 </code>    <code class="p">@</code><code class="n">endpush</code>
<code class="linenos">87 </code><code class="p">@</code><code class="n">endsection</code>
</pre></div>

</figure>


<p>Um panorâma geral dessa tela, nela temos tanto o formulário para upload como a listagem das fotos deste produto. As fotos do produto pego a partir da referência via ligação.</p>

<p>Vou destacar abaixo inicialmente o formulário da página:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('photos.store', ['product' =&gt; $product-&gt;id]) }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post\</code>
<code class="linenos"> 2 </code><code class="s">"</code> <code class="n">enctype</code><code class="o">=</code><code class="s">"multipart/form-data"</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>    <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>        <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mb-2 @error('photos.*') text-red-900 @enderror"</code><code class="o">&gt;</code><code class="n">Selecion</code>\
<code class="linenos"> 7 </code><code class="n">e</code> <code class="n">as</code> <code class="n">fotos</code> <code class="k">do</code> <code class="n">produto</code> <code class="nl">abaixo</code><code class="p">:</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>        <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"file"</code> <code class="n">name</code><code class="o">=</code><code class="s">"photos[]"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border @error('\</code>
<code class="linenos"> 9 </code><code class="s">photos.*') border-red-900 @else border-gray-900 @enderror"</code> <code class="n">multiple</code> <code class="n">required</code><code class="o">&gt;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>        <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">photos</code><code class="p">.</code><code class="o">*</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">12 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg-red-400 tex\</code>
<code class="linenos">13 </code><code class="s">t-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">14 </code>        <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">15 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 bg-green-700 border border-green-900 rounded text-white\</code>
<code class="linenos">19 </code><code class="s"> font-thin"</code><code class="o">&gt;</code><code class="n">Salvar</code> <code class="n">Fotos</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">20 </code><code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>Perceba que na diretiva <code>@error</code> chamo exatamente a chave como usei na validação: <code>photos.*</code>. Desta forma pegamos a mensagem corretamente para a validação dos itens como imagem válidas.</p>

<p>Nosso input permite upload múltiple por meio do atributo <code>multiple</code> e o nome do nosso input respeita a notação para enviarmos os itens como array na requisição: <code>name="photos[]"</code>.</p>

<p>Acima destaquei os principais pontos, não esqueça de pegar o trecho e executar localmente e entender ou rever mais nuances aqui existentes neta tela.</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tela-upload.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>A tela ainda possui um trecho onde exibimos as imagens, se existirem, para o produto escolhido. Vamos ao trecho:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">photos</code><code class="o">-&gt;</code><code class="n">count</code><code class="p">())</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"grid grid-cols-5 gap-x-3 border-t border-gray-400 py-4"</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>        <code class="p">@</code><code class="n">foreach</code><code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">photos</code> <code class="n">as</code> <code class="n">$photo</code><code class="p">)</code>
<code class="linenos"> 4 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"relative group"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>                <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{route('photos.destroy', ['product' =&gt; $product-&gt;id, \</code>
<code class="linenos"> 6 </code><code class="s">'photo' =&gt; $photo-&gt;id])}}"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"submitDestroy{{$photo-&gt;id}}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code><code class="p">@</code><code class="n">csrf</code> <code class="p">@</code><code class="n">met</code>\
<code class="linenos"> 7 </code><code class="n">hod</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code><code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>                <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"absolute top-1 right-1 text-white bg-red-700 p-2 roun\</code>
<code class="linenos">10 </code><code class="s">ded cursor-pointer hidden group-hover:block"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"destroyPhoto"</code> <code class="n">data</code><code class="o">-</code><code class="n">photo</code><code class="o">=</code><code class="s">"{{$photo-\</code>
<code class="linenos">11 </code><code class="s">&gt;id}}"</code><code class="o">&gt;</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>                    <code class="o">&lt;</code><code class="n">svg</code> <code class="n">xmlns</code><code class="o">=</code><code class="s">"http://www.w3.org/2000/svg"</code> <code class="n">fill</code><code class="o">=</code><code class="s">"none"</code> <code class="n">viewBox</code><code class="o">=</code><code class="s">"0 0\</code>
<code class="linenos">14 </code><code class="s"> 24 24"</code> <code class="n">stroke</code><code class="o">-</code><code class="n">width</code><code class="o">=</code><code class="s">"1.5"</code> <code class="n">stroke</code><code class="o">=</code><code class="s">"currentColor"</code> <code class="k">class</code><code class="o">=</code><code class="s">"size-6"</code><code class="o">&gt;</code>
<code class="linenos">15 </code>                        <code class="o">&lt;</code><code class="n">path</code> <code class="n">stroke</code><code class="o">-</code><code class="n">linecap</code><code class="o">=</code><code class="s">"round"</code> <code class="n">stroke</code><code class="o">-</code><code class="n">linejoin</code><code class="o">=</code><code class="s">"round"</code> <code class="n">d</code><code class="o">=</code><code class="s">"m14.\</code>
<code class="linenos">16 </code><code class="s">74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 \</code>
<code class="linenos">17 </code><code class="s">19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.4\</code>
<code class="linenos">18 </code><code class="s">56 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 4\</code>
<code class="linenos">19 </code><code class="s">8.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.\</code>
<code class="linenos">20 </code><code class="s">32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"</code> <code class="o">/&gt;</code>
<code class="linenos">21 </code>                        <code class="o">&lt;/</code><code class="n">svg</code><code class="o">&gt;</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>                <code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">24 </code>
<code class="linenos">25 </code>                <code class="o">&lt;</code><code class="n">img</code> <code class="n">src</code><code class="o">=</code><code class="s">"{{asset('storage/' . $photo-&gt;photo)}}"</code> <code class="n">alt</code><code class="o">=</code><code class="s">""</code> <code class="k">class</code><code class="o">=</code><code class="s">"p-1 r\</code>
<code class="linenos">26 </code><code class="s">ounded shadow bg-white"</code><code class="o">&gt;</code>
<code class="linenos">27 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">28 </code>        <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">29 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">30 </code><code class="p">@</code><code class="k">else</code>
<code class="linenos">31 </code><code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-4 text-red-700"</code><code class="o">&gt;</code>
<code class="linenos">32 </code>    <code class="n">Sem</code> <code class="n">fotos</code> <code class="n">para</code> <code class="n">este</code> <code class="n">produto</code><code class="o">!</code>
<code class="linenos">33 </code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">34 </code><code class="p">@</code><code class="n">endif</code>
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tela-upload-populada.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Esse loop é codicional onde verifico via propriedade da ligação a existência de fotos na collection ligada a produtos. Seguindo aquela explicação sobre acessar como método de ligação e propriedade de ligação.</p>

<p>Como nosso remover da imagem está via método <code>destroy</code>(que espera um DELETE), monto no loop formulários únicos para associá-los a cada button onde ao passar o mouse na imagem este button aparece com um ícone de lixeira (svg que peguei no site heroicons.com).</p>

<p>Esse button ao ser clicado será interceptado por nosso javascript e assim realizaremo a submissão deste form para processar o remover da imagem escolhida.</p>

<p>No button que está sob a imagem, via estilo, defino um atributo <code>dataset</code>(data-photo) para salvar a referência do id da imagem para via JS submeter o formulário associado ao button e a imagem.</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;button</code> <code class="na">class=</code><code class="s">"absolute top-1 right-1 text-white bg-red-700 p-2 rounded cursor-point\</code>
<code class="linenos"> 2 </code><code class="s">er hidden group-hover:block"</code> <code class="na">id=</code><code class="s">"destroyPhoto"</code> <code class="na">data-photo=</code><code class="s">"</code><code class="cp">{{</code><code class="err">$</code><code class="nv">photo-</code><code class="o">&gt;</code><code class="nv">id</code><code class="cp">}}</code><code class="s">"</code><code class="nt">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    <code class="nt">&lt;svg</code> <code class="na">xmlns=</code><code class="s">"http://www.w3.org/2000/svg"</code> <code class="na">fill=</code><code class="s">"none"</code> <code class="na">viewBox=</code><code class="s">"0 0 24 24"</code> <code class="err">stroke-w\</code>
<code class="linenos"> 5 </code><code class="na">idth=</code><code class="s">"1.5"</code> <code class="na">stroke=</code><code class="s">"currentColor"</code> <code class="na">class=</code><code class="s">"size-6"</code><code class="nt">&gt;</code>
<code class="linenos"> 6 </code>        <code class="nt">&lt;path</code> <code class="na">stroke-linecap=</code><code class="s">"round"</code> <code class="na">stroke-linejoin=</code><code class="s">"round"</code> <code class="na">d=</code><code class="s">"m14.74 9-.346 9m-4.7\</code>
<code class="linenos"> 7 </code><code class="s">88 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25\</code>
<code class="linenos"> 8 </code><code class="s"> 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.1\</code>
<code class="linenos"> 9 </code><code class="s">08 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478\</code>
<code class="linenos">10 </code><code class="s">-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2\</code>
<code class="linenos">11 </code><code class="s">.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"</code> <code class="nt">/&gt;</code>
<code class="linenos">12 </code>        <code class="nt">&lt;/svg&gt;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code><code class="nt">&lt;/button&gt;</code>
</pre></div>

</figure>


<p>Perceba também que via javascript buscarei pelos ids do button e pelo id dos formulários.</p>

<blockquote>
  <p>Aqui teremos mais um ponto nesta tela referente a possibilidade do Blade. Utilizarei para organizar o javascript deste template e fazer com que ele exista no âmbito geral da página a diretiva <code>@push</code>.</p>

  <p>O <code>@push</code> será adicionado no template principal onde existir a diretiva <code>@stack</code> no pensamente pilha de fato. Desta forma conseguimos enviar nossos códigos de scripts do contexto daquela view para o escopo geral da tela HTML. Poderia fazer isso com section também mas stack e push me ajudam neste ponto também.</p>
</blockquote>

<p>Abaixo segue o trecho do nosso javascript existente na tela:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">push</code><code class="p">(</code><code class="err">'</code><code class="n">scripts</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="o">&lt;</code><code class="n">script</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>    <code class="k">const</code> <code class="n">button</code> <code class="o">=</code> <code class="n">document</code><code class="p">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="err">'</code><code class="n">button</code><code class="err">#</code><code class="n">destroyPhoto</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="n">button</code><code class="p">.</code><code class="n">forEach</code><code class="p">(</code><code class="n">el</code> <code class="o">=&gt;</code> <code class="p">{</code>
<code class="linenos"> 6 </code>        <code class="n">console</code><code class="p">.</code><code class="n">log</code><code class="p">(</code><code class="n">el</code><code class="p">)</code>
<code class="linenos"> 7 </code>        <code class="n">el</code><code class="p">.</code><code class="n">addEventListener</code><code class="p">(</code><code class="err">'</code><code class="n">click</code><code class="err">'</code><code class="p">,</code> <code class="n">e</code> <code class="o">=&gt;</code> <code class="p">{</code>
<code class="linenos"> 8 </code>            <code class="n">e</code><code class="p">.</code><code class="n">preventDefault</code><code class="p">();</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code>            <code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="n">confirm</code><code class="p">(</code><code class="err">'</code><code class="n">Deseja</code> <code class="n">mesmo</code> <code class="n">remover</code> <code class="n">a</code> <code class="n">foto</code><code class="o">?</code><code class="err">'</code><code class="p">))</code> <code class="k">return</code><code class="p">;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code>            <code class="k">const</code> <code class="n">photoId</code> <code class="o">=</code> <code class="n">el</code><code class="p">.</code><code class="n">dataset</code><code class="p">.</code><code class="n">photo</code><code class="p">;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code>            <code class="n">document</code><code class="p">.</code><code class="n">querySelector</code><code class="p">(</code><code class="err">`</code><code class="n">form</code><code class="err">#</code><code class="n">submitDestroy$</code><code class="p">{</code><code class="n">photoId</code><code class="p">}</code><code class="err">`</code><code class="p">).</code><code class="n">submit</code><code class="p">();</code>
<code class="linenos">15 </code>        <code class="p">})</code>
<code class="linenos">16 </code>    <code class="p">});</code>
<code class="linenos">17 </code><code class="o">&lt;/</code><code class="n">script</code><code class="o">&gt;</code>
<code class="linenos">18 </code><code class="p">@</code><code class="n">endpush</code>
</pre></div>

</figure>


<p>Nomeei nossa stack como <code>scripts</code>, por esta razão chamamos o <code>@push('scripts')</code> para que este trecho de JS seja empilhado exatamente na definição da <code>@stack('scripts')</code>.</p>

<p>Começo nosso script buscando pelo <code>button</code> de ID destroyPhoto:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="k">const</code> <code class="n">button</code> <code class="o">=</code> <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'button#destroyPhoto'</code><code class="p">)</code>
</pre></div>

</figure>


<p>Como teremos vários buttons mediante a quantidade de imagens, itero em cada um deles para adicionar para cada um de forma individual o escutar do evento de clique, com o método <code>addEventListener</code>.</p>

<p>Ao o usuário clicar na imagem, ignore o comportamento padrão do elemento com o <code>e.preventDefault();</code>. Continuando, uso o <code>confirm</code>do js para exibir um pequeno popup de confirmação, se o usuário confirmar temos o true e se ele cancelar teremos o false. Negando o cancelar do usuário e condicionando isso, simplesmente ignoro o processo de remoção.</p>

<p>Se o usuário confirmar que quer remover continuamos o script, onde pego o ID da foto a partir do dataset salvo na tag do elemento button e realizo a busca do formulário único e assim submeto ele para realizar o processo de remoção de fato da imagem.</p>

<p>Pegando o ID da foto via dataset:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="k">const</code> <code class="n">photoId</code> <code class="o">=</code> <code class="n">el</code><code class="o">.</code><code class="n">dataset</code><code class="o">.</code><code class="n">photo</code><code class="p">;</code><code class="err">`</code>
</pre></div>

</figure>


<p>E o trecho onde busco o form para realizar a submissão e concretizar a remoção da imagem.</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>document.querySelector(`form#submitDestroy<code class="cp">${</code><code class="n">photoId</code><code class="cp">}</code>`).submit();
</pre></div>

</figure>


<p>Agora que destaquei os principais pontos desta tela, adicione no arquivo <code>app.blade.php</code> antes do fechamento da tag <code>body</code> o trecho abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nv">@stack</code><code class="p">(</code><code class="s1">'scripts'</code><code class="p">)</code><code class="w"></code>
</pre></div>

</figure>


<p>Perceba que comecei a utilizar as mensagens de feedback do processo, jogando as mensagens na sessão flash. Crie o arquivo <code>messages.blade.php</code> na pasta <code>includes</code>(precisa ser criada também) dentro de views.</p>

<p>Neste arquivo definiremos três blocos para mensagens de sucesso, erro e warning. Como o trecho é auto-explicativo e já falamos de sessão aqui nesta jornada. </p>

<p>Deixo o código completo abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">session</code><code class="p">(</code><code class="err">'</code><code class="n">success</code><code class="err">'</code><code class="p">))</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"my-10 p-5 rounded border-green-900 bg-green-400 text-green-900 font-\</code>
<code class="linenos"> 3 </code><code class="s">bold"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">session</code><code class="p">(</code><code class="err">'</code><code class="n">success</code><code class="err">'</code><code class="p">)}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 4 </code><code class="p">@</code><code class="n">endif</code>
<code class="linenos"> 5 </code>
<code class="linenos"> 6 </code><code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">session</code><code class="p">(</code><code class="err">'</code><code class="n">error</code><code class="err">'</code><code class="p">))</code>
<code class="linenos"> 7 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"my-10 p-5 rounded border-green-900 bg-red-400 text-red-900 font-bold\</code>
<code class="linenos"> 8 </code><code class="s">"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">session</code><code class="p">(</code><code class="err">'</code><code class="n">error</code><code class="err">'</code><code class="p">)}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code><code class="p">@</code><code class="n">endif</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code><code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">session</code><code class="p">(</code><code class="err">'</code><code class="n">warning</code><code class="err">'</code><code class="p">))</code>
<code class="linenos">12 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"my-10 p-5 rounded border-green-900 bg-yellow-400 text-yellow-900 fon\</code>
<code class="linenos">13 </code><code class="s">t-bold"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">session</code><code class="p">(</code><code class="err">'</code><code class="n">warning</code><code class="err">'</code><code class="p">)}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">14 </code><code class="p">@</code><code class="n">endif</code>
</pre></div>

</figure>


<p>Inclua este arquivo no seu <code>app.blade.php</code> acima do trecho do <code>yeld('content')</code>. Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nv">@include</code><code class="p">(</code><code class="s1">'includes.messages'</code><code class="p">)</code><code class="w"></code>
</pre></div>

</figure>


<p>A diretiva <code>@include</code> trabalha tal qual o include no PHP, com um adicional de você, se precisar, passar variáveis para este include via segundo parâmetro desta diretiva. Veja na íntegra como está nosso <code>app.blade.php</code> após as alterações:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;!doctype html&gt;</code>
<code class="linenos"> 2 </code><code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code><code class="nt">&lt;head&gt;</code>
<code class="linenos"> 5 </code>    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code><code class="nt">&gt;</code>
<code class="linenos"> 6 </code>    <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code>
<code class="linenos"> 7 </code>        <code class="na">content=</code><code class="s">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-sc\</code>
<code class="linenos"> 8 </code><code class="s">ale=1.0, minimum-scale=1.0"</code><code class="nt">&gt;</code>
<code class="linenos"> 9 </code>    <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code><code class="nt">&gt;</code>
<code class="linenos">10 </code>    <code class="nt">&lt;title&gt;</code>Loja - Code Experts<code class="nt">&lt;/title&gt;</code>
<code class="linenos">11 </code>    <code class="nt">&lt;script</code> <code class="na">src=</code><code class="s">"https://cdn.tailwindcss.com"</code><code class="nt">&gt;&lt;/script&gt;</code>
<code class="linenos">12 </code><code class="nt">&lt;/head&gt;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code><code class="nt">&lt;body&gt;</code>
<code class="linenos">15 </code>    <code class="nt">&lt;nav</code> <code class="na">class=</code><code class="s">"w-full mb-10 flex justify-between bg-gray-900 px-4"</code><code class="nt">&gt;</code>
<code class="linenos">16 </code>        <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"/"</code> <code class="na">class=</code><code class="s">"text-white py-4"</code><code class="nt">&gt;</code>Experts Store 12<code class="nt">&lt;/a&gt;</code>
<code class="linenos">17 </code>        <code class="nt">&lt;ul</code> <code class="na">class=</code><code class="s">"flex"</code><code class="nt">&gt;</code>
<code class="linenos">18 </code>            <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">19 </code>                <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'products.index'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code>
<code class="linenos">20 </code>                    <code class="na">class=</code><code class="s">"text-white px-6 py-4 hover:bg-purple-800 transition ease-\</code>
<code class="linenos">21 </code><code class="s">in-out duration-300"</code><code class="nt">&gt;</code>Produtos<code class="nt">&lt;/a&gt;</code>
<code class="linenos">22 </code>            <code class="nt">&lt;/li&gt;</code>
<code class="linenos">23 </code>            <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">24 </code>                <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'categories.index'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code>
<code class="linenos">25 </code>                    <code class="na">class=</code><code class="s">"text-white px-6 py-4 hover:bg-purple-800 transition ease-\</code>
<code class="linenos">26 </code><code class="s">in-out duration-300"</code><code class="nt">&gt;</code>Categorias<code class="nt">&lt;/a&gt;</code>
<code class="linenos">27 </code>            <code class="nt">&lt;/li&gt;</code>
<code class="linenos">28 </code>            <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">29 </code>                <code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code> <code class="nv">route</code><code class="o">(</code><code class="s1">'logout'</code><code class="o">)</code> <code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"post"</code> <code class="na">id=</code><code class="s">"logout"</code><code class="nt">&gt;</code>@csrf\
<code class="linenos">30 </code><code class="nt">&lt;/form&gt;</code>
<code class="linenos">31 </code>                <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"#"</code>
<code class="linenos">32 </code>                    <code class="na">class=</code><code class="s">"px-6 py-4 bg-red-800 hover:bg-red-950 text-white transiti\</code>
<code class="linenos">33 </code><code class="s">on ease-in-out duration-300"</code>
<code class="linenos">34 </code>                    <code class="na">onclick=</code><code class="s">"event.preventDefault(); document.querySelector('form#lo\</code>
<code class="linenos">35 </code><code class="s">gout').submit()"</code><code class="nt">&gt;</code>Sair<code class="nt">&lt;/a&gt;</code>
<code class="linenos">36 </code>            <code class="nt">&lt;/li&gt;</code>
<code class="linenos">37 </code>            <code class="nt">&lt;li</code> <code class="na">class=</code><code class="s">"py-4"</code><code class="nt">&gt;</code>
<code class="linenos">38 </code>                <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">" font-thin ml-4 text-white"</code><code class="nt">&gt;</code>Olá, <code class="cp">{{</code> <code class="nv">str</code><code class="o">(</code><code class="nv">auth</code><code class="o">()-&gt;</code><code class="nv">user</code><code class="o">()-</code><code class="err">\</code>
<code class="linenos">39 </code><code class="o">&gt;</code><code class="nv">name</code><code class="o">)-&gt;</code><code class="nv">explode</code><code class="o">(</code><code class="s1">' '</code><code class="o">)[</code><code class="m">0</code><code class="o">]</code> <code class="cp">}}</code><code class="nt">&lt;/span&gt;</code>
<code class="linenos">40 </code>            <code class="nt">&lt;/li&gt;</code>
<code class="linenos">41 </code>        <code class="nt">&lt;/ul&gt;</code>
<code class="linenos">42 </code>    <code class="nt">&lt;/nav&gt;</code>
<code class="linenos">43 </code>    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"container"</code> <code class="na">class=</code><code class="s">"max-w-7xl mx-auto p-6"</code><code class="nt">&gt;</code>
<code class="linenos">44 </code>        @include('includes.messages')
<code class="linenos">45 </code>
<code class="linenos">46 </code>        @yield('content')
<code class="linenos">47 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">48 </code>
<code class="linenos">49 </code>    @stack('scripts')
<code class="linenos">50 </code><code class="nt">&lt;/body&gt;</code>
<code class="linenos">51 </code>
<code class="linenos">52 </code><code class="nt">&lt;/html&gt;</code>
</pre></div>

</figure>


<p>Eu adicionei também na tela da edição do Produto o link para a tela de upload de fotos. Adicione acima do seu form de edição de produto o trecho abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-10 flex justify-end"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'photos.index'</code><code class="o">,</code> <code class="o">[</code><code class="s1">'product'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="nv">product-</code><code class="o">&gt;</code><code class="nv">id</code><code class="o">])</code><code class="cp">}}</code><code class="s">"</code> <code class="na">class=</code><code class="s">"px-4 py-\</code>
<code class="linenos">3 </code><code class="s">2 rounded bg-purple-600 border border-purple-900 text-white font-bold hover:bg-purpl\</code>
<code class="linenos">4 </code><code class="s">e-900 transition duration-300 ease-in-out"</code><code class="nt">&gt;</code>Gerenciar Fotos<code class="nt">&lt;/a&gt;</code>
<code class="linenos">5 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>E por fim, claro, as rotas para a tela e processos da área de uplaods:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">resource</code><code class="o">(</code><code class="s1">'products/{product}/photos'</code><code class="o">,</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Http</code><code class="err">\</code><code class="nt">Controllers</code><code class="err">\</code><code class="nt">Admin</code><code class="err">\</code><code class="nt">ProductPhot</code><code class="err">\</code>
<code class="linenos">2 </code><code class="nt">oController</code><code class="p">::</code><code class="nd">class</code><code class="o">)</code>
<code class="linenos">3 </code>          <code class="nt">-</code><code class="o">&gt;</code><code class="nt">only</code><code class="o">(</code><code class="cp">[</code><code class="s1">'index'</code><code class="p">,</code> <code class="s1">'store'</code><code class="p">,</code> <code class="s1">'destroy'</code><code class="cp">]</code><code class="o">);</code>
</pre></div>

</figure>

<p class="fake-para">Coloque a definição acima dentro do grupo do admin nas rotas do arquivo <code>web.php</code>.</p>

<p>No trecho acima destaco o uso do método <code>only</code>, utilizei ele aqui para expor apenas as rotas para o index, store e destroy pois precisamos apenas destas três rotas.</p>

<p>Com isso concluímos nossa área de upload de fotos.</p>

<h2 id="leanpub-auto-concluses-10" class="section">Conclusões</h2>

<p>Trabalhar com upload de arquivos no Laravel é algo íncrivel e simples no contexto geral. O Laravel já traz todo o arcabouço necessário para isso, inclusive se precisarmos subir os arquivos no S3 da Amazon, podemos realizar o processo sem muito esforço.</p>

<p>Agora que temos nosso gerenciamento com muitas possibilidades, vamos partir para nosso Front e criar o processo público onde nossos usuários(clientes) poderão realizar suas compras e gerenciar seus pedidos.</p>

<p>Vamos lá!</p>


<h1 id="leanpub-auto-criando-front-da-experts-store" class="chapter">Criando Front da Experts Store</h1>

<p>Olá, tudo bem? Espero que sim!</p>

<p>Chegamos ao capítulo onde iremos criar o front da nossa loja. Como a navegação de produtos e a parte do nosso carrinho de compras.</p>

<p>Então vamos lá!</p>

<h2 id="leanpub-auto-antes-falemos-de-blade-tag-componentes-ou-componentes" class="section">Antes, falemos de Blade Tag Componentes ou Componentes</h2>

<p>Antes de iniciarmos, quero falar um pouco sobre a parte de Tag Componentes do blade, minha intenção aqui é te ambientar deste ponto de forma a te preparar quando começar a desbravar os starter kits baseados em blade na camada de template. As tag componentes ou <code>x tag componentes</code> não são algo novo ou exclusivo 12+ mas foi uma novidade lá no Laravel 7 e é bastante utilizado nas estruturas de starter kit do Laravel como forma de reutilização na camada de template com Blade.</p>

<p>Os blade tag componentes têm algumas particularidades e podem ser associados a camada PHP + Blade, em nosso caso focarei apenas na parte Blade ou o nome correto: componentes de forma anônima. Estes componentes residem em uma pasta chamada de <code>components</code> que fica ou pode ser criada na pasta de views do framework.</p>

<p>Você pode criar seu(s) componentes de forma manual ou via comando. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:component exemplo --view
</pre></div>

</figure>


<p>O parâmetro <code>--view</code> indica que quero apenas criar meu componente anônimo sem está atrelado a uma classe PHP (recomendo criar um componente sem o –view para você olhar a estrutura, ao final do capítulo deixarei uma referência de um vídeo onde mostrei essa novidade pro caso de você se aprofundar mais). O componente será criado na pasta <code>resources/views/components</code> e o arquivo será o <code>exemplo.blade.php</code>.</p>

<p>Nesse componente podemos interagir de N formas, desde isolando pontos reutilizáveis a passar para este dados a serem trabalhados de forma individual. Por exemplo, podemos isolar uma lista e sua iteração em cima destes componentes. A passagem de valores para este componente se assemelha tal qual componentes nos frameworks JS, inclusive são sua inspiração e recebem os mesmo nome <code>props</code> ou passagem via <code>props</code>.</p>

<p>Por exemplo, vamos fazer deste componente gerado um pequeno <code>Hello World</code>. Veja abaixo seu conteúdo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>@props([
<code class="linenos">2 </code>    'name'=&gt; null
<code class="linenos">3 </code>])
<code class="linenos">4 </code>
<code class="linenos">5 </code><code class="nt">&lt;div&gt;</code>
<code class="linenos">6 </code>    <code class="nt">&lt;h1&gt;</code>Olá, <code class="cp">{{</code><code class="err">$</code><code class="nv">name</code><code class="cp">}}</code> - Hello World!<code class="nt">&lt;/h1&gt;</code>
<code class="linenos">7 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>Olhando o trecho acima perceba que inicialmente definimos em nosso componente a diretiva <code>@props</code> onde listamos os parâmetros que podem ser passados para nosso componente. Perceba que o nome da props ou das props, deve ser utilizada no template como variáveis, se você estivesse utilizando o componente com a camada PHP, você receberia estas props via construtor sem a necessidade de informar na camada de template mas como estamos com um componente anônimo é importante você listar props que receberão os valores para serem utilizadas na finalidade que seu componente espera e foi idealizado.</p>

<p>Nosso exemplo, simplemente printo a mensagem junto do nome dinâmico recebido por quem chamar e passar o valor pro nosso componente. Em qualquer template do blade você pode chamar este componente ou outros(respeitando o nome do componente) da seguinte forma:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>&lt;x-exemplo :name="$name" /&gt;
</pre></div>

</figure>


<p>Perceba que nosso tag componente recebe o prefixo <code>x-</code> indicando que este é um componente do Blade, logo após informamos o nome do componente sem a extensão do arquivo e ignorando o caminho de pastas até ele (o blade se vira para carregar desde que esteja na pasta correta e com a extensão <code>.blade.php</code>). </p>

<p>Nossa prop é informada tendo o nome prefixado por <code>:</code> indicando que é uma prop dinâmica, imagine também que <code>$name</code> é uma variável que veio do meu controller para a view que chamou o componente. Com isso teremos nossa mensagem exibida junto do valor que vier na variável <code>$name</code> que está sendo passada pro nosso componente.</p>

<blockquote>
  <p>PS.: Lembrando que o parâmetro <code>:name</code> deve ser o mesmo nome listado na diretiva @props, o nome da variável dinâmica pode mudar pois contêm o valor externo sendo passando para o componente consumir internamente.</p>
</blockquote>

<h2 id="leanpub-auto-componentes-slots" class="section">Componentes: Slots</h2>

<p>Um outro conceito importante nos componentes é a parte de slots e se você já conhece componentes JS vai entender bem tranquilamente esta ideia no Blade, toda a ideia de componentes na verdade.</p>

<p>Slots nos permitem utilizarmos os componentes com uma tag de abertura e fechamento, envolvendo um conteúdo e este conteúdo ser parte integrante do conteúdo do componente. Podemos utilizar o slot padrão ou podemos utilizar slots nomeados para organizar melhor o conteúdo e sua localização dentro do componete.</p>

<p>Por exemplo, na utilização:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;x-exemplo</code> <code class="err">:name"="$name"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;strong&gt;</code>Conteúdo vai para o slot padrão...<code class="nt">&lt;/strong&gt;</code>
<code class="linenos">3 </code><code class="nt">&lt;/x-exemplo&gt;</code>
</pre></div>

</figure>


<p>Internamete no componente basta que eu use o <code>{{ $slot }}</code> e o conteúdo será jogado exatamente onde ele está definido dentro do componente:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code>@props([
<code class="linenos"> 2 </code>    'name'=&gt; null
<code class="linenos"> 3 </code>])
<code class="linenos"> 4 </code><code class="nt">&lt;div&gt;</code>
<code class="linenos"> 5 </code>    <code class="nt">&lt;h1&gt;</code>Olá, <code class="cp">{{</code><code class="err">$</code><code class="nv">name</code><code class="cp">}}</code> - Hello World!<code class="nt">&lt;/h1&gt;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="nt">&lt;hr&gt;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="cp">{{</code> <code class="err">$</code><code class="nv">slot</code> <code class="cp">}}</code>
<code class="linenos">10 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>Se precisarmos organizar os slots via nome, podemos trabalhar da seguinte maneira. Na utilização:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;x-exemplo</code> <code class="err">:name"="$name"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    
<code class="linenos">3 </code>    <code class="nt">&lt;x-slot:header&gt;</code>Conteúdo pro slot nomeado...<code class="nt">&lt;/x-slot&gt;</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code>    <code class="nt">&lt;strong&gt;</code>Conteúdo vai para o slot padrão...<code class="nt">&lt;/strong&gt;</code>
<code class="linenos">6 </code>
<code class="linenos">7 </code><code class="nt">&lt;/x-exemplo&gt;</code>
</pre></div>

</figure>


<p>Perceba que na utilização do componente chamei o componente <code>x-slot</code> que me pemite depois dos <code>:</code> informar o nome do slot nomeado que está definido no componente <code>exemplo</code>. Para definir o local dele, podemos simplementes printar a variável <code>$header</code> dentro do componente que o blade entregará o conteúdo do slot a ser exibido. Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code>@props([
<code class="linenos"> 2 </code>    'name'=&gt; null
<code class="linenos"> 3 </code>])
<code class="linenos"> 4 </code><code class="nt">&lt;div&gt;</code>
<code class="linenos"> 5 </code>
<code class="linenos"> 6 </code>    <code class="cp">{{</code><code class="err">$</code><code class="nv">header</code><code class="cp">}}</code> <code class="c">&lt;!-- slot nomeado, chamado de header --&gt;</code>
<code class="linenos"> 7 </code>    <code class="nt">&lt;hr&gt;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="nt">&lt;h1&gt;</code>Olá, <code class="cp">{{</code><code class="err">$</code><code class="nv">name</code><code class="cp">}}</code> - Hello World!<code class="nt">&lt;/h1&gt;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="nt">&lt;hr&gt;</code>
<code class="linenos">12 </code>    <code class="cp">{{</code> <code class="err">$</code><code class="nv">slot</code> <code class="cp">}}</code> <code class="c">&lt;!-- slot padrão --&gt;</code>
<code class="linenos">13 </code><code class="nt">&lt;/div&gt;</code>
</pre></div>

</figure>


<p>Os slots nomeados facilitam muito quando precisamos organizar os conteúdos dentro do componente. Em componentes dentro do blade podemos realizar diversas outras operações como fazer bind de atributos usados no componente, fazer bind de atributos nos slots.Recomendo fortemente que você busque mais conteúdo sobre esta parte que não é muito mas já vai te ajudar bem quando precisar reutilizar partes das suas views com blade.</p>

<p>Este conteúdo mostrado aqui já é o suficiente para que possamos usar a técnica de layout base mas agora via componente. Um jeito diferente do que te mostrei no inicio e dentro do admin mas que vai te abrir muito a mente para os seus estudos futuros com starter kits oficiais do Laravel 12.</p>

<h2 id="leanpub-auto-componente-para-layout-front-loja" class="section">Componente para Layout Front Loja</h2>

<p>Vamos criar o componente para o layout da nossa loja na parte do front ou parte pública pros nossos clientes. Veja o conteúdo na integra e logo após foco nos principais pontos.</p>

<p>Veja o conteúdo do nosso layout como componente criado em <code>resources/views/components/</code> e o componente é <code>site.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;!</code><code class="n">doctype</code> <code class="n">html</code><code class="o">&gt;</code>
<code class="linenos"> 2 </code><code class="o">&lt;</code><code class="n">html</code> <code class="n">lang</code><code class="o">=</code><code class="s">"en"</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code><code class="o">&lt;</code><code class="n">head</code><code class="o">&gt;</code>
<code class="linenos"> 4 </code>    <code class="o">&lt;</code><code class="n">meta</code> <code class="n">charset</code><code class="o">=</code><code class="s">"UTF-8"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>    <code class="o">&lt;</code><code class="n">meta</code> <code class="n">name</code><code class="o">=</code><code class="s">"viewport"</code>
<code class="linenos"> 6 </code>          <code class="n">content</code><code class="o">=</code><code class="s">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-\</code>
<code class="linenos"> 7 </code><code class="s">scale=1.0, minimum-scale=1.0"</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>    <code class="o">&lt;</code><code class="n">meta</code> <code class="n">http</code><code class="o">-</code><code class="n">equiv</code><code class="o">=</code><code class="s">"X-UA-Compatible"</code> <code class="n">content</code><code class="o">=</code><code class="s">"ie=edge"</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>    <code class="o">&lt;</code><code class="n">title</code><code class="o">&gt;</code><code class="n">Experts</code> <code class="n">Store</code><code class="o">&lt;/</code><code class="n">title</code><code class="o">&gt;</code>
<code class="linenos">10 </code>    <code class="p">@</code><code class="n">vite</code><code class="p">([</code><code class="err">'</code><code class="n">resources</code><code class="o">/</code><code class="n">css</code><code class="o">/</code><code class="n">app</code><code class="p">.</code><code class="n">css</code><code class="err">'</code><code class="p">,</code> <code class="err">'</code><code class="n">resources</code><code class="o">/</code><code class="n">js</code><code class="o">/</code><code class="n">app</code><code class="p">.</code><code class="n">js</code><code class="err">'</code><code class="p">])</code>
<code class="linenos">11 </code><code class="o">&lt;/</code><code class="n">head</code><code class="o">&gt;</code>
<code class="linenos">12 </code><code class="o">&lt;</code><code class="n">body</code> <code class="k">class</code><code class="o">=</code><code class="s">"bg-fixed bg-gradient-to-b from-10% to-80% from-purple-800 to-black"</code><code class="o">&gt;</code>
<code class="linenos">13 </code>    <code class="o">&lt;</code><code class="n">header</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-10"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"max-w-7xl mx-auto flex justify-between items-center py-4"</code><code class="o">&gt;</code>
<code class="linenos">15 </code>            <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{route('site.home')}}"</code> <code class="k">class</code><code class="o">=</code><code class="s">"font-extrabold text-white text-x\</code>
<code class="linenos">16 </code><code class="s">l"</code><code class="o">&gt;</code><code class="n">Experts</code> <code class="n">Store</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>            <code class="o">&lt;</code><code class="n">nav</code> <code class="k">class</code><code class="o">=</code><code class="s">"mr-4"</code><code class="o">&gt;</code>
<code class="linenos">19 </code>                <code class="o">&lt;</code><code class="n">ul</code> <code class="k">class</code><code class="o">=</code><code class="s">"flex items-center gap-x-4"</code><code class="o">&gt;</code>
<code class="linenos">20 </code>                    <code class="o">&lt;</code><code class="n">li</code><code class="o">&gt;&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{route('site.home')}}"</code>
<code class="linenos">21 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"text-white  hover:underline hover:font-bold transitio\</code>
<code class="linenos">22 </code><code class="s">n duration-300 ease-in-out @if(request()-&gt;routeIs('site.home')) font-bold @else font\</code>
<code class="linenos">23 </code><code class="s">-thin @endif"</code><code class="o">&gt;</code><code class="n">Home</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;&lt;/</code><code class="n">li</code><code class="o">&gt;</code>
<code class="linenos">24 </code>                        <code class="o">&lt;</code><code class="n">li</code> <code class="k">class</code><code class="o">=</code><code class="s">"relative"</code><code class="o">&gt;</code>
<code class="linenos">25 </code>                            <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"#sera_link_pro_cart"</code>
<code class="linenos">26 </code>                            <code class="k">class</code><code class="o">=</code><code class="s">"flex gap-x-2 items-center text-white  hover:under\</code>
<code class="linenos">27 </code><code class="s">line hover:font-bold transition duration-300 ease-in-out @if(request()-&gt;routeIs('sit\</code>
<code class="linenos">28 </code><code class="s">e.home')) font-bold @else font-thin @endif"</code><code class="o">&gt;</code>
<code class="linenos">29 </code>                            <code class="o">&lt;</code><code class="n">svg</code> <code class="n">xmlns</code><code class="o">=</code><code class="s">"http://www.w3.org/2000/svg"</code> <code class="n">fill</code><code class="o">=</code><code class="s">"none"</code> <code class="n">view</code>\
<code class="linenos">30 </code><code class="n">Box</code><code class="o">=</code><code class="s">"0 0 24 24"</code> <code class="n">stroke</code><code class="o">-</code><code class="n">width</code><code class="o">=</code><code class="s">"1.5"</code> <code class="n">stroke</code><code class="o">=</code><code class="s">"currentColor"</code> <code class="k">class</code><code class="o">=</code><code class="s">"size-6"</code><code class="o">&gt;</code>
<code class="linenos">31 </code>                                <code class="o">&lt;</code><code class="n">path</code> <code class="n">stroke</code><code class="o">-</code><code class="n">linecap</code><code class="o">=</code><code class="s">"round"</code> <code class="n">stroke</code><code class="o">-</code><code class="n">linejoin</code><code class="o">=</code><code class="s">"round"</code>\
<code class="linenos">32 </code> <code class="n">d</code><code class="o">=</code><code class="s">"M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m\</code>
<code class="linenos">33 </code><code class="s">-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 \</code>
<code class="linenos">34 </code><code class="s">14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 \</code>
<code class="linenos">35 </code><code class="s">1-1.5 0 .75.75 0 0 1 1.5 0Z"</code> <code class="o">/&gt;</code>
<code class="linenos">36 </code>                              <code class="o">&lt;/</code><code class="n">svg</code><code class="o">&gt;</code>
<code class="linenos">37 </code>                              <code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">has</code><code class="p">(</code><code class="err">'</code><code class="n">cart</code><code class="err">'</code><code class="p">)</code> <code class="o">&amp;&amp;</code> <code class="n">count</code><code class="p">(</code><code class="n">session</code><code class="p">(</code><code class="err">'</code><code class="n">cart</code><code class="err">'</code><code class="p">)))</code>
<code class="linenos">38 </code>                                <code class="o">&lt;</code><code class="n">span</code> <code class="k">class</code><code class="o">=</code><code class="s">"rounded-xl p-1 text-white bg-red-700"</code><code class="o">&gt;</code>
<code class="linenos">39 </code>                                    <code class="p">{{</code><code class="n">count</code><code class="p">(</code><code class="n">session</code><code class="p">(</code><code class="err">'</code><code class="n">cart</code><code class="err">'</code><code class="p">))}}</code>
<code class="linenos">40 </code>                                <code class="o">&lt;/</code><code class="n">span</code><code class="o">&gt;</code>
<code class="linenos">41 </code>                              <code class="p">@</code><code class="n">endif</code>
<code class="linenos">42 </code>                        <code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">43 </code>                    <code class="o">&lt;/</code><code class="n">li</code><code class="o">&gt;</code>
<code class="linenos">44 </code>                <code class="o">&lt;/</code><code class="n">ul</code><code class="o">&gt;</code>
<code class="linenos">45 </code>            <code class="o">&lt;/</code><code class="n">nav</code><code class="o">&gt;</code>
<code class="linenos">46 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">47 </code>    <code class="o">&lt;/</code><code class="n">header</code><code class="o">&gt;</code>
<code class="linenos">48 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"max-w-7xl mx-auto"</code><code class="o">&gt;</code>
<code class="linenos">49 </code>        <code class="p">@</code><code class="n">include</code><code class="p">(</code><code class="err">'</code><code class="n">includes</code><code class="p">.</code><code class="n">messages</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">50 </code>
<code class="linenos">51 </code>        <code class="p">{{</code><code class="n">$slot</code><code class="p">}}</code>
<code class="linenos">52 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">53 </code>    <code class="o">&lt;</code><code class="n">footer</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-10"</code><code class="o">&gt;</code>
<code class="linenos">54 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"max-w-7xl mx-auto py-4 text-center border-t border-purple-500"</code><code class="o">&gt;</code>
<code class="linenos">55 </code>            <code class="o">&lt;</code><code class="n">small</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white "</code><code class="o">&gt;</code><code class="n">Experts</code> <code class="n">Store</code> <code class="o">&amp;</code><code class="k">copy</code><code class="p">;</code> <code class="n">Todos</code> <code class="n">os</code> <code class="n">Direitos</code> <code class="n">Reserv</code>\
<code class="linenos">56 </code><code class="n">ados</code><code class="o">&lt;/</code><code class="n">small</code><code class="o">&gt;</code>
<code class="linenos">57 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">58 </code>    <code class="o">&lt;/</code><code class="n">footer</code><code class="o">&gt;</code>
<code class="linenos">59 </code>    <code class="p">@</code><code class="n">stack</code><code class="p">(</code><code class="err">'</code><code class="n">scripts</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">60 </code><code class="o">&lt;/</code><code class="n">body</code><code class="o">&gt;</code>
<code class="linenos">61 </code><code class="o">&lt;/</code><code class="n">html</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>Nesse layout já deixei no ponto o ícone do nosso carrinho e como já conhecemos session no Laravel, já tomei a liberdade de deixar o contador de itens no carrinho, pegos da sessão, prontos neste código acima. Em breve vamos linkar a index do carrinho mas por hora o link que envolve o ícone do carrinho segue com o <code>#sera_link_pro_cart</code>.</p>

<p>Perceba no layout o ponto em que uso o <code>$slot</code>. O conteúdo que nosso componente envolver será colocado neste local do componente, local onde está a variável <code>$slot</code>. Um ponto importante e diferente aqui é que chamei nossos assets via diretiva <code>@vite</code> lá na parte <code>head</code> do HTML.</p>

<h2 id="leanpub-auto-laravel--vite" class="section">Laravel &amp; Vite</h2>

<p>O vite é um asset bundler, criado inicialmente pelo Evan You (criador do VueJS), que permite realizar diversas operações como gerar bundlers otimizados baseados nos assets frontends da aplicação, gerenciar scripts, organizar e compilar css, automatizar testes e muito mais. O Laravel até este ponto já traz uma integração pro Vite na aplicação e inclusive nosso app, desde o ínicio, já conta com o TailwindCSS configurado.</p>

<p>Desta forma, para usarmos esses assets gerenciados pelo ViteJS chamamos os arquivos de entrada via diretiva <code>@vite</code> como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nv">@vite</code><code class="p">(</code><code class="o">[</code><code class="n">'resources/css/app.css', 'resources/js/app.js'</code><code class="o">]</code><code class="p">)</code><code class="w"></code>
</pre></div>

</figure>


<p>Temos listado acima os entrypoint(arquivos de entrada) para geração do bundler pros assets na parte javascript e também na parte CSS que aqui já está configurado com TailwindCSS. Desta forma vamos precisar realizar os builds dos assets e isso pode ser feito automaticamente em DEV, usando o comando em seu terminal: <code>npm run dev</code>.</p>

<blockquote>
  <p>É claro que a esta altura esse comando pode ser um problema pra você, como assim? O npm normalmente vêm junto da instalação do NodeJS, então, se você já tiver o node o comando npm é algo usual pra você. Caso não tenha, é necessário instalar o Node e junto você terá acesso ao NPM (Node Package Manager) que permite, além de instalar dependências de front, executar scripts que estão no arquivo package.json do projeto.<br>Instalar o Node é bem tranquilo e imagino que você não terá problemas quanto a isso, aqui vale salientar que em repositórios Linux o NodeJs e Npm são pacotes distintos, neste caso você precisará instalar ambos para que tudo funcione corretamente.</p>
</blockquote>

<p>O comando <code>npm run dev</code> ficará escutando alterações nas suas views e arquivos entrypoint, e a medida que você for alterando e salvando o comando atualiza suas telas como forma de mostrar/refletir suas alterações. Como o proprio comando sugere, ele deve ser usado apenas em desenvolvimento, pois ao executar o comando um mini server para o frontend será levantado pelo Vite.</p>

<p>No futuro quando você encerrar sua primeira release, o comando para gerar os assets para produção será o <code>npm run build</code>, que você pode executar em DEV mas se torna um trabalho cansativo quando você pensar que têm N alterações e para cada alteração ter de executar o build rsrsrs. Por isso ele é usado para gerar o build de Produção.</p>

<h2 id="leanpub-auto-nosso-front-home--single-produto" class="section">Nosso Front: Home &amp; Single Produto</h2>

<p>Aqui na parte do front da loja serei o mais dinâmico possível uma vez que teremos muito repeteco de conhecimento. Vamos dá uma olhada nas rotas que criei para estas áreas:</p>

<p>web.php:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'/'</code><code class="o">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">HomeController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'index'</code><code class="cp">]</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'\</code>
<code class="linenos">2 </code><code class="s1">site.home'</code><code class="o">);</code>
<code class="linenos">3 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'/product/{product:slug}'</code><code class="o">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">HomeController</code><code class="nl">::cl</code><code class="o">\</code>
<code class="linenos">4 </code><code class="nx">ass</code><code class="p">,</code> <code class="s1">'single'</code><code class="cp">]</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'site.single'</code><code class="o">);</code>
</pre></div>

</figure>


<p>Baseado nas rotas acima, vamos precisar criar nosso HomeController que conterá os métodos para nossa home e nossa single do produto. Perceba, em específico na rota da single, que usamos o parâmetro dinâmico com o escopo de slug. Isso nos ajudará a, ao recebermos a instância do Model no método single esta instância vir populada com o Produto baseado no Slug informado na URL. Lembrando que o <code>:slug</code> se refere a coluna slug onde o resolvedor do parâmetro buscará o dado a ser populado na instância do Model injetado no método Single.</p>

<p>Veja na íntegra nosso controller e vamos a mais alguns conhecimentos:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Site</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">Product</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="n">HomeController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">(</code><code class="n">Product</code> <code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">12 </code>    <code class="p">{</code>
<code class="linenos">13 </code>        <code class="o">$</code><code class="n">products</code> <code class="o">=</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">whereIsActive</code><code class="p">(</code><code class="bp">true</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">orderBy</code><code class="p">(</code><code class="s1">'id'</code><code class="p">,</code> <code class="s1">'DESC'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">take</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code><code class="o">-&gt;</code>\
<code class="linenos">14 </code><code class="n">get</code><code class="p">();</code>
<code class="linenos">15 </code>
<code class="linenos">16 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'site.home'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'products'</code><code class="p">));</code>
<code class="linenos">17 </code>    <code class="p">}</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">single</code><code class="p">(</code><code class="n">Product</code> <code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">20 </code>    <code class="p">{</code>
<code class="linenos">21 </code>        <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="nb">load</code><code class="p">(</code><code class="s1">'photos'</code><code class="p">);</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'site.single'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'product'</code><code class="p">));</code>
<code class="linenos">24 </code>    <code class="p">}</code>
<code class="linenos">25 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Veja o método single e index, ambos recebem via injeção nosso model Product. Existe uma pequena diferença em ambos com respeito a esta injeção, no index como não tenho parâmetro dinâmico receberei apenas uma instância do Model para ser utilizada, já na single receberemos uma instância do Model populado com o Produto encontrado para o slug dinâmico informado e caso ele não exista receberemos um 404 lançado pelo framework antes mesmo de tentar executar o método do nosso controller.</p>

<p>No index perceba também que usei o método <code>whereIsActive</code> que será traduzido pelo framework para <code>where('is_active', true)</code>(onde is_active seja igual a true), usando métodos mágicos desta forma você poupa muita escrita. Por exemplo, você quer buscar o produto baseado no slug, você faria algo assim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">-&gt;</code><code class="n">where</code><code class="p">(</code><code class="s">'slug'</code><code class="p">,</code> <code class="err">$</code><code class="n">slug</code><code class="p">);</code>
</pre></div>

</figure>


<p>Com a escrita via método mágico, você pode fazer assim:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">-&gt;</code><code class="n">whereSlug</code><code class="p">(</code><code class="err">$</code><code class="n">slug</code><code class="p">);</code>
</pre></div>

</figure>


<p>Desta forma trago mais um exemplo para você fixar esta escrita, lembrando que a coluna deve existir na sua tabela caso contrário receberá um erro. Continuando no index perceba que peguei apenas 10 produtos, com o método <code>taken</code> e ordenei pelo id mais recente. O query builder do Laravel permite que criemos queries das mais variadas formas, então considere aqui um ínicio para esta jornada na parte de queries no Laravel, quanto mais você for buscando prosseguir na jornada mais facilitadores encontrará para criar suas queries e realizar suas execuções no banco de dados.</p>

<p>No método single, usei o método <code>load</code> para enviar junto do produto recebido as fotos deste produto. Desta forma podemos utilizá-las na view para exibir as fotos do produto.</p>

<h3 id="leanpub-auto-lazy--eager-loading" class="subsection">Lazy &amp; Eager Loading</h3>

<p>Aqui faço uma pausa para falar de mais um conceito beeem importante no Eloquent, que é Lazy e Eager Loading. Quando falamos de lazy loading ou carregamento (lento,preguiçoso) tratamos dos dados relacionados apenas quando acessamos a ligação, ou seja, imagina que eu busco um produto:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Product</code><code class="p">::</code><code class="nd">find</code><code class="o">(</code><code class="nt">10</code><code class="o">);</code>
</pre></div>

</figure>


<p>Este produto por padrão trará apenas os dados dele próprio, mesmo tendo dados relacionados. Quando chamamos posterior algo como <code>$product-&gt;photos</code> é somente neste momento que teremos a query e a busca das fotos do produto buscado. Então somente quando precisamos do dado é que ele será buscado e entregue dando a característica do Lazy Loading.</p>

<p>Já no Eager Loading, você terá seu dado junto dos dados relacionados ao buscar por eles. Usando eager loading para trazer o produto e suas fotos, por exemplo, teríamos algos como abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Product</code><code class="p">::</code><code class="nd">with</code><code class="o">(</code><code class="s1">'photos'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">find</code><code class="o">(</code><code class="nt">10</code><code class="o">);</code>
</pre></div>

</figure>


<p>Perceba que via método <code>with</code> já faço o loading da relação e logo em seguida tenho a busca do produto de id 10, desta forma nosso resultado será o model Product com os dados do produto 10 junto dos dados relacionados, neste caso as fotos. Se você tiver mais relações e quer trazer todas juntas, basta informa com a adição de mais parâmetros ou passar um array informando o nome das relações baseados no(s) método(s) de ligação em seu Model.</p>

<p>Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Product</code><code class="p">::</code><code class="nd">with</code><code class="o">(</code><code class="s1">'relacao1'</code><code class="o">,</code> <code class="s1">'relacao2'</code><code class="o">);</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="o">//</code><code class="nt">ou</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code><code class="nt">Product</code><code class="p">::</code><code class="nd">with</code><code class="o">(</code><code class="cp">[</code><code class="s1">'relacao1'</code><code class="p">,</code> <code class="s1">'relacao2'</code><code class="cp">]</code><code class="o">);</code>
</pre></div>

</figure>


<p>Lembrando que podemos também executar queries, por exemplo condicionais, para trazer apenas dados específicos na chamada do método with. Por exemplo imagina que eu quisesse apenas as fotos ativas, poderia fazer desta forma:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Product</code><code class="p">::</code><code class="nd">with</code><code class="o">(</code><code class="cp">[</code><code class="s1">'photos'</code> <code class="o">=&gt;</code> <code class="nx">fn</code><code class="p">(</code><code class="nv">$query</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nv">$query</code><code class="o">-&gt;</code><code class="nb">where</code><code class="p">(</code><code class="s1">'status'</code><code class="p">,</code> <code class="kc">true</code><code class="p">)</code><code class="cp">]</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">find</code><code class="o">(</code><code class="nt">10</code><code class="o">);</code>
</pre></div>

</figure>


<p>Desta forma podemos realizar condicionais nas querys dos dados relacionados e trazidos via Eager Loading. As possibilidades são inúmeras e recomendo já anotar aí mais um ponto a explorar após a leitura deste material!</p>

<p>Mas Nanderson, você usou o método <code>load</code> e não <code>with</code>. Nesse caso estou usando o <b>Lazy Eager Loading</b>, pois como o Laravel já me entregou o model populado com o Produto baseado no slug do parâmetro dinâmico, usei este mecanismo para atachar as fotos do produto em tempo de execução antes de ir para a view.</p>

<h3 id="leanpub-auto-eager--lazy-loading-qual-usar" class="subsection">Eager &amp; Lazy Loading, Qual Usar?</h3>

<p>Neste ponto temos a vantagem no Eager Loading quando pensamos no problema N+1 em queries no banco. Por exemplo, imagina que você tenha um endereço para o cliente e ao buscar 10 clientes você quer o endereço de cada um deles. Ao todo teremos 10 queries para os endereços + a query da busca dos clientes. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">$</code><code class="nt">customers</code> <code class="o">=</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">Customer</code><code class="p">::</code><code class="nd">take</code><code class="o">(</code><code class="nt">10</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">get</code><code class="o">();</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="nt">foreach</code><code class="o">($</code><code class="nt">customers</code> <code class="nt">as</code> <code class="o">$</code><code class="nt">customer</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">4 </code>    <code class="err">echo</code> <code class="err">$customer-&gt;address-&gt;address</code><code class="p">;</code>
<code class="linenos">5 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Com o padrão lazy loading teríamos a query dos clientes + 1 query para cada chamada de endereço. Com eager loading essas buscas seriam reduzidas, pois seriam trazidas em lote. Por exemplo com a adição do with, baseado no mesmo trecho acima:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">$</code><code class="nt">customers</code> <code class="o">=</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">Customer</code><code class="p">::</code><code class="nd">with</code><code class="o">(</code><code class="s1">'address'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">take</code><code class="o">(</code><code class="nt">10</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">get</code><code class="o">();</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="nt">foreach</code><code class="o">($</code><code class="nt">customers</code> <code class="nt">as</code> <code class="o">$</code><code class="nt">customer</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">4 </code>    <code class="err">echo</code> <code class="err">$customer-&gt;address-&gt;address</code><code class="p">;</code>
<code class="linenos">5 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Desta forma teríamos uma query tal qual vemos abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>-- query pros customers
<code class="linenos">2 </code>SELECT * FROM customers LIMIT 10;
<code class="linenos">3 </code>
<code class="linenos">4 </code>-- query pros endereços
<code class="linenos">5 </code>
<code class="linenos">6 </code>SELECT * FROM address WHERE customer_id in (1, 2, 3, 4, 5, 6, 7, 8, 9, 10);
</pre></div>

</figure>


<p>Perceba que ao invés de 11 queries, temos apenas duas queries quando usamos eager loading, ou seja, o ponto aqui não é termos duas queries mas sim a redução destas queries na chamada para aquela busca no banco de dados. Vão existir cenários pequenos que o Lazy Loading será o suficiente para você mas sempre que você identificar telas que demandam de muita chamada a relacionamentos tenha o cuidado de buscar seus dados com eager loading e claro sempre que possível pagine seus resultados.</p>

<h2 id="leanpub-auto-mutators--accessors" class="section">Mutators &amp; Accessors</h2>

<p>Existe mais um conhecimento que existe no Eloquent e é aplicado em seus Models, a possibilidade de modificar os dados da sua tabela em tempo de execução tanto na chamada do dado quanto na criação deste dado. Por exemplo, criarei um accessor e mutator para nossa coluna do preço (lembra que estamos usando ela como inteiro mas precisamos formatar para exibir e também quando vamos salvar e/ou atualizar). Um accessor e um mutator no model deixará este ponto mais organizado.</p>

<p>Veja o método abaixo que coloquei no <code>Product.php</code> model:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">price</code><code class="o">():</code> <code class="nt">Attribute</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">return</code> <code class="err">new</code> <code class="err">Attribute(</code>
<code class="linenos">4 </code>        <code class="n">get</code><code class="p">:</code> <code class="nf">fn</code><code class="p">(</code><code class="err">$</code><code class="n">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">value</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code> 
<code class="linenos">5 </code>        <code class="n">set</code><code class="o">:</code>  <code class="nf">fn</code><code class="p">(</code><code class="err">$</code><code class="n">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">value</code> <code class="o">*</code> <code class="mi">100</code>
<code class="linenos">6 </code>    <code class="p">);</code>
<code class="linenos">7 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Acima temos um método chamado de <code>price</code> que será lido pelo Laravel em prioridade quanto eu tentar acessar a propriedade <code>price</code> do nosso produto. O callback para o parâmetro* <code>get</code>, pega nosso valor inteiro e colocar a vírgula duas casas pra esquerda trazendo nosso ponto decimal pro lugar correto, já o parâmetro <code>set</code> recebe o callback que pegerá o valor informado para propriedade <code>price</code> e colocar o ponto decimal duas casas para a direita deixando nosso inteiro no ponto a ser salvo. O accessor seria o <code>get</code> e o mutator seria o<code>set</code>, o accessor age quando pego o valor do preço do produto e o mutator quando vou salvar ou atualizar este preço.</p>

<blockquote>
  <p>*usei acima os parâmetros nomeados do PHP 8 no construtor do Attribute</p>
</blockquote>

<p>Desta forma podemos organizar melhor também nossos controllers, no momento dos saves do produto. Ainda no model Product, criei um accessor para colocar uma thumb na home baseado na ligação de Produto e Fotos. </p>

<p>Veja abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">thumb</code><code class="o">():</code> <code class="nt">Attribute</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">return</code> <code class="err">new</code> <code class="err">Attribute(</code><code class="n">get</code><code class="p">:</code> <code class="nf">fn</code><code class="p">(</code><code class="err">$</code><code class="n">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">this-</code><code class="o">&gt;</code><code class="n">photos</code><code class="o">?-&gt;</code><code class="nf">first</code><code class="p">()</code><code class="o">?-&gt;</code><code class="n">photo</code><code class="p">);</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<blockquote>
  <p>PS.: Não esqueça de importar no model Product o cast Attribute usado na definição dos accessors e mutators: <code>use Illuminate\Database\Eloquent\Casts\Attribute;</code></p>
</blockquote>

<p>Neste caso, thumb não existe na tabela então ele vira uma propriedade virtual do objeto/model Produto. Quando acessado trará, se existir, a foto thumb relacionada ao produto, que acima pego a primeira foto da ligação. Você verá esta chamada quando codarmos a view front da loja.</p>

<p>Abaixo segue o model completo para consulta:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Models</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Casts</code>\<code class="n">Attribute</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Model</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Factories</code>\<code class="n">HasFactory</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Relations</code>\<code class="n">HasMany</code><code class="p">;</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code><code class="k">class</code> <code class="n">Product</code> <code class="k">extends</code> <code class="n">Model</code>
<code class="linenos">11 </code><code class="p">{</code>
<code class="linenos">12 </code>    <code class="n">use</code> <code class="n">HasFactory</code><code class="p">;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code>    <code class="n">protected</code> <code class="o">$</code><code class="n">fillable</code> <code class="o">=</code> <code class="p">[</code>
<code class="linenos">15 </code>        <code class="s1">'name'</code><code class="p">,</code>
<code class="linenos">16 </code>        <code class="s1">'description'</code><code class="p">,</code>
<code class="linenos">17 </code>        <code class="s1">'body'</code><code class="p">,</code>
<code class="linenos">18 </code>        <code class="s1">'slug'</code><code class="p">,</code>
<code class="linenos">19 </code>        <code class="s1">'is_active'</code><code class="p">,</code>
<code class="linenos">20 </code>        <code class="s1">'in_stock'</code><code class="p">,</code>
<code class="linenos">21 </code>        <code class="s1">'price'</code>
<code class="linenos">22 </code>    <code class="p">];</code>
<code class="linenos">23 </code>
<code class="linenos">24 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">photos</code><code class="p">():</code> <code class="n">HasMany</code>
<code class="linenos">25 </code>    <code class="p">{</code>
<code class="linenos">26 </code>        <code class="k">return</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">hasMany</code><code class="p">(</code><code class="n">ProductPhoto</code><code class="p">::</code><code class="k">class</code><code class="p">);</code>
<code class="linenos">27 </code>    <code class="p">}</code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">categories</code><code class="p">()</code>
<code class="linenos">30 </code>    <code class="p">{</code>
<code class="linenos">31 </code>        <code class="k">return</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">belongsToMany</code><code class="p">(</code><code class="n">Category</code><code class="p">::</code><code class="k">class</code><code class="p">);</code>
<code class="linenos">32 </code>    <code class="p">}</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code>    <code class="o">/**</code>
<code class="linenos">35 </code>     <code class="o">*</code> <code class="n">Accessors</code>
<code class="linenos">36 </code>     <code class="o">*/</code>
<code class="linenos">37 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">thumb</code><code class="p">():</code> <code class="n">Attribute</code>
<code class="linenos">38 </code>    <code class="p">{</code>
<code class="linenos">39 </code>        <code class="k">return</code> <code class="n">new</code> <code class="n">Attribute</code><code class="p">(</code><code class="n">get</code><code class="p">:</code> <code class="n">fn</code><code class="p">(</code><code class="o">$</code><code class="n">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">photos</code><code class="err">?</code><code class="o">-&gt;</code><code class="n">first</code><code class="p">()</code><code class="err">?</code><code class="o">-&gt;</code><code class="n">photo</code><code class="p">);</code>
<code class="linenos">40 </code>    <code class="p">}</code>
<code class="linenos">41 </code>
<code class="linenos">42 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">price</code><code class="p">():</code> <code class="n">Attribute</code>
<code class="linenos">43 </code>    <code class="p">{</code>
<code class="linenos">44 </code>        <code class="k">return</code> <code class="n">new</code> <code class="n">Attribute</code><code class="p">(</code>
<code class="linenos">45 </code>            <code class="n">get</code><code class="p">:</code> <code class="n">fn</code><code class="p">(</code><code class="o">$</code><code class="n">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">value</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>
<code class="linenos">46 </code>            <code class="n">set</code><code class="p">:</code>  <code class="n">fn</code><code class="p">(</code><code class="o">$</code><code class="n">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">value</code> <code class="o">*</code> <code class="mi">100</code>
<code class="linenos">47 </code>        <code class="p">);</code>
<code class="linenos">48 </code>    <code class="p">}</code>
<code class="linenos">49 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Baseado no accessor/mutator de price, veja o método store e update alterados lá no <code>ProductController</code> da pasta <code>Admin</code>:</p>

<p><b>store</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="kr">function</code> <code class="kr">store</code><code class="p">(</code><code class="n">ProductRequest</code> <code class="err">$</code><code class="n">request</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">$</code><code class="kt">data</code> <code class="o">=</code> <code class="err">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="kr">all</code><code class="p">();</code>
<code class="linenos"> 4 </code>    <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'price'</code><code class="p">]</code> <code class="o">=</code> <code class="p">(</code><code class="n">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="s">'.'</code><code class="p">,</code> <code class="s">','</code><code class="p">],</code> <code class="p">[</code><code class="s">''</code><code class="p">,</code> <code class="s">'.'</code><code class="p">],</code> <code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'price'</code><code class="p">]);</code>
<code class="linenos"> 5 </code>
<code class="linenos"> 6 </code>    <code class="err">$</code><code class="n">product</code> <code class="o">=</code> <code class="err">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code>    <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">sync</code><code class="p">(</code><code class="err">$</code><code class="n">data</code><code class="p">[</code><code class="s">'categories'</code><code class="p">]);</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code>    <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'products.edit'</code><code class="p">,</code> <code class="p">[</code><code class="s">'product'</code> <code class="o">=&gt;</code> <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">11 </code><code class="p">}</code>
</pre></div>

</figure>


<p><b>update</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="k">function</code> <code class="n">update</code><code class="p">(</code><code class="n">$product</code><code class="p">,</code> <code class="n">ProductRequest</code> <code class="n">$request</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="c1">//Atualizando com mass assignment</code>
<code class="linenos"> 4 </code>    <code class="n">$data</code> <code class="o">=</code> <code class="n">$request</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">();</code>
<code class="linenos"> 5 </code>    <code class="n">$data</code><code class="p">['</code><code class="n">price</code><code class="p">']</code> <code class="o">=</code> <code class="p">(</code><code class="n">float</code><code class="p">)</code> <code class="n">str_replace</code><code class="p">([</code><code class="sc">'.'</code><code class="p">,</code> <code class="sc">','</code><code class="p">],</code> <code class="p">['',</code> <code class="sc">'.'</code><code class="p">],</code> <code class="n">$data</code><code class="p">['</code><code class="n">price</code><code class="p">']);</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="n">$product</code> <code class="o">=</code> <code class="n">$this</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">findOrFail</code><code class="p">(</code><code class="n">$product</code><code class="p">);</code>
<code class="linenos"> 8 </code>    <code class="n">$product</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">(</code><code class="n">$data</code><code class="p">);</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code>    <code class="n">$product</code><code class="o">-&gt;</code><code class="n">categories</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">sync</code><code class="p">(</code><code class="n">$data</code><code class="p">['</code><code class="n">categories</code><code class="p">']);</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code>    <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">('</code><code class="n">products</code><code class="p">.</code><code class="n">edit</code><code class="p">',</code> <code class="p">['</code><code class="n">product</code><code class="p">'</code> <code class="o">=&gt;</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">]);</code>
<code class="linenos">13 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Também remova esta linha do método <code>edit</code> no <code>Admin/ProductController</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code> <code class="o">=</code> <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code> <code class="o">/</code> <code class="mi">100</code><code class="p">;</code>
</pre></div>

</figure>


<h2 id="leanpub-auto-nossas-views-home--single-produto" class="section">Nossas Views: Home &amp; Single Produto</h2>

<p>A nossa view da home está bem tranquila, segue ela abaixo:</p>

<p>View <code>resources/views/site/home.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-20"</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"border-b border-purple-500 mb-10 pb-4 flex justify-between items\</code>
<code class="linenos"> 5 </code><code class="s">-center"</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>            <code class="o">&lt;</code><code class="n">h1</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-4xl font-bold text-white"</code><code class="o">&gt;</code><code class="n">Produtos</code><code class="o">&lt;/</code><code class="n">h1</code><code class="o">&gt;</code>
<code class="linenos"> 7 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"max-w-7xl grid grid-cols-3 gap-14"</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code>            <code class="p">@</code><code class="n">foreach</code><code class="p">(</code><code class="n">$products</code> <code class="n">as</code> <code class="n">$product</code><code class="p">)</code>
<code class="linenos">10 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-96 min-h-[460px] relative bg-white border border-purpl\</code>
<code class="linenos">11 </code><code class="s">e-500 rounded mb-10 shadow shadow-purple-500"</code><code class="o">&gt;</code>
<code class="linenos">12 </code>                    <code class="o">&lt;</code><code class="n">img</code> <code class="n">src</code><code class="o">=</code><code class="s">"{{$product-&gt;thumb ? asset('storage/' . $product-&gt;thumb\</code>
<code class="linenos">13 </code><code class="s">) : asset('storage/no-photo.jpg') }}"</code>
<code class="linenos">14 </code>                        <code class="n">alt</code><code class="o">=</code><code class="s">"Foto Produto: {{$product-&gt;name}}"</code>
<code class="linenos">15 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"w-full h-52 rounded-t"</code><code class="o">&gt;</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"p-4"</code><code class="o">&gt;</code>
<code class="linenos">18 </code>                        <code class="o">&lt;</code><code class="n">h4</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-xl font-bold capitalize"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">}}</code><code class="o">&lt;</code>\
<code class="linenos">19 </code><code class="o">/</code><code class="n">h4</code><code class="o">&gt;</code>
<code class="linenos">20 </code>
<code class="linenos">21 </code>                        <code class="o">&lt;</code><code class="n">p</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-xl font-thin py-2"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">description</code><code class="p">}}</code><code class="o">&lt;</code>\
<code class="linenos">22 </code><code class="o">/</code><code class="n">p</code><code class="o">&gt;</code>
<code class="linenos">23 </code>
<code class="linenos">24 </code>                        <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-3xl mt-4 mb-10 font-bold text-red-800"</code><code class="o">&gt;</code><code class="n">R$</code> <code class="p">{{</code>\
<code class="linenos">25 </code><code class="n">number_format</code><code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">price</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="sc">','</code><code class="p">,</code> <code class="sc">'.'</code><code class="p">)}}</code><code class="o">&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>                        <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{route('site.single', ['product' =&gt; $product-&gt;slug\</code>
<code class="linenos">28 </code><code class="s">])}}"</code>
<code class="linenos">29 </code>                                <code class="k">class</code><code class="o">=</code><code class="s">"absolute bottom-2 px-8 py-4 mt-5 bg-gradient-\</code>
<code class="linenos">30 </code><code class="s">to-b from-purple-500 to-purple-800</code>
<code class="linenos">31 </code>                                    <code class="n">font</code><code class="o">-</code><code class="n">bold</code> <code class="n">text</code><code class="o">-</code><code class="n">white</code> <code class="n">transition</code><code class="o">-</code><code class="n">all</code> <code class="n">duration</code><code class="mi">-300</code>\
<code class="linenos">32 </code> <code class="n">ease</code><code class="o">-</code><code class="k">in</code><code class="o">-</code><code class="k">out</code> <code class="n">rounded</code>
<code class="linenos">33 </code>                                    <code class="nl">hover</code><code class="p">:</code><code class="n">to</code><code class="o">-</code><code class="n">purple</code><code class="mi">-800</code> <code class="nl">hover</code><code class="p">:</code><code class="n">from</code><code class="o">-</code><code class="n">purple</code><code class="mi">-900</code><code class="s">"&gt;</code>
<code class="linenos">34 </code>                            <code class="n">Ver</code> <code class="n">produto</code>
<code class="linenos">35 </code>                        <code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">36 </code>                    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">37 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">38 </code>            <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">39 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">40 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">41 </code><code class="o">&lt;/</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>Perceba que envolvo nosso componente de layout no conteúdo da view acima, e todo o conteúdo envolvido será jogado na variável <code>$slot</code> do componente. Um ponto aqui, só pra constar, é que como nosso componente site.blade.php está na pasta <code>layouts</code> dentro de components da pasta de views, precisamos referenciar o caminho na chamada do tag componente, como você ver acima: `&lt;x-layouts.site&gt;&lt;/x-layouts.site&gt;.</p>

<p>Nossa Home ficou assim:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----home-site.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Nossa view para a single do produto segue abaixo, em seguida pontuo os pontos importantes e novos:</p>

<p><code>resources/views/site/single.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-20"</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>        <code class="p">@</code><code class="n">php</code> <code class="n">$photos</code> <code class="o">=</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">photos</code><code class="p">;</code> <code class="p">@</code><code class="n">endphp</code>
<code class="linenos"> 5 </code>
<code class="linenos"> 6 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"max-w-7xl @if($photos-&gt;count()) flex gap-x-4 @endif"</code><code class="o">&gt;</code>
<code class="linenos"> 7 </code>            <code class="p">@</code><code class="n">php</code> <code class="n">$photos</code> <code class="o">=</code> <code class="n">$product</code><code class="o">-&gt;</code><code class="n">photos</code><code class="p">;</code> <code class="p">@</code><code class="n">endphp</code>
<code class="linenos"> 8 </code>            <code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">$photos</code><code class="o">-&gt;</code><code class="n">count</code><code class="p">())</code>
<code class="linenos"> 9 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[40%] p-2"</code><code class="o">&gt;</code>
<code class="linenos">10 </code>                <code class="o">&lt;</code><code class="n">img</code> <code class="n">src</code><code class="o">=</code><code class="s">"{{ asset('storage/' . $photos-&gt;first()-&gt;photo) }}"</code>
<code class="linenos">11 </code>                <code class="n">alt</code><code class="o">=</code><code class="s">"Foto Produto: {{$product-&gt;name}}"</code>
<code class="linenos">12 </code>                <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-1 rounded bg-purple-500 shadow shadow-black rounded-\</code>
<code class="linenos">13 </code><code class="s">t"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"mainPhoto"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-4 flex gap-x-2"</code><code class="o">&gt;</code>
<code class="linenos">16 </code>                    <code class="p">@</code><code class="n">foreach</code><code class="p">(</code><code class="n">$photos</code> <code class="n">as</code> <code class="n">$photo</code><code class="p">)</code>
<code class="linenos">17 </code>                    <code class="o">&lt;</code><code class="n">img</code> <code class="n">src</code><code class="o">=</code><code class="s">"{{ asset('storage/' . $photo-&gt;photo) }}"</code>
<code class="linenos">18 </code>                        <code class="n">alt</code><code class="o">=</code><code class="s">"Foto Produto: {{$product-&gt;name}}"</code>
<code class="linenos">19 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"w-[25%] p-1 rounded bg-purple-500 shadow shadow-black\</code>
<code class="linenos">20 </code><code class="s"> rounded-t photoList"</code><code class="o">&gt;</code>
<code class="linenos">21 </code>                    <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">22 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">23 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">24 </code>            <code class="p">@</code><code class="n">endif</code>
<code class="linenos">25 </code>            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"@if($photos-&gt;count()) w-[60%] @else w-full @endif pl-12"</code><code class="o">&gt;</code>
<code class="linenos">26 </code>                <code class="o">&lt;</code><code class="n">h1</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-4xl font-bold text-white mb-4"</code><code class="o">&gt;</code><code class="nl">Produto</code><code class="p">:</code> <code class="p">{{</code><code class="n">$product</code><code class="o">-&gt;</code>\
<code class="linenos">27 </code><code class="n">name</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">h1</code><code class="o">&gt;</code>
<code class="linenos">28 </code>                <code class="o">&lt;</code><code class="n">p</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">description</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">p</code><code class="o">&gt;</code>
<code class="linenos">29 </code>                <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-3xl mt-4 mb-10 font-bold text-white"</code><code class="o">&gt;</code><code class="n">R$</code> <code class="p">{{</code><code class="n">number_for</code>\
<code class="linenos">30 </code><code class="n">mat</code><code class="p">(</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">price</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="sc">','</code><code class="p">,</code> <code class="sc">'.'</code><code class="p">)}}</code><code class="o">&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos">31 </code>
<code class="linenos">32 </code>                <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{route('site.cart.add')}}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos">33 </code>                    <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">34 </code>
<code class="linenos">35 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"flex items-center gap-x-2"</code><code class="o">&gt;</code>
<code class="linenos">36 </code>                        <code class="o">&lt;</code><code class="n">label</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white"</code><code class="o">&gt;</code><code class="n">Quantidade</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">37 </code>                        <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"hidden"</code> <code class="n">name</code><code class="o">=</code><code class="s">"cart[product]"</code> <code class="n">value</code><code class="o">=</code><code class="s">"{{$product-\</code>
<code class="linenos">38 </code><code class="s">&gt;slug}}"</code><code class="o">&gt;</code>
<code class="linenos">39 </code>                        <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"number"</code> <code class="n">min</code><code class="o">=</code><code class="s">"1"</code> <code class="n">name</code><code class="o">=</code><code class="s">"cart[quantity]"</code> <code class="n">required</code> \
<code class="linenos">40 </code><code class="k">class</code><code class="o">=</code><code class="s">"w-[80px] p-4 rounded border-purple-900 text-white bg-black text-2xl"</code> <code class="n">value</code><code class="o">=</code><code class="s">"1\</code>
<code class="linenos">41 </code><code class="s">"</code><code class="o">&gt;</code>
<code class="linenos">42 </code>                        <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">cart</code><code class="p">.</code><code class="n">product</code><code class="err">'</code><code class="p">)</code> <code class="o">&lt;</code><code class="n">span</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-xl font-bold text-w\</code>
<code class="linenos">43 </code><code class="s">hite bg-red-800 rounded p-1"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">span</code><code class="o">&gt;</code> <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">44 </code>                        <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">cart</code><code class="p">.</code><code class="n">quantity</code><code class="err">'</code><code class="p">)</code> <code class="o">&lt;</code><code class="n">span</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-xl font-bold text-\</code>
<code class="linenos">45 </code><code class="s">white bg-red-800 rounded p-1"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">span</code><code class="o">&gt;</code> <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">46 </code>                    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">47 </code>                    <code class="o">&lt;</code><code class="n">button</code>
<code class="linenos">48 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"px-8 py-4 mt-5 bg-gradient-to-b from-purple-500 to-pu\</code>
<code class="linenos">49 </code><code class="s">rple-800</code>
<code class="linenos">50 </code>                            <code class="n">font</code><code class="o">-</code><code class="n">bold</code> <code class="n">text</code><code class="o">-</code><code class="n">white</code> <code class="n">transition</code><code class="o">-</code><code class="n">all</code> <code class="n">duration</code><code class="mi">-300</code> <code class="n">ease</code><code class="o">-</code><code class="k">in</code>\
<code class="linenos">51 </code><code class="o">-</code><code class="k">out</code> <code class="n">rounded</code>
<code class="linenos">52 </code>                            <code class="nl">hover</code><code class="p">:</code><code class="n">to</code><code class="o">-</code><code class="n">purple</code><code class="mi">-800</code> <code class="nl">hover</code><code class="p">:</code><code class="n">from</code><code class="o">-</code><code class="n">purple</code><code class="mi">-900</code><code class="s">"&gt;</code>
<code class="linenos">53 </code>                    <code class="n">COMPRAR</code>
<code class="linenos">54 </code>                <code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">55 </code>                <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">56 </code>            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">57 </code>
<code class="linenos">58 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">59 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-10 py-10 border-t border-purple-500"</code><code class="o">&gt;</code>
<code class="linenos">60 </code>            <code class="o">&lt;</code><code class="n">p</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white text-xl"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$product</code><code class="o">-&gt;</code><code class="n">body</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">p</code><code class="o">&gt;</code>
<code class="linenos">61 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">62 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">63 </code>
<code class="linenos">64 </code>    <code class="p">@</code><code class="n">push</code><code class="p">(</code><code class="err">'</code><code class="n">scripts</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">65 </code>        <code class="o">&lt;</code><code class="n">script</code><code class="o">&gt;</code>
<code class="linenos">66 </code>            <code class="k">const</code> <code class="n">mainPhoto</code> <code class="o">=</code> <code class="n">document</code><code class="p">.</code><code class="n">querySelector</code><code class="p">(</code><code class="err">'</code><code class="n">img</code><code class="err">#</code><code class="n">mainPhoto</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">67 </code>            <code class="k">const</code> <code class="n">listPhotos</code> <code class="o">=</code> <code class="n">document</code><code class="p">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="err">'</code><code class="n">img</code><code class="p">.</code><code class="n">photoList</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">68 </code>
<code class="linenos">69 </code>            <code class="n">listPhotos</code><code class="p">.</code><code class="n">forEach</code><code class="p">(</code><code class="n">photoEl</code> <code class="o">=&gt;</code> <code class="p">{</code>
<code class="linenos">70 </code>                <code class="n">photoEl</code><code class="p">.</code><code class="n">addEventListener</code><code class="p">(</code><code class="err">'</code><code class="n">mouseover</code><code class="err">'</code><code class="p">,</code> <code class="n">e</code> <code class="o">=&gt;</code> <code class="p">{</code>
<code class="linenos">71 </code>                    <code class="n">mainPhoto</code><code class="p">.</code><code class="n">src</code> <code class="o">=</code> <code class="n">e</code><code class="p">.</code><code class="n">target</code><code class="p">.</code><code class="n">src</code><code class="p">;</code>
<code class="linenos">72 </code>                <code class="p">})</code>
<code class="linenos">73 </code>            <code class="p">})</code>
<code class="linenos">74 </code>        <code class="o">&lt;/</code><code class="n">script</code><code class="o">&gt;</code>
<code class="linenos">75 </code>    <code class="p">@</code><code class="n">endpush</code>
<code class="linenos">76 </code><code class="o">&lt;/</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>De ínicio chamo a atenção para a diretiva <code>@php @endphp</code>, que nos permite na view blade criar código vanilla PHP. Aqui uso apenas para definir uma variável que utilizarei na view, guardando as fotos do produto em questão.</p>

<p>Nesta view criei algumas condicionais baseadas na existência das fotos onde altero o layout caso o produto não tenha foto e adequo o layout pro caso de termos foto pro produto como forma de exibi-las organizadamente.</p>

<p>Essa view também traz um pequeno script onde aplico um efeito ao passar o mouse na lista de imagens, fazendo com que a imagem que você estiver passando o mouse seja destacada na imagem principal. Trecho do script destacado abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="n">push</code><code class="p">(</code><code class="err">'</code><code class="n">scripts</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">script</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>        <code class="k">const</code> <code class="n">mainPhoto</code> <code class="o">=</code> <code class="n">document</code><code class="p">.</code><code class="n">querySelector</code><code class="p">(</code><code class="err">'</code><code class="n">img</code><code class="err">#</code><code class="n">mainPhoto</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 4 </code>        <code class="k">const</code> <code class="n">listPhotos</code> <code class="o">=</code> <code class="n">document</code><code class="p">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="err">'</code><code class="n">img</code><code class="p">.</code><code class="n">photoList</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 5 </code>
<code class="linenos"> 6 </code>        <code class="n">listPhotos</code><code class="p">.</code><code class="n">forEach</code><code class="p">(</code><code class="n">photoEl</code> <code class="o">=&gt;</code> <code class="p">{</code>
<code class="linenos"> 7 </code>            <code class="n">photoEl</code><code class="p">.</code><code class="n">addEventListener</code><code class="p">(</code><code class="err">'</code><code class="n">mouseover</code><code class="err">'</code><code class="p">,</code> <code class="n">e</code> <code class="o">=&gt;</code> <code class="p">{</code>
<code class="linenos"> 8 </code>                <code class="n">mainPhoto</code><code class="p">.</code><code class="n">src</code> <code class="o">=</code> <code class="n">e</code><code class="p">.</code><code class="n">target</code><code class="p">.</code><code class="n">src</code><code class="p">;</code>
<code class="linenos"> 9 </code>            <code class="p">})</code>
<code class="linenos">10 </code>        <code class="p">})</code>
<code class="linenos">11 </code>    <code class="o">&lt;/</code><code class="n">script</code><code class="o">&gt;</code>
<code class="linenos">12 </code><code class="p">@</code><code class="n">endpush</code>
</pre></div>

</figure>


<p>Perceba que pra cada foto da lista de fotos adicionao um listener pro evento de mouseover (passar do mouse sobre o elemento). Com isso pego o source da imagem que está ativa no hover e substituo na tag img principal dando o efeito comentado anteriormente. É um script bem simples de entender numa lida tranquila.</p>

<p>Nesta view ainda coloquei um form para que possamos enviar os dados do produto pro carrinho que criaremos em breve, além das info do produto mando também a quantidade desejada.</p>

<p>Como vamos aplicar algumas validações nestes dados do produto-&gt;carrinho, já coloquei também a diretivar @error para exibir as mensagens de validação.</p>

<blockquote>
  <p>Depois veja nosso repositório, como comentei no ínicio do livro, para pegar este códigos de forma mais livre e legível.</p>
</blockquote>

<p>A single do produto que têm fotos:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----single-product-with-photo.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Single do produto sem foto:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----single-product-with-no-photo.png">
    <figcaption></figcaption>
  </figure>
</div>


<h2 id="leanpub-auto-nosso-carrinho" class="section">Nosso Carrinho</h2>

<p>Nosso carrinho de produtos será gerenciado via sessão, então aqui teremos muito conhecimento que já mencionei na jornada junto do conhecimento prévio que você já têm de PHP.</p>

<p>Vamos gerar nosso CartController:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller Site/CartController
</pre></div>

</figure>


<p>Gere também o FormRequest, CartRequest:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:request CartRequest
</pre></div>

</figure>


<p>Veja o conteúdo do CartRequest abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Foundation</code>\<code class="n">Http</code>\<code class="n">FormRequest</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="n">CartRequest</code> <code class="k">extends</code> <code class="n">FormRequest</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="o">/**</code>
<code class="linenos">10 </code>     <code class="o">*</code> <code class="n">Determine</code> <code class="k">if</code> <code class="n">the</code> <code class="n">user</code> <code class="k">is</code> <code class="n">authorized</code> <code class="n">to</code> <code class="n">make</code> <code class="n">this</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">11 </code>     <code class="o">*/</code>
<code class="linenos">12 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">authorize</code><code class="p">():</code> <code class="nb nb-Type">bool</code>
<code class="linenos">13 </code>    <code class="p">{</code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="bp">true</code><code class="p">;</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="o">/**</code>
<code class="linenos">18 </code>     <code class="o">*</code> <code class="n">Get</code> <code class="n">the</code> <code class="n">validation</code> <code class="n">rules</code> <code class="n">that</code> <code class="n">apply</code> <code class="n">to</code> <code class="n">the</code> <code class="n">request</code><code class="o">.</code>
<code class="linenos">19 </code>     <code class="o">*</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="err">@</code><code class="k">return</code> <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="p">,</code> \<code class="n">Illuminate</code>\<code class="n">Contracts</code>\<code class="n">Validation</code>\<code class="n">ValidationRule</code><code class="o">|</code><code class="n">array</code><code class="o">&lt;</code><code class="n">m</code>\
<code class="linenos">21 </code><code class="n">ixed</code><code class="o">&gt;|</code><code class="n">string</code><code class="o">&gt;</code>
<code class="linenos">22 </code>     <code class="o">*/</code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">rules</code><code class="p">():</code> <code class="n">array</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">26 </code>            <code class="s1">'cart.quantity'</code> <code class="o">=&gt;</code> <code class="s1">'integer|min:1'</code><code class="p">,</code>
<code class="linenos">27 </code>            <code class="s1">'cart.product'</code> <code class="o">=&gt;</code> <code class="s1">'required|string'</code>
<code class="linenos">28 </code>        <code class="p">];</code>
<code class="linenos">29 </code>    <code class="p">}</code>
<code class="linenos">30 </code>
<code class="linenos">31 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">messages</code><code class="p">()</code>
<code class="linenos">32 </code>    <code class="p">{</code>
<code class="linenos">33 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">34 </code>            <code class="s1">'cart.quantity.min'</code> <code class="o">=&gt;</code> <code class="s1">'Quantidade Inválida!'</code><code class="p">,</code>
<code class="linenos">35 </code>            <code class="s1">'cart.product.required'</code> <code class="o">=&gt;</code> <code class="s1">'Escolha o produto para adicionar no carrinho</code><code class="se">\</code>
<code class="linenos">36 </code><code class="s1">!'</code>
<code class="linenos">37 </code>        <code class="p">];</code>
<code class="linenos">38 </code>    <code class="p">}</code>
<code class="linenos">39 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Validei tanto o envio do campo <code>product</code> quanto do <code>quantity</code>, onde o usuário deve selecionar pelo menos a quantidade <code>1</code> para o produto escolhido. Também traduzi as mensagens dentro do form request como já vimos anteriormente.</p>

<p>Segue o conteúdo na íntegra do nosso CartController:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Site</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code>\<code class="n">CartRequest</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">Product</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Services</code>\<code class="n">CartService</code><code class="p">;</code>
<code class="linenos"> 9 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code><code class="k">class</code> <code class="n">CartController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">12 </code><code class="p">{</code>
<code class="linenos">13 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">__construct</code><code class="p">(</code><code class="n">private</code> <code class="n">CartService</code> <code class="o">$</code><code class="n">cartService</code><code class="p">)</code>
<code class="linenos">14 </code>    <code class="p">{</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">18 </code>    <code class="p">{</code>
<code class="linenos">19 </code>        <code class="o">$</code><code class="n">cartItems</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">cartService</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">();</code>
<code class="linenos">20 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'site.cart'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'cartItems'</code><code class="p">));</code>
<code class="linenos">21 </code>    <code class="p">}</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">add</code><code class="p">(</code><code class="n">CartRequest</code> <code class="o">$</code><code class="n">request</code><code class="p">,</code> <code class="n">Product</code> <code class="o">$</code><code class="n">product</code><code class="p">)</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="o">$</code><code class="n">item</code> <code class="o">=</code> <code class="o">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">validated</code><code class="p">(</code><code class="s1">'cart'</code><code class="p">);</code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>        <code class="o">$</code><code class="n">product</code> <code class="o">=</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">whereSlug</code><code class="p">(</code><code class="o">$</code><code class="n">item</code><code class="p">[</code><code class="s1">'product'</code><code class="p">])</code><code class="o">-&gt;</code><code class="n">firstOrFail</code><code class="p">();</code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>        <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">cartService</code><code class="o">-&gt;</code><code class="n">add</code><code class="p">([</code>
<code class="linenos">30 </code>            <code class="s1">'id'</code>       <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">,</code>
<code class="linenos">31 </code>            <code class="s1">'quantity'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">item</code><code class="p">[</code><code class="s1">'quantity'</code><code class="p">],</code>
<code class="linenos">32 </code>            <code class="s1">'slug'</code>     <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">slug</code><code class="p">,</code>
<code class="linenos">33 </code>            <code class="s1">'name'</code>     <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">,</code>
<code class="linenos">34 </code>            <code class="s1">'photo'</code>    <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">thumb</code><code class="p">,</code>
<code class="linenos">35 </code>            <code class="s1">'price'</code>    <code class="o">=&gt;</code> <code class="o">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code>
<code class="linenos">36 </code>        <code class="p">]);</code>
<code class="linenos">37 </code>
<code class="linenos">38 </code>        <code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">flash</code><code class="p">(</code><code class="s1">'success'</code><code class="p">,</code> <code class="s1">'Produto Adicionado com Sucesso!'</code><code class="p">);</code>
<code class="linenos">39 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">back</code><code class="p">();</code>
<code class="linenos">40 </code>    <code class="p">}</code>
<code class="linenos">41 </code>
<code class="linenos">42 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">remove</code><code class="p">(</code><code class="n">string</code> <code class="o">$</code><code class="n">item</code><code class="p">)</code>
<code class="linenos">43 </code>    <code class="p">{</code>
<code class="linenos">44 </code>        <code class="k">if</code><code class="p">(</code><code class="o">!$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">cartService</code><code class="o">-&gt;</code><code class="n">has</code><code class="p">(</code><code class="o">$</code><code class="n">item</code><code class="p">,</code> <code class="n">column</code><code class="p">:</code> <code class="s1">'slug'</code><code class="p">))</code> <code class="p">{</code>
<code class="linenos">45 </code>            <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'site.index'</code><code class="p">);</code>
<code class="linenos">46 </code>        <code class="p">}</code>
<code class="linenos">47 </code>
<code class="linenos">48 </code>        <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">cartService</code><code class="o">-&gt;</code><code class="n">remove</code><code class="p">(</code><code class="o">$</code><code class="n">item</code><code class="p">);</code>
<code class="linenos">49 </code>
<code class="linenos">50 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'site.cart.index'</code><code class="p">);</code>
<code class="linenos">51 </code>    <code class="p">}</code>
<code class="linenos">52 </code>
<code class="linenos">53 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">cancel</code><code class="p">()</code>
<code class="linenos">54 </code>    <code class="p">{</code>
<code class="linenos">55 </code>        <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">cartService</code><code class="o">-&gt;</code><code class="n">clear</code><code class="p">();</code>
<code class="linenos">56 </code>
<code class="linenos">57 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'site.home'</code><code class="p">);</code>
<code class="linenos">58 </code>    <code class="p">}</code>
<code class="linenos">59 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Um ponto bem importante aqui neste controller é que delegamos todo o processo de gerenciamento do carrinho pra um service, que vamos criar ainda. Este service gerencia tanto as adições como remoções, limpeza do carrinho e recuperação dos itens do carrinho.</p>

<p>O método index do CartController carregará a tela principal do carrinho, exibindo os itens existente ali mas antes vamos ao CartService abaixo:</p>

<blockquote>
  <p>Crie manualmente o arquivo no caminho abaixo:</p>
</blockquote>

<p><code>app/Services/CartService.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Services</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="k">use</code> <code class="nx">Illuminate\Session\SessionManager</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="nc">CartService</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="k">private</code> <code class="k">const</code> <code class="no">SESSION_KEY</code> <code class="o">=</code> <code class="s1">'cart'</code><code class="p">;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">private</code> <code class="nx">SessionManager</code> <code class="nv">$session</code><code class="p">)</code>
<code class="linenos">12 </code>    <code class="p">{</code>
<code class="linenos">13 </code>        <code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">has</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSION_KEY</code><code class="p">))</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">put</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSIO\</code>
<code class="linenos">14 </code><code class="nx">N_KEY</code><code class="p">,</code> <code class="p">[]);</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">all</code><code class="p">()</code>
<code class="linenos">18 </code>    <code class="p">{</code>
<code class="linenos">19 </code>        <code class="k">return</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">get</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSION_KEY</code><code class="p">);</code>
<code class="linenos">20 </code>    <code class="p">}</code>
<code class="linenos">21 </code>
<code class="linenos">22 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">count</code><code class="p">()</code>
<code class="linenos">23 </code>    <code class="p">{</code>
<code class="linenos">24 </code>        <code class="k">return</code> <code class="nb">count</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">all</code><code class="p">());</code>
<code class="linenos">25 </code>    <code class="p">}</code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">has</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$item</code><code class="p">,</code> <code class="nx">string</code> <code class="nv">$column</code> <code class="o">=</code> <code class="s1">'id'</code><code class="p">)</code>
<code class="linenos">28 </code>    <code class="p">{</code>
<code class="linenos">29 </code>        <code class="nv">$itemsList</code> <code class="o">=</code> <code class="nb">array_column</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">all</code><code class="p">(),</code> <code class="nv">$column</code><code class="p">);</code>
<code class="linenos">30 </code>
<code class="linenos">31 </code>        <code class="k">return</code> <code class="nb">in_array</code><code class="p">(</code><code class="nv">$item</code><code class="p">,</code> <code class="nv">$itemsList</code><code class="p">);</code>
<code class="linenos">32 </code>    <code class="p">}</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">add</code><code class="p">(</code><code class="k">array</code> <code class="nv">$item</code><code class="p">)</code>
<code class="linenos">35 </code>    <code class="p">{</code>
<code class="linenos">36 </code>        <code class="k">if</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">has</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSION_KEY</code><code class="p">))</code> <code class="p">{</code>
<code class="linenos">37 </code>
<code class="linenos">38 </code>            <code class="k">if</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">has</code><code class="p">(</code><code class="nv">$item</code><code class="p">[</code><code class="s1">'slug'</code><code class="p">],</code> <code class="s1">'slug'</code><code class="p">))</code> <code class="p">{</code>
<code class="linenos">39 </code>                <code class="nv">$items</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">increaseExistentProduct</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">all</code><code class="p">(),</code> <code class="nv">$item</code><code class="p">);</code>
<code class="linenos">40 </code>
<code class="linenos">41 </code>                <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">put</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSION_KEY</code><code class="p">,</code> <code class="nv">$items</code><code class="p">);</code>
<code class="linenos">42 </code>
<code class="linenos">43 </code>                <code class="k">return</code><code class="p">;</code>
<code class="linenos">44 </code>            <code class="p">}</code>
<code class="linenos">45 </code>
<code class="linenos">46 </code>            <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">push</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSION_KEY</code><code class="p">,</code> <code class="nv">$item</code><code class="p">);</code>
<code class="linenos">47 </code>
<code class="linenos">48 </code>        <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
<code class="linenos">49 </code>            <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">put</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSION_KEY</code><code class="p">,</code> <code class="p">[</code><code class="nv">$item</code><code class="p">]);</code>
<code class="linenos">50 </code>        <code class="p">}</code>
<code class="linenos">51 </code>    <code class="p">}</code>
<code class="linenos">52 </code>
<code class="linenos">53 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">remove</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$item</code><code class="p">)</code>
<code class="linenos">54 </code>    <code class="p">{</code>
<code class="linenos">55 </code>        <code class="nv">$cart</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">all</code><code class="p">();</code>
<code class="linenos">56 </code>
<code class="linenos">57 </code>        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">put</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSION_KEY</code><code class="p">,</code> <code class="nb">array_filter</code><code class="p">(</code><code class="nv">$cart</code><code class="p">,</code> <code class="k">function</code><code class="p">(</code><code class="nv">$line</code><code class="p">)</code> <code class="nx">u\</code>
<code class="linenos">58 </code><code class="nx">se</code><code class="p">(</code><code class="nv">$item</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">59 </code>            <code class="k">return</code> <code class="nv">$line</code><code class="p">[</code><code class="s1">'slug'</code><code class="p">]</code> <code class="o">!==</code> <code class="nv">$item</code><code class="p">;</code>
<code class="linenos">60 </code>        <code class="p">}));</code>
<code class="linenos">61 </code>    <code class="p">}</code>
<code class="linenos">62 </code>
<code class="linenos">63 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">clear</code><code class="p">()</code>
<code class="linenos">64 </code>    <code class="p">{</code>
<code class="linenos">65 </code>        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">session</code><code class="o">-&gt;</code><code class="na">put</code><code class="p">(</code><code class="nx">self</code><code class="o">::</code><code class="na">SESSION_KEY</code><code class="p">,</code> <code class="p">[]);</code>
<code class="linenos">66 </code>    <code class="p">}</code>
<code class="linenos">67 </code>
<code class="linenos">68 </code>    <code class="k">private</code> <code class="k">function</code> <code class="nf">increaseExistentProduct</code><code class="p">(</code><code class="nv">$items</code><code class="p">,</code> <code class="nv">$item</code><code class="p">)</code>
<code class="linenos">69 </code>    <code class="p">{</code>
<code class="linenos">70 </code>        <code class="k">return</code> <code class="nb">array_map</code><code class="p">(</code><code class="k">function</code><code class="p">(</code><code class="nv">$itemLine</code><code class="p">)</code> <code class="k">use</code><code class="p">(</code><code class="nv">$item</code><code class="p">){</code>
<code class="linenos">71 </code>            <code class="k">if</code><code class="p">(</code><code class="nv">$item</code><code class="p">[</code><code class="s1">'slug'</code><code class="p">]</code> <code class="o">==</code> <code class="nv">$itemLine</code><code class="p">[</code><code class="s1">'slug'</code><code class="p">])</code> <code class="p">{</code>
<code class="linenos">72 </code>                <code class="nv">$itemLine</code><code class="p">[</code><code class="s1">'quantity'</code><code class="p">]</code> <code class="o">+=</code> <code class="nv">$item</code><code class="p">[</code><code class="s1">'quantity'</code><code class="p">];</code>
<code class="linenos">73 </code>            <code class="p">}</code>
<code class="linenos">74 </code>            <code class="k">return</code> <code class="nv">$itemLine</code><code class="p">;</code>
<code class="linenos">75 </code>        <code class="p">},</code> <code class="nv">$items</code><code class="p">);</code>
<code class="linenos">76 </code>    <code class="p">}</code>
<code class="linenos">77 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Este CartService reune diversos conhecimentos que já passamos aqui e que imagino que você tenha na bagagem com PHP. Deixo aqui um exercício para que você leia e entenda este service que gerencia nosso carrinho na sessão via Manager Session do Laravel, este gerenciador de sessão é entregue também pelo helper <code>session()</code> que já conhecemos.</p>

<p>Antes de criarmos a view index do carrinho, listo abaixo as rotas para a área do carrinho:</p>

<p><code>web.php</code>:</p>

<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'cart'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'site.cart.'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code><code class="o">()</code><code class="p">{</code>
<code class="linenos"> 2 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">CartController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'index'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">na</code><code class="err">\</code>
<code class="linenos"> 3 </code><code class="nf">me</code><code class="p">(</code><code class="s1">'index'</code><code class="p">);</code>
<code class="linenos"> 4 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">post</code><code class="p">(</code><code class="s1">'/add'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">CartController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'add'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="err">\</code>
<code class="linenos"> 5 </code><code class="nf">name</code><code class="p">(</code><code class="s1">'add'</code><code class="p">);</code>
<code class="linenos"> 6 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">delete</code><code class="p">(</code><code class="s1">'/remove/{item}'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">CartController</code><code class="nl">::clas</code><code class="o">\</code>
<code class="linenos"> 7 </code><code class="nx">s</code><code class="p">,</code> <code class="s1">'remove'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'remove'</code><code class="p">);</code>
<code class="linenos"> 8 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/cancel'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">CartController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'cancel</code><code class="se">\</code><code class="s1"></code>
<code class="linenos"> 9 </code><code class="s1">'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'cancel'</code><code class="p">);</code>
<code class="linenos">10 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Temos rota pro index, pra adição e remoção do item e também pro cancelar do carrinho. </p>

<p>Veja abaixo a view <code>cart.blade.php</code>: </p>

<p><code>resources/views/site/cart.blade.php</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full"</code><code class="o">&gt;</code>
<code class="linenos"> 4 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"border-b border-gray-300 pb-4 flex justify-between items-center"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>            <code class="o">&lt;</code><code class="n">h1</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-4xl font-thin text-white"</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>                <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{route('site.home')}}"</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-xl hover:underline hove\</code>
<code class="linenos"> 7 </code><code class="s">r:text-black transition duration-300 ease-in-out"</code><code class="o">&gt;</code><code class="n">Home</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code> <code class="o">&lt;</code><code class="n">span</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-xl"</code><code class="o">&gt;&amp;</code><code class="n">ra</code>\
<code class="linenos"> 8 </code><code class="n">quo</code><code class="p">;</code><code class="o">&lt;/</code><code class="n">span</code><code class="o">&gt;</code> <code class="n">Carrinho</code>
<code class="linenos"> 9 </code>            <code class="o">&lt;/</code><code class="n">h1</code><code class="o">&gt;</code>
<code class="linenos">10 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full"</code><code class="o">&gt;</code>
<code class="linenos">13 </code>            <code class="p">@</code><code class="n">cartcount</code><code class="p">(</code><code class="n">$cartItems</code><code class="p">)</code>
<code class="linenos">14 </code>                <code class="p">@</code><code class="n">php</code> <code class="n">$totalCart</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="p">@</code><code class="n">endphp</code>
<code class="linenos">15 </code>                <code class="p">@</code><code class="n">foreach</code><code class="p">(</code><code class="n">$cartItems</code> <code class="n">as</code> <code class="n">$item</code><code class="p">)</code>
<code class="linenos">16 </code>                    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full py-8 border-b border-gray-300 flex justify-ar\</code>
<code class="linenos">17 </code><code class="s">ound items-center gap-x-5"</code><code class="o">&gt;</code>
<code class="linenos">18 </code>                        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[10%]"</code><code class="o">&gt;</code>
<code class="linenos">19 </code>                            <code class="o">&lt;</code><code class="n">img</code> <code class="n">src</code><code class="o">=</code><code class="s">"{{$item['photo'] ? asset('storage/' . $item['p\</code>
<code class="linenos">20 </code><code class="s">hoto']) : asset('storage/no-photo.jpg') }}"</code>
<code class="linenos">21 </code>                                <code class="n">alt</code><code class="o">=</code><code class="s">"Foto Produto: {{$item['name']}}"</code>
<code class="linenos">22 </code>                                <code class="k">class</code><code class="o">=</code><code class="s">"w-full rounded-t"</code><code class="o">&gt;</code>
<code class="linenos">23 </code>                        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">24 </code>                        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-2/3 flex flex-col"</code><code class="o">&gt;</code>
<code class="linenos">25 </code>                            <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-left"</code><code class="o">&gt;</code>
<code class="linenos">26 </code>                                <code class="o">&lt;</code><code class="n">h4</code> <code class="k">class</code><code class="o">=</code><code class="s">"font-bold capitalize  text-white"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$item</code>\
<code class="linenos">27 </code><code class="p">[</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">]}}</code> <code class="o">-</code> <code class="n">R$</code> <code class="p">{{</code><code class="n">number_format</code><code class="p">(</code><code class="n">$item</code><code class="p">[</code><code class="err">'</code><code class="n">price</code><code class="err">'</code><code class="p">],</code> <code class="mi">2</code><code class="p">,</code> <code class="sc">','</code><code class="p">,</code> <code class="sc">'.'</code><code class="p">)}}</code> <code class="p">({{</code><code class="n">$item</code><code class="p">[</code><code class="err">'</code><code class="n">quantity</code><code class="err">'</code><code class="p">]}</code>\
<code class="linenos">28 </code><code class="p">}</code><code class="n">x</code><code class="p">)</code><code class="o">&lt;/</code><code class="n">h4</code><code class="o">&gt;</code>
<code class="linenos">29 </code>                                <code class="p">@</code><code class="n">php</code> <code class="n">$subtotal</code> <code class="o">=</code> <code class="n">$item</code><code class="p">[</code><code class="err">'</code><code class="n">price</code><code class="err">'</code><code class="p">]</code> <code class="o">*</code> <code class="n">$item</code><code class="p">[</code><code class="err">'</code><code class="n">quantity</code><code class="err">'</code><code class="p">];</code>\
<code class="linenos">30 </code> <code class="p">@</code><code class="n">endphp</code>
<code class="linenos">31 </code>                                <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-xl font-thin  text-white"</code><code class="o">&gt;</code><code class="nl">Subtotal</code><code class="p">:</code> \
<code class="linenos">32 </code><code class="n">R$</code> <code class="p">{{</code><code class="n">number_format</code><code class="p">(</code><code class="n">$subtotal</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="sc">','</code><code class="p">,</code> <code class="sc">'.'</code><code class="p">)}}</code><code class="o">&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos">33 </code>                            <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">34 </code>                        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">35 </code>                        <code class="o">&lt;</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">36 </code>                            <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{route('site.cart.remove', ['item' =&gt; $it\</code>
<code class="linenos">37 </code><code class="s">em['slug']])}}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"POST"</code><code class="o">&gt;</code>
<code class="linenos">38 </code>                                <code class="p">@</code><code class="n">csrf</code>
<code class="linenos">39 </code>                                <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">DELETE</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">40 </code>                                <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white cursor-pointer"</code><code class="o">&gt;</code>
<code class="linenos">41 </code>                                    <code class="o">&lt;</code><code class="n">svg</code> <code class="n">xmlns</code><code class="o">=</code><code class="s">"http://www.w3.org/2000/svg"</code> <code class="n">fill</code><code class="o">=</code><code class="s">"no\</code>
<code class="linenos">42 </code><code class="s">ne"</code> <code class="n">viewBox</code><code class="o">=</code><code class="s">"0 0 24 24"</code> <code class="n">stroke</code><code class="o">-</code><code class="n">width</code><code class="o">=</code><code class="s">"1.5"</code> <code class="n">stroke</code><code class="o">=</code><code class="s">"currentColor"</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-6 h-6 hove\</code>
<code class="linenos">43 </code><code class="s">r:text-red-800"</code><code class="o">&gt;</code>
<code class="linenos">44 </code>                                        <code class="o">&lt;</code><code class="n">path</code> <code class="n">stroke</code><code class="o">-</code><code class="n">linecap</code><code class="o">=</code><code class="s">"round"</code> <code class="n">stroke</code><code class="o">-</code><code class="n">linejoin</code>\
<code class="linenos">45 </code><code class="o">=</code><code class="s">"round"</code> <code class="n">d</code><code class="o">=</code><code class="s">"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-\</code>
<code class="linenos">46 </code><code class="s">1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L\</code>
<code class="linenos">47 </code><code class="s">4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.1\</code>
<code class="linenos">48 </code><code class="s">65m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.\</code>
<code class="linenos">49 </code><code class="s">964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"</code>\
<code class="linenos">50 </code> <code class="o">/&gt;</code>
<code class="linenos">51 </code>                                    <code class="o">&lt;/</code><code class="n">svg</code><code class="o">&gt;</code>
<code class="linenos">52 </code>
<code class="linenos">53 </code>                                <code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">54 </code>                            <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">55 </code>                        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">56 </code>                    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">57 </code>                    <code class="p">@</code><code class="n">php</code> <code class="n">$totalCart</code> <code class="o">+=</code> <code class="n">$subtotal</code><code class="p">;</code> <code class="p">@</code><code class="n">endphp</code>
<code class="linenos">58 </code>                <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">59 </code>
<code class="linenos">60 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full py-8 border-b border-gray-300 flex justify-start \</code>
<code class="linenos">61 </code><code class="s">text-white"</code><code class="o">&gt;</code>
<code class="linenos">62 </code>                    <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[20%] text-2xl font-extrabold"</code><code class="o">&gt;</code><code class="nl">Total</code><code class="p">:</code><code class="o">&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos">63 </code>                    <code class="o">&lt;</code><code class="k">strong</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-2/3 text-left text-2xl font-extrabold"</code><code class="o">&gt;</code><code class="n">R$</code> <code class="p">{{</code> <code class="n">nu</code>\
<code class="linenos">64 </code><code class="n">mber_format</code><code class="p">(</code><code class="n">$totalCart</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="sc">','</code><code class="p">,</code> <code class="sc">'.'</code><code class="p">)}}</code><code class="o">&lt;/</code><code class="k">strong</code><code class="o">&gt;</code>
<code class="linenos">65 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">66 </code>
<code class="linenos">67 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full py-8 mt-10 flex justify-around gap-5 text-white"</code><code class="o">&gt;</code>
<code class="linenos">68 </code>                    <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{route('site.cart.cancel')}}"</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-5 py-2 rounded\</code>
<code class="linenos">69 </code><code class="s"> text-white text-2xl font-bold bg-red-600"</code><code class="o">&gt;</code><code class="n">Cancelar</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">70 </code>                    <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"#"</code> <code class="nl">wire</code><code class="p">:</code><code class="n">navigate</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-5 py-2 rounded text-white te\</code>
<code class="linenos">71 </code><code class="s">xt-2xl font-bold bg-green-600"</code><code class="o">&gt;</code><code class="n">Continuar</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">72 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">73 </code>            <code class="p">@</code><code class="k">else</code>
<code class="linenos">74 </code>                <code class="o">&lt;</code><code class="n">h3</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full text-center text-white text-4xl font-thin py-4"</code><code class="o">&gt;</code><code class="n">Ne</code>\
<code class="linenos">75 </code><code class="n">nhum</code> <code class="n">item</code> <code class="n">no</code> <code class="n">seu</code> <code class="n">carrinho</code> <code class="n">de</code> <code class="n">compras</code><code class="o">!&lt;/</code><code class="n">h3</code><code class="o">&gt;</code>
<code class="linenos">76 </code>            <code class="p">@</code><code class="n">endcartcount</code>
<code class="linenos">77 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">78 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">79 </code><code class="o">&lt;/</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>Nossa view é bem tranquila também, iteramos nos produtos da sessão e realizamos as exibições do total e subtotal baseados no preço do produto e na sua quantidade existente no carrinho. Inclusive lá no service, temos o incremento da quantidade se o usuário tentar adicionar um produto que já exista na sessão do carrinho.</p>

<p>Existe um detalhe que trouxe nessa view mais como exploração e demonstração. O blade possui diversas diretivas como vimos diversas vezes durante nossa jornada, diretivas que começam com <code>@</code> e seguido pelo nome da diretiva. Assim como existem diretivas padrão no Blade, podemos criar diretivas customizadas e em nossa tela você percebe que criei uma chamada <code>@cartcount</code> e também criei uma de fechamento <code>@endcartcount</code>.</p>

<p>Para isso, vamos colocar a definição dessas diretivas customizadas de forma global no framework. Para este caso adicionemos o trecho abaixo lá no arquivo <code>AppServiceProvider</code> na pasta <code>app/Providers</code>. </p>

<p>Coloque o trecho abaixo no método <code>boot</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nx">Blade</code><code class="o">::</code><code class="nx">directive</code><code class="p">(</code><code class="s1">'cartcount'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">string</code> <code class="nx">$expression</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">2 </code>    <code class="k">return</code> <code class="s2">"</code><code class="cp">&lt;?php</code> <code class="k">if</code><code class="p">(</code><code class="nb">count</code><code class="p">(</code><code class="nv">$expression</code><code class="p">))</code><code class="o">:</code> <code class="cp">?&gt;</code><code class="s2">"</code><code class="p">;</code>
<code class="linenos">3 </code><code class="p">});</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code>
<code class="linenos">6 </code><code class="nx">Blade</code><code class="o">::</code><code class="nx">directive</code><code class="p">(</code><code class="s1">'endcartcount'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">string</code> <code class="nx">$expression</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">7 </code>    <code class="k">return</code> <code class="s1">'</code><code class="cp">&lt;?php</code> <code class="k">endif</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="s1">'</code><code class="p">;</code>
<code class="linenos">8 </code><code class="p">});</code>
</pre></div>

</figure>


<blockquote>
  <p>PS.: Não esqueça de importar a facade Blade no AppServiceProvider: <code>use Illuminate\Support\Facades\Blade;</code>.</p>
</blockquote>

<p>O método directive permite que criemos diretivas customizadas e aqui simplemesmente criei uma para envolver a condicional baseada no count de itens em nosso carrinho. O valor que eu usar na diretiva será passado para o parâmetro <code>$expression</code> do callback, que é o segundo parâmetro do método <code>directive</code>.</p>

<p>Neste caso, passo somente os itens do carrinho que é usado no count e testado pelo if que já conhecemos.</p>

<p>Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">@</code><code class="n">cartcount</code><code class="p">(</code><code class="n">$itemsCart</code><code class="p">)</code>
<code class="linenos">2 </code>    <code class="o">&lt;!--</code> <code class="n">Existindo</code> <code class="n">itens</code> <code class="n">no</code> <code class="n">cart</code> <code class="n">exibe</code> <code class="o">--&gt;</code>
<code class="linenos">3 </code>
<code class="linenos">4 </code><code class="o">&lt;!--</code><code class="n">posso</code> <code class="n">combinar</code> <code class="n">um</code> <code class="k">else</code> <code class="n">via</code> <code class="n">diretiva</code> <code class="n">padrão</code> <code class="n">pois</code> <code class="n">respeita</code> <code class="n">a</code> <code class="n">estrutura</code> <code class="k">do</code> <code class="k">if</code> <code class="o">--&gt;</code>
<code class="linenos">5 </code><code class="p">@</code><code class="k">else</code> 
<code class="linenos">6 </code>
<code class="linenos">7 </code><code class="o">&lt;!--</code> <code class="n">Algo</code> <code class="n">para</code> <code class="n">a</code> <code class="n">não</code> <code class="n">existência</code> <code class="n">de</code> <code class="n">itens</code> <code class="n">no</code> <code class="n">cart</code> <code class="o">--&gt;</code>
<code class="linenos">8 </code>
<code class="linenos">9 </code><code class="p">@</code><code class="n">endcartcount</code>
</pre></div>

</figure>


<p>Veja a tela do carrinho:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----cart-index.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Com as rotas do carrinho existindo no projeto, adicione o link pro index do carrinho no ícone do cart no componente layout site. Se você teve erro na sua single com respeito a url do cart add no form da single do produto, ela deve funcionar agora.</p>

<h2 id="leanpub-auto-produtos-por-categorias" class="section">Produtos por Categorias</h2>

<p>Aqui deixo um exercício pra você, a tela de produtos por categoria se torna fácil agora. Já buscamos bastante dado relacionado e buscar os produtos de uma categoria será algo bem tranquilo nesse momento pra você.</p>

<p>Tente criar as rotas pra tela da single do produto por categorias e entregar nesta tela os produtos pela categoria selecionada por seu slug, numa ideia de slug que usamos para exibir a single do produto.</p>

<p>Você pode até reutilizar a tela home pois os produtos vindos da ligação com a categoria, vêm em collection para ser iterados. Talvez no máximo você precise controlar pro caso da categoria não ter nenhum produto relacionado.</p>

<p>Acredito que você não terá problemas neste ponto, mas existindo problemas busque nosso grupo no telegram que comentei lá no ínicio do livro.</p>

<h2 id="leanpub-auto-concluses-11" class="section">Conclusões</h2>

<p>Bom, então chegamos ao fim de mais um capítulo aqui em nossa jornada, tivemos diversos pontos aqui nesta parte do front da nossa loja. Revise com calma cada código e não deixe de buscar mais e mais sobre os assuntos que pincelei aqui.</p>

<p>Temos também um grupo e um canal onde podemos conversar sobre os assuntos abordados aqui em nossa jornada, deixei ele no ínicio também.</p>

<p>No próximo capítulo vamos criar um mock pro processo de pagamento onde abordarei sobre o Container de Serviços do Laravel.</p>

<p>Nos vemos lá!</p>


<h1 id="leanpub-auto-container-de-servios-laravel" class="chapter">Container de Serviços Laravel</h1>

<p>Neste capítulos vamos criar um mock para simular o processo de pagamentos em nosso site, utilizaremos aqui uma pequena ideia abordada em Arquitetura Limpa onde criaremos uma espécie de contrato para que os serviços de pagamento respeitem caso queiram ser utilizados como opção de pagamento.</p>

<p>Falei aqui de um jeito bem formal mas basicamente seria um contrato que eu devo segui para que eu integre um PagSeguro, PagarMe e outros gateways conhecidos. Isso vai me ajudar a ter menos motivos para modificar a lógica de pagamentos sempre que precisar de um gateway novo e claro que, como disse, aqui é um conceito bem pontual abordado em Clean Architecture (Arquitetura Limpa) e o conceito em si vai muito além do que o que eu mostro aqui.</p>

<p>Vamos compartilhar este serviço de pagamento via Container de Serviços do Laravel e com isso tenho oportunidade de trazer pra você os conceitos desta camada do framework.</p>

<h2 id="leanpub-auto-di-injeo-de-dependncias" class="section">DI (Injeção de Dependências)</h2>

<p>No mundo da Orientação a Objetos temos diversos conceitos que visam facilitar as conversa e relacionamento dos objetos, além de irmos para conceitos mais abstratos buscando essa melhor organização e design.</p>

<p>Começo abordando aqui o pensamento de Injeção de Dependências como forma de chegarmos ao Container de Serviços que também é chamado de Container DI (Dependencie Injection Container ou Container de Injeção de Dependência). </p>

<p>Existem diversos cenários no mundo OO em que criamos diversos acoplamentos entre nossas classes, tornando determinado Objeto dependente e responsável pela instância de outro a qual este objeto necessita para realizar alguma operação.</p>

<p>Este cenário de dependência e responsabilidade pela instância de outro, conforme o tempo passa fica bem dificil de gerenciar, manter e no fim acaba tornando o crescimento truncado ainda mais se pensarmos nas diversas possíveis dependências que um determinado Objeto possa ter. Nesse cenário existe uma forma de relacionar o objeto de forma a não deixar este objeto responsável, ainda que dependente, da instância de outro objeto. Podemos recorrer a associação, onde um Objeto, pode existir sem a existência de outro dependente.</p>

<p>O mecanismo utilizado neste contexto, e ao retirarmos a responsabilidade da instância, é a Injeção da Dependência. Onde fora da classe dependente criamos a instância da sua dependência e a injetamos no objeto que espera aquela instância.</p>

<p>Pense num exemplo simples onde temos um objeto Query que depende de uma conexão com o BD e fora do objeto Query podemos criar a instância da conexão com BD e injetar essa instância no objeto Query para que ele possa trabalhar corretamente.</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">connection</code> <code class="o">=</code> <code class="n">new</code> <code class="n">MySQLConnector</code><code class="p">(...);</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="err">$</code><code class="n">queryBuilder</code> <code class="o">=</code> <code class="n">new</code> <code class="n">QueryBuilder</code><code class="p">(</code><code class="err">$</code><code class="n">connection</code><code class="p">);</code>
<code class="linenos">4 </code>
<code class="linenos">5 </code><code class="kr">return</code> <code class="err">$</code><code class="n">queryBuilder</code><code class="o">-&gt;</code><code class="n">where</code><code class="p">(...)</code><code class="o">-&gt;</code><code class="n">orderBy</code><code class="p">(...)</code><code class="o">-&gt;</code><code class="n">get</code><code class="p">();</code>
</pre></div>

</figure>


<p>Perceba que queryBuilder não precisa saber quem é a conexão e apenas precisa receber sua dependência requerida para trabalhar, ele(Query) também não precisa carregar a responsabilidade da instância da conexão e se formos mais abstratos ainda, pode inclusive tornar Query dependente de uma interface Connection, deixando a injeção da dependência da conexao mais maleável a quem respeitar a interface esperada.</p>

<p>Em cenários como este é normal termos algumas, não muitas, dependências e gerenciar isso manualmente pode ser um problema e é nesse ponto que automatizar e gerenciar de forma centralizada estas injeções faz sentido o uso de um Container de Serviços ou Container de Injeção de Dependências.</p>

<h2 id="leanpub-auto-container-de-servios" class="section">Container de Serviços</h2>

<p>O Container de Serviços contêm as instâncias a serem compartilhadas no contexto global da aplicação, em um framework como o Laravel é uma parte crucial do ciclo de vida da aplicação pois compartilha diversos componentes a serem utilizados internamente no funcionamento das diversas parte do framerwork. Neste container você também pode e deve compartilhar seus serviços para que possam ser consumidos na sua aplicação, ao criar pacotes é possível compartilhar seus serviços para serem chamados via container sem problemas.</p>

<p>Inclusive você pode simplemente usar o utilitário do container apenas para instanciar seu objeto, além de poder fazer binds de interface e utilizar a instância Singleton do seu serviço, onde independentemente da chamada o container sempre entregará a mesma instância no ciclo de vida do momento da execução.</p>

<p>O laravel sempre compartilha em seus providers uma instância do container de serviços mas você pode invocar utilizado o helper <code>app()</code> se assim desejar utilizar em outros momentos. Como comentei, iremos utilizar o container para compartilhar nosso serviço de Pagamento como bind de Interface, para isto criei na pasta <code>app\Services</code> o namespace <code>Payments</code> onde teremos nossa interface e uma classe concreta baseada nesta interface para exemplo.</p>

<p>Na pasta crie primeiro a interface:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="cp">&lt;?php</code>
<code class="linenos">2 </code><code class="k">namespace</code> <code class="nx">App\Services\Payments</code><code class="p">;</code>
<code class="linenos">3 </code>
<code class="linenos">4 </code><code class="k">interface</code> <code class="nx">PaymentInterface</code>
<code class="linenos">5 </code><code class="p">{</code>
<code class="linenos">6 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">doPayment</code><code class="p">(</code><code class="k">array</code> <code class="nv">$data</code><code class="p">)</code><code class="o">:</code> <code class="k">array</code><code class="p">;</code>
<code class="linenos">7 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba que a priore obrigaremos aos participantes apenas a implementação do método <code>doPayment</code> e sua assinatura, onde esperamos os dados para passar pro gateway de escolha. A classe concreta que criei se chama <code>PayHappyService</code>(rs) e como comentei não teremos lógica nenhuma de pagamento aqui mas na maioria dos gateways que já usei essa interface pode resolver bem suas classes concretas.</p>

<p>Segue abaixo o conteúdo da classe <code>PayHappyService</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Services\Payments</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="k">class</code> <code class="nc">PayHappyService</code> <code class="k">implements</code> <code class="nx">PaymentInterface</code>
<code class="linenos"> 6 </code><code class="p">{</code>
<code class="linenos"> 7 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">doPayment</code><code class="p">(</code><code class="k">array</code> <code class="nv">$data</code><code class="p">)</code><code class="o">:</code> <code class="k">array</code>
<code class="linenos"> 8 </code>    <code class="p">{</code>
<code class="linenos"> 9 </code>        <code class="c1">//payment Algorithm</code>
<code class="linenos">10 </code>        <code class="k">return</code> <code class="p">[</code><code class="s1">'gateway_code'</code> <code class="o">=&gt;</code> <code class="nx">str</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">uuid</code><code class="p">()];</code>
<code class="linenos">11 </code>    <code class="p">}</code>
<code class="linenos">12 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Nossa interface aqui funcionará com um contrato de fato, onde dependeremos de um concreto que seja do tipo da interface <code>PaymentInterface</code>, com isso não dependeremos de um concreto e se precisarmos num futuro, poderemos trocar a instância da classe concreta sem muita dor de cabeça, perceba que não estou falando dor de cabeça zero mas o mínimo atrito na mudança é esperado.</p>

<p>Para definirmos no container de serviços do Laravel o bind da nossa interface e já pontuarmos uma classe concreta para satisfazer essa dependência vamos ao provider AppServiceProvider mas antes deixa eu esclarecer rapidamente o que são os providers no Laravel!</p>

<h2 id="leanpub-auto-laravel-service-providers" class="section">Laravel Service Providers</h2>

<p>No ciclo de vida de sua aplicação Laravel os Service Providers são outro ponto beeem importante pois são eles que configuram as diversas áreas do framework além de permitirem a criação e integração de pacotes de terceiros no framework. Estes pacotes podem inclusive se configurar totalmente via Service Providers.</p>

<p>No Laravel 11 os Services Providers que ficavam explícitos na estrutura do framework agora fazem parte dos internos e suas configurações como pontos para a parte de Middlewares, Rotas, Error Handlers e outros podem ser efetuados no arquivo app na pasta <code>bootstrap</code>. Um provider inicialmente existe explicitamente na estrutura do projeto e esse provider é o <code>AppServiceProvider</code> que desde sempre nos permite configurarmos pontos que precisam ser globais em nossos projetos, o bind no container é um exemplo.</p>

<p>Esses providers contam com dois métodos a serem explorados inicialmente, o boot e o register e inclusive foi nesse provider que colocamos as configs da diretiva customizada do Blade no capítulo anterior. Pontos de bind no container de serviço é recomendado colocar estas configurações no método <code>register</code>, outras configurações como a parte de diretivas customizadas e etc podem ser colocadas no método <code>boot</code>.</p>

<p>Para realizarmos o bind por interface de nosso serviço de pagamentos podemos chamar o container via helper <code>app</code> e acionar o método <code>bind</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">app</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">bind</code><code class="o">(</code><code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Services</code><code class="err">\</code><code class="nt">Payments</code><code class="err">\</code><code class="nt">PaymentInterface</code><code class="p">::</code><code class="nd">class</code><code class="o">,</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Services</code><code class="err">\</code><code class="nt">Payments</code><code class="err">\\</code>
<code class="linenos">2 </code><code class="nt">PayHappyService</code><code class="p">::</code><code class="nd">class</code><code class="o">);</code>
</pre></div>

</figure>


<p>A linha acima é adicionada no método <code>register</code> do <code>AppServiceProvider</code>, veja na íntegra: </p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Providers</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">Facades</code>\<code class="n">Blade</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">ServiceProvider</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code><code class="k">class</code> <code class="n">AppServiceProvider</code> <code class="k">extends</code> <code class="n">ServiceProvider</code>
<code class="linenos"> 9 </code><code class="p">{</code>
<code class="linenos">10 </code>    <code class="o">/**</code>
<code class="linenos">11 </code>     <code class="o">*</code> <code class="n">Register</code> <code class="n">any</code> <code class="n">application</code> <code class="n">services</code><code class="o">.</code>
<code class="linenos">12 </code>     <code class="o">*/</code>
<code class="linenos">13 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">register</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">14 </code>    <code class="p">{</code>
<code class="linenos">15 </code>        <code class="n">app</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">bind</code><code class="p">(</code>\<code class="n">App</code>\<code class="n">Services</code>\<code class="n">Payments</code>\<code class="n">PaymentInterface</code><code class="p">::</code><code class="k">class</code><code class="p">,</code> \<code class="n">App</code>\<code class="n">Services</code>\<code class="n">Pa</code>\
<code class="linenos">16 </code><code class="n">yments</code>\<code class="n">PayHappyService</code><code class="p">::</code><code class="k">class</code><code class="p">);</code>
<code class="linenos">17 </code>    <code class="p">}</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="o">/**</code>
<code class="linenos">20 </code>     <code class="o">*</code> <code class="n">Bootstrap</code> <code class="n">any</code> <code class="n">application</code> <code class="n">services</code><code class="o">.</code>
<code class="linenos">21 </code>     <code class="o">*/</code>
<code class="linenos">22 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">boot</code><code class="p">():</code> <code class="n">void</code>
<code class="linenos">23 </code>    <code class="p">{</code>
<code class="linenos">24 </code>        <code class="n">Blade</code><code class="p">::</code><code class="n">directive</code><code class="p">(</code><code class="s1">'cartcount'</code><code class="p">,</code> <code class="n">function</code><code class="p">(</code><code class="n">string</code> <code class="o">$</code><code class="n">expression</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">25 </code>            <code class="k">return</code> <code class="s2">"&lt;?php if(count($expression)): ?&gt;"</code><code class="p">;</code>
<code class="linenos">26 </code>        <code class="p">});</code>
<code class="linenos">27 </code>
<code class="linenos">28 </code>
<code class="linenos">29 </code>        <code class="n">Blade</code><code class="p">::</code><code class="n">directive</code><code class="p">(</code><code class="s1">'endcartcount'</code><code class="p">,</code> <code class="n">function</code><code class="p">(</code><code class="n">string</code> <code class="o">$</code><code class="n">expression</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">30 </code>            <code class="k">return</code> <code class="s1">'&lt;?php endif; ?&gt;'</code><code class="p">;</code>
<code class="linenos">31 </code>        <code class="p">});</code>
<code class="linenos">32 </code>
<code class="linenos">33 </code>    <code class="p">}</code>
<code class="linenos">34 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O bind a priore é bem simples e o poder que teremos no desacoplamento e futuras modificações com pouco atrito é o que brilha aqui com todo o conceito envolvido. Com este bind podemos agora utilizar a tipagem pela interface <code>PaymentInterface</code> e o container de serviços do Laravel já entregará nosso objeto concreto.</p>

<p>Com este trabalho feito vamos ao nosso recurso de Checkout e tudo que engloba toda a parte de Pedido e utilização do que já bindamos aqui!</p>

<h2 id="leanpub-auto-checkout-finalizando-compra" class="section">Checkout, finalizando compra</h2>

<p>Vamos começar por nossa estrutura de pedidos, onde irei organizar da seguinte maneira:</p>

<ul>
  <li>Order (Pedido)
    <ul>
      <li>code</li>
      <li>user_id</li>
      <li>gateway_code</li>
      <li>status</li>
    </ul>
  </li>
  <li>OrderItem (Itens Pedido)
    <ul>
      <li>order_id</li>
      <li>product_id</li>
      <li>quantity</li>
    </ul>
  </li>
</ul>

<p>Desta forma podemos ter os dados principais do pedido em sua tabela e os itens(produtos) ficam ligados na tabela itens do pedido. Para isso vamos gerar nossos models com suas respectivas migrations:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:model Order -m
<code class="linenos">2 </code>
<code class="linenos">3 </code>php artisan make:model OrderItem -m
</pre></div>

</figure>


<p>Segue abaixo as colunas das tabelas para serem adicionadas nas migrações(migrations):</p>

<p><b>migration: create_orders_table</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">foreignId</code><code class="p">(</code><code class="s1">'user_id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">constrained</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">cascadeOnDelete</code><code class="p">();</code>
<code class="linenos">2 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">uuid</code><code class="p">(</code><code class="s1">'code'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">unique</code><code class="p">();</code>
<code class="linenos">3 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">uuid</code><code class="p">(</code><code class="s1">'gateway_code'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">nullable</code><code class="p">();</code>
<code class="linenos">4 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">string</code><code class="p">(</code><code class="s1">'status'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">default</code><code class="p">(</code><code class="s1">'WAITING_PAYMENT'</code><code class="p">);</code>
</pre></div>

</figure>


<p><b>migration: create_order_items_table</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">foreignId</code><code class="p">(</code><code class="s1">'order_id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">constrained</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">cascadeOnDelete</code><code class="p">();</code>
<code class="linenos">2 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">foreignId</code><code class="p">(</code><code class="s1">'product_id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">constrained</code><code class="p">();</code>
<code class="linenos">3 </code><code class="o">$</code><code class="n">table</code><code class="o">-&gt;</code><code class="n">integer</code><code class="p">(</code><code class="s1">'quantity'</code><code class="p">);</code>
</pre></div>

</figure>


<blockquote>
  <p>PS.: Apenas adicione as definições acima, coloquei entre os métodos id e timestamps</p>
</blockquote>

<p>Segue abaixo os models já com suas ligações, nesta altura imagino que a leitura do código abaixo seja o suficiente:</p>

<p><b>Order</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Models</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Model</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Relations</code>\<code class="n">BelongsTo</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Relations</code>\<code class="n">HasMany</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="n">Order</code> <code class="k">extends</code> <code class="n">Model</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="n">protected</code> <code class="o">$</code><code class="n">fillable</code> <code class="o">=</code> <code class="p">[</code>
<code class="linenos">12 </code>        <code class="s1">'user_id'</code><code class="p">,</code> <code class="s1">'code'</code><code class="p">,</code> <code class="s1">'status'</code><code class="p">,</code> <code class="s1">'gateway_code'</code>
<code class="linenos">13 </code>    <code class="p">];</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">customer</code><code class="p">():</code><code class="n">BelongsTo</code>
<code class="linenos">16 </code>    <code class="p">{</code>
<code class="linenos">17 </code>        <code class="k">return</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">belongsTo</code><code class="p">(</code><code class="n">User</code><code class="p">::</code><code class="k">class</code><code class="p">,</code> <code class="s1">'user_id'</code><code class="p">);</code>
<code class="linenos">18 </code>    <code class="p">}</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">items</code><code class="p">():</code> <code class="n">HasMany</code>
<code class="linenos">21 </code>    <code class="p">{</code>
<code class="linenos">22 </code>        <code class="k">return</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">hasMany</code><code class="p">(</code><code class="n">OrderItem</code><code class="p">::</code><code class="k">class</code><code class="p">);</code>
<code class="linenos">23 </code>    <code class="p">}</code>
<code class="linenos">24 </code><code class="p">}</code>
</pre></div>

</figure>


<p><b>OrderItem</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Models</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Model</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Database</code>\<code class="n">Eloquent</code>\<code class="n">Relations</code>\<code class="n">BelongsTo</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code><code class="k">class</code> <code class="n">OrderItem</code> <code class="k">extends</code> <code class="n">Model</code>
<code class="linenos"> 9 </code><code class="p">{</code>
<code class="linenos">10 </code>    <code class="n">protected</code> <code class="o">$</code><code class="n">fillable</code> <code class="o">=</code> <code class="p">[</code>
<code class="linenos">11 </code>        <code class="s1">'product_id'</code><code class="p">,</code> <code class="s1">'quantity'</code>
<code class="linenos">12 </code>    <code class="p">];</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">order</code><code class="p">():</code> <code class="n">BelongsTo</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>        <code class="k">return</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">belongsTo</code><code class="p">(</code><code class="n">Order</code><code class="p">::</code><code class="k">class</code><code class="p">);</code>
<code class="linenos">17 </code>    <code class="p">}</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">product</code><code class="p">():</code> <code class="n">BelongsTo</code>
<code class="linenos">20 </code>    <code class="p">{</code>
<code class="linenos">21 </code>        <code class="k">return</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">belongsTo</code><code class="p">(</code><code class="n">Product</code><code class="p">::</code><code class="k">class</code><code class="p">);</code>
<code class="linenos">22 </code>    <code class="p">}</code>
<code class="linenos">23 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Definido nossas migrations e nossos models, não esqueça de executar estas migrações na base com o comando já conhecido:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate
</pre></div>

</figure>


<p>Vamos gerar nosso controller e suas definições e por fim partiremos para as views e rotas:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller Site/CheckoutController
</pre></div>

</figure>


<p>Neste controller vamos ter três métodos a priore: um pra tela de pagamento, para o processamento e tela de obrigado. Veja o controller e depois focamos no método que processa o pagamento, que na minha visão é o que demanda mais da nossa atenção:</p>

<p><b>Controller: CheckoutController</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Site</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">Order</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Services</code>\<code class="n">CartService</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Services</code>\<code class="n">Payments</code>\<code class="n">PaymentInterface</code><code class="p">;</code>
<code class="linenos"> 9 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos">10 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Support</code>\<code class="n">Str</code><code class="p">;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code><code class="k">class</code> <code class="n">CheckoutController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">13 </code><code class="p">{</code>
<code class="linenos">14 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">__construct</code><code class="p">(</code><code class="n">private</code> <code class="n">Order</code> <code class="o">$</code><code class="n">modelOrder</code><code class="p">)</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>    <code class="p">}</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">19 </code>    <code class="p">{</code>
<code class="linenos">20 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'site.checkout'</code><code class="p">);</code>
<code class="linenos">21 </code>    <code class="p">}</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">process</code><code class="p">(</code><code class="n">PaymentInterface</code> <code class="o">$</code><code class="n">payment</code><code class="p">,</code> <code class="n">CartService</code> <code class="o">$</code><code class="n">cart</code><code class="p">)</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="k">if</code><code class="p">(</code><code class="o">!$</code><code class="n">cart</code><code class="o">-&gt;</code><code class="n">count</code><code class="p">())</code> <code class="p">{</code>
<code class="linenos">26 </code>            <code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">flash</code><code class="p">(</code><code class="s1">'warning'</code><code class="p">,</code> <code class="s1">'Sem Itens para Processar Checkout!'</code><code class="p">);</code>
<code class="linenos">27 </code>            <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'site.home'</code><code class="p">);</code>
<code class="linenos">28 </code>        <code class="p">}</code>
<code class="linenos">29 </code>
<code class="linenos">30 </code>        <code class="o">$</code><code class="n">customer</code> <code class="o">=</code> <code class="n">auth</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">user</code><code class="p">();</code>
<code class="linenos">31 </code>
<code class="linenos">32 </code>        <code class="o">$</code><code class="n">order</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">modelOrder</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">([</code>
<code class="linenos">33 </code>            <code class="s1">'code'</code> <code class="o">=&gt;</code> <code class="n">Str</code><code class="p">::</code><code class="n">uuid</code><code class="p">(),</code>
<code class="linenos">34 </code>            <code class="s1">'user_id'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">customer</code><code class="o">-&gt;</code><code class="n">id</code>
<code class="linenos">35 </code>        <code class="p">]);</code>
<code class="linenos">36 </code>
<code class="linenos">37 </code>        <code class="o">$</code><code class="n">saveOrderItems</code> <code class="o">=</code> <code class="p">[];</code>
<code class="linenos">38 </code>        <code class="n">foreach</code><code class="p">(</code><code class="o">$</code><code class="n">cart</code><code class="o">-&gt;</code><code class="n">all</code><code class="p">()</code> <code class="k">as</code> <code class="o">$</code><code class="n">item</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">39 </code>            <code class="o">$</code><code class="n">saveOrderItems</code><code class="p">[]</code> <code class="o">=</code> <code class="p">[</code>
<code class="linenos">40 </code>                <code class="s1">'quantity'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">item</code><code class="p">[</code><code class="s1">'quantity'</code><code class="p">],</code>
<code class="linenos">41 </code>                <code class="s1">'product_id'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">item</code><code class="p">[</code><code class="s1">'id'</code><code class="p">],</code>
<code class="linenos">42 </code>            <code class="p">];</code>
<code class="linenos">43 </code>        <code class="p">}</code>
<code class="linenos">44 </code>        <code class="o">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">items</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">createMany</code><code class="p">(</code><code class="o">$</code><code class="n">saveOrderItems</code><code class="p">);</code>
<code class="linenos">45 </code>
<code class="linenos">46 </code>        <code class="o">$</code><code class="n">gatewayCode</code> <code class="o">=</code> <code class="o">$</code><code class="n">payment</code><code class="o">-&gt;</code><code class="n">doPayment</code><code class="p">([</code>
<code class="linenos">47 </code>            <code class="s1">'our_code'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">,</code>
<code class="linenos">48 </code>            <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">customer</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">,</code>
<code class="linenos">49 </code>            <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">customer</code><code class="o">-&gt;</code><code class="n">email</code><code class="p">,</code>
<code class="linenos">50 </code>            <code class="s1">'cardToken'</code> <code class="o">=&gt;</code> <code class="s1">'XYZ'</code><code class="p">,</code>
<code class="linenos">51 </code>            <code class="s1">'paymentMethod'</code> <code class="o">=&gt;</code> <code class="s1">'CREDIT_CARD'</code>
<code class="linenos">52 </code>        <code class="p">])[</code><code class="s1">'gateway_code'</code><code class="p">];</code>
<code class="linenos">53 </code>
<code class="linenos">54 </code>
<code class="linenos">55 </code>        <code class="o">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">([</code><code class="s1">'gateway_code'</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="n">gatewayCode</code><code class="p">]);</code>
<code class="linenos">56 </code>
<code class="linenos">57 </code>        <code class="n">session</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">forget</code><code class="p">(</code><code class="n">CartService</code><code class="p">::</code><code class="n">SESSION_KEY</code><code class="p">);</code>
<code class="linenos">58 </code>
<code class="linenos">59 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'site.checkout.thanks'</code><code class="p">,</code> <code class="o">$</code><code class="n">order</code><code class="p">);</code>
<code class="linenos">60 </code>    <code class="p">}</code>
<code class="linenos">61 </code>
<code class="linenos">62 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">thanks</code><code class="p">(</code><code class="n">Order</code> <code class="o">$</code><code class="n">order</code><code class="p">)</code>
<code class="linenos">63 </code>    <code class="p">{</code>
<code class="linenos">64 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'site.thanks'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'order'</code><code class="p">));</code>
<code class="linenos">65 </code>    <code class="p">}</code>
<code class="linenos">66 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Vamos dá um zoom no método <code>process</code>: </p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">process</code><code class="o">(</code><code class="nt">PaymentInterface</code> <code class="o">$</code><code class="nt">payment</code><code class="o">,</code> <code class="nt">CartService</code> <code class="o">$</code><code class="nt">cart</code><code class="o">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">if(!$cart-&gt;count())</code> <code class="err">{</code>
<code class="linenos"> 4 </code>        <code class="err">session()-&gt;flash('warning',</code> <code class="err">'Sem</code> <code class="err">Itens</code> <code class="err">para</code> <code class="err">Processar</code> <code class="err">Checkout!')</code><code class="p">;</code>
<code class="linenos"> 5 </code>        <code class="err">return</code> <code class="err">redirect()-&gt;route('site.home')</code><code class="p">;</code>
<code class="linenos"> 6 </code>    <code class="p">}</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code>    <code class="o">$</code><code class="nt">customer</code> <code class="o">=</code> <code class="nt">auth</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">user</code><code class="o">();</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code>    <code class="o">$</code><code class="nt">order</code> <code class="o">=</code> <code class="o">$</code><code class="nt">this-</code><code class="o">&gt;</code><code class="nt">modelOrder-</code><code class="o">&gt;</code><code class="nt">create</code><code class="o">(</code><code class="cp">[</code>
<code class="linenos">11 </code>        <code class="s1">'code'</code> <code class="o">=&gt;</code> <code class="nx">Str</code><code class="nl">::uuid</code><code class="p">(),</code>
<code class="linenos">12 </code>        <code class="s1">'user_id'</code> <code class="o">=&gt;</code> <code class="nv">$customer</code><code class="o">-&gt;</code><code class="nb">id</code>
<code class="linenos">13 </code>    <code class="cp">]</code><code class="o">);</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>    <code class="o">$</code><code class="nt">saveOrderItems</code> <code class="o">=</code> <code class="cp">[]</code><code class="o">;</code>
<code class="linenos">16 </code>    <code class="nt">foreach</code><code class="o">($</code><code class="nt">cart-</code><code class="o">&gt;</code><code class="nt">all</code><code class="o">()</code> <code class="nt">as</code> <code class="o">$</code><code class="nt">item</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">17 </code>        <code class="err">$saveOrderItems</code><code class="cp">[]</code> <code class="err">=</code> <code class="cp">[</code>
<code class="linenos">18 </code>            <code class="s1">'quantity'</code> <code class="o">=&gt;</code> <code class="nv">$item</code><code class="err">[</code><code class="s1">'quantity'</code><code class="cp">]</code><code class="err">,</code>
<code class="linenos">19 </code>            <code class="err">'product_id'</code> <code class="err">=&gt;</code> <code class="err">$item</code><code class="cp">[</code><code class="s1">'id'</code><code class="cp">]</code><code class="err">,</code>
<code class="linenos">20 </code>        <code class="err">]</code><code class="p">;</code>
<code class="linenos">21 </code>    <code class="p">}</code>
<code class="linenos">22 </code>    <code class="o">$</code><code class="nt">order-</code><code class="o">&gt;</code><code class="nt">items</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">createMany</code><code class="o">($</code><code class="nt">saveOrderItems</code><code class="o">);</code>
<code class="linenos">23 </code>
<code class="linenos">24 </code>    <code class="o">$</code><code class="nt">gatewayCode</code> <code class="o">=</code> <code class="o">$</code><code class="nt">payment-</code><code class="o">&gt;</code><code class="nt">doPayment</code><code class="o">(</code><code class="cp">[</code>
<code class="linenos">25 </code>        <code class="s1">'our_code'</code> <code class="o">=&gt;</code> <code class="nv">$order</code><code class="o">-&gt;</code><code class="nb">id</code><code class="p">,</code>
<code class="linenos">26 </code>        <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="nv">$customer</code><code class="o">-&gt;</code><code class="nb">name</code><code class="p">,</code>
<code class="linenos">27 </code>        <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="nv">$customer</code><code class="o">-&gt;</code><code class="nx nx-Member">email</code><code class="p">,</code>
<code class="linenos">28 </code>        <code class="s1">'cardToken'</code> <code class="o">=&gt;</code> <code class="s1">'XYZ'</code><code class="p">,</code>
<code class="linenos">29 </code>        <code class="s1">'paymentMethod'</code> <code class="o">=&gt;</code> <code class="s1">'CREDIT_CARD'</code>
<code class="linenos">30 </code>    <code class="cp">]</code><code class="o">)</code><code class="cp">[</code><code class="s1">'gateway_code'</code><code class="cp">]</code><code class="o">;</code>
<code class="linenos">31 </code>
<code class="linenos">32 </code>
<code class="linenos">33 </code>    <code class="o">$</code><code class="nt">order-</code><code class="o">&gt;</code><code class="nt">update</code><code class="o">(</code><code class="cp">[</code><code class="s1">'gateway_code'</code> <code class="o">=&gt;</code> <code class="nv">$gatewayCode</code><code class="cp">]</code><code class="o">);</code>
<code class="linenos">34 </code>
<code class="linenos">35 </code>    <code class="nt">session</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">forget</code><code class="o">(</code><code class="nt">CartService</code><code class="p">::</code><code class="nd">SESSION_KEY</code><code class="o">);</code>
<code class="linenos">36 </code>
<code class="linenos">37 </code>    <code class="nt">return</code> <code class="nt">redirect</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">route</code><code class="o">(</code><code class="s1">'site.checkout.thanks'</code><code class="o">,</code> <code class="o">$</code><code class="nt">order</code><code class="o">);</code>
<code class="linenos">38 </code><code class="err">}</code>
</pre></div>

</figure>


<p>Perceba que aqui explicito duas dependências, sendo uma delas nosso objeto de pagamento que deve ser do tipo <code>PaymentoInterface</code> e isso é possível, possível termos um concreto, por conta do bind no container de serviços do Laravel e deixando nosso controller livre da dependência de uma classe concreta o que nos ajudará muito na troca por outro gateway e claro que este ponto é só o ínicio do que você pode alcançar com este tipo de abstração.</p>

<p>Um ponto que irei comentar aqui para este método será no que estou fazendo no todo dele e não em cada ponto linha a linha, tudo bem? Basicamente neste método pego os itens do carrinho, existindo eu gero uma coleção com estes produtos a serem salvos em massa através do método <code>createMany</code> via associação de Pedido(Order) com Itens Pedido(OrderItem).</p>

<p>Após isso, todo o processo de pagamento é mocado(como se) mas deixei bem explícito alguns detalhes pra fins de visualização de como é o business. Perceba que passei os dados para nosso objeto de pagamento como se eu estivesse mesmo passando os dados para um serviço real(PagSeguro, PagarMe etc.) e é claro que estes dados vão ser diferentes dependendo do gateway utilizado, como comentei aqui é mais pra termos algo próximo do real para te dá a visão melhor do processo.</p>

<p>O código do gateway que retornei do nosso HappyPaymentService seria algo retornado da API de um serviço real que sincronizaríamos em nossa base para futuras consultas, ao receber este código atualizo nosso Pedido(Order) com o código em questão, finalizando assim nosso processo de registro do pedido e pagamento.</p>

<p>Por fim redireciono nosso cliente para a tela de obrigado com alguns dados do pedido.</p>

<blockquote>
  <p>O restante do controller de checkout é bem simples e não carece, ao meu ver, de explicações uma vez que temos apenas chamadas para views :D</p>
</blockquote>

<h2 id="leanpub-auto-rotas-e-views-checkout" class="section">Rotas e Views Checkout</h2>

<p>Dentro da pasta de views, na pasta site, crie os arquivos <code>checkout.blade.php</code> e o <code>thanks.blade.php</code>. Segue os códigos abaixo:</p>

<p><b>checkout.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;x-layouts.site&gt;</code>
<code class="linenos"> 2 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"border-b border-gray-300 pb-4 flex justify-between items-center"</code><code class="nt">&gt;</code>
<code class="linenos"> 3 </code>        <code class="nt">&lt;h1</code> <code class="na">class=</code><code class="s">"text-4xl font-thin text-white"</code><code class="nt">&gt;</code>
<code class="linenos"> 4 </code>            <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'site.home'</code><code class="o">)</code><code class="cp">}}</code><code class="s">"</code> <code class="na">class=</code><code class="s">"text-xl hover:underline hover:te\</code>
<code class="linenos"> 5 </code><code class="s">xt-black transition duration-300 ease-in-out"</code><code class="nt">&gt;</code>Home<code class="nt">&lt;/a&gt;</code> <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"text-xl"</code><code class="nt">&gt;</code><code class="ni">&amp;raquo;</code>\
<code class="linenos"> 6 </code><code class="nt">&lt;/span&gt;</code> Checkout
<code class="linenos"> 7 </code>        <code class="nt">&lt;/h1&gt;</code>
<code class="linenos"> 8 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos"> 9 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full h-[480px] flex justify-center items-center"</code><code class="nt">&gt;</code>
<code class="linenos">10 </code>        <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-[380px] rounded p-4"</code><code class="nt">&gt;</code>
<code class="linenos">11 </code>            <code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'site.checkout.process'</code><code class="o">)</code><code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"POST"</code><code class="nt">&gt;</code>
<code class="linenos">12 </code>                @csrf
<code class="linenos">13 </code>                <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6"</code><code class="nt">&gt;</code>
<code class="linenos">14 </code>                    <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"card_number"</code> <code class="na">class=</code><code class="s">"text-white mb-2"</code><code class="nt">&gt;</code>Número Cartão<code class="err">&lt;</code>/\
<code class="linenos">15 </code>label&gt;
<code class="linenos">16 </code>                    <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"card_number"</code> <code class="na">id=</code><code class="s">"card_number"</code> <code class="err">placehold\</code>
<code class="linenos">17 </code><code class="na">er=</code><code class="s">"Número Cartão..."</code> <code class="err">required</code>
<code class="linenos">18 </code>                        <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray-900 bg-white"</code><code class="nt">&gt;</code>
<code class="linenos">19 </code>                <code class="nt">&lt;/div&gt;</code>
<code class="linenos">20 </code>
<code class="linenos">21 </code>                <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mb-6 flex gap-x-2"</code><code class="nt">&gt;</code>
<code class="linenos">22 </code>                    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-1/2"</code><code class="nt">&gt;</code>
<code class="linenos">23 </code>                        <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"card_date"</code> <code class="na">class=</code><code class="s">"text-white mb-2"</code><code class="nt">&gt;</code>Validade Cart\
<code class="linenos">24 </code>ão<code class="nt">&lt;/label&gt;</code>
<code class="linenos">25 </code>                        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"card_date"</code> <code class="na">id=</code><code class="s">"card_date"</code> <code class="err">placehold\</code>
<code class="linenos">26 </code><code class="na">er=</code><code class="s">"Validade Cartão..."</code> <code class="err">required</code>
<code class="linenos">27 </code>                            <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray-900 bg-whit\</code>
<code class="linenos">28 </code><code class="s">e"</code><code class="nt">&gt;</code>
<code class="linenos">29 </code>                    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">30 </code>
<code class="linenos">31 </code>                    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-1/2"</code><code class="nt">&gt;</code>
<code class="linenos">32 </code>                        <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"card_cvv"</code> <code class="na">class=</code><code class="s">"text-white mb-2"</code><code class="nt">&gt;</code>CVV Cartão<code class="err">&lt;</code>/la\
<code class="linenos">33 </code>bel&gt;
<code class="linenos">34 </code>                        <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"card_cvv"</code> <code class="na">id=</code><code class="s">"card_cvv"</code> <code class="err">placeholder\</code>
<code class="linenos">35 </code><code class="err">="CVV</code> <code class="err">Cartão..."</code> <code class="err">required</code>
<code class="linenos">36 </code>                            <code class="na">class=</code><code class="s">"w-full p-2 rounded border border-gray-900 bg-whit\</code>
<code class="linenos">37 </code><code class="s">e"</code><code class="nt">&gt;</code>
<code class="linenos">38 </code>                    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">39 </code>                <code class="nt">&lt;/div&gt;</code>
<code class="linenos">40 </code>
<code class="linenos">41 </code>                <code class="nt">&lt;button</code> <code class="na">class=</code><code class="s">"px-5 py-2 rounded text-white text-5xl font-bold bg-gr\</code>
<code class="linenos">42 </code><code class="s">een-600"</code><code class="nt">&gt;</code>
<code class="linenos">43 </code>                    PAGAR
<code class="linenos">44 </code>                <code class="nt">&lt;/button&gt;</code>
<code class="linenos">45 </code>            <code class="nt">&lt;/form&gt;</code>
<code class="linenos">46 </code>        <code class="nt">&lt;/div&gt;</code>
<code class="linenos">47 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">48 </code><code class="nt">&lt;/x-layouts.site&gt;</code>
</pre></div>

</figure>


<p>Apesar de não termos um processo de cartão e pagamento, criei uma tela com alguns campos para informar cartão de crédito, como comentei algo mais de perfumaria neste momento uma vez que mocamos o pagamento.</p>

<p><b>thanks.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">&lt;x-layouts.site&gt;</code>
<code class="linenos"> 2 </code>    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"w-full mt-20 text-white"</code><code class="nt">&gt;</code>
<code class="linenos"> 3 </code>        <code class="nt">&lt;h3</code> <code class="na">class=</code><code class="s">"text-2xl font-extrabold mb-4"</code><code class="nt">&gt;</code>Obrigado, compra concluída!<code class="nt">&lt;/h3&gt;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>        <code class="nt">&lt;p</code> <code class="na">class=</code><code class="s">"text-xl"</code><code class="nt">&gt;</code>
<code class="linenos"> 6 </code>            Código compra: <code class="nt">&lt;strong&gt;</code> <code class="cp">{{</code><code class="err">$</code><code class="nv">order-</code><code class="o">&gt;</code><code class="nv">code</code><code class="cp">}}</code><code class="nt">&lt;/strong&gt;</code> <code class="nt">&lt;br&gt;</code>
<code class="linenos"> 7 </code>            Sua compra foi registrada e está aguardando a confirmação do pagamento, \
<code class="linenos"> 8 </code>assim que o status for modificado te notificaremos via e-mail.
<code class="linenos"> 9 </code>        <code class="nt">&lt;/p&gt;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="nt">&lt;/div&gt;</code>
<code class="linenos">12 </code><code class="nt">&lt;/x-layouts.site&gt;</code>
</pre></div>

</figure>


<p>Abaixo segue no grupo de rotas pro checkout:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'checkout'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'site.checkout.'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">middleware</code><code class="o">(</code><code class="s1">'auth'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">functio</code><code class="err">\</code>
<code class="linenos">2 </code><code class="nt">n</code><code class="o">()</code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">CheckoutController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'index'</code><code class="cp">]</code><code class="p">)</code><code class="err">\</code>
<code class="linenos">4 </code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'index'</code><code class="p">);</code>
<code class="linenos">5 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">post</code><code class="p">(</code><code class="s1">'/process'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">CheckoutController</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'</code><code class="se">\</code><code class="s1"></code>
<code class="linenos">6 </code><code class="s1">process'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'process'</code><code class="p">);</code>
<code class="linenos">7 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'/thanks/{order}'</code><code class="p">,</code>  <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Site</code><code class="o">\</code><code class="nx">CheckoutController</code><code class="nl">::c</code><code class="o">\</code>
<code class="linenos">8 </code><code class="nx">lass</code><code class="p">,</code> <code class="s1">'thanks'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'thanks'</code><code class="p">);</code>
<code class="linenos">9 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<blockquote>
  <p>Caso tenha dúvidas quanto ao código recorra ao github que deixei nos capítulos introdutórios ou nosso grupo no telegram.</p>
</blockquote>

<p>O checkout é algo que é bem pessoal do usuário e inclusive no momento de finalização precisamos da referência deste usuário(cliente) para associar ao pedido. Por esta razão precisamos colocar este grupo de rotas sob autenticação como mostro no código acima ao utilizar o middleware auth.</p>

<p>Para concluirmos nosso processo de checkout precisamos linkar o checkout no carrinho e também criar a tela de registro pro cliente que não possui cadastro.</p>

<h2 id="leanpub-auto-cadastro-cliente--concluindo-processo-de-checkout" class="section">Cadastro cliente &amp; Concluindo Processo de Checkout</h2>

<p>Como criaremos a tela de cadastro e estamos pedindo que nosso cliente esteja autenticado durante o checkout, eu coloquei um link abaixo do btn de login pra tela de registro.</p>

<p>Claro, vamos antes gerar o que é preciso pra tela de registro/cadastro e posteriormente vamos colocar este link que comentei. Vamos gerar nosso <code>RegisterController</code> e seu form request:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller Auth/RegisterController
<code class="linenos">2 </code>
<code class="linenos">3 </code>php artisan make:request Auth/RegisterRequest
</pre></div>

</figure>


<p>Segue na íntegra o conteúdo do controller e do Form Request:</p>

<p><b>RegisterController</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Auth</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Requests</code>\<code class="n">Auth</code>\<code class="n">RegisterRequest</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Models</code>\<code class="n">User</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Services</code>\<code class="n">CartService</code><code class="p">;</code>
<code class="linenos"> 9 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Auth</code>\<code class="n">Events</code>\<code class="n">Registered</code><code class="p">;</code>
<code class="linenos">10 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos">11 </code>
<code class="linenos">12 </code><code class="k">class</code> <code class="n">RegisterController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos">13 </code><code class="p">{</code>
<code class="linenos">14 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">__construct</code><code class="p">(</code><code class="n">private</code> <code class="n">User</code> <code class="o">$</code><code class="n">userModel</code><code class="p">)</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>
<code class="linenos">17 </code>    <code class="p">}</code>
<code class="linenos">18 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">19 </code>    <code class="p">{</code>
<code class="linenos">20 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'auth.register'</code><code class="p">);</code>
<code class="linenos">21 </code>    <code class="p">}</code>
<code class="linenos">22 </code>
<code class="linenos">23 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">store</code><code class="p">(</code><code class="n">RegisterRequest</code> <code class="o">$</code><code class="n">request</code><code class="p">,</code> <code class="n">CartService</code> <code class="o">$</code><code class="n">cart</code><code class="p">)</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="o">$</code><code class="n">data</code> <code class="o">=</code> <code class="o">$</code><code class="n">request</code><code class="o">-&gt;</code><code class="n">validated</code><code class="p">();</code>
<code class="linenos">26 </code>        <code class="o">$</code><code class="n">data</code><code class="p">[</code><code class="s1">'password'</code><code class="p">]</code> <code class="o">=</code> <code class="n">bcrypt</code><code class="p">(</code><code class="o">$</code><code class="n">data</code><code class="p">[</code><code class="s1">'password'</code><code class="p">]);</code>
<code class="linenos">27 </code>
<code class="linenos">28 </code>        <code class="o">$</code><code class="n">user</code> <code class="o">=</code> <code class="o">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">userModel</code><code class="o">-&gt;</code><code class="n">create</code><code class="p">(</code><code class="o">$</code><code class="n">data</code><code class="p">);</code>
<code class="linenos">29 </code>
<code class="linenos">30 </code>        <code class="n">event</code><code class="p">(</code><code class="n">new</code> <code class="n">Registered</code><code class="p">(</code><code class="o">$</code><code class="n">user</code><code class="p">));</code>
<code class="linenos">31 </code>
<code class="linenos">32 </code>        <code class="n">auth</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">login</code><code class="p">(</code><code class="o">$</code><code class="n">user</code><code class="p">);</code>
<code class="linenos">33 </code>
<code class="linenos">34 </code>        <code class="k">if</code><code class="p">(</code><code class="o">$</code><code class="n">cart</code><code class="o">-&gt;</code><code class="n">count</code><code class="p">())</code> <code class="p">{</code>
<code class="linenos">35 </code>            <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'site.checkout.index'</code><code class="p">);</code>
<code class="linenos">36 </code>        <code class="p">}</code>
<code class="linenos">37 </code>
<code class="linenos">38 </code>        <code class="k">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s1">'site.home'</code><code class="p">);</code>
<code class="linenos">39 </code>    <code class="p">}</code>
<code class="linenos">40 </code><code class="p">}</code>
</pre></div>

</figure>


<p>No controller acima perceba que realizamos o cadastro do cliente e usamos o helper auth para logar o usuário informando o model gerado pós criação. Adicionei a este controller a verificação da existência do carrinho com itens na sessão e existindo já mandamos o cliente para a tela do checkout.</p>

<p>Neste caso você também pode encaminhar o usuário pra tela do carrinho e deixar ele decidir se quer prosseguir no checkout ou fazer outras operações, daí, basta modiciar a rota do redirecionamento.</p>

<blockquote>
  <p>PS.: Um ponto importante também, é a parte em que no cadastro do usuário utilizamos o helper bcrypt para realizar o hash da senha do nosso usuário. Atente a isso e nunca salve senhas em plain text em qualquer lugar e aplicação que seja!</p>

  <p>PS2.: Respeitando o funcionamento do Laravel emiti aqui o evento de usuário registrado, isso permite ter listeners que podem escutar este evento e agir conforme lógica esperada. Fiz isso inclusive pra se manter bem próximo de como é feito em um Starter Kit, no último capítulo falarei sobre eventos e você terá mais clareza sobre este ponto.</p>
</blockquote>

<p>Adicione o conteúdo das regras de validação ao RegisterRequest gerado:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">return</code> <code class="cp">[</code>
<code class="linenos">2 </code>    <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="s1">'required|string|max:255'</code><code class="p">,</code>
<code class="linenos">3 </code>    <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="s1">'required|string|lowercase|email|max:255|unique:'</code><code class="bp">.</code><code class="nb">User</code><code class="nl">::class</code><code class="p">,</code>
<code class="linenos">4 </code>    <code class="s1">'password'</code> <code class="o">=&gt;</code> <code class="err">[</code><code class="s1">'required'</code><code class="p">,</code> <code class="s1">'confirmed'</code><code class="p">,</code> <code class="nx">Rules</code><code class="o">\</code><code class="nx">Password</code><code class="nl">::defaults</code><code class="p">()</code><code class="cp">]</code><code class="o">,</code>
<code class="linenos">5 </code><code class="o">];</code>
</pre></div>

</figure>


<p>Pontos importantes das validações acima, o Laravel possui uma classe utilitária para as regras de validação de senha e basicamente usamos o método defaults que pede senha minima de 8 caracteres, valida string e etc. Esta classe possui diversos métodos extras que você pode utilizar e recomendo fortemente que você dê uma espiada no conteúdo desta classe.</p>

<p>Não esqueça de adicionar o namespace base da classe Password:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>use Illuminate\Validation\Rules;
</pre></div>

</figure>


<p>Outra validação importante de frisar aqui, é o validador <code>confirmed</code> para a senha, este validador permite que coloquemos no form um input de confirmação de senha e que deve seguir a seguinte regra: </p>

<ul>
  <li>Se o input a ser confirmado for chamado de <b>senha</b> o input de confirmação deve receber o nome do campo mais o sufixo <b>_confirmation</b>, ou seja, input da senha com nome <b>senha</b> e o input de confirmação com o nome <b>senha_confirmation</b>. Você verá este detalhe no html da view abaixo.</li>
  <li>Com esta configuração o validador vai interceptar automaticamente os campos e validar se a confirmação bate com o valor principal.</li>
</ul>

<blockquote>
  <p>PS.: Um lembrete simples, não esqueça de retornar true no método authorize do RegisterRequest.</p>
</blockquote>

<p>Gerado o controller e a request, vamos adicionar a rota para o cadastro e criar a view com o form de cadastro. Segue abaixo ambos:</p>

<p><b>resources/views/auth/register.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"flex justify-center items-center"</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-[690px] p-5 rounded bg-black shadow shadow-purple-600"</code><code class="o">&gt;</code>
<code class="linenos"> 5 </code>            <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full text-center mb-4 text-2xl font-extrabold text-white"</code><code class="o">&gt;</code><code class="n">E</code>\
<code class="linenos"> 6 </code><code class="n">xperts</code> <code class="n">Store</code><code class="o">&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos"> 7 </code>            <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{ route('register.store') }}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"post"</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>                <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 9 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">10 </code>                    <code class="o">&lt;</code><code class="n">label</code> <code class="k">for</code><code class="o">=</code><code class="s">"name"</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white mb-2"</code><code class="o">&gt;</code><code class="n">Nome</code> <code class="n">Completo</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">11 </code>                    <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"text"</code> <code class="n">name</code><code class="o">=</code><code class="s">"name"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"name"</code> <code class="n">placeholder</code><code class="o">=</code><code class="s">"Nome Compl\</code>
<code class="linenos">12 </code><code class="s">eto..."</code> <code class="n">required</code>
<code class="linenos">13 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-gray-900 text-white"</code><code class="o">&gt;</code>
<code class="linenos">14 </code>                    <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">name</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">15 </code>                        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg\</code>
<code class="linenos">16 </code><code class="s">-red-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">17 </code>                    <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">18 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">21 </code>                    <code class="o">&lt;</code><code class="n">label</code> <code class="k">for</code><code class="o">=</code><code class="s">"email"</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white mb-2"</code><code class="o">&gt;</code><code class="n">E</code><code class="o">-</code><code class="n">mail</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">22 </code>                    <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"email"</code> <code class="n">name</code><code class="o">=</code><code class="s">"email"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"email"</code> <code class="n">placeholder</code><code class="o">=</code><code class="s">"Seu e-m\</code>
<code class="linenos">23 </code><code class="s">ail..."</code> <code class="n">required</code>
<code class="linenos">24 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-gray-900 text-white"</code><code class="o">&gt;</code>
<code class="linenos">25 </code>                    <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">email</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">26 </code>                        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg\</code>
<code class="linenos">27 </code><code class="s">-red-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">28 </code>                    <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">29 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">30 </code>
<code class="linenos">31 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">32 </code>                    <code class="o">&lt;</code><code class="n">label</code> <code class="k">for</code><code class="o">=</code><code class="s">"password"</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white mb-2"</code><code class="o">&gt;</code><code class="n">Senha</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">33 </code>                    <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"password"</code> <code class="n">name</code><code class="o">=</code><code class="s">"password"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"password"</code> <code class="n">placeholder</code>\
<code class="linenos">34 </code><code class="o">=</code><code class="s">"Sua senha..."</code>
<code class="linenos">35 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-gray-900 text-white"</code><code class="o">&gt;</code>
<code class="linenos">36 </code>
<code class="linenos">37 </code>                    <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">password</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">38 </code>                        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg\</code>
<code class="linenos">39 </code><code class="s">-red-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">40 </code>                    <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">41 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">42 </code>
<code class="linenos">43 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-6"</code><code class="o">&gt;</code>
<code class="linenos">44 </code>                    <code class="o">&lt;</code><code class="n">label</code> <code class="k">for</code><code class="o">=</code><code class="s">"password_confirmation"</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-white mb-2"</code><code class="o">&gt;</code><code class="n">Confi</code>\
<code class="linenos">45 </code><code class="n">rmar</code> <code class="n">Senha</code><code class="o">&lt;/</code><code class="n">label</code><code class="o">&gt;</code>
<code class="linenos">46 </code>                    <code class="o">&lt;</code><code class="n">input</code> <code class="n">type</code><code class="o">=</code><code class="s">"password"</code> <code class="n">name</code><code class="o">=</code><code class="s">"password_confirmation"</code> <code class="kt">id</code><code class="o">=</code><code class="s">"password\</code>
<code class="linenos">47 </code><code class="s">_confirmation"</code> <code class="n">placeholder</code><code class="o">=</code><code class="s">"Confirme Sua senha..."</code>
<code class="linenos">48 </code>                        <code class="k">class</code><code class="o">=</code><code class="s">"w-full p-2 rounded border border-gray-900 text-white"</code><code class="o">&gt;</code>
<code class="linenos">49 </code>
<code class="linenos">50 </code>                    <code class="p">@</code><code class="n">error</code><code class="p">(</code><code class="err">'</code><code class="n">password_confirmation</code><code class="err">'</code><code class="p">)</code>
<code class="linenos">51 </code>                        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mt-2 p-2 rounded border border-red-900 bg\</code>
<code class="linenos">52 </code><code class="s">-red-400 text-red-900"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$message</code><code class="p">}}</code><code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">53 </code>                    <code class="p">@</code><code class="n">enderror</code>
<code class="linenos">54 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">55 </code>
<code class="linenos">56 </code>                <code class="o">&lt;</code><code class="n">button</code>
<code class="linenos">57 </code>                    <code class="k">class</code><code class="o">=</code><code class="s">"py-2 px-4 text-thin text-xl cursor-pointer rounded border\</code>
<code class="linenos">58 </code><code class="s"> border-purple-900 bg-black text-purple-900 hover:bg-purple-900 hover:text-white tra\</code>
<code class="linenos">59 </code><code class="s">nsition ease-in-out duration-300"</code><code class="o">&gt;</code>
<code class="linenos">60 </code>                <code class="n">Cadastrar</code>
<code class="linenos">61 </code>                <code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">62 </code>            <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos">63 </code>
<code class="linenos">64 </code>            <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{route('login')}}"</code> <code class="k">class</code><code class="o">=</code><code class="s">"block mt-4 text-white hover:underlin\</code>
<code class="linenos">65 </code><code class="s">e hover:font-bold"</code><code class="o">&gt;</code><code class="n">Já</code> <code class="n">possui</code> <code class="n">cadastro</code><code class="o">?</code> <code class="n">Clique</code> <code class="n">aqui</code><code class="o">!&lt;/</code><code class="n">a</code><code class="o">&gt;</code>
<code class="linenos">66 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">67 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">68 </code><code class="o">&lt;/</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>Adicione a rota pra tela de cadastro no <b>web.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">Route</code><code class="o">::</code><code class="n">get</code><code class="p">('</code><code class="n">register</code><code class="p">',</code> <code class="p">[</code><code class="n">\App\Http\Controllers\Auth\RegisterController::class,</code> <code class="p">'</code><code class="n">index</code>\
<code class="linenos">2 </code><code class="p">'])</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">('</code><code class="n">register</code><code class="p">.</code><code class="n">index</code><code class="p">');</code>
<code class="linenos">3 </code>
<code class="linenos">4 </code><code class="n">Route</code><code class="o">::</code><code class="n">post</code><code class="p">('</code><code class="n">register</code><code class="p">',</code> <code class="p">[</code><code class="n">\App\Http\Controllers\Auth\RegisterController::class,</code> <code class="p">'</code><code class="n">stor</code>\
<code class="linenos">5 </code><code class="n">e</code><code class="p">'])</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">('</code><code class="n">register</code><code class="p">.</code><code class="n">store</code><code class="p">');</code>
</pre></div>

</figure>


<p>Coloquei as rotas do cadastro próximo das rotas do login pra deixar o arquivo de rotas organizado. Acima temos a rota de exibição do form e a rota que recebe os dados pra processar a criação.</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----register.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Vamos adicionar, agora, o link pra tela de registro na tela do login. Logo abaixo do <b>button</b> de logar coloque o link do trecho abaixo:</p>

<p>Alteração na view <b>login.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'register.index'</code><code class="o">)</code><code class="cp">}}</code><code class="s">"</code> <code class="na">class=</code><code class="s">"block mt-4 text-white hover:underline h\</code>
<code class="linenos">2 </code><code class="s">over:font-bold"</code><code class="nt">&gt;</code>Não possui cadastro? Clique aqui!<code class="nt">&lt;/a&gt;</code>
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----login-link-cadastro.png">
    <figcaption></figcaption>
  </figure>
</div>


<h2 id="leanpub-auto-prosseguindo-pra-finalizao-do-checkout" class="section">Prosseguindo pra Finalização do Checkout</h2>

<p>Com todos os insumos anteriores, vamos adicionar na view do carrinho a rota do botão pro checkout. Adicione a rota por apelido a nossa tag <b>a</b> que levaria pro checkout:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'site.checkout.index'</code><code class="o">)</code><code class="cp">}}</code><code class="x"></code>
</pre></div>

</figure>


<p>A tag completa:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'site.checkout.index'</code><code class="o">)</code><code class="cp">}}</code><code class="s">"</code> <code class="na">class=</code><code class="s">"px-5 py-2 rounded text-white text-\</code>
<code class="linenos">2 </code><code class="s">2xl font-bold bg-green-600"</code><code class="nt">&gt;</code>Continuar<code class="nt">&lt;/a&gt;</code>
</pre></div>

</figure>


<p>A tag está ao lado da tag de cancelar o carrinho.</p>

<p>Um ponto legal no trecho acima é que mandamos o link pra tela do checkout e não havendo sessão, nosso usuário é enviado pra tela de login podendo escolher clicar no link de criar conta também. Ele escolhendo logar, como o link referência era nosso checkout, após o login ele volta pra tela de checkout por conta do <code>redirect()-&gt;intended()</code> lá no <b>LoginController</b>. Ponto simples mas facilita muito a experiência do usuário.</p>

<p>Feito isso podemos realizar todo o processo de compra do usuário, adicionando itens no carrinho, clicando em continuar e prosseguir pra a finalização do pagamento.</p>

<p>1. Escolhemos o produto:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----compra-1.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>2. Vamos ao carrinho:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----compra-2.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>3. Podemos simular o pagamento:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----compra-3.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>4. Temos nossa tela de obrigado:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----compra-4.png">
    <figcaption></figcaption>
  </figure>
</div>


<h2 id="leanpub-auto-pedidos-orders-do-cliente" class="section">Pedidos (Orders) do Cliente</h2>

<p>Pra gente completar nosso ciclo, vamos criar uma tela, mesmo que simples, para nosso cliente visualizar seus pedidos. Comecemos gerando o controller para tal:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:controller Customer/MyOrdersController
</pre></div>

</figure>


<p>Segue o conteúdo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="err">?</code><code class="n">php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="n">namespace</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Customer</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="n">use</code> <code class="n">App</code>\<code class="n">Http</code>\<code class="n">Controllers</code>\<code class="n">Controller</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="n">use</code> <code class="n">Illuminate</code>\<code class="n">Http</code>\<code class="n">Request</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code><code class="k">class</code> <code class="n">MyOrdersController</code> <code class="k">extends</code> <code class="n">Controller</code>
<code class="linenos"> 9 </code><code class="p">{</code>
<code class="linenos">10 </code>    <code class="n">public</code> <code class="n">function</code> <code class="n">index</code><code class="p">()</code>
<code class="linenos">11 </code>    <code class="p">{</code>
<code class="linenos">12 </code>        <code class="o">$</code><code class="n">orders</code> <code class="o">=</code> <code class="n">auth</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">user</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">orders</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">orderBy</code><code class="p">(</code><code class="s1">'id'</code><code class="p">,</code> <code class="s1">'DESC'</code><code class="p">)</code><code class="o">-&gt;</code><code class="n">paginate</code><code class="p">(</code><code class="mi">5</code><code class="p">);</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code>        <code class="k">return</code> <code class="n">view</code><code class="p">(</code><code class="s1">'customer.my-orders'</code><code class="p">,</code> <code class="n">compact</code><code class="p">(</code><code class="s1">'orders'</code><code class="p">));</code>
<code class="linenos">15 </code>    <code class="p">}</code>
<code class="linenos">16 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba aqui, que através do usuário autenticado pego os pedidos dele de forma paginada, ordenada pelas mais recente e limitando 5 pedidos por página. Lembrando que o método <code>user()</code> do auth retorna um model <code>User</code> com os dados do usuário autenticado.</p>

<p>Outro ponto, ainda não temos o método de ligação em User. Então vamos adicionar o método <code>orders</code> no model <b>User</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">orders</code><code class="o">():</code> <code class="nt">HasMany</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">return</code> <code class="err">$this-&gt;hasMany(</code><code class="n">Order</code><code class="p">:</code><code class="o">:</code><code class="n">class</code><code class="p">);</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Método acima que indica que o usuário tem N pedidos e o pedido pertence a 1 usuário.</p>

<p>Pontos que já conhecemos bem, vamos a tela dos pedidos e posteriormente as rotas:</p>

<p><b>resources/views/customer/my-orders.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="o">&lt;</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
<code class="linenos"> 2 </code>    <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"max-w-7xl mx-auto"</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-8 text-white py-4 border-b border-purple-500"</code><code class="o">&gt;</code>
<code class="linenos"> 4 </code>            <code class="n">Olá</code><code class="p">,</code> <code class="p">{{</code><code class="n">request</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">user</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">}}</code>
<code class="linenos"> 5 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>        <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full mb-8 text-white py-4"</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>            <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-2xl font-extrabold block mb-8 text-white"</code><code class="o">&gt;</code><code class="n">Meus</code> <code class="n">Pedidos</code><code class="o">&lt;/</code>\
<code class="linenos"> 9 </code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos">10 </code>            <code class="p">@</code><code class="n">forelse</code><code class="p">(</code><code class="n">$orders</code> <code class="n">as</code> <code class="n">$order</code><code class="p">)</code>
<code class="linenos">11 </code>                <code class="o">&lt;</code><code class="n">div</code> <code class="k">class</code><code class="o">=</code><code class="s">"w-full rounded bg-white shadow p-4 my-8"</code><code class="o">&gt;</code>
<code class="linenos">12 </code>                    <code class="o">&lt;</code><code class="n">h2</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-xl font-bold text-purple-900 mb-4 block"</code><code class="o">&gt;</code>
<code class="linenos">13 </code>                        <code class="nl">Pedido</code><code class="p">:</code> <code class="p">{{</code><code class="n">$order</code><code class="o">-&gt;</code><code class="n">code</code><code class="p">}}</code>
<code class="linenos">14 </code>                    <code class="o">&lt;/</code><code class="n">h2</code><code class="o">&gt;</code>
<code class="linenos">15 </code>
<code class="linenos">16 </code>                    <code class="o">&lt;</code><code class="n">p</code> <code class="k">class</code><code class="o">=</code><code class="s">"font-thin p-2 text-xl text-purple-900"</code><code class="o">&gt;</code>
<code class="linenos">17 </code>                        <code class="nl">Produtos</code><code class="p">:</code> <code class="o">&lt;</code><code class="n">br</code><code class="o">&gt;</code>
<code class="linenos">18 </code>                        <code class="o">&lt;</code><code class="n">ul</code> <code class="k">class</code><code class="o">=</code><code class="s">"p-8"</code><code class="o">&gt;</code>
<code class="linenos">19 </code>                        <code class="p">@</code><code class="n">foreach</code><code class="p">(</code><code class="n">$order</code><code class="o">-&gt;</code><code class="n">items</code> <code class="n">as</code> <code class="n">$item</code><code class="p">)</code>
<code class="linenos">20 </code>                            <code class="o">&lt;</code><code class="n">li</code> <code class="k">class</code><code class="o">=</code><code class="s">"text-purple-900 list-decimal"</code><code class="o">&gt;</code><code class="p">{{</code><code class="n">$item</code><code class="o">-&gt;</code><code class="n">produc</code>\
<code class="linenos">21 </code><code class="n">t</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">}}</code> <code class="o">-</code> <code class="p">{{</code><code class="n">number_format</code><code class="p">(</code><code class="n">$item</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="sc">','</code><code class="p">,</code> <code class="sc">'.'</code><code class="p">)}}</code> <code class="p">({{</code><code class="n">$item</code><code class="o">-&gt;</code><code class="n">quantity</code>\
<code class="linenos">22 </code><code class="p">}})</code><code class="n">x</code><code class="o">&lt;/</code><code class="n">li</code><code class="o">&gt;</code>
<code class="linenos">23 </code>                        <code class="p">@</code><code class="n">endforeach</code>
<code class="linenos">24 </code>                        <code class="o">&lt;/</code><code class="n">ul</code><code class="o">&gt;</code>
<code class="linenos">25 </code>                    <code class="o">&lt;/</code><code class="n">p</code><code class="o">&gt;</code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>                    <code class="o">&lt;</code><code class="n">p</code> <code class="k">class</code><code class="o">=</code><code class="s">"font-thin p-2 text-xl text-purple-900"</code><code class="o">&gt;</code>
<code class="linenos">28 </code>                        <code class="n">Total</code> <code class="nl">Pedido</code><code class="p">:</code> <code class="n">R$</code> <code class="p">{{</code><code class="n">number_format</code><code class="p">(</code><code class="n">$order</code><code class="o">-&gt;</code><code class="n">totalOrder</code><code class="p">(),</code> <code class="mi">2</code><code class="p">,</code> <code class="err">'</code><code class="p">,</code>\
<code class="linenos">29 </code><code class="err">'</code><code class="p">,</code> <code class="sc">'.'</code><code class="p">)}}</code>
<code class="linenos">30 </code>                    <code class="o">&lt;/</code><code class="n">p</code><code class="o">&gt;</code>
<code class="linenos">31 </code>                <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">32 </code>            <code class="p">@</code><code class="n">empty</code>
<code class="linenos">33 </code>            <code class="p">@</code><code class="n">endforelse</code>
<code class="linenos">34 </code>        <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">35 </code>
<code class="linenos">36 </code>    <code class="o">&lt;/</code><code class="n">div</code><code class="o">&gt;</code>
<code class="linenos">37 </code><code class="o">&lt;/</code><code class="n">x</code><code class="o">-</code><code class="n">layouts</code><code class="p">.</code><code class="n">site</code><code class="o">&gt;</code>
</pre></div>

</figure>


<p>Acima deixo pra você explorar a tela e desvendar os detalhes existentes nela. Faço isso, pois não temos muito diferente do que já vimos na jornada e do que você têm de bagagem com PHP.</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----orders.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Um ponto importante nesta tela, é o total do pedido que adicionei. Utilizei a ligação de Order com Items e via collection retornada, dos itens do pedido, fiz um reduce para somar e gerar o total. </p>

<p>O método foi adicionado no model Order:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">totalOrder</code><code class="p">()</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">$</code><code class="n">total</code> <code class="o">=</code> <code class="err">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">items</code><code class="o">-&gt;</code><code class="n">reduce</code><code class="p">(</code><code class="kr">function</code><code class="p">(</code><code class="o">?</code><code class="n">int</code> <code class="err">$</code><code class="n">total</code><code class="p">,</code> <code class="err">$</code><code class="n">item</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">4 </code>        <code class="kr">return</code> <code class="err">$</code><code class="n">total</code> <code class="o">+=</code> <code class="p">(</code><code class="err">$</code><code class="n">item</code><code class="o">-&gt;</code><code class="n">quantity</code> <code class="o">*</code> <code class="err">$</code><code class="n">item</code><code class="o">-&gt;</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">price</code><code class="p">);</code>
<code class="linenos">5 </code>    <code class="p">});</code>
<code class="linenos">6 </code>
<code class="linenos">7 </code>    <code class="kr">return</code> <code class="err">$</code><code class="n">total</code><code class="p">;</code>
<code class="linenos">8 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Adicione a rota pro painel dos pedidos no arquivo <b>web.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">middleware</code><code class="o">(</code><code class="s1">'auth'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">prefix</code><code class="o">(</code><code class="s1">'customers'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'customers.'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code><code class="o">()</code><code class="p">{</code>
<code class="linenos">2 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">get</code><code class="p">(</code><code class="s1">'my-orders'</code><code class="p">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Customer</code><code class="o">\</code><code class="nx">MyOrdersController</code><code class="nl">::clas</code><code class="o">\</code>
<code class="linenos">3 </code><code class="nx">s</code><code class="p">,</code> <code class="s1">'index'</code><code class="cp">]</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">name</code><code class="p">(</code><code class="s1">'my-orders'</code><code class="p">);</code>
<code class="linenos">4 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Adicione a tag do link no componente layout do site, ao lado do link da home:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">&lt;</code><code class="n">li</code><code class="o">&gt;&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">"{{route('customers.my-orders')}}"</code>
<code class="linenos">2 </code>    <code class="k">class</code><code class="o">=</code><code class="s">"text-white  hover:underline hover:font-bold transition duration-300 ease-\</code>
<code class="linenos">3 </code><code class="s">in-out @if(request()-&gt;routeIs('customers.my-orders')) font-bold @else font-thin @end\</code>
<code class="linenos">4 </code><code class="s">if"</code><code class="o">&gt;</code><code class="n">Pedidos</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;&lt;/</code><code class="n">li</code><code class="o">&gt;</code>
</pre></div>

</figure>


<blockquote>
  <p>Lembre sempre de consultar o repositório conforme comentei no ínicio, para se encontrar melhor nestas telas que têm muito html.</p>
</blockquote>

<h2 id="leanpub-auto-concluses-12" class="section">Conclusões</h2>

<p>Concluímos aqui nossa jornada de compra pro nosso cliente e junto tivemos a oportunidade de conhecer diversos conceitos do framework desde os pontos de Sessão nos capítulos anteriores, a parte de Container neste capítulo.</p>

<p>Nossa jornada está quase chegando ao fim mas quero falar um pouco sobre Eventos &amp; ACL no framework e pra isso vamos continuando no próximo capítulo.</p>

<p>Até lá!</p>


<h1 id="leanpub-auto-acl--eventos" class="chapter">ACL &amp; Eventos</h1>

<p>Neste capítulo vamos conhecer o Controle de Acesso no Laravel e também falarei sobre Eventos, inclusive aplicando eventos para gerenciar nosso estoque tanto durante a conclusão do pedido quanto na possibilidade do usuário cancelar. </p>

<p>Primeiramente vamos começar pela parte de Controle de Acessos ou Autorização onde podemos utilizar para organizar acessos via papéis, entretanto, o Laravel não organiza a camada de autorização por papéis e etc mas podemos organizar estes papéis por fora e aplicá-los dentro do framework nos mecanismos disponibilizados para o controle de autorização dentro do sistema.</p>

<h2 id="leanpub-auto-laravel-autorizao" class="section">Laravel: Autorização</h2>

<p>Vamos começar esta parte falando dos principais pensamentos na camada de autorização do framework, a priore temos dois mecanismo: </p>

<ul>
  <li>Gates</li>
  <li>Policies</li>
</ul>

<p><b>Gates</b>: Gates nos permitem organizar controles com pensamentos mais globais de teste, onde podemos definir a label da regra e mediante um callback criar a lógica de acesso baseada em retorno booleano. True para pode acessar e False para a não possibilidade, e claro, esse retorno booleano será baseado na sua regra de acesso para aquele regra ou ability(como o framework chama).</p>

<p><b>Policie</b>: Policies também são pensadas de forma global mas existe uma diferença promordial em comparação a Gates. A diferença é que policies estão diretamente ligadas ao model e suas operações, onde você pode controlar e criar regras de acesso para cada operação que você pode fazer em cima de um dado que aquele model compete. Ações como listar todos, criar, atualizar, remover e etc. Policies são classes com as regras pelas operações via métodos.</p>

<p>Um ponto bem importante em autorização no Laravel é que tanto o callback da Gate quanto o método da Policy receberão o usuário autenticado como primeiro parâmetro. Importante lembrar isso pois os controles serão feitos em cima do usuário autenticado.</p>

<h3 id="leanpub-auto-gates-exemplo" class="subsection">Gates exemplo</h3>

<p>Hoje o Laravel recomenda que coloquemos nossas definições de gates dentro do AppServiceProvider ou em um Provider criado por nós para este fim. Como já temos o AppServiceProvider, colocaremos neles nosso exemplo e posteriormente nosso controle para usuários clientes e usuários admin.</p>

<p>A definição da gate pode ser feita via facade Gate:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>    <code class="err">\</code><code class="nt">Illuminate</code><code class="err">\</code><code class="nt">Support</code><code class="err">\</code><code class="nt">Facades</code><code class="err">\</code><code class="nt">Gate</code><code class="p">::</code><code class="nd">define</code><code class="o">(</code><code class="s1">'exemplo'</code><code class="o">,</code> <code class="nt">fn</code><code class="o">(</code><code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">User</code> <code class="o">$</code><code class="nt">user</code><code class="o">)</code> <code class="o">=</code><code class="err">\</code>
<code class="linenos">2 </code><code class="o">&gt;</code> <code class="o">$</code><code class="nt">user-</code><code class="o">&gt;</code><code class="nt">isAdmin</code><code class="o">());</code>
</pre></div>

</figure>


<p>O exemplo acima define uma gate com a ability(regra) chamada de exemplo e tem o teste baseado na verificação se usuário autenticado é admin ou não. Usei uma arrow function(PHP 7.4) para simplificar o callback e implicitamente sabemos que encapsulado no método <b>isAdmin</b> teríamos uma lógica para verificar se o usuário é admin ou não.</p>

<p>Essa definição colocada no método <code>boot</code> do <code>AppServiceProvider</code> nos ajuda a termos o registro global dela por meio da Gate em nossa aplicação.</p>

<p>Os testes baseadas nestes controles é basicamente o mesmo, tanto para Gate quanto para Policies, então vamos logo entender como definir Policies e posteriormente podemos conhecer algumas formas de verificar estas regras tanto em controllers como em views e rotas.</p>

<blockquote>
  <p>O termo Facade vêm de um padrão de projeto que o Laravel utiliza bastante e este padrão visa simplificar o acesso a interfaces de objetos complexos. O Laravel utiliza Facades para diversos componentes internos e você também pode criar Facades e compartilhar no framework de forma customizada.</p>
</blockquote>

<h3 id="leanpub-auto-policies-exemplo" class="subsection">Policies exemplo</h3>

<p>Como as policies são classes, nós podemos gerar via artisan. Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:policie ProductPolicy
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----policy.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>A classe Policy é gerada na pasta app/Policies e normalmente está atrelada a um Model. Da forma que geramos, a clase vêm apenas com um construtor e você pode definir os métodos de forma mais livre, entretanto, podemos gerar ela já associada a um model diretamente informando o parâmetro <code>-m</code> e o nome do model.</p>

<p>Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:policy ProductPolicy -m Product --force
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----policy-2.png">
    <figcaption></figcaption>
  </figure>
</div>


<blockquote>
  <p>O parâmetro –force aqui é pra sobscrevermos a policy gerada anteriormente, se a policy for nova não precisa informá-lo e inclusive verifique se a policy que existe não possui conteúdo, pois o parâmetro –force pode ser destrutivo quando pensar em usar no dia a dia este parâmetro no comando.</p>
</blockquote>

<p>Desta forma nossa policy já virá populada com os métodos para controle baseados na operação. Veja:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Policies</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="k">use</code> <code class="nx">App\Models\Product</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="k">use</code> <code class="nx">App\Models\User</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="k">use</code> <code class="nx">Illuminate\Auth\Access\Response</code><code class="p">;</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code><code class="k">class</code> <code class="nc">ProductPolicy</code>
<code class="linenos">10 </code><code class="p">{</code>
<code class="linenos">11 </code>    <code class="sd">/**</code>
<code class="linenos">12 </code><code class="sd">     * Determine whether the user can view any models.</code>
<code class="linenos">13 </code><code class="sd">     */</code>
<code class="linenos">14 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">viewAny</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
<code class="linenos">15 </code>    <code class="p">{</code>
<code class="linenos">16 </code>        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
<code class="linenos">17 </code>    <code class="p">}</code>
<code class="linenos">18 </code>
<code class="linenos">19 </code>    <code class="sd">/**</code>
<code class="linenos">20 </code><code class="sd">     * Determine whether the user can view the model.</code>
<code class="linenos">21 </code><code class="sd">     */</code>
<code class="linenos">22 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">view</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">,</code> <code class="nx">Product</code> <code class="nv">$product</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
<code class="linenos">23 </code>    <code class="p">{</code>
<code class="linenos">24 </code>        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
<code class="linenos">25 </code>    <code class="p">}</code>
<code class="linenos">26 </code>
<code class="linenos">27 </code>    <code class="sd">/**</code>
<code class="linenos">28 </code><code class="sd">     * Determine whether the user can create models.</code>
<code class="linenos">29 </code><code class="sd">     */</code>
<code class="linenos">30 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">create</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
<code class="linenos">31 </code>    <code class="p">{</code>
<code class="linenos">32 </code>        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
<code class="linenos">33 </code>    <code class="p">}</code>
<code class="linenos">34 </code>
<code class="linenos">35 </code>    <code class="sd">/**</code>
<code class="linenos">36 </code><code class="sd">     * Determine whether the user can update the model.</code>
<code class="linenos">37 </code><code class="sd">     */</code>
<code class="linenos">38 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">update</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">,</code> <code class="nx">Product</code> <code class="nv">$product</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
<code class="linenos">39 </code>    <code class="p">{</code>
<code class="linenos">40 </code>        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
<code class="linenos">41 </code>    <code class="p">}</code>
<code class="linenos">42 </code>
<code class="linenos">43 </code>    <code class="sd">/**</code>
<code class="linenos">44 </code><code class="sd">     * Determine whether the user can delete the model.</code>
<code class="linenos">45 </code><code class="sd">     */</code>
<code class="linenos">46 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">delete</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">,</code> <code class="nx">Product</code> <code class="nv">$product</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
<code class="linenos">47 </code>    <code class="p">{</code>
<code class="linenos">48 </code>        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
<code class="linenos">49 </code>    <code class="p">}</code>
<code class="linenos">50 </code>
<code class="linenos">51 </code>    <code class="sd">/**</code>
<code class="linenos">52 </code><code class="sd">     * Determine whether the user can restore the model.</code>
<code class="linenos">53 </code><code class="sd">     */</code>
<code class="linenos">54 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">restore</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">,</code> <code class="nx">Product</code> <code class="nv">$product</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
<code class="linenos">55 </code>    <code class="p">{</code>
<code class="linenos">56 </code>        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
<code class="linenos">57 </code>    <code class="p">}</code>
<code class="linenos">58 </code>
<code class="linenos">59 </code>    <code class="sd">/**</code>
<code class="linenos">60 </code><code class="sd">     * Determine whether the user can permanently delete the model.</code>
<code class="linenos">61 </code><code class="sd">     */</code>
<code class="linenos">62 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">forceDelete</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">,</code> <code class="nx">Product</code> <code class="nv">$product</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
<code class="linenos">63 </code>    <code class="p">{</code>
<code class="linenos">64 </code>        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
<code class="linenos">65 </code>    <code class="p">}</code>
<code class="linenos">66 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Olhando a Policy fica simples entendermos os pontos de controle nas operações. Exemplo:</p>

<p>(Pode/Não pode)</p>
<ul>
  <li>viewAny: Visualizar todos os dados;</li>
  <li>view: Visualizar um dado;</li>
  <li>create: Criar um dado;</li>
  <li>update: Atualizar um dado;</li>
  <li>delete: Remover um dado;</li>
  <li>restore: Restaurar um dado apagado via Soft Deletes</li>
  <li>forceDelete: Remover, de fato, um dado removido via Soft Deletes</li>
</ul>

<blockquote>
  <p>Abrindo aqui uma explicação, pois não abordei aqui, para a parte de Soft Deletes. Soft Deletes nos permitem remover um dado de forma lógica, este dado não é removido da base apenas recebe uma data de remoção via nova coluna adicionada na tabela do model em questão. Coluna esta chamada de <code>deleted_at</code> que é preenchida pelo próprio Laravel ao removermos o dado normalmente. </p>

  <p>O model deve ser configurado como tendo Soft Deletes e a coluna mencionada deve ser adicionada a sua tabela via migration. O processo de apagar continua o mesmo, inclusive os dados com a flag do soft delete é ignorado pelo model, podendo ser recuperados por métodos específicos do Eloquent, facilitando a listagem de dados em Lixeira por exemplo.</p>
</blockquote>

<p>Perceba que como a policy está associada diretamente a um model, cada método recebe tanto a instância do usuário autenticado quanto a instância do model associado. Os testes serão efetuados em cima dos dados daquele gerenciamento pelo model.</p>

<p>Lembrando que os métodos da policy devem retornar booleano baseado no teste do poder ou não poder acessar determinado conteúdo. Por exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">...</code>
<code class="linenos">2 </code>
<code class="linenos">3 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">update</code><code class="p">(</code><code class="n">User</code> <code class="err">$</code><code class="n">user</code><code class="p">,</code> <code class="n">Product</code> <code class="err">$</code><code class="n">product</code><code class="p">)</code><code class="o">:</code> <code class="n">bool</code>
<code class="linenos">4 </code><code class="p">{</code>
<code class="linenos">5 </code>    <code class="kr">return</code> <code class="err">$</code><code class="n">product</code><code class="o">-&gt;</code><code class="n">user_id</code> <code class="o">===</code> <code class="err">$</code><code class="n">user</code><code class="o">-&gt;</code><code class="n">id</code><code class="p">;</code>
<code class="linenos">6 </code><code class="p">}</code>
<code class="linenos">7 </code><code class="p">...</code>
</pre></div>

</figure>


<p>O exemplo acima verifica se o produto a ser alterado pertence ao usuário autenticado. Se o teste retornar verdadeiro, ele poderá atualizar o produto, caso falso não poderá alterá. </p>

<p>Acima é apenas um exemplo mas acredito que dá pra você ter ideias do que controlar.</p>

<blockquote>
  <p>Lembrando também que nos form requests temos o método authorize que pode ser usado para controle de criação e atualização de dados também.</p>
</blockquote>

<h3 id="leanpub-auto-usando-controle-permisses-abilities-como-quiser-chamar" class="subsection">Usando controle, permissões, abilities como quiser chamar!</h3>

<p>Exsitem diversas formas de utilizar as permissões nas aplicações Laravel. Podemos usar nos controllers por meio da facade gate, podemos usar nas rotas por meio do método <code>can</code> e podemos utilizar nas views via diretiva <code>@can</code>.</p>

<h4 id="leanpub-auto-controllers-1" class="subsubsection">Controllers</h4>

<p>Caso queira testar os acessos no seu controller nos métodos específicos, pode usar os métodos <b>denies</b> ou <b>allows</b> via <code>Gate</code>. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">\</code><code class="nt">Illuminate</code><code class="err">\</code><code class="nt">Support</code><code class="err">\</code><code class="nt">Facades</code><code class="err">\</code><code class="nt">Gate</code><code class="p">::</code><code class="nd">allows</code><code class="o">(</code><code class="s1">'exemplo'</code><code class="o">);</code>
</pre></div>

</figure>



<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">\</code><code class="nt">Illuminate</code><code class="err">\</code><code class="nt">Support</code><code class="err">\</code><code class="nt">Facades</code><code class="err">\</code><code class="nt">Gate</code><code class="p">::</code><code class="nd">denies</code><code class="o">(</code><code class="s1">'exemplo'</code><code class="o">);</code>
</pre></div>

</figure>


<p>Acima teremos o retorno verdadeiro no método <code>allows</code> se a permissão <code>exemplo</code>, definida via Gate, retornar verdadeiro indicando que o usuário pode fazer a ação. Temos o <code>denies</code> que terá o verdadeiro invertido, ou seja, o denies é verdadeiro se a permissão retornar falso pro teste da ação.</p>

<p>As policies também podem ser testadas via Gate e tanto a policy quanto as regras via gate não precisam receber a instância do usuário autenticado pois o Laravel já resolve.</p>

<p>Testando a policy, lembre do nome do método e da instância do model a ser validada. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>\Illuminate\Support\Facades\Gate::allows('update', Product::find(2))
</pre></div>

</figure>

<p class="fake-para">Em ações de policies que envolvem um dado específico, como atualizar, remover e visualizar um é necessário lembra de passar a instância com os dados do model a ser validado. Lembra do pequeno trecho do update na policy de produto.</p>

<p>O Laravel normalmente possui diversos caminhos para testar e fazer as coisas. Podemos inclusive através do usuário autenticado validar as permissões por meio dos métodos <code>can</code>(similar ao allows) e <code>cannot</code>(similar ao denies).</p>

<p>Os métodos allows e denies retornam booleano e podem ser combinados com controles condicionais. Se você quiser ser mais simplista pode usar o método <b>authorize</b> da facade Gate, que disparará uma exception quando o usuário não puder realizar a ação. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Gate</code><code class="p">::</code><code class="nd">authorize</code><code class="o">(</code><code class="s1">'update'</code><code class="o">,</code> <code class="nt">Product</code><code class="p">::</code><code class="nd">find</code><code class="o">(</code><code class="nt">2</code><code class="o">));</code>
</pre></div>

</figure>


<p>A exception lançada é do tipo: <code>Illuminate\Auth\Access\AuthorizationException</code>.</p>

<blockquote>
  <p>O método authorize por já lançar uma exceção não precisa ser combinada com condicionais e pode está apenas como linha já no inicio do método que receberá o check.</p>
</blockquote>

<h4 id="leanpub-auto-blade" class="subsubsection">Blade</h4>

<p>Nas views podemos utilizar a diretiva <code>@can</code> ou <code>@cannot</code>, imagino que você já entendeu como funcionam. Existem o pensamento aqui de o que o usuário não pode fazer é bom que não seja exibido, então estas diretivas são bem úteis para este fim.</p>

<p>Você pode ocultar o botão de editar por exemplo se o usuário pode/ou não pode atualizar um dado. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="p">@</code><code class="n">can</code><code class="p">(</code><code class="err">'</code><code class="n">update</code><code class="err">'</code><code class="p">,</code> <code class="n">$product</code><code class="p">)</code>
<code class="linenos">2 </code>    <code class="o">&lt;</code><code class="n">button</code><code class="o">&gt;</code><code class="n">Editar</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos">3 </code><code class="p">@</code><code class="n">endcan</code>
</pre></div>

</figure>


<p>Lembrando que acima o $product virá da linha do loop na tabela html por exemplo ou se fosse um dado single ` $product` já seria populada com o model pro teste, e por aí vai.</p>

<h4 id="leanpub-auto-rotas-1" class="subsubsection">Rotas</h4>

<p>Nas rotas podemos utilizar o método <b>can</b> como método aninhado na config da rota para validar policies. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">Route</code><code class="o">::</code><code class="n">get</code><code class="p">(</code><code class="s">'products/{product}'</code><code class="p">,</code> <code class="n">ProductController</code><code class="o">::</code><code class="n">class</code><code class="p">,</code> <code class="s">'update'</code><code class="p">)</code>
<code class="linenos">2 </code>    <code class="o">-&gt;</code><code class="n">can</code><code class="p">(</code><code class="s">'update'</code><code class="p">,</code> <code class="s">'product'</code><code class="p">)</code>
</pre></div>

</figure>


<p>ou</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">Route</code><code class="o">::</code><code class="n">get</code><code class="p">(</code><code class="s">'products/{product}'</code><code class="p">,</code> <code class="n">ProductController</code><code class="o">::</code><code class="n">class</code><code class="p">,</code> <code class="s">'update'</code><code class="p">)</code>
<code class="linenos">2 </code>    <code class="o">-&gt;</code><code class="n">can</code><code class="p">(</code><code class="s">'update'</code><code class="p">,</code> <code class="n">Product</code><code class="o">::</code><code class="n">class</code><code class="p">)</code>
</pre></div>

</figure>


<p>O Laravel injeta no teste do can o que é necessário pro teste baseado no dados vindo no parâmetro dinâmico da rota. O controle aqui é feito com a ideia de middleware. Inclusive temos middleware para testar também. Exemplo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'products/{product}'</code><code class="o">,</code> <code class="nt">ProductController</code><code class="p">::</code><code class="nd">class</code><code class="o">,</code> <code class="s1">'update'</code><code class="o">)</code>
<code class="linenos">2 </code>    <code class="nt">-</code><code class="o">&gt;</code><code class="nt">middleware</code><code class="o">(</code><code class="s1">'can:update,product'</code><code class="o">);</code>
<code class="linenos">3 </code>
<code class="linenos">4 </code><code class="o">//</code><code class="nt">ou</code>
<code class="linenos">5 </code>
<code class="linenos">6 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">get</code><code class="o">(</code><code class="s1">'products/{product}'</code><code class="o">,</code> <code class="nt">ProductController</code><code class="p">::</code><code class="nd">class</code><code class="o">,</code> <code class="s1">'update'</code><code class="o">)</code>
<code class="linenos">7 </code>    <code class="nt">-</code><code class="o">&gt;</code><code class="nt">middleware</code><code class="o">(</code><code class="s1">'can:update,\App\Models\Product'</code><code class="o">);</code>
</pre></div>

</figure>


<blockquote>
  <p>Pode confundir mas o can chamado como middleware também aceita as abilities ou permissões feitas via Gate.</p>
</blockquote>

<p>Perceba que temos diversos caminhos para teste das permissões definidas via Gate e Policies. Reforçando que o teste é válido se o usuário estiver logado, caso o contrário sempre será falso. O usuário logado é resolvido automaticamente pelo Laravel.</p>

<h2 id="leanpub-auto-como-vamos-controlar-nosso-acesso" class="section">Como vamos controlar nosso acesso</h2>

<p>Agora que conhecemos bastante da área de autorização do Laravel, vamos criar um controle até que simples mas pro nosso app será o suficiente pro momento. Primeiramente vamos adicionar na tabela de usuários(users) a coluna <code>role</code> com o valor defualt: <code>ROLE_CUSTOMER</code>.</p>

<p>Utilizarei aqui labels para indicar os papéis puxando a ideia do Symfony Security nestas nomeclaturas.</p>

<p>Vamos gerar nossa migration para esta adição:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:migration alter_users_table_add_role_column --table=users
</pre></div>

</figure>


<p>Veja os métodos up e down da migration:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">up</code><code class="o">():</code> <code class="nt">void</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="n">Schema</code><code class="p">:</code><code class="o">:</code><code class="nf">table</code><code class="p">(</code><code class="s1">'users'</code><code class="p">,</code> <code class="n">function</code> <code class="err">(</code><code class="n">Blueprint</code> <code class="err">$</code><code class="kc">table</code><code class="p">)</code> <code class="err">{</code>
<code class="linenos"> 4 </code>        <code class="err">$</code><code class="kc">table</code><code class="o">-&gt;</code><code class="nf">string</code><code class="p">(</code><code class="s1">'role'</code><code class="p">)</code><code class="o">-&gt;</code><code class="nf">default</code><code class="p">(</code><code class="s1">'ROLE_CUSTOMER'</code><code class="p">);</code>
<code class="linenos"> 5 </code>    <code class="p">}</code><code class="o">);</code>
<code class="linenos"> 6 </code><code class="err">}</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">down</code><code class="o">():</code> <code class="nt">void</code>
<code class="linenos"> 9 </code><code class="p">{</code>
<code class="linenos">10 </code>    <code class="n">Schema</code><code class="p">:</code><code class="o">:</code><code class="nf">table</code><code class="p">(</code><code class="s1">'users'</code><code class="p">,</code> <code class="n">function</code> <code class="err">(</code><code class="n">Blueprint</code> <code class="err">$</code><code class="kc">table</code><code class="p">)</code> <code class="err">{</code>
<code class="linenos">11 </code>        <code class="err">$</code><code class="kc">table</code><code class="o">-&gt;</code><code class="nf">dropColumn</code><code class="p">(</code><code class="s1">'role'</code><code class="p">);</code>
<code class="linenos">12 </code>    <code class="p">}</code><code class="o">);</code>
<code class="linenos">13 </code><code class="err">}</code>
</pre></div>

</figure>


<p>Não esqueça de executar a migração:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan migrate
</pre></div>

</figure>


<p>Vamos controlar nosso acesso ao painel admin. Vamos criar o check no model User, o método <code>hasRole</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">hasRole</code><code class="p">(</code><code class="kt">string</code> <code class="err">$</code><code class="n">role</code><code class="p">)</code><code class="o">:</code> <code class="n">bool</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="kr">return</code> <code class="err">$</code><code class="n">this</code><code class="o">-&gt;</code><code class="n">role</code> <code class="o">===</code> <code class="err">$</code><code class="n">role</code><code class="p">;</code>
<code class="linenos">4 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Desta forma fica mais maleável, apesar de simples, o controle pelo papél desejado. Lembrando que o método acima está no model User.</p>

<p>Agora podemos checkar via Gate se o usuário têm o papel admin para acessar nosso painel. Adicione a verificação lá no método <code>boot</code> do <code>AppServiceProvider</code>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">Gate</code><code class="p">::</code><code class="nd">define</code><code class="o">(</code><code class="s1">'can_access_manager'</code><code class="o">,</code> <code class="nt">fn</code><code class="o">(</code><code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Models</code><code class="err">\</code><code class="nt">User</code> <code class="o">$</code><code class="nt">user</code><code class="o">)</code> <code class="o">=&gt;</code> <code class="o">$</code><code class="nt">user-</code><code class="o">&gt;</code><code class="nt">hasRole</code><code class="o">(</code><code class="s1">'ROL\</code>
<code class="linenos">2 </code><code class="s1">E_ADMIN'</code><code class="o">));</code>
</pre></div>

</figure>


<p>Uma vez definido a permissão podemos utilizar o método middleware no grupo de rotas do nosso admin, para adicionar o check do papél, lá no arquivo <b>web.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">-&gt;</code><code class="n">middleware</code><code class="p">(</code><code class="s">'auth'</code><code class="p">,</code> <code class="s">'can:can_access_manager'</code><code class="p">)</code>
</pre></div>

</figure>


<p>Veja o grupo do admin completo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">Route</code><code class="p">::</code><code class="nd">prefix</code><code class="o">(</code><code class="s1">'admin'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">middleware</code><code class="o">(</code><code class="s1">'auth'</code><code class="o">,</code> <code class="s1">'can:can_access_manager'</code><code class="o">)</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">group</code><code class="o">(</code><code class="nt">function</code><code class="err">\</code>
<code class="linenos"> 2 </code> <code class="o">()</code> <code class="p">{</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">resource</code><code class="p">(</code><code class="s1">'products'</code><code class="p">,</code> <code class="err">\</code><code class="n">App</code><code class="err">\</code><code class="n">Http</code><code class="err">\</code><code class="n">Controllers</code><code class="err">\</code><code class="n">Admin</code><code class="err">\</code><code class="n">ProductController</code><code class="err">::</code><code class="n">class</code><code class="err">\</code>
<code class="linenos"> 5 </code><code class="p">);</code>
<code class="linenos"> 6 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">resource</code><code class="p">(</code><code class="s1">'categories'</code><code class="p">,</code> <code class="err">\</code><code class="n">App</code><code class="err">\</code><code class="n">Http</code><code class="err">\</code><code class="n">Controllers</code><code class="err">\</code><code class="n">Admin</code><code class="err">\</code><code class="n">CategoryController</code><code class="err">::</code><code class="n">cl</code><code class="err">\</code>
<code class="linenos"> 7 </code><code class="n">ass</code><code class="p">);</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="n">Route</code><code class="p">:</code><code class="o">:</code><code class="nf">resource</code><code class="p">(</code><code class="s1">'products/{product}/photos'</code><code class="p">,</code> <code class="err">\</code><code class="n">App</code><code class="err">\</code><code class="n">Http</code><code class="err">\</code><code class="n">Controllers</code><code class="err">\</code><code class="n">Admin</code><code class="err">\</code><code class="n">Product</code><code class="err">\</code>
<code class="linenos">10 </code><code class="n">PhotoController</code><code class="err">::</code><code class="n">class</code><code class="p">)</code>
<code class="linenos">11 </code>          <code class="o">-&gt;</code><code class="nf">only</code><code class="p">(</code><code class="cp">[</code><code class="s1">'index'</code><code class="p">,</code> <code class="s1">'store'</code><code class="p">,</code> <code class="s1">'destroy'</code><code class="cp">]</code><code class="p">);</code>
<code class="linenos">12 </code><code class="p">}</code><code class="o">);</code>
</pre></div>

</figure>


<p>Como nossos usuários todos estão como clientes(ROLE_CUSTOMER), ao logarmos e tentarmos acessar o gerenciador receberemos um <code>403 -  This action is unauthorized.</code>:</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----acl.png">
    <figcaption></figcaption>
  </figure>
</div>


<p>Teste modificar o papél do usuário autenticado para <code>ROLE_ADMIN</code> e tente acessar o paínel novamente. Tudo deve fluir corretamente conforme o controle global.</p>

<p>Aqui fizemos um controle simples mas já dá pra você ter uma excelente ideia de como trabalhar com autorização dentro do Laravel.</p>

<p>Num futuro você pode dinamizar mais as coisas associando papéis via tabela a recursos baseados nas rotas do sistema e ligar papéis e recursos em muitos pra muitos para facilitar a criação de papéis com acessos específicos.</p>

<p>Esses recursos, baseados nas rotas podem se torar as permissões e a geração das gates pode ser dinamizado via ServiceProvider. Associando o papél a um usuário ele poderá acessar o que o papél dele têm de abilities.</p>

<p>Aqui foi um rascunho rápido do que pode ser feito, inclusive tenho um curso no portal da Code Experts (codeexeperts.com.br) sobre isso, e caso queira mais facilidade, existe um pacote chamada de Spatie/Permissions que também implementa este pensamento de forma mais simples sem necessidade de criar todo o arcabouço para tal. Recomendo dá uma olhada depois.</p>

<p>Com este controle feito, vamos a mais um conhecimento dentro do framework. </p>

<p>Eventos!</p>

<h2 id="leanpub-auto-eventos" class="section">Eventos</h2>

<p>O conceito dentro do sistema de eventos é algo que particularmente é simples de entender. Muita das vezes o que pode confundir é como aplicar e neste ponto iremos realizar as explicações e usar dentro do nosso sistema.</p>

<p>Sistemas de Eventos normalmente são utilizados para um processo desacoplado, onde pontos do sistema podem reagir a execução de outros sem que estejam acoplados e seus contextos sejam diferentes.</p>

<p>Por exemplo, quando o usuário loga no sistema ou se registra emitimos um evento específico daquele processo que pode ser ouvido por outros participantes e assim estes participantes(outros objetos) podem realizar processos baseados neste evento.</p>

<p>Imagine que centralizamos um log, e este log irá registrar quando o usuário logou, se cadastrou, dentre outra coisas. Posso trabalhar estes processos via eventos fazendo com que o log escute eventos específicos para salvar aquela ação do usuário. Sempre teremos em um sistema de eventos o emissor e os escutadores (Emmiters &amp; Listeners).</p>

<p>Emissor é a classe que disparará o evento, e Escutador(Listener) é quem ecustará o evento. Podemos propagar diversos eventos e termos diversos Listeners(gosto mais do termo em eng rs!) que irão reagir mediante o evento propagado.</p>

<p>Irei aplicar eventos aqui para gerenciarmos nosso estoque, onde adicionarei a possibilidade do usuário cancelar o pedido retornando os produtos pro estoque via evento e adicionaremos no momento do checkout a remoção dos itens do estoque também lançando um evento para isso.</p>

<p>Aqui irei focar nos pontos principais de alteração, comentários de adição de link em menu de layout e outros pontos deixo pra você adicionar ou consultar nosso github tudo bem?</p>

<h3 id="leanpub-auto-criando-eventos" class="subsection">Criando eventos</h3>

<p>Podemos gerar eventos e listeners via artisan com os comandos respectivos: <b>make:event</b> &amp; <b>make:listener</b>.</p>

<p>Vamos entender quais os pontos que iremos gerar para termos o panorama mais de cima e depois vamos as gerações e o restante dos processos. Você deve lembrar também que temos um estoque dentro da tabela de produtos, e por meio destes eventos vamos retirar ou retornar os produtos do estoque.</p>

<p>O cenário de eventos e listeners será o seguinte (colocarei em termos pt_BR mas gerarei os participantes em inglês):</p>

<ul>
  <li>Evento: UsuarioPediuProdutos
    <ul>
      <li>Listener: RetireProdutosDoEstoque</li>
    </ul>
  </li>
  <li>Evento: UsuarioCancelouPedido
    <ul>
      <li>Listener: ColoqueProdutosDeVoltaNoEstoque</li>
    </ul>
  </li>
</ul>

<p>Estes eventos são o suficiente para que possamos entender o processo envolvendo o gerenciamento do estoque também.</p>

<p>Vamos gerar nossos dois eventos:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:event UserOrderedProductsEvent
<code class="linenos">2 </code>
<code class="linenos">3 </code>php artisan make:event UserCancelledOrderEvent
</pre></div>

</figure>


<p>Na geração dos listeners, além de escolhermos os nomes iremos associar o listener ao evento que desejamos escutar. Veja os comandos de geração abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:listener GetProductsFromStockListener -e UserOrderedProductsEvent
<code class="linenos">2 </code>
<code class="linenos">3 </code>php artisan make:listener PutProductsBackOnStockListener -e UserCancelledOrderEvent
</pre></div>

</figure>


<p>Perceba que criamos os listeners associados aos eventos anterioremente criados. Um ponto importante de comentar aqui, é como o Laravel mapeia de forma automática estes eventos e listeners.</p>

<p>Se você perceber seu listener, a classe, você perceberá que temos um método handle que recebe a injeção do evento associado. O que o Laravel fará é criar um mapeamento interno onde lerá a assinatura deste método handle e mapeará o evento tipado no parâmetro para o listener em questão.</p>

<p>Não abordarei aqui mas existem formas de mapear manualmente estes eventos e listeners e recomendo que busque mais sobre e se aprofunde nesse cenário. Um ponto importante também é que sempre que você fizer deploy gere cache desses eventos.</p>

<p>Podemos gerar o cache e remover com os comando respectivos: <code>event:cache</code> &amp; <code>event:clear</code> via artisan, ou opte pelo <code>optimize</code> que dentre outros caches cria o cache dos eventos também o clear do optimize é <code>optimize:clear</code>.</p>

<p>Antes de criarmos os conteúdos dos eventos e listeners vamos criar nosso serviço para o gerenciamento básico do estoque.</p>

<p>Veja o serviço abaixo, criado na pasta <code>app/Services</code>:</p>

<p><b>StockManagerService</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code><code class="k">namespace</code> <code class="nx">App\Services</code><code class="p">;</code>
<code class="linenos"> 3 </code>
<code class="linenos"> 4 </code><code class="k">use</code> <code class="nx">App\Models\Order</code><code class="p">;</code>
<code class="linenos"> 5 </code><code class="k">use</code> <code class="nx">App\Models\Product</code><code class="p">;</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code><code class="k">class</code> <code class="nc">StockManagerService</code>
<code class="linenos"> 8 </code><code class="p">{</code>
<code class="linenos"> 9 </code>    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">private</code> <code class="nx">Order</code> <code class="nv">$order</code><code class="p">)</code>
<code class="linenos">10 </code>    <code class="p">{</code>
<code class="linenos">11 </code>    <code class="p">}</code>
<code class="linenos">12 </code>
<code class="linenos">13 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">removeProductFromStock</code><code class="p">()</code>
<code class="linenos">14 </code>    <code class="p">{</code>
<code class="linenos">15 </code>        <code class="k">foreach</code> <code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">order</code><code class="o">-&gt;</code><code class="na">items</code> <code class="k">as</code> <code class="nv">$item</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">16 </code>            <code class="nx">Product</code><code class="o">::</code><code class="na">find</code><code class="p">(</code><code class="nv">$item</code><code class="o">-&gt;</code><code class="na">product_id</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">decrement</code><code class="p">(</code><code class="s1">'in_stock'</code><code class="p">,</code> <code class="nv">$item</code><code class="o">-&gt;</code><code class="na">quantity</code><code class="p">);</code>
<code class="linenos">17 </code>        <code class="p">}</code>
<code class="linenos">18 </code>    <code class="p">}</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">addingProductInStock</code><code class="p">()</code>
<code class="linenos">21 </code>    <code class="p">{</code>
<code class="linenos">22 </code>        <code class="k">foreach</code> <code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">order</code><code class="o">-&gt;</code><code class="na">items</code> <code class="k">as</code> <code class="nv">$item</code><code class="p">)</code> <code class="p">{</code>
<code class="linenos">23 </code>            <code class="nx">Product</code><code class="o">::</code><code class="na">find</code><code class="p">(</code><code class="nv">$item</code><code class="o">-&gt;</code><code class="na">product_id</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">increment</code><code class="p">(</code><code class="s1">'in_stock'</code><code class="p">,</code> <code class="nv">$item</code><code class="o">-&gt;</code><code class="na">quantity</code><code class="p">);</code>
<code class="linenos">24 </code>        <code class="p">}</code>
<code class="linenos">25 </code>    <code class="p">}</code>
<code class="linenos">26 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O serviço é bem tranquilo e uma rápida leitura você conseguirá entender, um ponto que saliento é que estamos, em cada método, iterando sobre os itens do pedido passado pro serviço.</p>

<p>Vamos focar no evento que gerará a retirada dos itens do estoque e depois eu apenas coloco o evento e listener do cancelar, uma vez que é bem semelhante as explicações.</p>

<p>Veja nossa classe evento <b>UserOrderedProductsEvent</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Events</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="k">use</code> <code class="nx">App\Models\Order</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="k">use</code> <code class="nx">Illuminate\Broadcasting\Channel</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="k">use</code> <code class="nx">Illuminate\Broadcasting\InteractsWithSockets</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="k">use</code> <code class="nx">Illuminate\Broadcasting\PresenceChannel</code><code class="p">;</code>
<code class="linenos"> 9 </code><code class="k">use</code> <code class="nx">Illuminate\Broadcasting\PrivateChannel</code><code class="p">;</code>
<code class="linenos">10 </code><code class="k">use</code> <code class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</code><code class="p">;</code>
<code class="linenos">11 </code><code class="k">use</code> <code class="nx">Illuminate\Foundation\Events\Dispatchable</code><code class="p">;</code>
<code class="linenos">12 </code><code class="k">use</code> <code class="nx">Illuminate\Queue\SerializesModels</code><code class="p">;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code><code class="k">class</code> <code class="nc">UserOrderedProductsEvent</code>
<code class="linenos">15 </code><code class="p">{</code>
<code class="linenos">16 </code>    <code class="k">use</code> <code class="nx">Dispatchable</code><code class="p">,</code> <code class="nx">InteractsWithSockets</code><code class="p">,</code> <code class="nx">SerializesModels</code><code class="p">;</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="sd">/**</code>
<code class="linenos">19 </code><code class="sd">     * Create a new event instance.</code>
<code class="linenos">20 </code><code class="sd">     */</code>
<code class="linenos">21 </code>    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">public</code> <code class="nx">Order</code> <code class="nv">$order</code><code class="p">)</code>
<code class="linenos">22 </code>    <code class="p">{</code>
<code class="linenos">23 </code>        <code class="c1">//</code>
<code class="linenos">24 </code>    <code class="p">}</code>
<code class="linenos">25 </code>
<code class="linenos">26 </code>    <code class="sd">/**</code>
<code class="linenos">27 </code><code class="sd">     * Get the channels the event should broadcast on.</code>
<code class="linenos">28 </code><code class="sd">     *</code>
<code class="linenos">29 </code><code class="sd">     * @return array&lt;int, \Illuminate\Broadcasting\Channel&gt;</code>
<code class="linenos">30 </code><code class="sd">     */</code>
<code class="linenos">31 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">broadcastOn</code><code class="p">()</code><code class="o">:</code> <code class="k">array</code>
<code class="linenos">32 </code>    <code class="p">{</code>
<code class="linenos">33 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">34 </code>            <code class="k">new</code> <code class="nx">PrivateChannel</code><code class="p">(</code><code class="s1">'channel-name'</code><code class="p">),</code>
<code class="linenos">35 </code>        <code class="p">];</code>
<code class="linenos">36 </code>    <code class="p">}</code>
<code class="linenos">37 </code><code class="p">}</code>
</pre></div>

</figure>


<p>A classe evento acima está com a mínima alteração em relação ao que foi gerado, apenas adicionei um parâmetro ao construtor que poderá ser acessado quando o listener for invocado.</p>

<p>Pra te dá um panorama sobre o método <code>broadcastOn</code>, mesmo que não vamos usar aqui. Ele permite que propaguemos este evento via canal broadcast no Laravel que está associado a conversas em tempo real e mais uma vez recomendo a busca de materiais desta parte do framework, inclusive podemos enfileirar estes eventos via workers.</p>

<p>O listener associado a este evento <b>GetProductsFromStockListener</b>, está abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Listeners</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="k">use</code> <code class="nx">App\Events\UserOrderedProductsEvent</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="k">use</code> <code class="nx">App\Models\Order</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="k">use</code> <code class="nx">Illuminate\Contracts\Queue\ShouldQueue</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="k">use</code> <code class="nx">Illuminate\Queue\InteractsWithQueue</code><code class="p">;</code>
<code class="linenos"> 9 </code><code class="k">use</code> <code class="nx">App\Services\StockManagerService</code><code class="p">;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code><code class="k">class</code> <code class="nc">GetProductsFromStockListener</code>
<code class="linenos">12 </code><code class="p">{</code>
<code class="linenos">13 </code>    <code class="sd">/**</code>
<code class="linenos">14 </code><code class="sd">     * Create the event listener.</code>
<code class="linenos">15 </code><code class="sd">     */</code>
<code class="linenos">16 </code>    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">()</code>
<code class="linenos">17 </code>    <code class="p">{</code>
<code class="linenos">18 </code>        <code class="c1">//</code>
<code class="linenos">19 </code>    <code class="p">}</code>
<code class="linenos">20 </code>
<code class="linenos">21 </code>    <code class="sd">/**</code>
<code class="linenos">22 </code><code class="sd">     * Handle the event.</code>
<code class="linenos">23 </code><code class="sd">     */</code>
<code class="linenos">24 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">handle</code><code class="p">(</code><code class="nx">UserOrderedProductsEvent</code> <code class="nv">$event</code><code class="p">)</code><code class="o">:</code> <code class="nx">void</code>
<code class="linenos">25 </code>    <code class="p">{</code>
<code class="linenos">26 </code>        <code class="p">(</code><code class="k">new</code> <code class="nx">StockManagerService</code><code class="p">(</code><code class="nv">$event</code><code class="o">-&gt;</code><code class="na">order</code><code class="p">))</code><code class="o">-&gt;</code><code class="na">removeProductFromStock</code><code class="p">();</code>
<code class="linenos">27 </code>    <code class="p">}</code>
<code class="linenos">28 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Perceba que, quando o evento <b>UserOrderedProductsEvent</b> for disparado o listener associado <b>GetProductsFromStockListener</b> será acionado e o método, deste listener, handle será executado. É aí que usamos nosso serviço para fazer a retirada do itens do estoque.</p>

<p>Este evento pode ser disparado da seguinte forma:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="o">//</code><code class="nt">via</code> <code class="nt">helper</code>
<code class="linenos">2 </code><code class="nt">event</code><code class="o">(</code><code class="nt">new</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Events</code><code class="err">\</code><code class="nt">UserOrderedProductsEvent</code><code class="o">($</code><code class="nt">order</code><code class="o">));</code>
<code class="linenos">3 </code>
<code class="linenos">4 </code><code class="o">//</code> <code class="nt">via</code> <code class="nt">método</code> <code class="nt">dispatch</code>
<code class="linenos">5 </code><code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Events</code><code class="err">\</code><code class="nt">UserOrderedProductsEvent</code><code class="p">::</code><code class="nd">dispatch</code><code class="o">($</code><code class="nt">order</code><code class="o">);</code>
</pre></div>

</figure>


<p>Para utilizarmos dentro do projeto, vamos adicinar a linha do helper lá no <b>CheckoutController</b> no método <b>process</b>. Coloque após a linha do update do código do gateway:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>event(new \App\Events\UserOrderedProductsEvent($order));
</pre></div>

</figure>


<p>método completo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="nt">public</code> <code class="nt">function</code> <code class="nt">process</code><code class="o">(</code><code class="nt">PaymentInterface</code> <code class="o">$</code><code class="nt">payment</code><code class="o">,</code> <code class="nt">CartService</code> <code class="o">$</code><code class="nt">cart</code><code class="o">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="err">if(!$cart-&gt;count())</code> <code class="err">{</code>
<code class="linenos"> 4 </code>        <code class="err">session()-&gt;flash('warning',</code> <code class="err">'Sem</code> <code class="err">Itens</code> <code class="err">para</code> <code class="err">Processar</code> <code class="err">Checkout!')</code><code class="p">;</code>
<code class="linenos"> 5 </code>        <code class="err">return</code> <code class="err">redirect()-&gt;route('site.home')</code><code class="p">;</code>
<code class="linenos"> 6 </code>    <code class="p">}</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code>    <code class="o">$</code><code class="nt">customer</code> <code class="o">=</code> <code class="nt">auth</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">user</code><code class="o">();</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code>    <code class="o">$</code><code class="nt">order</code> <code class="o">=</code> <code class="o">$</code><code class="nt">this-</code><code class="o">&gt;</code><code class="nt">modelOrder-</code><code class="o">&gt;</code><code class="nt">create</code><code class="o">(</code><code class="cp">[</code>
<code class="linenos">11 </code>        <code class="s1">'code'</code> <code class="o">=&gt;</code> <code class="nx">Str</code><code class="nl">::uuid</code><code class="p">(),</code>
<code class="linenos">12 </code>        <code class="s1">'user_id'</code> <code class="o">=&gt;</code> <code class="nv">$customer</code><code class="o">-&gt;</code><code class="nb">id</code>
<code class="linenos">13 </code>    <code class="cp">]</code><code class="o">);</code>
<code class="linenos">14 </code>
<code class="linenos">15 </code>    <code class="o">$</code><code class="nt">saveOrderItems</code> <code class="o">=</code> <code class="cp">[]</code><code class="o">;</code>
<code class="linenos">16 </code>    <code class="nt">foreach</code><code class="o">($</code><code class="nt">cart-</code><code class="o">&gt;</code><code class="nt">all</code><code class="o">()</code> <code class="nt">as</code> <code class="o">$</code><code class="nt">item</code><code class="o">)</code> <code class="p">{</code>
<code class="linenos">17 </code>        <code class="err">$saveOrderItems</code><code class="cp">[]</code> <code class="err">=</code> <code class="cp">[</code>
<code class="linenos">18 </code>            <code class="s1">'quantity'</code> <code class="o">=&gt;</code> <code class="nv">$item</code><code class="err">[</code><code class="s1">'quantity'</code><code class="cp">]</code><code class="err">,</code>
<code class="linenos">19 </code>            <code class="err">'product_id'</code> <code class="err">=&gt;</code> <code class="err">$item</code><code class="cp">[</code><code class="s1">'id'</code><code class="cp">]</code><code class="err">,</code>
<code class="linenos">20 </code>        <code class="err">]</code><code class="p">;</code>
<code class="linenos">21 </code>    <code class="p">}</code>
<code class="linenos">22 </code>    <code class="o">$</code><code class="nt">order-</code><code class="o">&gt;</code><code class="nt">items</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">createMany</code><code class="o">($</code><code class="nt">saveOrderItems</code><code class="o">);</code>
<code class="linenos">23 </code>
<code class="linenos">24 </code>    <code class="o">$</code><code class="nt">gatewayCode</code> <code class="o">=</code> <code class="o">$</code><code class="nt">payment-</code><code class="o">&gt;</code><code class="nt">doPayment</code><code class="o">(</code><code class="cp">[</code>
<code class="linenos">25 </code>        <code class="s1">'our_code'</code> <code class="o">=&gt;</code> <code class="nv">$order</code><code class="o">-&gt;</code><code class="nb">id</code><code class="p">,</code>
<code class="linenos">26 </code>        <code class="s1">'name'</code> <code class="o">=&gt;</code> <code class="nv">$customer</code><code class="o">-&gt;</code><code class="nb">name</code><code class="p">,</code>
<code class="linenos">27 </code>        <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="nv">$customer</code><code class="o">-&gt;</code><code class="nx nx-Member">email</code><code class="p">,</code>
<code class="linenos">28 </code>        <code class="s1">'cardToken'</code> <code class="o">=&gt;</code> <code class="s1">'XYZ'</code><code class="p">,</code>
<code class="linenos">29 </code>        <code class="s1">'paymentMethod'</code> <code class="o">=&gt;</code> <code class="s1">'CREDIT_CARD'</code>
<code class="linenos">30 </code>    <code class="cp">]</code><code class="o">)</code><code class="cp">[</code><code class="s1">'gateway_code'</code><code class="cp">]</code><code class="o">;</code>
<code class="linenos">31 </code>
<code class="linenos">32 </code>
<code class="linenos">33 </code>    <code class="o">$</code><code class="nt">order-</code><code class="o">&gt;</code><code class="nt">update</code><code class="o">(</code><code class="cp">[</code><code class="s1">'gateway_code'</code> <code class="o">=&gt;</code> <code class="nv">$gatewayCode</code><code class="cp">]</code><code class="o">);</code>
<code class="linenos">34 </code>
<code class="linenos">35 </code>    <code class="nt">event</code><code class="o">(</code><code class="nt">new</code> <code class="err">\</code><code class="nt">App</code><code class="err">\</code><code class="nt">Events</code><code class="err">\</code><code class="nt">UserOrderedProductsEvent</code><code class="o">($</code><code class="nt">order</code><code class="o">));</code>
<code class="linenos">36 </code>
<code class="linenos">37 </code>    <code class="nt">session</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">forget</code><code class="o">(</code><code class="nt">CartService</code><code class="p">::</code><code class="nd">SESSION_KEY</code><code class="o">);</code>
<code class="linenos">38 </code>
<code class="linenos">39 </code>    <code class="nt">return</code> <code class="nt">redirect</code><code class="o">()</code><code class="nt">-</code><code class="o">&gt;</code><code class="nt">route</code><code class="o">(</code><code class="s1">'site.checkout.thanks'</code><code class="o">,</code> <code class="o">$</code><code class="nt">order</code><code class="o">);</code>
<code class="linenos">40 </code><code class="err">}</code>
</pre></div>

</figure>


<p>Abaixo segue o evento de Cancelamento e seu Listener; onde vamos usar, veremos no próximo bloco:</p>

<p><b>UserCancelledOrderEvent</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Events</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="k">use</code> <code class="nx">App\Models\Order</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="k">use</code> <code class="nx">Illuminate\Broadcasting\Channel</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="k">use</code> <code class="nx">Illuminate\Broadcasting\InteractsWithSockets</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="k">use</code> <code class="nx">Illuminate\Broadcasting\PresenceChannel</code><code class="p">;</code>
<code class="linenos"> 9 </code><code class="k">use</code> <code class="nx">Illuminate\Broadcasting\PrivateChannel</code><code class="p">;</code>
<code class="linenos">10 </code><code class="k">use</code> <code class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</code><code class="p">;</code>
<code class="linenos">11 </code><code class="k">use</code> <code class="nx">Illuminate\Foundation\Events\Dispatchable</code><code class="p">;</code>
<code class="linenos">12 </code><code class="k">use</code> <code class="nx">Illuminate\Queue\SerializesModels</code><code class="p">;</code>
<code class="linenos">13 </code>
<code class="linenos">14 </code><code class="k">class</code> <code class="nc">UserCancelledOrderEvent</code>
<code class="linenos">15 </code><code class="p">{</code>
<code class="linenos">16 </code>    <code class="k">use</code> <code class="nx">Dispatchable</code><code class="p">,</code> <code class="nx">InteractsWithSockets</code><code class="p">,</code> <code class="nx">SerializesModels</code><code class="p">;</code>
<code class="linenos">17 </code>
<code class="linenos">18 </code>    <code class="sd">/**</code>
<code class="linenos">19 </code><code class="sd">     * Create a new event instance.</code>
<code class="linenos">20 </code><code class="sd">     */</code>
<code class="linenos">21 </code>    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">public</code> <code class="nx">Order</code> <code class="nv">$order</code><code class="p">)</code>
<code class="linenos">22 </code>    <code class="p">{</code>
<code class="linenos">23 </code>        <code class="c1">//</code>
<code class="linenos">24 </code>    <code class="p">}</code>
<code class="linenos">25 </code>
<code class="linenos">26 </code>    <code class="sd">/**</code>
<code class="linenos">27 </code><code class="sd">     * Get the channels the event should broadcast on.</code>
<code class="linenos">28 </code><code class="sd">     *</code>
<code class="linenos">29 </code><code class="sd">     * @return array&lt;int, \Illuminate\Broadcasting\Channel&gt;</code>
<code class="linenos">30 </code><code class="sd">     */</code>
<code class="linenos">31 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">broadcastOn</code><code class="p">()</code><code class="o">:</code> <code class="k">array</code>
<code class="linenos">32 </code>    <code class="p">{</code>
<code class="linenos">33 </code>        <code class="k">return</code> <code class="p">[</code>
<code class="linenos">34 </code>            <code class="k">new</code> <code class="nx">PrivateChannel</code><code class="p">(</code><code class="s1">'channel-name'</code><code class="p">),</code>
<code class="linenos">35 </code>        <code class="p">];</code>
<code class="linenos">36 </code>    <code class="p">}</code>
<code class="linenos">37 </code><code class="p">}</code>
</pre></div>

</figure>


<p><b>PutProductsBackOnStockListener</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Listeners</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="k">use</code> <code class="nx">App\Events\UserCancelledOrderEvent</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="k">use</code> <code class="nx">Illuminate\Contracts\Queue\ShouldQueue</code><code class="p">;</code>
<code class="linenos"> 7 </code><code class="k">use</code> <code class="nx">Illuminate\Queue\InteractsWithQueue</code><code class="p">;</code>
<code class="linenos"> 8 </code><code class="k">use</code> <code class="nx">App\Services\StockManagerService</code><code class="p">;</code>
<code class="linenos"> 9 </code>
<code class="linenos">10 </code><code class="k">class</code> <code class="nc">PutProductsBackOnStockListener</code>
<code class="linenos">11 </code><code class="p">{</code>
<code class="linenos">12 </code>    <code class="sd">/**</code>
<code class="linenos">13 </code><code class="sd">     * Create the event listener.</code>
<code class="linenos">14 </code><code class="sd">     */</code>
<code class="linenos">15 </code>    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">()</code>
<code class="linenos">16 </code>    <code class="p">{</code>
<code class="linenos">17 </code>        <code class="c1">//</code>
<code class="linenos">18 </code>    <code class="p">}</code>
<code class="linenos">19 </code>
<code class="linenos">20 </code>    <code class="sd">/**</code>
<code class="linenos">21 </code><code class="sd">     * Handle the event.</code>
<code class="linenos">22 </code><code class="sd">     */</code>
<code class="linenos">23 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">handle</code><code class="p">(</code><code class="nx">UserCancelledOrderEvent</code> <code class="nv">$event</code><code class="p">)</code><code class="o">:</code> <code class="nx">void</code>
<code class="linenos">24 </code>    <code class="p">{</code>
<code class="linenos">25 </code>        <code class="p">(</code><code class="k">new</code> <code class="nx">StockManagerService</code><code class="p">(</code><code class="nv">$event</code><code class="o">-&gt;</code><code class="na">order</code><code class="p">))</code><code class="o">-&gt;</code><code class="na">addingProductInStock</code><code class="p">();</code>
<code class="linenos">26 </code>    <code class="p">}</code>
<code class="linenos">27 </code><code class="p">}</code>
</pre></div>

</figure>


<h2 id="leanpub-auto-cancelando-pedido-do-usurio" class="section">Cancelando pedido do usuário</h2>

<p>Vamos adicionar uma ação de cancelamento na tela de pedidos do usuário. Desta forma podemos adicionar o uso prático do cancelar e seus eventos.</p>

<p>Vamos adicionar o método que compete a ação do cancelar lá no <b>MyOrdersController</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">cancelOrder</code><code class="p">(</code><code class="n">Order</code> <code class="err">$</code><code class="n">order</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="nf">if</code><code class="p">(</code><code class="err">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">status</code> <code class="o">===</code> <code class="s">'CUSTOMER_CANCELLED'</code><code class="p">)</code> <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">back</code><code class="p">();</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="err">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">([</code><code class="s">'status'</code> <code class="o">=&gt;</code> <code class="s">'CUSTOMER_CANCELLED'</code><code class="p">]);</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="nf">event</code><code class="p">(</code><code class="n">new</code> <code class="n">UserCancelledOrderEvent</code><code class="p">(</code><code class="err">$</code><code class="n">order</code><code class="p">));</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'customers.my-orders'</code><code class="p">);</code>
<code class="linenos">10 </code><code class="p">}</code>
</pre></div>

</figure>


<p>O método acima está dentro do que já conhecemos até o momento. Um ponto que verifico aqui é: se o pedido já foi cancelado, nós impedimos o processar do cancelamento novamente.</p>

<p>Para controlar a autorização a esta ação, vamos gerar uma policy para controlar que somente o usuário que for dono do pedido pode cancelar seu próprio pedido. Algo que já vimos também e que é bem interessante aplicarmos aqui:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>php artisan make:policy OrderPolicy
</pre></div>

</figure>


<p>Segue a policy na íntegra e somente com o que precisamos:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Policies</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="k">use</code> <code class="nx">App\Models\Order</code><code class="p">;</code>
<code class="linenos"> 6 </code><code class="k">use</code> <code class="nx">App\Models\User</code><code class="p">;</code>
<code class="linenos"> 7 </code>
<code class="linenos"> 8 </code><code class="k">class</code> <code class="nc">OrderPolicy</code>
<code class="linenos"> 9 </code><code class="p">{</code>
<code class="linenos">10 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">update</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">,</code> <code class="nx">Order</code> <code class="nv">$order</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
<code class="linenos">11 </code>    <code class="p">{</code>
<code class="linenos">12 </code>        <code class="k">return</code> <code class="nv">$user</code><code class="o">-&gt;</code><code class="na">id</code> <code class="o">===</code> <code class="nv">$order</code><code class="o">-&gt;</code><code class="na">user_id</code><code class="p">;</code>
<code class="linenos">13 </code>    <code class="p">}</code>
<code class="linenos">14 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Lá no grupo de rotas da área de meus pedidos, adicione no grupo do customer o trecho de rota abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">Route</code><code class="p">::</code><code class="nd">put</code><code class="o">(</code><code class="s1">'my-orders/cancel/{order}'</code><code class="o">,</code> <code class="cp">[</code><code class="o">\</code><code class="nx">App</code><code class="o">\</code><code class="nx">Http</code><code class="o">\</code><code class="nx">Controllers</code><code class="o">\</code><code class="nx">Customer</code><code class="o">\</code><code class="nx">MyOrdersCont</code><code class="o">\</code>
<code class="linenos">2 </code><code class="nx">roller</code><code class="nl">::class</code><code class="p">,</code> <code class="s1">'cancelOrder'</code><code class="cp">]</code><code class="o">)</code>
<code class="linenos">3 </code>    <code class="nt">-</code><code class="o">&gt;</code><code class="nt">can</code><code class="o">(</code><code class="s1">'update'</code><code class="o">,</code> <code class="s1">'order'</code><code class="o">)</code>
<code class="linenos">4 </code>    <code class="nt">-</code><code class="o">&gt;</code><code class="nt">name</code><code class="o">(</code><code class="s1">'my-orders.cancel'</code><code class="o">);</code>
</pre></div>

</figure>


<p>A rota já conta com o controle de acesso pela policy de Order pra permissão(ability) update. Desta forma controlamos que somente o dono do pedido é que pode cancelar este pedido.</p>

<p>Por fim coloquei após a linha do total do pedido o trecho do form que irá executar a ação  de cancelar, isso na tela <b>my-orders.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">&lt;p</code> <code class="na">class=</code><code class="s">"flex justify-start items-start"</code><code class="nt">&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">{{</code><code class="nv">route</code><code class="o">(</code><code class="s1">'customers.my-orders.cancel'</code><code class="o">,</code> <code class="err">$</code><code class="nv">order</code><code class="o">)</code><code class="cp">}}</code><code class="s">"</code> <code class="na">method=</code><code class="s">"POST"</code><code class="nt">&gt;</code>
<code class="linenos">3 </code>        @method('PUT')
<code class="linenos">4 </code>        @csrf
<code class="linenos">5 </code>        <code class="nt">&lt;button</code> <code class="na">class=</code><code class="s">"px-4 py-2 rounded border border-red-900 bg-red-500 text-white\</code>
<code class="linenos">6 </code><code class="s">"</code><code class="nt">&gt;</code>CANCELAR<code class="nt">&lt;/button&gt;</code>
<code class="linenos">7 </code>    <code class="nt">&lt;/form&gt;</code>
<code class="linenos">8 </code><code class="nt">&lt;/p&gt;</code>
</pre></div>

</figure>


<p>Agora o usuário pode cancelar seus pedidos e assim temos um uso prático do processo do evento que retorna os itens pro estoque.</p>

<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----tela-pedidos-button-cancelar.png">
    <figcaption></figcaption>
  </figure>
</div>


<h2 id="leanpub-auto-pra-finalizar" class="section">Pra Finalizar</h2>

<p>Pra finalizarmos estes pontos vamos gerar um enumerator, vindo no PHP 8 e que você provavelmente já conhece. Apesar de podermos criar livremente um enumerator, temos um comando gerador para eles também dentro do framework.</p>

<p>Pra isso execute o comando abaixo:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="n">php</code> <code class="n">artisan</code> <code class="n">make</code><code class="p">:</code><code class="k">enum</code> <code class="n">Enums</code><code class="o">/</code><code class="n">OrderStatusEnum</code>
</pre></div>

</figure>


<p>Gerei nosso enumerator na pasta(namespace) <code>Enums</code>. Segue o conteúdo abaixo na íntegra de como nosso Enum deve ficar:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="cp">&lt;?php</code>
<code class="linenos"> 2 </code>
<code class="linenos"> 3 </code><code class="k">namespace</code> <code class="nx">App\Enums</code><code class="p">;</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code><code class="nx">enum</code> <code class="nx">OrderStatusEnum</code>
<code class="linenos"> 6 </code><code class="p">{</code>
<code class="linenos"> 7 </code>    <code class="k">case</code> <code class="nx">WAITING_PAYMENT</code><code class="p">;</code>
<code class="linenos"> 8 </code>    <code class="k">case</code> <code class="nx">CUSTOMER_CANCELLED</code><code class="p">;</code>
<code class="linenos"> 9 </code>    <code class="k">case</code> <code class="nx">PAYMENT_CONFIRMED</code><code class="p">;</code>
<code class="linenos">10 </code>
<code class="linenos">11 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">color</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
<code class="linenos">12 </code>    <code class="p">{</code>
<code class="linenos">13 </code>        <code class="k">return</code> <code class="nx">match</code><code class="p">(</code><code class="nv">$this</code><code class="p">)</code>
<code class="linenos">14 </code>        <code class="p">{</code>
<code class="linenos">15 </code>            <code class="nx">self</code><code class="o">::</code><code class="na">WAITING_PAYMENT</code> <code class="o">=&gt;</code> <code class="s1">'blue'</code><code class="p">,</code>
<code class="linenos">16 </code>            <code class="nx">self</code><code class="o">::</code><code class="na">CUSTOMER_CANCELLED</code> <code class="o">=&gt;</code> <code class="s1">'red'</code><code class="p">,</code>
<code class="linenos">17 </code>            <code class="nx">self</code><code class="o">::</code><code class="na">PAYMENT_CONFIRMED</code>  <code class="o">=&gt;</code> <code class="s1">'green'</code>
<code class="linenos">18 </code>        <code class="p">};</code>
<code class="linenos">19 </code>    <code class="p">}</code>
<code class="linenos">20 </code>
<code class="linenos">21 </code>    <code class="k">public</code> <code class="k">function</code> <code class="nf">status</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
<code class="linenos">22 </code>    <code class="p">{</code>
<code class="linenos">23 </code>        <code class="k">return</code> <code class="nx">match</code><code class="p">(</code><code class="nv">$this</code><code class="p">)</code>
<code class="linenos">24 </code>        <code class="p">{</code>
<code class="linenos">25 </code>            <code class="nx">self</code><code class="o">::</code><code class="na">WAITING_PAYMENT</code> <code class="o">=&gt;</code> <code class="s1">'Aguardando Pagamento'</code><code class="p">,</code>
<code class="linenos">26 </code>            <code class="nx">self</code><code class="o">::</code><code class="na">CUSTOMER_CANCELLED</code> <code class="o">=&gt;</code> <code class="s1">'Cancelado pelo Cliente'</code><code class="p">,</code>
<code class="linenos">27 </code>            <code class="nx">self</code><code class="o">::</code><code class="na">PAYMENT_CONFIRMED</code>  <code class="o">=&gt;</code> <code class="s1">'Pagamento Confirmado'</code>
<code class="linenos">28 </code>        <code class="p">};</code>
<code class="linenos">29 </code>    <code class="p">}</code>
<code class="linenos">30 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Resolvi usar esta estrutura para organizarmos nossos status do pedido e assim termos um ponto central para ser utilizado ao querermos exibir o status, com cor específica e etc.</p>

<h2 id="leanpub-auto-eloquent-casts" class="section">Eloquent Casts</h2>

<p>Dentro do model com Eloquent podemos utilizar um mecanismo chamado de model casts, estes casts nos ajudam a padronizarmos dados baseado nas colunas da tabela que o model gerencia, ao indicarmos a transformação do tipo ou formato do dado desta coluna.</p>

<p>Neste ponto quero apenas fazer o cast da coluna status com nosso enumerator, pra isso adicione o método abaixo no model <b>Order</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="nt">protected</code> <code class="nt">function</code> <code class="nt">casts</code><code class="o">():</code> <code class="nt">array</code>
<code class="linenos">2 </code><code class="p">{</code>
<code class="linenos">3 </code>    <code class="err">return</code> <code class="cp">[</code>
<code class="linenos">4 </code>        <code class="s1">'status'</code> <code class="o">=&gt;</code> <code class="nx">OrderStatusEnum</code><code class="nl">::class</code><code class="p">,</code>
<code class="linenos">5 </code>    <code class="cp">]</code><code class="p">;</code>
<code class="linenos">6 </code><code class="p">}</code>
</pre></div>

</figure>


<p>Não esqueça do import:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code>use App\Enums\OrderStatusEnum;
</pre></div>

</figure>


<p>Desta forma ao acessarmos os dados do pedido via model, a coluna status será o enumerator e não mais apenas uma string. Desta forma posso usar o valor real do status via <code>$order-&gt;status-&gt;name</code> ou mesmo pegar a cor desejada via <code>$order-&gt;status-&gt;color()</code> ou mesmo o nome pt_BR <code>$order-&gt;status-&gt;status()</code>.</p>

<p>Vamos alterar e adicionar alguns pontos baseados neste cast por Enum. Primeiro vamos adicionar a exibição do status na listagem de pedidos, coloquei o trecho abaixo logo após a exibição do código do pedido na view <b>my-orders.blade.php</b>:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code> <code class="nt">&lt;p&gt;</code>
<code class="linenos">2 </code>    <code class="nt">&lt;strong</code> <code class="na">class=</code><code class="s">"text-purple-900"</code><code class="nt">&gt;</code>Status: <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"text-</code><code class="cp">{{</code><code class="err">$</code><code class="nv">order-</code><code class="o">&gt;</code><code class="nv">status-</code><code class="o">&gt;</code><code class="nv">colo</code><code class="err">\</code>
<code class="linenos">3 </code><code class="nv">r</code><code class="o">()</code><code class="cp">}}</code><code class="s">-800"</code><code class="nt">&gt;</code><code class="cp">{{</code><code class="err">$</code><code class="nv">order-</code><code class="o">&gt;</code><code class="nv">status-</code><code class="o">&gt;</code><code class="nv">status</code><code class="o">()</code><code class="cp">}}</code><code class="nt">&lt;/span&gt;&lt;/strong&gt;</code>
<code class="linenos">4 </code><code class="nt">&lt;/p&gt;</code>
</pre></div>

</figure>


<p>Outra alteração nesta tela também é: ocultar a exibição do botão de cancelar se o pedido já foi cancelado. Segue o trecho completo com a condicional:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="p">@</code><code class="k">if</code><code class="p">(</code><code class="n">$order</code><code class="o">-&gt;</code><code class="n">status</code><code class="o">-&gt;</code><code class="n">name</code> <code class="o">!==</code> <code class="err">'</code><code class="n">CUSTOMER_CANCELLED</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="o">&lt;</code><code class="n">p</code> <code class="k">class</code><code class="o">=</code><code class="s">"flex justify-start items-start"</code><code class="o">&gt;</code>
<code class="linenos"> 3 </code>    <code class="o">&lt;</code><code class="n">form</code> <code class="n">action</code><code class="o">=</code><code class="s">"{{route('customers.my-orders.cancel', $order)}}"</code> <code class="n">method</code><code class="o">=</code><code class="s">"POST"</code><code class="o">&gt;</code>
<code class="linenos"> 4 </code>        <code class="p">@</code><code class="n">method</code><code class="p">(</code><code class="err">'</code><code class="n">PUT</code><code class="err">'</code><code class="p">)</code>
<code class="linenos"> 5 </code>        <code class="p">@</code><code class="n">csrf</code>
<code class="linenos"> 6 </code>        <code class="o">&lt;</code><code class="n">button</code> <code class="k">class</code><code class="o">=</code><code class="s">"px-4 py-2 rounded border border-red-900 bg-red-500 text-white\</code>
<code class="linenos"> 7 </code><code class="s">"</code><code class="o">&gt;</code><code class="n">CANCELAR</code><code class="o">&lt;/</code><code class="n">button</code><code class="o">&gt;</code>
<code class="linenos"> 8 </code>    <code class="o">&lt;/</code><code class="n">form</code><code class="o">&gt;</code>
<code class="linenos"> 9 </code><code class="o">&lt;/</code><code class="n">p</code><code class="o">&gt;</code>
<code class="linenos">10 </code><code class="p">@</code><code class="n">endif</code>
</pre></div>

</figure>


<p>Por fim, como temos um enumerator ao acessarmos o status, vamos só alterar nossa condicional no método de cancelar pedido lá do <code>MyOrdersController</code>:</p>

<p>O que está assim:</p>

<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">status</code> <code class="o">===</code> <code class="s">'CUSTOMER_CANCELLED'</code>
</pre></div>

</figure>


<p>fica assim:</p>

<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos">1 </code><code class="err">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">status</code><code class="o">-&gt;</code><code class="n">name</code> <code class="o">===</code> <code class="s">'CUSTOMER_CANCELLED'</code>
</pre></div>

</figure>


<p>método na íntegra:</p>


<figure class="code " dir="ltr">
  <figcaption></figcaption>
  <div class="highlight"><pre><code></code><code class="linenos"> 1 </code><code class="n">public</code> <code class="kr">function</code> <code class="n">cancelOrder</code><code class="p">(</code><code class="n">Order</code> <code class="err">$</code><code class="n">order</code><code class="p">)</code>
<code class="linenos"> 2 </code><code class="p">{</code>
<code class="linenos"> 3 </code>    <code class="nf">if</code><code class="p">(</code><code class="err">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">status</code><code class="o">-&gt;</code><code class="n">name</code> <code class="o">===</code> <code class="s">'CUSTOMER_CANCELLED'</code><code class="p">)</code> <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">back</code><code class="p">();</code>
<code class="linenos"> 4 </code>
<code class="linenos"> 5 </code>    <code class="err">$</code><code class="n">order</code><code class="o">-&gt;</code><code class="n">update</code><code class="p">([</code><code class="s">'status'</code> <code class="o">=&gt;</code> <code class="s">'CUSTOMER_CANCELLED'</code><code class="p">]);</code>
<code class="linenos"> 6 </code>
<code class="linenos"> 7 </code>    <code class="nf">event</code><code class="p">(</code><code class="n">new</code> <code class="n">UserCancelledOrderEvent</code><code class="p">(</code><code class="err">$</code><code class="n">order</code><code class="p">));</code>
<code class="linenos"> 8 </code>
<code class="linenos"> 9 </code>    <code class="kr">return</code> <code class="n">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">route</code><code class="p">(</code><code class="s">'customers.my-orders'</code><code class="p">);</code>
<code class="linenos">10 </code><code class="p">}</code>
</pre></div>

</figure>


<div class="figure-wrapper center">
  <figure class="image block">
    <img alt="" src="resources/.----images----pedidos-pos-enum.png">
    <figcaption></figcaption>
  </figure>
</div>


<h2 id="leanpub-auto-concluses-13" class="section">Conclusões</h2>

<p>Assim concluímos nossa jornada aqui neste projeto!</p>

<p>Espero de coração que você tenha aproveitado bastante e espero ter te dado um excelente visão, desde o ínicio, do trabalho com framework Laravel e também na prática que eu tenha conseguido te passar a visão de negócio baseada no projeto!</p>

<p>Claro que o projeto aqui não é algo pra se descartar mas também está longe de ser uma loja com toda a infra a lá Amazon por exemplo mas o que vimos aqui já te ajudará a entender a lógica central de sistemas como esse e claro, continue sua jornada pois o framework ainda pode te proporcionar muita produtividade em áreas como Filas, Websocket, Cache e muito mais!</p>

<p>Desejo muito sucesso e até mais!!</p>


<h1 id="leanpub-auto-continue-em-contato-conosco" class="chapter">Continue em contato conosco</h1>

<p>Continue em contato conosco e se especializando com a Code Experts, temos diversos cursos na área de desenvolvimento web com PHP e frameworks focando totalmente em prática como você pode acompanhar aqui neste livro.</p>

<p>Se você gosta de aprender colocando a mão na massa acesse já <a href="https://codeexperts.com.br">codeexperts.com.br</a>.</p>

<p>Mais uma vez obrigado e meu sinceros de desejo de sucesso sempre!</p>

<p>Venha fazer parte dos nossos grupos no Telegram e Facebook: </p>

<ul>
  <li>Telegram: <a href="t.me/CodeExpertsCursos">http://t.me/CodeExpertsCursos</a>;</li>
  <li>Conheça nosso canal no Youtube: [http://youtube.com/@codeexperts]</li>
</ul>

<p>Obrigado! </p>

<p>Sucesso!</p>

</div>
</body>
</html>
